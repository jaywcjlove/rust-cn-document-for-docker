<!DOCTYPE HTML>
<html lang="zh" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Rust Cookbook 中文版 - A Rust Cookbook</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="rust cookbook 中文版, Rust 实践指南, Rust 实例示例, Rust 编程实战, Rust crate 生态实践, Rust crate 集成应用">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <link rel="stylesheet" href="css/custom.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="intro.html">总览</a></li><li class="chapter-item expanded affix "><a href="about.html">关于本书</a></li><li class="chapter-item expanded "><a href="algorithms.html"><strong aria-hidden="true">1.</strong> 算法</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="algorithms/randomness.html"><strong aria-hidden="true">1.1.</strong> 生成随机值</a></li><li class="chapter-item expanded "><a href="algorithms/sorting.html"><strong aria-hidden="true">1.2.</strong> Vector 排序</a></li></ol></li><li class="chapter-item expanded "><a href="cli.html"><strong aria-hidden="true">2.</strong> 命令行</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cli/arguments.html"><strong aria-hidden="true">2.1.</strong> 参数解析</a></li><li class="chapter-item expanded "><a href="cli/ansi_terminal.html"><strong aria-hidden="true">2.2.</strong> ANSI 终端</a></li></ol></li><li class="chapter-item expanded "><a href="compression.html"><strong aria-hidden="true">3.</strong> 压缩</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="compression/tar.html"><strong aria-hidden="true">3.1.</strong> 使用 tar 包</a></li></ol></li><li class="chapter-item expanded "><a href="concurrency.html"><strong aria-hidden="true">4.</strong> 并发/并行</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="concurrency/threads.html"><strong aria-hidden="true">4.1.</strong> 显式线程</a></li><li class="chapter-item expanded "><a href="concurrency/parallel.html"><strong aria-hidden="true">4.2.</strong> 数据并行</a></li></ol></li><li class="chapter-item expanded "><a href="cryptography.html"><strong aria-hidden="true">5.</strong> 密码学</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cryptography/hashing.html"><strong aria-hidden="true">5.1.</strong> 散列（哈希）</a></li><li class="chapter-item expanded "><a href="cryptography/encryption.html"><strong aria-hidden="true">5.2.</strong> 加密</a></li></ol></li><li class="chapter-item expanded "><a href="data_structures.html"><strong aria-hidden="true">6.</strong> 数据结构</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="data_structures/bitfield.html"><strong aria-hidden="true">6.1.</strong> 位域</a></li></ol></li><li class="chapter-item expanded "><a href="database.html"><strong aria-hidden="true">7.</strong> 数据库</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="database/sqlite.html"><strong aria-hidden="true">7.1.</strong> SQLite</a></li><li class="chapter-item expanded "><a href="database/postgres.html"><strong aria-hidden="true">7.2.</strong> Postgres</a></li></ol></li><li class="chapter-item expanded "><a href="datetime.html"><strong aria-hidden="true">8.</strong> 日期及时间</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="datetime/duration.html"><strong aria-hidden="true">8.1.</strong> 期间和计算</a></li><li class="chapter-item expanded "><a href="datetime/parse.html"><strong aria-hidden="true">8.2.</strong> 解析与显示</a></li></ol></li><li class="chapter-item expanded "><a href="development_tools.html"><strong aria-hidden="true">9.</strong> 开发工具</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="development_tools/debugging.html"><strong aria-hidden="true">9.1.</strong> 调试工具</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="development_tools/debugging/log.html"><strong aria-hidden="true">9.1.1.</strong> 日志信息</a></li><li class="chapter-item expanded "><a href="development_tools/debugging/config_log.html"><strong aria-hidden="true">9.1.2.</strong> 日志配置</a></li></ol></li><li class="chapter-item expanded "><a href="development_tools/versioning.html"><strong aria-hidden="true">9.2.</strong> 版本控制</a></li><li class="chapter-item expanded "><a href="development_tools/build_tools.html"><strong aria-hidden="true">9.3.</strong> 构建工具</a></li></ol></li><li class="chapter-item expanded "><a href="encoding.html"><strong aria-hidden="true">10.</strong> 编码</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="encoding/strings.html"><strong aria-hidden="true">10.1.</strong> 字符集</a></li><li class="chapter-item expanded "><a href="encoding/csv.html"><strong aria-hidden="true">10.2.</strong> CSV 处理</a></li><li class="chapter-item expanded "><a href="encoding/complex.html"><strong aria-hidden="true">10.3.</strong> 结构化数据</a></li></ol></li><li class="chapter-item expanded "><a href="errors.html"><strong aria-hidden="true">11.</strong> 错误处理</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="errors/handle.html"><strong aria-hidden="true">11.1.</strong> 处理错误变量</a></li></ol></li><li class="chapter-item expanded "><a href="file.html"><strong aria-hidden="true">12.</strong> 文件系统</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="file/read-write.html"><strong aria-hidden="true">12.1.</strong> 文件读写</a></li><li class="chapter-item expanded "><a href="file/dir.html"><strong aria-hidden="true">12.2.</strong> 目录遍历</a></li></ol></li><li class="chapter-item expanded "><a href="hardware.html"><strong aria-hidden="true">13.</strong> 硬件支持</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="hardware/processor.html"><strong aria-hidden="true">13.1.</strong> 处理器</a></li></ol></li><li class="chapter-item expanded "><a href="mem.html"><strong aria-hidden="true">14.</strong> 内存管理</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="mem/global_static.html"><strong aria-hidden="true">14.1.</strong> 全局静态/全局堆栈</a></li></ol></li><li class="chapter-item expanded "><a href="net.html"><strong aria-hidden="true">15.</strong> 网络</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="net/server.html"><strong aria-hidden="true">15.1.</strong> 服务器</a></li></ol></li><li class="chapter-item expanded "><a href="os.html"><strong aria-hidden="true">16.</strong> 操作系统</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="os/external.html"><strong aria-hidden="true">16.1.</strong> 外部命令</a></li></ol></li><li class="chapter-item expanded "><a href="science.html"><strong aria-hidden="true">17.</strong> 科学计算</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="science/mathematics.html"><strong aria-hidden="true">17.1.</strong> 数学</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="science/mathematics/linear_algebra.html"><strong aria-hidden="true">17.1.1.</strong> 线性代数</a></li><li class="chapter-item expanded "><a href="science/mathematics/trigonometry.html"><strong aria-hidden="true">17.1.2.</strong> 三角学</a></li><li class="chapter-item expanded "><a href="science/mathematics/complex_numbers.html"><strong aria-hidden="true">17.1.3.</strong> 复数</a></li><li class="chapter-item expanded "><a href="science/mathematics/statistics.html"><strong aria-hidden="true">17.1.4.</strong> 统计学</a></li><li class="chapter-item expanded "><a href="science/mathematics/miscellaneous.html"><strong aria-hidden="true">17.1.5.</strong> 其它数学计算</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="text.html"><strong aria-hidden="true">18.</strong> 文本处理</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="text/regex.html"><strong aria-hidden="true">18.1.</strong> 正则表达式</a></li><li class="chapter-item expanded "><a href="text/string_parsing.html"><strong aria-hidden="true">18.2.</strong> 字符串解析</a></li></ol></li><li class="chapter-item expanded "><a href="web.html"><strong aria-hidden="true">19.</strong> Web 编程</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="web/scraping.html"><strong aria-hidden="true">19.1.</strong> 提取链接</a></li><li class="chapter-item expanded "><a href="web/url.html"><strong aria-hidden="true">19.2.</strong> URL</a></li><li class="chapter-item expanded "><a href="web/mime.html"><strong aria-hidden="true">19.3.</strong> 媒介类型</a></li><li class="chapter-item expanded "><a href="web/clients.html"><strong aria-hidden="true">19.4.</strong> 客户端</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="web/clients/requests.html"><strong aria-hidden="true">19.4.1.</strong> 请求处理</a></li><li class="chapter-item expanded "><a href="web/clients/apis.html"><strong aria-hidden="true">19.4.2.</strong> Web API 调用</a></li><li class="chapter-item expanded "><a href="web/clients/download.html"><strong aria-hidden="true">19.4.3.</strong> 下载</a></li><li class="spacer"></li></ol></li></ol></li></ol>

                <div style="text-align: center; margin-bottom: 10px;">
                    <a href="https://budshome.com/books.html" target="_blank">
                        <img src="css/summary.jpg">
                    </a>
                </div>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Rust Cookbook 中文版 - A Rust Cookbook</h1>

                    <div class="right-buttons">
                        <a href="https://budshome.com/books.html" target="_blank" title="返回书馆" aria-label="返回书馆">
                            <span>书馆</span>
                        </a>
                        
                        <a href="https://github.com/zzy/rust-cookbook-zh-cn" target="_blank" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <script type="text/javascript" src="//static.budshome.com/js/bdutop.js"></script>
                    
                    <main>
                        <h1><a class="header" href="#rust-cookbook-中文版" id="rust-cookbook-中文版">Rust Cookbook 中文版</a></h1>
<!--
> [intro.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/intro.md)
> <br />
> commit - a79932c9a624fd17977eaea5df3d5a9600d014f6 - 2018.12.05
-->
<p>《Rust Cookbook 中文版》是 Rust 程序设计语言（<a href="https://rust-lang.budshome.com">Rust 2018 简体中文版文档</a>）的简要实例示例集合：展示了在 Rust 生态系统中，使用各类 crate 来完成常见编程任务的良好实践。</p>
<p>了解更多关于《Rust Cookbook 中文版》一书的信息，请阅读<a href="about.html">关于本书</a>，包括：如何阅读本书的提示、如何使用实例示例，以及关于注释的约定。</p>
<blockquote>
<p>注1：《Rust Cookbook 中文版》翻译自 rust-lang-nursery 团队撰写的 <em>“A Rust Cookbook”</em>，感谢 rust-lang-nursery 团队的无私奉献！</p>
</blockquote>
<blockquote>
<p>注2：《Rust Cookbook 中文版》计划为两个阶段：<br>
第一阶段：经仔细斟酌，形成专业、通俗、容易理解的 Rust 生态实践指南中文版本；<br>
第二阶段：对书中代码进行详细讲解，在实际应用场景中对 Rust 生态 crate 进行分析、比较，以及拓展。<br>
目前，第一阶段已经完成，并且和 rust-lang-nursery 团队项目同步更新。<br>
第二阶段正在进行中，但可能需要另开一个开源项目，欢迎参与。<br></p>
</blockquote>
<pre><code>欢迎您提出宝贵意见：linshi@budshome.com，budshome（个人微信），晨曦中（微信公众号）。
</code></pre>
<h2><a class="header" href="#做贡献" id="做贡献">做贡献</a></h2>
<p>《Rust Cookbook 中文版》的目的是让 Rust 程序员新手能够更容易地参与到 Rust 社区中，因此欢迎你做出贡献。</p>
<h3><a class="header" href="#构建和测试" id="构建和测试">构建和测试</a></h3>
<p>首先，从 git 克隆《Rust Cookbook 中文版》并进入目录：</p>
<pre><code>git clone https://github.com/zzy/rust-cookbook-zh-cn.git
cd rust-cookbook-zh-cn
</code></pre>
<p>《Rust Cookbook 中文版》使用 <code>mdBook</code>（<a href="https://mdbook.budshome.com">中文文档</a>）构建，所以需要通过 <code>Cargo</code>（<a href="https://cargo.budshome.com">中文文档</a>）安装它：</p>
<pre><code>cargo install --version 0.3.5 mdbook
</code></pre>
<p>若要在本地生成和阅读《Rust Cookbook 中文版》，请运行：</p>
<pre><code>mdbook serve
</code></pre>
<p>然后在浏览器中打开 <code>http://localhost:3000</code>，即可阅读本书。对源代码所做的任何更改都将自动重新生成页面，并会主动刷新浏览器，因此在编辑源码时打开浏览器窗口是很有帮助的。</p>
<p>书中的所有实例都是使用 <a href="https://github.com/brson/rust-skeptic">skeptic</a> 测试的，它是测试任意 markdown 文档的工具，风格类似于 rustdoc。</p>
<p>提交前，请对整个仓库进行测试：</p>
<pre><code>cargo test
</code></pre>
<p>祝你学习愉快，欢迎提交问题，欢迎发送 PR。</p>
<h1><a class="header" href="#算法" id="算法">算法</a></h1>
<!--
> [algorithms.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/algorithms.md)
> <br />
> commit - 2eee7043988e4289f16b5deca9f3b36e2516362b - 2020.04.18
-->
<h2><a class="header" href="#生成随机值" id="生成随机值">生成随机值</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="algorithms/randomness.html#%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0">生成随机数</a></td><td><a href="https://docs.rs/rand/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand" alt="rand-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="algorithms/randomness.html#%E7%94%9F%E6%88%90%E8%8C%83%E5%9B%B4%E5%86%85%E9%9A%8F%E6%9C%BA%E6%95%B0">生成范围内随机数</a></td><td><a href="https://docs.rs/rand/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand" alt="rand-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="algorithms/randomness.html#%E7%94%9F%E6%88%90%E7%BB%99%E5%AE%9A%E5%88%86%E5%B8%83%E9%9A%8F%E6%9C%BA%E6%95%B0">生成给定分布随机数</a></td><td><a href="https://docs.rs/rand/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand" alt="rand-badge" /></a> <a href="https://docs.rs/rand_distr/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand_distr" alt="rand_distr-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="algorithms/randomness.html#%E7%94%9F%E6%88%90%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B%E9%9A%8F%E6%9C%BA%E5%80%BC">生成自定义类型随机值</a></td><td><a href="https://docs.rs/rand/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand" alt="rand-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="algorithms/randomness.html#%E4%BB%8E%E4%B8%80%E7%BB%84%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97%E5%AD%97%E7%AC%A6%E5%88%9B%E5%BB%BA%E9%9A%8F%E6%9C%BA%E5%AF%86%E7%A0%81">从一组字母数字字符创建随机密码</a></td><td><a href="https://docs.rs/rand/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand" alt="rand-badge" /></a></td><td><a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a></td></tr>
<tr><td><a href="algorithms/randomness.html#%E4%BB%8E%E4%B8%80%E7%BB%84%E7%94%A8%E6%88%B7%E5%AE%9A%E4%B9%89%E5%AD%97%E7%AC%A6%E5%88%9B%E5%BB%BA%E9%9A%8F%E6%9C%BA%E5%AF%86%E7%A0%81">从一组用户定义字符创建随机密码</a></td><td><a href="https://docs.rs/rand/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand" alt="rand-badge" /></a></td><td><a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#vector-排序" id="vector-排序">Vector 排序</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="algorithms/sorting.html#%E6%95%B4%E6%95%B0-vector-%E6%8E%92%E5%BA%8F">整数 Vector 排序</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="algorithms/sorting.html#%E6%B5%AE%E7%82%B9%E6%95%B0-vector-%E6%8E%92%E5%BA%8F">浮点数 Vector 排序</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="algorithms/sorting.html#%E7%BB%93%E6%9E%84%E4%BD%93-vector-%E6%8E%92%E5%BA%8F">结构体 Vector 排序</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#命令行" id="命令行">命令行</a></h1>
<!--
> [cli.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/cli.md)
> <br />
> commit - d4e44638ee8b87bb49459980e4eebd3a1d7463c8 - 2018.10.03
-->
<h2><a class="header" href="#参数解析" id="参数解析">参数解析</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="cli/arguments.html#%E8%A7%A3%E6%9E%90%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0">解析命令行参数</a></td><td><a href="https://docs.rs/clap/"><img src="https://badge-cache.kominick.com/crates/v/clap.svg?label=clap" alt="clap-badge" /></a></td><td><a href="https://crates.io/categories/command-line-interface"><img src="https://badge-cache.kominick.com/badge/command_line--x.svg?style=social" alt="cat-command-line-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#ansi-终端" id="ansi-终端">ANSI 终端</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="cli/ansi_terminal.html#ansi-%E7%BB%88%E7%AB%AF">ANSI 终端</a></td><td><a href="https://docs.rs/ansi_term/"><img src="https://badge-cache.kominick.com/crates/v/base64.svg?label=ansi_term" alt="ansi_term-badge" /></a></td><td><a href="https://crates.io/categories/command-line-interface"><img src="https://badge-cache.kominick.com/badge/command_line--x.svg?style=social" alt="cat-command-line-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#压缩" id="压缩">压缩</a></h1>
<!--
> [compression.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/compression.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#使用-tar-包" id="使用-tar-包">使用 tar 包</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="compression/tar.html#%E8%A7%A3%E5%8E%8B-tar-%E5%8C%85">解压 tar 包</a></td><td><a href="https://docs.rs/flate2/"><img src="https://badge-cache.kominick.com/crates/v/flate2.svg?label=flate2" alt="flate2-badge" /></a> <a href="https://docs.rs/tar/"><img src="https://badge-cache.kominick.com/crates/v/tar.svg?label=tar" alt="tar-badge" /></a></td><td><a href="https://crates.io/categories/compression"><img src="https://badge-cache.kominick.com/badge/compression--x.svg?style=social" alt="cat-compression-badge" /></a></td></tr>
<tr><td><a href="compression/tar.html#%E5%8E%8B%E7%BC%A9%E7%9B%AE%E5%BD%95%E4%B8%BA-tar-%E5%8C%85">压缩目录为 tar 包</a></td><td><a href="https://docs.rs/flate2/"><img src="https://badge-cache.kominick.com/crates/v/flate2.svg?label=flate2" alt="flate2-badge" /></a> <a href="https://docs.rs/tar/"><img src="https://badge-cache.kominick.com/crates/v/tar.svg?label=tar" alt="tar-badge" /></a></td><td><a href="https://crates.io/categories/compression"><img src="https://badge-cache.kominick.com/badge/compression--x.svg?style=social" alt="cat-compression-badge" /></a></td></tr>
<tr><td><a href="compression/tar.html#%E4%BB%8E%E8%B7%AF%E5%BE%84%E7%A7%BB%E9%99%A4%E5%89%8D%E7%BC%80%E6%97%B6%E8%A7%A3%E5%8E%8B-tar-%E5%8C%85">从路径移除前缀时，解压 tar 包</a></td><td><a href="https://docs.rs/flate2/"><img src="https://badge-cache.kominick.com/crates/v/flate2.svg?label=flate2" alt="flate2-badge" /></a> <a href="https://docs.rs/tar/"><img src="https://badge-cache.kominick.com/crates/v/tar.svg?label=tar" alt="tar-badge" /></a></td><td><a href="https://crates.io/categories/compression"><img src="https://badge-cache.kominick.com/badge/compression--x.svg?style=social" alt="cat-compression-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#并发并行" id="并发并行">并发/并行</a></h1>
<!--
> [concurrency.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/concurrency.md)
> <br />
> commit 3c32c84475a2d99aa1d1b2d5d2e480aeada47293 - 2020.06.07
-->
<h2><a class="header" href="#显式线程" id="显式线程">显式线程</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="concurrency/threads.html#%E7%94%9F%E6%88%90%E7%9F%AD%E6%9C%9F%E7%BA%BF%E7%A8%8B">生成短期线程</a></td><td><a href="https://docs.rs/crossbeam/"><img src="https://badge-cache.kominick.com/crates/v/crossbeam.svg?label=crossbeam" alt="crossbeam-badge" /></a></td><td><a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a></td></tr>
<tr><td><a href="concurrency/threads.html#%E5%88%9B%E5%BB%BA%E5%B9%B6%E5%8F%91%E7%9A%84%E6%95%B0%E6%8D%AE%E7%AE%A1%E9%81%93">创建并发的数据管道</a></td><td><a href="https://docs.rs/crossbeam/"><img src="https://badge-cache.kominick.com/crates/v/crossbeam.svg?label=crossbeam" alt="crossbeam-badge" /></a></td><td><a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a></td></tr>
<tr><td><a href="concurrency/threads.html#%E5%9C%A8%E4%B8%A4%E4%B8%AA%E7%BA%BF%E7%A8%8B%E9%97%B4%E4%BC%A0%E9%80%92%E6%95%B0%E6%8D%AE">在两个线程间传递数据</a></td><td><a href="https://docs.rs/crossbeam/"><img src="https://badge-cache.kominick.com/crates/v/crossbeam.svg?label=crossbeam" alt="crossbeam-badge" /></a></td><td><a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a></td></tr>
<tr><td><a href="concurrency/threads.html#%E4%BF%9D%E6%8C%81%E5%85%A8%E5%B1%80%E5%8F%AF%E5%8F%98%E7%8A%B6%E6%80%81">保持全局可变状态</a></td><td><a href="https://docs.rs/lazy_static/"><img src="https://badge-cache.kominick.com/crates/v/lazy_static.svg?label=lazy_static" alt="lazy_static-badge" /></a></td><td><a href="https://crates.io/categories/rust-patterns"><img src="https://badge-cache.kominick.com/badge/rust_patterns--x.svg?style=social" alt="cat-rust-patterns-badge" /></a></td></tr>
<tr><td><a href="concurrency/threads.html#%E5%AF%B9%E6%89%80%E6%9C%89-iso-%E6%96%87%E4%BB%B6%E7%9A%84-sha256-%E5%80%BC%E5%B9%B6%E5%8F%91%E6%B1%82%E5%92%8C">对所有 iso 文件的 SHA256 值并发求和</a></td><td><a href="https://docs.rs/threadpool/"><img src="https://badge-cache.kominick.com/crates/v/threadpool.svg?label=threadpool" alt="threadpool-badge" /></a> <a href="https://docs.rs/walkdir/"><img src="https://badge-cache.kominick.com/crates/v/walkdir.svg?label=walkdir" alt="walkdir-badge" /></a> <a href="https://docs.rs/num_cpus/"><img src="https://badge-cache.kominick.com/crates/v/num_cpus.svg?label=num_cpus" alt="num_cpus-badge" /></a> <a href="https://briansmith.org/rustdoc/ring/"><img src="https://badge-cache.kominick.com/crates/v/ring.svg?label=ring" alt="ring-badge" /></a></td><td><a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
<tr><td><a href="concurrency/threads.html#%E5%B0%86%E7%BB%98%E5%88%B6%E5%88%86%E5%BD%A2%E7%9A%84%E7%BA%BF%E7%A8%8B%E5%88%86%E6%B4%BE%E5%88%B0%E7%BA%BF%E7%A8%8B%E6%B1%A0">将绘制分形的线程分派到线程池</a></td><td><a href="https://docs.rs/threadpool/"><img src="https://badge-cache.kominick.com/crates/v/threadpool.svg?label=threadpool" alt="threadpool-badge" /></a> <a href="https://docs.rs/num/"><img src="https://badge-cache.kominick.com/crates/v/num.svg?label=num" alt="num-badge" /></a> <a href="https://docs.rs/num_cpus/"><img src="https://badge-cache.kominick.com/crates/v/num_cpus.svg?label=num_cpus" alt="num_cpus-badge" /></a> <a href="https://docs.rs/image/"><img src="https://badge-cache.kominick.com/crates/v/image.svg?label=image" alt="image-badge" /></a></td><td><a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a><a href="https://crates.io/categories/rendering"><img src="https://badge-cache.kominick.com/badge/rendering--x.svg?style=social" alt="cat-rendering-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#数据并行" id="数据并行">数据并行</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="concurrency/parallel.html#%E5%B9%B6%E8%A1%8C%E6%94%B9%E5%8F%98%E6%95%B0%E7%BB%84%E4%B8%AD%E5%85%83%E7%B4%A0">并行改变数组中元素</a></td><td><a href="https://docs.rs/rayon/"><img src="https://badge-cache.kominick.com/crates/v/rayon.svg?label=rayon" alt="rayon-badge" /></a></td><td><a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a></td></tr>
<tr><td><a href="concurrency/parallel.html#%E5%B9%B6%E8%A1%8C%E6%B5%8B%E8%AF%95%E9%9B%86%E5%90%88%E4%B8%AD%E4%BB%BB%E6%84%8F%E6%88%96%E6%89%80%E6%9C%89%E7%9A%84%E5%85%83%E7%B4%A0%E6%98%AF%E5%90%A6%E5%8C%B9%E9%85%8D%E7%BB%99%E5%AE%9A%E6%96%AD%E8%A8%80">并行测试集合中任意或所有的元素是否匹配给定断言</a></td><td><a href="https://docs.rs/rayon/"><img src="https://badge-cache.kominick.com/crates/v/rayon.svg?label=rayon" alt="rayon-badge" /></a></td><td><a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a></td></tr>
<tr><td><a href="concurrency/parallel.html#%E4%BD%BF%E7%94%A8%E7%BB%99%E5%AE%9A%E6%96%AD%E8%A8%80%E5%B9%B6%E8%A1%8C%E6%90%9C%E7%B4%A2%E9%A1%B9">使用给定断言并行搜索项</a></td><td><a href="https://docs.rs/rayon/"><img src="https://badge-cache.kominick.com/crates/v/rayon.svg?label=rayon" alt="rayon-badge" /></a></td><td><a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a></td></tr>
<tr><td><a href="concurrency/parallel.html#%E5%AF%B9-vector-%E5%B9%B6%E8%A1%8C%E6%8E%92%E5%BA%8F">对 vector 并行排序</a></td><td><a href="https://docs.rs/rayon/"><img src="https://badge-cache.kominick.com/crates/v/rayon.svg?label=rayon" alt="rayon-badge" /></a> <a href="https://docs.rs/rand/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand" alt="rand-badge" /></a></td><td><a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a></td></tr>
<tr><td><a href="concurrency/parallel.html#map-reduce-%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97">Map-reduce 并行计算</a></td><td><a href="https://docs.rs/rayon/"><img src="https://badge-cache.kominick.com/crates/v/rayon.svg?label=rayon" alt="rayon-badge" /></a></td><td><a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a></td></tr>
<tr><td><a href="concurrency/parallel.html#%E5%B9%B6%E8%A1%8C%E7%94%9F%E6%88%90-jpg-%E7%BC%A9%E7%95%A5%E5%9B%BE">并行生成 jpg 缩略图</a></td><td><a href="https://docs.rs/rayon/"><img src="https://badge-cache.kominick.com/crates/v/rayon.svg?label=rayon" alt="rayon-badge" /></a> <a href="https://docs.rs/glob/"><img src="https://badge-cache.kominick.com/crates/v/glob.svg?label=glob" alt="glob-badge" /></a> <a href="https://docs.rs/image/"><img src="https://badge-cache.kominick.com/crates/v/image.svg?label=image" alt="image-badge" /></a></td><td><a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#密码学" id="密码学">密码学</a></h1>
<!--
> [cryptography.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/cryptography.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#散列哈希" id="散列哈希">散列（哈希）</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="cryptography/hashing.html#%E8%AE%A1%E7%AE%97%E6%96%87%E4%BB%B6%E7%9A%84-sha-256-%E6%91%98%E8%A6%81">计算文件的 SHA-256 摘要</a></td><td><a href="https://briansmith.org/rustdoc/ring/"><img src="https://badge-cache.kominick.com/crates/v/ring.svg?label=ring" alt="ring-badge" /></a> <a href="https://docs.rs/data-encoding/"><img src="https://badge-cache.kominick.com/crates/v/data-encoding.svg?label=data-encoding" alt="data-encoding-badge" /></a></td><td><a href="https://crates.io/categories/cryptography"><img src="https://badge-cache.kominick.com/badge/cryptography--x.svg?style=social" alt="cat-cryptography-badge" /></a></td></tr>
<tr><td><a href="cryptography/hashing.html#%E4%BD%BF%E7%94%A8-hmac-%E6%91%98%E8%A6%81%E5%AF%B9%E6%B6%88%E6%81%AF%E8%BF%9B%E8%A1%8C%E7%AD%BE%E5%90%8D%E5%92%8C%E9%AA%8C%E8%AF%81">使用 HMAC 摘要对消息进行签名和验证</a></td><td><a href="https://briansmith.org/rustdoc/ring/"><img src="https://badge-cache.kominick.com/crates/v/ring.svg?label=ring" alt="ring-badge" /></a></td><td><a href="https://crates.io/categories/cryptography"><img src="https://badge-cache.kominick.com/badge/cryptography--x.svg?style=social" alt="cat-cryptography-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#加密" id="加密">加密</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="cryptography/encryption.html#%E4%BD%BF%E7%94%A8-pbkdf2-%E5%AF%B9%E5%AF%86%E7%A0%81%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86salt%E5%92%8C%E6%95%A3%E5%88%97hash%E8%BF%90%E7%AE%97">使用 PBKDF2 对密码进行加密（salt）和散列（hash）运算</a></td><td><a href="https://briansmith.org/rustdoc/ring/"><img src="https://badge-cache.kominick.com/crates/v/ring.svg?label=ring" alt="ring-badge" /></a> <a href="https://docs.rs/data-encoding/"><img src="https://badge-cache.kominick.com/crates/v/data-encoding.svg?label=data-encoding" alt="data-encoding-badge" /></a></td><td><a href="https://crates.io/categories/cryptography"><img src="https://badge-cache.kominick.com/badge/cryptography--x.svg?style=social" alt="cat-cryptography-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#数据结构" id="数据结构">数据结构</a></h1>
<!--
> [data_structures.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/data_structures.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#位域" id="位域">位域</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="data_structures/bitfield.html#%E5%AE%9A%E4%B9%89%E5%B9%B6%E6%93%8D%E4%BD%9C%E4%BD%8D%E5%9F%9F%E9%A3%8E%E6%A0%BC%E7%9A%84%E7%B1%BB%E5%9E%8B">定义并操作位域风格的类型</a></td><td><a href="https://docs.rs/bitflags/"><img src="https://badge-cache.kominick.com/crates/v/bitflags.svg?label=bitflags" alt="bitflags-badge" /></a></td><td><a href="https://crates.io/categories/no-std"><img src="https://badge-cache.kominick.com/badge/no_std--x.svg?style=social" alt="cat-no-std-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#数据库" id="数据库">数据库</a></h1>
<!--
> [database.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/database.md)
> <br />
> commit 5824ee21eb8100b5795053a6d3bd61ed8b569cac - 2019.04.12
-->
<h2><a class="header" href="#sqlite" id="sqlite">SQLite</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="database/sqlite.html#%E5%88%9B%E5%BB%BA-sqlite-%E6%95%B0%E6%8D%AE%E5%BA%93">创建 SQLite 数据库</a></td><td><a href="https://crates.io/crates/rusqlite/"><img src="https://badge-cache.kominick.com/crates/v/rusqlite.svg?label=rusqlite" alt="rusqlite-badge" /></a></td><td><a href="https://crates.io/categories/database"><img src="https://badge-cache.kominick.com/badge/database--x.svg?style=social" alt="cat-database-badge" /></a></td></tr>
<tr><td><a href="database/sqlite.html#%E6%95%B0%E6%8D%AE%E6%8F%92%E5%85%A5%E5%92%8C%E6%9F%A5%E8%AF%A2">数据插入和查询</a></td><td><a href="https://crates.io/crates/rusqlite/"><img src="https://badge-cache.kominick.com/crates/v/rusqlite.svg?label=rusqlite" alt="rusqlite-badge" /></a></td><td><a href="https://crates.io/categories/database"><img src="https://badge-cache.kominick.com/badge/database--x.svg?style=social" alt="cat-database-badge" /></a></td></tr>
<tr><td><a href="database/sqlite.html#%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86">事务处理</a></td><td><a href="https://crates.io/crates/rusqlite/"><img src="https://badge-cache.kominick.com/crates/v/rusqlite.svg?label=rusqlite" alt="rusqlite-badge" /></a></td><td><a href="https://crates.io/categories/database"><img src="https://badge-cache.kominick.com/badge/database--x.svg?style=social" alt="cat-database-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#使用-postgres" id="使用-postgres">使用 Postgres</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="database/postgres.html#postgres-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E5%88%9B%E5%BB%BA%E8%A1%A8">Postgres 数据库中创建表</a></td><td><a href="https://docs.rs/postgres/0.15.2/postgres/"><img src="https://badge-cache.kominick.com/crates/v/postgres.svg?label=postgres" alt="postgres-badge" /></a></td><td><a href="https://crates.io/categories/database"><img src="https://badge-cache.kominick.com/badge/database--x.svg?style=social" alt="cat-database-badge" /></a></td></tr>
<tr><td><a href="database/postgres.html#%E6%95%B0%E6%8D%AE%E6%8F%92%E5%85%A5%E5%92%8C%E6%9F%A5%E8%AF%A2">数据插入和查询</a></td><td><a href="https://docs.rs/postgres/0.15.2/postgres/"><img src="https://badge-cache.kominick.com/crates/v/postgres.svg?label=postgres" alt="postgres-badge" /></a></td><td><a href="https://crates.io/categories/database"><img src="https://badge-cache.kominick.com/badge/database--x.svg?style=social" alt="cat-database-badge" /></a></td></tr>
<tr><td><a href="database/postgres.html#%E6%95%B0%E6%8D%AE%E8%81%9A%E5%90%88">数据聚合</a></td><td><a href="https://docs.rs/postgres/0.15.2/postgres/"><img src="https://badge-cache.kominick.com/crates/v/postgres.svg?label=postgres" alt="postgres-badge" /></a></td><td><a href="https://crates.io/categories/database"><img src="https://badge-cache.kominick.com/badge/database--x.svg?style=social" alt="cat-database-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#日期及时间" id="日期及时间">日期及时间</a></h1>
<!--
> [datetime.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/datetime.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#期间和计算" id="期间和计算">期间和计算</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="datetime/duration.html#%E6%B5%8B%E9%87%8F%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4">测量运行时间</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/date-and-time"><img src="https://badge-cache.kominick.com/badge/time--x.svg?style=social" alt="cat-time-badge" /></a></td></tr>
<tr><td><a href="datetime/duration.html#%E6%89%A7%E8%A1%8C%E6%97%A5%E6%9C%9F%E6%A3%80%E6%9F%A5%E5%92%8C%E6%97%B6%E9%97%B4%E8%AE%A1%E7%AE%97">执行日期检查和时间计算</a></td><td><a href="https://docs.rs/chrono/"><img src="https://badge-cache.kominick.com/crates/v/chrono.svg?label=chrono" alt="chrono-badge" /></a></td><td><a href="https://crates.io/categories/date-and-time"><img src="https://badge-cache.kominick.com/badge/date_and_time--x.svg?style=social" alt="cat-date-and-time-badge" /></a></td></tr>
<tr><td><a href="datetime/duration.html#%E6%97%B6%E9%97%B4%E7%9A%84%E6%97%B6%E5%8C%BA%E8%BD%AC%E6%8D%A2">时间的时区转换</a></td><td><a href="https://docs.rs/chrono/"><img src="https://badge-cache.kominick.com/crates/v/chrono.svg?label=chrono" alt="chrono-badge" /></a></td><td><a href="https://crates.io/categories/date-and-time"><img src="https://badge-cache.kominick.com/badge/date_and_time--x.svg?style=social" alt="cat-date-and-time-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#解析与显示" id="解析与显示">解析与显示</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="datetime/parse.html#%E6%A3%80%E6%9F%A5%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4">检查日期和时间</a></td><td><a href="https://docs.rs/chrono/"><img src="https://badge-cache.kominick.com/crates/v/chrono.svg?label=chrono" alt="chrono-badge" /></a></td><td><a href="https://crates.io/categories/date-and-time"><img src="https://badge-cache.kominick.com/badge/date_and_time--x.svg?style=social" alt="cat-date-and-time-badge" /></a></td></tr>
<tr><td><a href="datetime/parse.html#%E6%97%A5%E6%9C%9F%E5%92%8C-unix-%E6%97%B6%E9%97%B4%E6%88%B3%E7%9A%84%E4%BA%92%E7%9B%B8%E8%BD%AC%E6%8D%A2">日期和 UNIX 时间戳的互相转换</a></td><td><a href="https://docs.rs/chrono/"><img src="https://badge-cache.kominick.com/crates/v/chrono.svg?label=chrono" alt="chrono-badge" /></a></td><td><a href="https://crates.io/categories/date-and-time"><img src="https://badge-cache.kominick.com/badge/date_and_time--x.svg?style=social" alt="cat-date-and-time-badge" /></a></td></tr>
<tr><td><a href="datetime/parse.html#%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E7%9A%84%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%98%BE%E7%A4%BA">日期和时间的格式化显示</a></td><td><a href="https://docs.rs/chrono/"><img src="https://badge-cache.kominick.com/crates/v/chrono.svg?label=chrono" alt="chrono-badge" /></a></td><td><a href="https://crates.io/categories/date-and-time"><img src="https://badge-cache.kominick.com/badge/date_and_time--x.svg?style=social" alt="cat-date-and-time-badge" /></a></td></tr>
<tr><td><a href="datetime/parse.html#%E5%B0%86%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%A7%A3%E6%9E%90%E4%B8%BA-datetime-%E7%BB%93%E6%9E%84%E4%BD%93">将字符串解析为 DateTime 结构体</a></td><td><a href="https://docs.rs/chrono/"><img src="https://badge-cache.kominick.com/crates/v/chrono.svg?label=chrono" alt="chrono-badge" /></a></td><td><a href="https://crates.io/categories/date-and-time"><img src="https://badge-cache.kominick.com/badge/date_and_time--x.svg?style=social" alt="cat-date-and-time-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#开发工具" id="开发工具">开发工具</a></h1>
<!--
> [development_tools.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#调试工具" id="调试工具">调试工具</a></h2>
<!--
> [development_tools/debugging.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools/debugging.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#日志信息" id="日志信息">日志信息</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="/development_tools/debugging/log.html#%E8%AE%B0%E5%BD%95%E8%B0%83%E8%AF%95%E4%BF%A1%E6%81%AF%E5%88%B0%E6%8E%A7%E5%88%B6%E5%8F%B0">记录调试信息到控制台</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/env_logger/"><img src="https://badge-cache.kominick.com/crates/v/env_logger.svg?label=env_logger" alt="env_logger-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
<tr><td><a href="/development_tools/debugging/log.html#%E8%AE%B0%E5%BD%95%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%E5%88%B0%E6%8E%A7%E5%88%B6%E5%8F%B0">记录错误信息到控制台</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/env_logger/"><img src="https://badge-cache.kominick.com/crates/v/env_logger.svg?label=env_logger" alt="env_logger-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
<tr><td><a href="/development_tools/debugging/log.html#%E8%AE%B0%E5%BD%95%E4%BF%A1%E6%81%AF%E6%97%B6%E7%94%A8%E6%A0%87%E5%87%86%E8%BE%93%E5%87%BA-stdout-%E6%9B%BF%E6%8D%A2%E6%A0%87%E5%87%86%E9%94%99%E8%AF%AF-stderr">记录信息时，用标准输出 stdout 替换标准错误 stderr</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/env_logger/"><img src="https://badge-cache.kominick.com/crates/v/env_logger.svg?label=env_logger" alt="env_logger-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
<tr><td><a href="/development_tools/debugging/log.html#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%E5%99%A8%E8%AE%B0%E5%BD%95%E4%BF%A1%E6%81%AF">使用自定义日志记录器记录信息</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
<tr><td><a href="/development_tools/debugging/log.html#%E8%AE%B0%E5%BD%95%E5%88%B0-unix-%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97">记录到 Unix 系统日志</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/syslog/"><img src="https://badge-cache.kominick.com/crates/v/syslog.svg?label=syslog" alt="syslog-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#日志配置" id="日志配置">日志配置</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="/development_tools/debugging/config_log.html#%E5%90%AF%E7%94%A8%E6%AF%8F%E4%B8%AA%E6%A8%A1%E5%9D%97%E7%9A%84%E6%97%A5%E5%BF%97%E7%BA%A7%E5%88%AB">启用每个模块的日志级别</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/env_logger/"><img src="https://badge-cache.kominick.com/crates/v/env_logger.svg?label=env_logger" alt="env_logger-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
<tr><td><a href="/development_tools/debugging/config_log.html#%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E8%AE%BE%E7%BD%AE%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95">用自定义环境变量设置日志记录</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/env_logger/"><img src="https://badge-cache.kominick.com/crates/v/env_logger.svg?label=env_logger" alt="env_logger-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
<tr><td><a href="/development_tools/debugging/config_log.html#%E5%9C%A8%E6%97%A5%E5%BF%97%E4%BF%A1%E6%81%AF%E4%B8%AD%E5%8C%85%E5%90%AB%E6%97%B6%E9%97%B4%E6%88%B3">在日志信息中包含时间戳</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/env_logger/"><img src="https://badge-cache.kominick.com/crates/v/env_logger.svg?label=env_logger" alt="env_logger-badge" /></a> <a href="https://docs.rs/chrono/"><img src="https://badge-cache.kominick.com/crates/v/chrono.svg?label=chrono" alt="chrono-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
<tr><td><a href="/development_tools/debugging/config_log.html#%E5%B0%86%E4%BF%A1%E6%81%AF%E8%AE%B0%E5%BD%95%E5%88%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BD%8D%E7%BD%AE">将信息记录到自定义位置</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/log4rs/"><img src="https://badge-cache.kominick.com/crates/v/log4rs.svg?label=log4rs" alt="log4rs-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h2><a class="header" href="#版本控制" id="版本控制">版本控制</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="development_tools/versioning.html#%E8%A7%A3%E6%9E%90%E5%B9%B6%E9%80%92%E5%A2%9E%E7%89%88%E6%9C%AC%E5%AD%97%E7%AC%A6%E4%B8%B2">解析并递增版本字符串</a></td><td><a href="https://docs.rs/semver/"><img src="https://badge-cache.kominick.com/crates/v/semver.svg?label=semver" alt="semver-badge" /></a></td><td><a href="https://crates.io/categories/config"><img src="https://badge-cache.kominick.com/badge/config--x.svg?style=social" alt="cat-config-badge" /></a></td></tr>
<tr><td><a href="development_tools/versioning.html#%E8%A7%A3%E6%9E%90%E5%A4%8D%E6%9D%82%E7%9A%84%E7%89%88%E6%9C%AC%E5%AD%97%E7%AC%A6%E4%B8%B2">解析复杂的版本字符串</a></td><td><a href="https://docs.rs/semver/"><img src="https://badge-cache.kominick.com/crates/v/semver.svg?label=semver" alt="semver-badge" /></a></td><td><a href="https://crates.io/categories/config"><img src="https://badge-cache.kominick.com/badge/config--x.svg?style=social" alt="cat-config-badge" /></a></td></tr>
<tr><td><a href="development_tools/versioning.html#%E6%A3%80%E6%9F%A5%E7%BB%99%E5%AE%9A%E7%89%88%E6%9C%AC%E6%98%AF%E5%90%A6%E4%B8%BA%E9%A2%84%E5%8F%91%E5%B8%83%E7%89%88%E6%9C%AC">检查给定版本是否为预发布版本</a></td><td><a href="https://docs.rs/semver/"><img src="https://badge-cache.kominick.com/crates/v/semver.svg?label=semver" alt="semver-badge" /></a></td><td><a href="https://crates.io/categories/config"><img src="https://badge-cache.kominick.com/badge/config--x.svg?style=social" alt="cat-config-badge" /></a></td></tr>
<tr><td><a href="development_tools/versioning.html#%E6%9F%A5%E8%AF%A2%E9%80%82%E9%85%8D%E7%BB%99%E5%AE%9A%E8%8C%83%E5%9B%B4%E7%9A%84%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC">查询适配给定范围的最新版本</a></td><td><a href="https://docs.rs/semver/"><img src="https://badge-cache.kominick.com/crates/v/semver.svg?label=semver" alt="semver-badge" /></a></td><td><a href="https://crates.io/categories/config"><img src="https://badge-cache.kominick.com/badge/config--x.svg?style=social" alt="cat-config-badge" /></a></td></tr>
<tr><td><a href="development_tools/versioning.html#%E6%A3%80%E6%9F%A5%E5%A4%96%E9%83%A8%E5%91%BD%E4%BB%A4%E7%9A%84%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9%E6%80%A7">检查外部命令的版本兼容性</a></td><td><a href="https://docs.rs/semver/"><img src="https://badge-cache.kominick.com/crates/v/semver.svg?label=semver" alt="semver-badge" /></a></td><td><a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a> <a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#构建时" id="构建时">构建时</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="development_tools/build_tools.html#%E7%BC%96%E8%AF%91%E5%B9%B6%E9%9D%99%E6%80%81%E9%93%BE%E6%8E%A5%E5%88%B0%E7%BB%91%E5%AE%9A%E7%9A%84-c-%E8%AF%AD%E8%A8%80%E5%BA%93">编译并静态链接到绑定的 C 语言库</a></td><td><a href="https://docs.rs/cc"><img src="https://badge-cache.kominick.com/crates/v/cc.svg?label=cc" alt="cc-badge" /></a></td><td><a href="https://crates.io/categories/development-tools"><img src="https://badge-cache.kominick.com/badge/development_tools--x.svg?style=social" alt="cat-development-tools-badge" /></a></td></tr>
<tr><td><a href="development_tools/build_tools.html#%E7%BC%96%E8%AF%91%E5%B9%B6%E9%9D%99%E6%80%81%E9%93%BE%E6%8E%A5%E5%88%B0%E7%BB%91%E5%AE%9A%E7%9A%84-c-%E8%AF%AD%E8%A8%80%E5%BA%93-1">编译并静态链接到绑定的 C++ 语言库</a></td><td><a href="https://docs.rs/cc"><img src="https://badge-cache.kominick.com/crates/v/cc.svg?label=cc" alt="cc-badge" /></a></td><td><a href="https://crates.io/categories/development-tools"><img src="https://badge-cache.kominick.com/badge/development_tools--x.svg?style=social" alt="cat-development-tools-badge" /></a></td></tr>
<tr><td><a href="development_tools/build_tools.html#%E7%BC%96%E8%AF%91-c-%E8%AF%AD%E8%A8%80%E5%BA%93%E6%97%B6%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AE%BE%E7%BD%AE">编译 C 语言库时自定义设置</a></td><td><a href="https://docs.rs/cc"><img src="https://badge-cache.kominick.com/crates/v/cc.svg?label=cc" alt="cc-badge" /></a></td><td><a href="https://crates.io/categories/development-tools"><img src="https://badge-cache.kominick.com/badge/development_tools--x.svg?style=social" alt="cat-development-tools-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#编码" id="编码">编码</a></h1>
<!--
> [encoding.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/encoding.md)
> <br />
> commit 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<h2><a class="header" href="#字符集" id="字符集">字符集</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="encoding/strings.html#%E7%99%BE%E5%88%86%E6%AF%94%E7%BC%96%E7%A0%81url-%E7%BC%96%E7%A0%81%E5%AD%97%E7%AC%A6%E4%B8%B2">百分比编码（URL 编码）字符串</a></td><td><a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/percent-encoding.svg?label=percent-encoding" alt="percent-encoding-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="encoding/strings.html#%E5%B0%86%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%BC%96%E7%A0%81%E4%B8%BA-applicationx-www-form-urlencoded">将字符串编码为 application/x-www-form-urlencoded</a></td><td><a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="encoding/strings.html#%E7%BC%96%E7%A0%81%E5%92%8C%E8%A7%A3%E7%A0%81%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6">编码和解码十六进制</a></td><td><a href="https://docs.rs/data-encoding/"><img src="https://badge-cache.kominick.com/crates/v/data-encoding.svg?label=data-encoding" alt="data-encoding-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="encoding/strings.html#%E7%BC%96%E7%A0%81%E5%92%8C%E8%A7%A3%E7%A0%81-base64">编码和解码 base64</a></td><td><a href="https://docs.rs/base64/"><img src="https://badge-cache.kominick.com/crates/v/base64.svg?label=base64" alt="base64-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#csv-处理" id="csv-处理">CSV 处理</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="encoding/csv.html#%E8%AF%BB%E5%8F%96-csv-%E8%AE%B0%E5%BD%95">读取 CSV 记录</a></td><td><a href="https://docs.rs/csv/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=csv" alt="csv-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="encoding/csv.html#%E8%AF%BB%E5%8F%96%E6%9C%89%E4%B8%8D%E5%90%8C%E5%88%86%E9%9A%94%E7%AC%A6%E7%9A%84-csv-%E8%AE%B0%E5%BD%95">读取有不同分隔符的 CSV 记录</a></td><td><a href="https://docs.rs/csv/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=csv" alt="csv-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="encoding/csv.html#%E7%AD%9B%E9%80%89%E5%8C%B9%E9%85%8D%E6%96%AD%E8%A8%80%E7%9A%84-csv-%E8%AE%B0%E5%BD%95">筛选匹配断言的 CSV 记录</a></td><td><a href="https://docs.rs/csv/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=csv" alt="csv-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="encoding/csv.html#%E7%94%A8-serde-%E5%A4%84%E7%90%86%E6%97%A0%E6%95%88%E7%9A%84-csv-%E6%95%B0%E6%8D%AE">用 Serde 处理无效的 CSV 数据</a></td><td><a href="https://docs.rs/csv/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=csv" alt="csv-badge" /></a> <a href="https://docs.rs/serde/"><img src="https://badge-cache.kominick.com/crates/v/serde.svg?label=serde" alt="serde-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="encoding/csv.html#%E5%B0%86%E8%AE%B0%E5%BD%95%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%BA-csv">将记录序列化为 CSV</a></td><td><a href="https://docs.rs/csv/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=csv" alt="csv-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="encoding/csv.html#%E7%94%A8-serde-%E5%B0%86%E8%AE%B0%E5%BD%95%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%BA-csv">用 Serde 将记录序列化为 CSV</a></td><td><a href="https://docs.rs/csv/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=csv" alt="csv-badge" /></a> <a href="https://docs.rs/serde/"><img src="https://badge-cache.kominick.com/crates/v/serde.svg?label=serde" alt="serde-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="encoding/csv.html#%E8%BD%AC%E6%8D%A2-csv-%E6%96%87%E4%BB%B6%E7%9A%84%E5%88%97">转换 CSV 文件的列</a></td><td><a href="https://docs.rs/csv/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=csv" alt="csv-badge" /></a> <a href="https://docs.rs/serde/"><img src="https://badge-cache.kominick.com/crates/v/serde.svg?label=serde" alt="serde-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#结构化数据" id="结构化数据">结构化数据</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="encoding/complex.html#%E5%AF%B9%E9%9D%9E%E7%BB%93%E6%9E%84%E5%8C%96-json-%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96">对非结构化 JSON 序列化和反序列化</a></td><td><a href="https://docs.rs/serde_json/*/serde_json/"><img src="https://badge-cache.kominick.com/crates/v/serde_json.svg?label=serde_json" alt="serde-json-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="encoding/complex.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-toml-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">反序列化 TOML 配置文件</a></td><td><a href="https://docs.rs/toml/"><img src="https://badge-cache.kominick.com/crates/v/toml.svg?label=toml" alt="toml-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="encoding/complex.html#%E4%BB%A5%E5%B0%8F%E7%AB%AF%E6%A8%A1%E5%BC%8F%E4%BD%8E%E4%BD%8D%E6%A8%A1%E5%BC%8F%E5%AD%97%E8%8A%82%E9%A1%BA%E5%BA%8F%E8%AF%BB%E5%86%99%E6%95%B4%E6%95%B0">以小端模式（低位模式）字节顺序读写整数</a></td><td><a href="https://docs.rs/byteorder/"><img src="https://badge-cache.kominick.com/crates/v/byteorder.svg?label=byteorder" alt="byteorder-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#错误处理" id="错误处理">错误处理</a></h1>
<!--
> [errors.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/errors.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#处理错误变量" id="处理错误变量">处理错误变量</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="errors/handle.html#%E5%9C%A8-main-%E6%96%B9%E6%B3%95%E4%B8%AD%E5%AF%B9%E9%94%99%E8%AF%AF%E9%80%82%E5%BD%93%E5%A4%84%E7%90%86">在 main 方法中对错误适当处理</a></td><td><a href="https://docs.rs/error-chain/"><img src="https://badge-cache.kominick.com/crates/v/error-chain.svg?label=error-chain" alt="error-chain-badge" /></a></td><td><a href="https://crates.io/categories/rust-patterns"><img src="https://badge-cache.kominick.com/badge/rust_patterns--x.svg?style=social" alt="cat-rust-patterns-badge" /></a></td></tr>
<tr><td><a href="errors/handle.html#%E9%81%BF%E5%85%8D%E5%9C%A8%E9%94%99%E8%AF%AF%E8%BD%AC%E5%8F%98%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%81%97%E6%BC%8F%E9%94%99%E8%AF%AF">避免在错误转变过程中遗漏错误</a></td><td><a href="https://docs.rs/error-chain/"><img src="https://badge-cache.kominick.com/crates/v/error-chain.svg?label=error-chain" alt="error-chain-badge" /></a></td><td><a href="https://crates.io/categories/rust-patterns"><img src="https://badge-cache.kominick.com/badge/rust_patterns--x.svg?style=social" alt="cat-rust-patterns-badge" /></a></td></tr>
<tr><td><a href="errors/handle.html#%E8%8E%B7%E5%8F%96%E5%A4%8D%E6%9D%82%E9%94%99%E8%AF%AF%E5%9C%BA%E6%99%AF%E7%9A%84%E5%9B%9E%E6%BA%AF">获取复杂错误场景的回溯</a></td><td><a href="https://docs.rs/error-chain/"><img src="https://badge-cache.kominick.com/crates/v/error-chain.svg?label=error-chain" alt="error-chain-badge" /></a></td><td><a href="https://crates.io/categories/rust-patterns"><img src="https://badge-cache.kominick.com/badge/rust_patterns--x.svg?style=social" alt="cat-rust-patterns-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#文件系统" id="文件系统">文件系统</a></h1>
<!--
> [file.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/file.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#文件读写" id="文件读写">文件读写</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="file/read-write.html#%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%A1%8C">读取文件的字符串行</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
<tr><td><a href="file/read-write.html#%E9%81%BF%E5%85%8D%E8%AF%BB%E5%8F%96%E5%86%99%E5%85%A5%E5%90%8C%E4%B8%80%E6%96%87%E4%BB%B6">避免读取写入同一文件</a></td><td><a href="https://docs.rs/same-file/"><img src="https://badge-cache.kominick.com/crates/v/same_file.svg?label=same_file" alt="same_file-badge" /></a></td><td><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
<tr><td><a href="file/read-write.html#%E4%BD%BF%E7%94%A8%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%84%E9%9A%8F%E6%9C%BA%E8%AE%BF%E9%97%AE%E6%96%87%E4%BB%B6">使用内存映射随机访问文件</a></td><td><a href="https://docs.rs/memmap/"><img src="https://badge-cache.kominick.com/crates/v/memmap.svg?label=memmap" alt="memmap-badge" /></a></td><td><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#目录遍历" id="目录遍历">目录遍历</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="file/dir.html#%E8%BF%87%E5%8E%BB-24-%E5%B0%8F%E6%97%B6%E5%86%85%E4%BF%AE%E6%94%B9%E8%BF%87%E7%9A%84%E6%96%87%E4%BB%B6%E5%90%8D">过去 24 小时内修改过的文件名</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a> <a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a></td></tr>
<tr><td><a href="file/dir.html#%E6%9F%A5%E6%89%BE%E7%BB%99%E5%AE%9A%E8%B7%AF%E5%BE%84%E7%9A%84%E5%BE%AA%E7%8E%AF">查找给定路径的循环</a></td><td><a href="https://docs.rs/same-file/"><img src="https://badge-cache.kominick.com/crates/v/same_file.svg?label=same_file" alt="same_file-badge" /></a></td><td><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
<tr><td><a href="file/dir.html#%E9%80%92%E5%BD%92%E6%9F%A5%E6%89%BE%E9%87%8D%E5%90%8D%E6%96%87%E4%BB%B6">递归查找重名文件</a></td><td><a href="https://docs.rs/walkdir/"><img src="https://badge-cache.kominick.com/crates/v/walkdir.svg?label=walkdir" alt="walkdir-badge" /></a></td><td><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
<tr><td><a href="file/dir.html#%E4%BD%BF%E7%94%A8%E7%BB%99%E5%AE%9A%E6%96%AD%E8%A8%80%E9%80%92%E5%BD%92%E6%9F%A5%E6%89%BE%E6%89%80%E6%9C%89%E6%96%87%E4%BB%B6">使用给定断言递归查找所有文件</a></td><td><a href="https://docs.rs/walkdir/"><img src="https://badge-cache.kominick.com/crates/v/walkdir.svg?label=walkdir" alt="walkdir-badge" /></a></td><td><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
<tr><td><a href="file/dir.html#%E8%B7%B3%E8%BF%87%E9%9A%90%E8%97%8F%E6%96%87%E4%BB%B6%E9%81%8D%E5%8E%86%E7%9B%AE%E5%BD%95">跳过隐藏文件遍历目录</a></td><td><a href="https://docs.rs/walkdir/"><img src="https://badge-cache.kominick.com/crates/v/walkdir.svg?label=walkdir" alt="walkdir-badge" /></a></td><td><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
<tr><td><a href="file/dir.html#%E5%9C%A8%E7%BB%99%E5%AE%9A%E6%B7%B1%E5%BA%A6%E7%9A%84%E7%9B%AE%E5%BD%95%E9%80%92%E5%BD%92%E8%AE%A1%E7%AE%97%E6%96%87%E4%BB%B6%E5%A4%A7%E5%B0%8F">在给定深度的目录，递归计算文件大小</a></td><td><a href="https://docs.rs/walkdir/"><img src="https://badge-cache.kominick.com/crates/v/walkdir.svg?label=walkdir" alt="walkdir-badge" /></a></td><td><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
<tr><td><a href="file/dir.html#%E9%80%92%E5%BD%92%E6%9F%A5%E6%89%BE%E6%89%80%E6%9C%89-png-%E6%96%87%E4%BB%B6">递归查找所有 png 文件</a></td><td><a href="https://docs.rs/glob/"><img src="https://badge-cache.kominick.com/crates/v/glob.svg?label=glob" alt="glob-badge" /></a></td><td><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
<tr><td><a href="file/dir.html#%E5%BF%BD%E7%95%A5%E6%96%87%E4%BB%B6%E5%90%8D%E5%A4%A7%E5%B0%8F%E5%86%99%E4%BD%BF%E7%94%A8%E7%BB%99%E5%AE%9A%E6%A8%A1%E5%BC%8F%E6%9F%A5%E6%89%BE%E6%89%80%E6%9C%89%E6%96%87%E4%BB%B6">忽略文件名大小写，使用给定模式查找所有文件</a></td><td><a href="https://docs.rs/glob/"><img src="https://badge-cache.kominick.com/crates/v/glob.svg?label=glob" alt="glob-badge" /></a></td><td><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#硬件支持" id="硬件支持">硬件支持</a></h1>
<!--
> [hardware.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/hardware.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#处理器" id="处理器">处理器</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="hardware/processor.html#%E6%A3%80%E6%9F%A5%E9%80%BB%E8%BE%91-cpu-%E5%86%85%E6%A0%B8%E7%9A%84%E6%95%B0%E9%87%8F">检查逻辑 cpu 内核的数量</a></td><td><a href="https://docs.rs/num_cpus/"><img src="https://badge-cache.kominick.com/crates/v/num_cpus.svg?label=num_cpus" alt="num_cpus-badge" /></a></td><td><a href="https://crates.io/categories/hardware-support"><img src="https://badge-cache.kominick.com/badge/hardware_support--x.svg?style=social" alt="cat-hardware-support-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#内存管理" id="内存管理">内存管理</a></h1>
<!--
> [mem.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/mem.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#常量" id="常量">常量</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="mem/global_static.html#%E5%A3%B0%E6%98%8E%E5%BB%B6%E8%BF%9F%E8%AE%A1%E7%AE%97%E5%B8%B8%E9%87%8F">声明延迟计算常量</a></td><td><a href="https://docs.rs/lazy_static/"><img src="https://badge-cache.kominick.com/crates/v/lazy_static.svg?label=lazy_static" alt="lazy_static-badge" /></a></td><td><a href="https://crates.io/categories/caching"><img src="https://badge-cache.kominick.com/badge/caching--x.svg?style=social" alt="cat-caching-badge" /></a> <a href="https://crates.io/categories/rust-patterns"><img src="https://badge-cache.kominick.com/badge/rust_patterns--x.svg?style=social" alt="cat-rust-patterns-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#网络" id="网络">网络</a></h1>
<!--
> [net.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/net.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#服务器" id="服务器">服务器</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="net/server.html#%E7%9B%91%E5%90%AC%E6%9C%AA%E4%BD%BF%E7%94%A8%E7%9A%84-tcpip-%E7%AB%AF%E5%8F%A3">监听未使用的 TCP/IP 端口</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#操作系统" id="操作系统">操作系统</a></h1>
<!--
> [os.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/os.md)
> <br />
> commit bba147f18531934c904b1c5afaed3e6550b1c1c0 - 2020.06.14
-->
<h2><a class="header" href="#外部命令" id="外部命令">外部命令</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="os/external.html#%E8%BF%90%E8%A1%8C%E5%A4%96%E9%83%A8%E5%91%BD%E4%BB%A4%E5%B9%B6%E5%A4%84%E7%90%86-stdout">运行外部命令并处理 stdout</a></td><td><a href="https://docs.rs/regex/"><img src="https://badge-cache.kominick.com/crates/v/regex.svg?label=regex" alt="regex-badge" /></a></td><td><a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a> <a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></td></tr>
<tr><td><a href="os/external.html#%E8%BF%90%E8%A1%8C%E4%BC%A0%E9%80%92-stdin-%E7%9A%84%E5%A4%96%E9%83%A8%E5%91%BD%E4%BB%A4%E5%B9%B6%E6%A3%80%E6%9F%A5%E9%94%99%E8%AF%AF%E4%BB%A3%E7%A0%81">运行传递 stdin 的外部命令，并检查错误代码</a></td><td><a href="https://docs.rs/regex/"><img src="https://badge-cache.kominick.com/crates/v/regex.svg?label=regex" alt="regex-badge" /></a></td><td><a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a> <a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></td></tr>
<tr><td><a href="os/external.html#%E8%BF%90%E8%A1%8C%E7%AE%A1%E9%81%93%E4%BC%A0%E8%BE%93%E7%9A%84%E5%A4%96%E9%83%A8%E5%91%BD%E4%BB%A4">运行管道传输的外部命令</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a></td></tr>
<tr><td><a href="os/external.html#%E5%B0%86%E5%AD%90%E8%BF%9B%E7%A8%8B%E7%9A%84-stdout-%E5%92%8C-stderr-%E9%87%8D%E5%AE%9A%E5%90%91%E5%88%B0%E5%90%8C%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6">将子进程的 stdout 和 stderr 重定向到同一个文件</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a></td></tr>
<tr><td><a href="os/external.html#%E6%8C%81%E7%BB%AD%E5%A4%84%E7%90%86%E5%AD%90%E8%BF%9B%E7%A8%8B%E7%9A%84%E8%BE%93%E5%87%BA">持续处理子进程的输出</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a><a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></td></tr>
<tr><td><a href="os/external.html#%E8%AF%BB%E5%8F%96%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F">读取环境变量</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#科学计算" id="科学计算">科学计算</a></h1>
<!--
> [science.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science.md)
> <br />
> commit 580e16feff644155826c7494cebe4d9c053d43f7 - 2018.10.09
-->
<h2><a class="header" href="#数学" id="数学">数学</a></h2>
<!--
> [science/mathematics.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science/mathematics.md)
> <br />
> commit 714e9f4fcd2fc7649abd87eef00b13b3b571c655 2020.12.31
-->
<h2><a class="header" href="#线性代数" id="线性代数">线性代数</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="/science/mathematics/linear_algebra.html#vector-%E8%8C%83%E6%95%B0">Vector 范数</a></td><td><a href="https://docs.rs/ndarray"><img src="https://badge-cache.kominick.com/crate/ndarray.svg?label=ndarray" alt="ndarray-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="/science/mathematics/linear_algebra.html#vector-%E6%AF%94%E8%BE%83">Vector 比较</a></td><td><a href="https://docs.rs/ndarray"><img src="https://badge-cache.kominick.com/crate/ndarray.svg?label=ndarray" alt="ndarray-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="/science/mathematics/linear_algebra.html#%E7%9F%A9%E9%98%B5%E7%9B%B8%E5%8A%A0">矩阵相加</a></td><td><a href="https://docs.rs/ndarray"><img src="https://badge-cache.kominick.com/crate/ndarray.svg?label=ndarray" alt="ndarray-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="/science/mathematics/linear_algebra.html#%E7%9F%A9%E9%98%B5%E7%9B%B8%E4%B9%98">矩阵相乘</a></td><td><a href="https://docs.rs/ndarray"><img src="https://badge-cache.kominick.com/crate/ndarray.svg?label=ndarray" alt="ndarray-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="/science/mathematics/linear_algebra.html#%E6%A0%87%E9%87%8Fvector%E7%9F%A9%E9%98%B5%E7%9B%B8%E4%B9%98">标量、vector、矩阵相乘</a></td><td><a href="https://docs.rs/ndarray"><img src="https://badge-cache.kominick.com/crate/ndarray.svg?label=ndarray" alt="ndarray-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="/science/mathematics/linear_algebra.html#%E7%9F%A9%E9%98%B5%E6%B1%82%E9%80%86">矩阵求逆</a></td><td><a href="https://docs.rs/nalgebra"><img src="https://badge-cache.kominick.com/crate/nalgebra.svg?label=nalgebra" alt="nalgebra-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="/science/mathematics/linear_algebra.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A9%E9%98%B5">（反）序列化矩阵</a></td><td><a href="https://docs.rs/ndarray"><img src="https://badge-cache.kominick.com/crate/ndarray.svg?label=ndarray" alt="ndarray-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#三角学" id="三角学">三角学</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="/science/mathematics/trigonometry.html#%E8%AE%A1%E7%AE%97%E4%B8%89%E8%A7%92%E5%BD%A2%E7%9A%84%E8%BE%B9%E9%95%BF">计算三角形的边长</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="/science/mathematics/trigonometry.html#%E9%AA%8C%E8%AF%81%E6%AD%A3%E5%88%87tan%E7%AD%89%E4%BA%8E%E6%AD%A3%E5%BC%A6sin%E9%99%A4%E4%BB%A5%E4%BD%99%E5%BC%A6cos">验证正切（tan）等于正弦（sin）除以余弦（cos）</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="/science/mathematics/trigonometry.html#%E5%9C%B0%E7%90%83%E4%B8%8A%E4%B8%A4%E7%82%B9%E4%B9%8B%E9%97%B4%E7%9A%84%E8%B7%9D%E7%A6%BB">地球上两点之间的距离</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#复数" id="复数">复数</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="/science/mathematics/complex_numbers.html#%E5%88%9B%E5%BB%BA%E5%A4%8D%E6%95%B0">创建复数</a></td><td><a href="https://docs.rs/num/"><img src="https://badge-cache.kominick.com/crates/v/num.svg?label=num" alt="num-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="/science/mathematics/complex_numbers.html#%E5%A4%8D%E6%95%B0%E7%9B%B8%E5%8A%A0">复数相加</a></td><td><a href="https://docs.rs/num/"><img src="https://badge-cache.kominick.com/crates/v/num.svg?label=num" alt="num-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="/science/mathematics/complex_numbers.html#%E5%A4%8D%E6%95%B0%E7%9A%84%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0">复数的数学函数</a></td><td><a href="https://docs.rs/num/"><img src="https://badge-cache.kominick.com/crates/v/num.svg?label=num" alt="num-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#统计学" id="统计学">统计学</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="/science/mathematics/statistics.html#%E9%9B%86%E4%B8%AD%E8%B6%8B%E5%8A%BF%E5%BA%A6%E9%87%8F">集中趋势度量</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="/science/mathematics/statistics.html#%E8%AE%A1%E7%AE%97%E6%A0%87%E5%87%86%E5%81%8F%E5%B7%AE">计算标准偏差</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#其它数学计算" id="其它数学计算">其它数学计算</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="/science/mathematics/miscellaneous.html#%E5%A4%A7%E6%95%B0">大数</a></td><td><a href="https://docs.rs/num/"><img src="https://badge-cache.kominick.com/crates/v/num.svg?label=num" alt="num-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#文本处理" id="文本处理">文本处理</a></h1>
<!--
> [os.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/text.md)
> <br />
> commit f1ad9ad44c355d12b7759dca2f700f254ca86114 - 2019.04.13
-->
<h2><a class="header" href="#正则表达式" id="正则表达式">正则表达式</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="text/regex.html#%E9%AA%8C%E8%AF%81%E5%B9%B6%E6%8F%90%E5%8F%96%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF">验证并提取电子邮件登录信息</a></td><td><a href="https://docs.rs/regex/"><img src="https://badge-cache.kominick.com/crates/v/regex.svg?label=regex" alt="regex-badge" /></a> <a href="https://docs.rs/lazy_static/"><img src="https://badge-cache.kominick.com/crates/v/lazy_static.svg?label=lazy_static" alt="lazy_static-badge" /></a></td><td><a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></td></tr>
<tr><td><a href="text/regex.html#%E4%BB%8E%E6%96%87%E6%9C%AC%E6%8F%90%E5%8F%96%E6%A0%87%E7%AD%BE%E5%85%83%E7%B4%A0%E5%94%AF%E4%B8%80%E7%9A%84%E5%88%97%E8%A1%A8">从文本提取标签元素唯一的列表</a></td><td><a href="https://docs.rs/regex/"><img src="https://badge-cache.kominick.com/crates/v/regex.svg?label=regex" alt="regex-badge" /></a> <a href="https://docs.rs/lazy_static/"><img src="https://badge-cache.kominick.com/crates/v/lazy_static.svg?label=lazy_static" alt="lazy_static-badge" /></a></td><td><a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></td></tr>
<tr><td><a href="text/regex.html#%E4%BB%8E%E6%96%87%E6%9C%AC%E6%8F%90%E5%8F%96%E7%94%B5%E8%AF%9D%E5%8F%B7%E7%A0%81">从文本提取电话号码</a></td><td><a href="https://docs.rs/regex/"><img src="https://badge-cache.kominick.com/crates/v/regex.svg?label=regex" alt="regex-badge" /></a></td><td><a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></td></tr>
<tr><td><a href="text/regex.html#%E9%80%9A%E8%BF%87%E5%8C%B9%E9%85%8D%E5%A4%9A%E4%B8%AA%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%9D%A5%E7%AD%9B%E9%80%89%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6">通过匹配多个正则表达式来筛选日志文件</a></td><td><a href="https://docs.rs/regex/"><img src="https://badge-cache.kominick.com/crates/v/regex.svg?label=regex" alt="regex-badge" /></a></td><td><a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></td></tr>
<tr><td><a href="text/regex.html#%E6%96%87%E6%9C%AC%E6%A8%A1%E5%BC%8F%E6%9B%BF%E6%8D%A2">文本模式替换</a></td><td><a href="https://docs.rs/regex/"><img src="https://badge-cache.kominick.com/crates/v/regex.svg?label=regex" alt="regex-badge" /></a> <a href="https://docs.rs/lazy_static/"><img src="https://badge-cache.kominick.com/crates/v/lazy_static.svg?label=lazy_static" alt="lazy_static-badge" /></a></td><td><a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#字符串解析" id="字符串解析">字符串解析</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="text/string_parsing.html#%E6%94%B6%E9%9B%86-unicode-%E5%AD%97%E7%AC%A6">收集 Unicode 字符</a></td><td><a href="https://docs.rs/unicode-segmentation/"><img src="https://badge-cache.kominick.com/crates/v/unicode-segmentation.svg?label=unicode-segmentation" alt="unicode-segmentation-badge" /></a></td><td><a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="text/string_parsing.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%93%E6%9E%84%E4%BD%93%E5%B9%B6%E5%AE%9E%E7%8E%B0-fromstr-trait">自定义<code>结构体</code>并实现 <code>FromStr</code> trait</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#web-编程" id="web-编程">Web 编程</a></h1>
<!--
> [web.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web.md)
> <br />
> commit dd4efa8dcd8e611326caa01c08db8f227aa909d6 - 2020.06.07
-->
<h2><a class="header" href="#抓取网页" id="抓取网页">抓取网页</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="web/scraping.html#%E4%BB%8E-html-%E7%BD%91%E9%A1%B5%E4%B8%AD%E6%8F%90%E5%8F%96%E6%89%80%E6%9C%89%E9%93%BE%E6%8E%A5">从 HTML 网页中提取所有链接</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/select/"><img src="https://badge-cache.kominick.com/crates/v/select.svg?label=select" alt="select-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
<tr><td><a href="web/scraping.html#%E6%A3%80%E6%9F%A5%E7%BD%91%E9%A1%B5%E6%AD%BB%E9%93%BE">检查网页死链</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/select/"><img src="https://badge-cache.kominick.com/crates/v/select.svg?label=select" alt="select-badge" /></a> <a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
<tr><td><a href="web/scraping.html#%E4%BB%8E-mediawiki-%E6%A0%87%E8%AE%B0%E9%A1%B5%E9%9D%A2%E6%8F%90%E5%8F%96%E6%89%80%E6%9C%89%E5%94%AF%E4%B8%80%E6%80%A7%E9%93%BE%E6%8E%A5">从 MediaWiki 标记页面提取所有唯一性链接</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/regex/"><img src="https://badge-cache.kominick.com/crates/v/regex.svg?label=regex" alt="regex-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#url" id="url">URL</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="web/url.html#%E8%A7%A3%E6%9E%90-url-%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%BA-url-%E7%B1%BB%E5%9E%8B">解析 URL 字符串为 <code>Url</code> 类型</a></td><td><a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
<tr><td><a href="web/url.html#%E9%80%9A%E8%BF%87%E7%A7%BB%E9%99%A4%E8%B7%AF%E5%BE%84%E6%AE%B5%E5%88%9B%E5%BB%BA%E5%9F%BA%E6%9C%AC-url">通过移除路径段创建基本 URL</a></td><td><a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
<tr><td><a href="web/url.html#%E4%BB%8E%E5%9F%BA%E6%9C%AC-url-%E5%88%9B%E5%BB%BA%E6%96%B0-urls">从基本 URL 创建新 URLs</a></td><td><a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
<tr><td><a href="web/url.html#%E6%8F%90%E5%8F%96-url-%E6%BA%90scheme-host-port">提取 URL 源（scheme/ host/ port）</a></td><td><a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
<tr><td><a href="web/url.html#%E4%BB%8E-url-%E7%A7%BB%E9%99%A4%E7%89%87%E6%AE%B5%E6%A0%87%E8%AF%86%E7%AC%A6%E5%92%8C%E6%9F%A5%E8%AF%A2%E5%AF%B9">从 URL 移除片段标识符和查询对</a></td><td><a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#媒体类型mime" id="媒体类型mime">媒体类型（MIME）</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="web/mime.html#%E4%BB%8E%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%8E%B7%E5%8F%96-mime-%E7%B1%BB%E5%9E%8B">从字符串获取 MIME 类型</a></td><td><a href="https://docs.rs/mime/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=mime" alt="mime-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="web/mime.html#%E4%BB%8E%E6%96%87%E4%BB%B6%E5%90%8D%E8%8E%B7%E5%8F%96-mime-%E7%B1%BB%E5%9E%8B">从文件名获取 MIME 类型</a></td><td><a href="https://docs.rs/mime/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=mime" alt="mime-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="web/mime.html#%E8%A7%A3%E6%9E%90-http-%E5%93%8D%E5%BA%94%E7%9A%84-mime-%E7%B1%BB%E5%9E%8B">解析 HTTP 响应的 MIME 类型</a></td><td><a href="https://docs.rs/mime/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=mime" alt="mime-badge" /></a> <a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#客户端" id="客户端">客户端</a></h2>
<!--
> [web/clients.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/clients.md)
> <br />
> commit dd4efa8dcd8e611326caa01c08db8f227aa909d6 - 2020.06.07
-->
<h3><a class="header" href="#请求处理" id="请求处理">请求处理</a></h3>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="/web/clients/requests.html#%E5%8F%91%E5%87%BA-http-get-%E8%AF%B7%E6%B1%82">发出 HTTP GET 请求</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
<tr><td><a href="/web/clients/requests.html#%E4%B8%BA-rest-%E8%AF%B7%E6%B1%82%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B6%88%E6%81%AF%E6%A0%87%E5%A4%B4%E5%92%8C-url-%E5%8F%82%E6%95%B0">为 REST 请求设置自定义消息标头和 URL 参数</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/hyper/"><img src="https://badge-cache.kominick.com/crates/v/hyper.svg?label=hyper" alt="hyper-badge" /></a> <a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td><td></td></tr>
</tbody></table>
<h3><a class="header" href="#web-api-调用" id="web-api-调用">Web API 调用</a></h3>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="/web/clients/apis.html#%E6%9F%A5%E8%AF%A2-github-api">查询 GitHub API</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/serde/"><img src="https://badge-cache.kominick.com/crates/v/serde.svg?label=serde" alt="serde-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="/web/clients/apis.html#%E6%A3%80%E6%9F%A5-api-%E8%B5%84%E6%BA%90%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8">检查 API 资源是否存在</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
<tr><td><a href="/web/clients/apis.html#%E4%BD%BF%E7%94%A8-github-api-%E5%88%9B%E5%BB%BA%E5%92%8C%E5%88%A0%E9%99%A4-gist">使用 GitHub API 创建和删除 Gist</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/serde/"><img src="https://badge-cache.kominick.com/crates/v/serde.svg?label=serde" alt="serde-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="/web/clients/apis.html#%E4%BD%BF%E7%94%A8-restful-api-%E5%88%86%E9%A1%B5">使用 RESTful API 分页</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/serde/"><img src="https://badge-cache.kominick.com/crates/v/serde.svg?label=serde" alt="serde-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="/web/clients/apis.html#%E5%A4%84%E7%90%86%E9%80%9F%E7%8E%87%E5%8F%97%E9%99%90-api">处理速率受限 API</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/hyper/"><img src="https://badge-cache.kominick.com/crates/v/hyper.svg?label=hyper" alt="hyper-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td><td></td></tr>
</tbody></table>
<h3><a class="header" href="#下载" id="下载">下载</a></h3>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="/web/clients/download.html#%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6%E5%88%B0%E4%B8%B4%E6%97%B6%E7%9B%AE%E5%BD%95">下载文件到临时目录</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/tempdir/"><img src="https://badge-cache.kominick.com/crates/v/tempdir.svg?label=tempdir" alt="tempdir-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a> <a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
<tr><td><a href="/web/clients/download.html#%E4%BD%BF%E7%94%A8-http-range-%E8%AF%B7%E6%B1%82%E5%A4%B4%E8%BF%9B%E8%A1%8C%E9%83%A8%E5%88%86%E4%B8%8B%E8%BD%BD">使用 HTTP range 请求头进行部分下载</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
<tr><td><a href="/web/clients/download.html#post-%E6%96%87%E4%BB%B6%E5%88%B0-paste-rs">POST 文件到 paste-rs</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#关于本书" id="关于本书">关于本书</a></h1>
<!--
> [about.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/about.md)
> <br />
> commit - b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<h2><a class="header" href="#目录" id="目录">目录</a></h2>
<ul>
<li><a href="about.html#%E6%8C%87%E5%8D%97%E7%9B%AE%E6%A0%87%E8%AF%BB%E8%80%85">指南目标读者</a></li>
<li><a href="about.html#%E5%A6%82%E4%BD%95%E9%98%85%E8%AF%BB%E6%8C%87%E5%8D%97">如何阅读指南</a></li>
<li><a href="about.html#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B">如何使用实例</a></li>
<li><a href="about.html#%E5%85%B3%E4%BA%8E%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86">关于错误处理</a></li>
<li><a href="about.html#%E5%85%B3%E4%BA%8E-crate-%E7%9A%84%E8%AF%B4%E6%98%8E">关于 crate 的说明</a></li>
</ul>
<h2><a class="header" href="#指南目标读者" id="指南目标读者">指南目标读者</a></h2>
<p>本指南适用于 Rust 程序员新手，以便于他们可以快速了解 Rust crate 生态系统的功能。同时，本指南也适用于经验丰富的 Rust 程序员，他们可以在本指南中找到如何完成常见任务的简单提示。</p>
<h2><a class="header" href="#如何阅读指南" id="如何阅读指南">如何阅读指南</a></h2>
<p>指南的<a href="intro.html">索引</a>包含完整的实例列表，组织为数个章节：基础、编码、并发等。这些章节基本是按照顺序排列的；后面的章节更深入一些，并且有些实例是在前面章节的概念之上构建。</p>
<p>在<a href="intro.html">索引</a>中，每个章节都包含实例列表。实例名称是要完成任务的简单描述，比如“在一个范围内生成随机数”；每个实例都有标记指示所使用的 <em>crates</em>，比如 <a href="https://docs.rs/rand/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand" alt="rand-badge" /></a>；以及 crate 在 <a href="https://crates.io">crates.io</a> 上的分类，比如 <a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a>。</p>
<p>Rust 程序员新手应该按照由第一章节直至最后章节的顺序来阅读，这种方式易于理解书中的实例。同时，这样也可以对 crate 生态系统有一个全面的了解。点击索引中的章节标题，或者在侧边栏中导航到指南的章节页面。</p>
<p>如果你只是在简单地为一个任务的寻找解决方案，那么指南就较难以导航。找到特定实例的最简单的方法是详细查看索引，寻找感兴趣的 crate 及其类别，然后点击实例的名称来阅读它。指南的导航和浏览还在改进，以后或许会有所改善。</p>
<h2><a class="header" href="#如何使用实例" id="如何使用实例">如何使用实例</a></h2>
<p>指南的设计是为了让你能够即时访问可工作的代码，以及对其正在做什么有一个完整阐述，并指导你了解如何更进一步的信息。</p>
<p>指南中的所有实例都是完整的、可独立运行的程序，因此你可以直接复制它们到自己的项目中进行试验。为此，请按照以下说明进行操作。</p>
<p>考虑这个实例：“在一个范围内，生成随机数”：</p>
<p><a href="https://docs.rs/rand/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand" alt="rand-badge" /></a> <a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></p>
<pre><pre class="playground"><code class="language-rust edition2018">use rand::Rng;

fn main() {
    let mut rng = rand::thread_rng();
    println!(&quot;Random f64: {}&quot;, rng.gen::&lt;f64&gt;());
}
</code></pre></pre>
<p>欲在本地使用，我们可以运行以下命令来创建一个新的 cargo 项目，并切换到该目录：</p>
<pre><code class="language-sh">cargo new my-example --bin
cd my-example
</code></pre>
<p>然后，我们还需要添加必要的 crate 到 <a href="http://doc.crates.io/manifest.html">Cargo.toml</a> 中（译者注：了解更多请阅读 <a href="https://cargo.budshome.com">Cargo 中文文档</a>，关于 Cargo.toml 详细信息也可参阅 <a href="https://cargo.budshome.com/guide/cargo-toml-vs-cargo-lock.html">Cargo.toml 与 Cargo.lock</a> 中文文档），如上面实例代码顶部的 crate 标志所示，在本实例中仅使用了 “rand” crate。为了增加 “rand” crate，我们将使用 <code>cargo add</code> 命令，该命令由 <a href="https://github.com/killercup/cargo-edit"><code>cargo-edit</code></a> crate 提供，我们需要先安装它：</p>
<pre><code class="language-sh">cargo install cargo-edit
cargo add rand
</code></pre>
<p>接下来，可以使用实例代码替换 <code>src/main.rs</code> 文件的全部内容，并通过如下命令运行：</p>
<pre><code class="language-sh">cargo run
</code></pre>
<blockquote>
<p>亲，成功执行了吧？你已经是一个 Rustacean（Rust 开发者）了！——此处应该有掌声 :-)</p>
</blockquote>
<p>上面实例代码顶部的 crate 标志，链接到了 crate 在站点 <a href="https://docs.rs">docs.rs</a> 上的完整文档，通常你在决定使用那个 crate 组件后，应该阅读一下它的文档。</p>
<h2><a class="header" href="#关于错误处理" id="关于错误处理">关于错误处理</a></h2>
<p>正确处理时，Rust 中的错误处理是健壮的，但在现今的 Rust 中，它需要大量的模板文件。正因为如此，你会发现 Rust 实例中经常充满了 <code>unwrap</code> 调用，而不是正确的错误处理。</p>
<p>由于本指南旨在提供原样重用的实例，并鼓励最佳实践。因此当涉及到 <code>Result</code> 类型时，它们可以正确地设置错误处理。</p>
<p>我们使用的基本模式是有一个 <code>fn main() -&gt; Result</code> 函数签名。</p>
<p>错误处理的结构，通常如下：</p>
<pre><pre class="playground"><code class="language-rust edition2018">use error_chain::error_chain;
use std::net::IpAddr;
use std::str;

error_chain! {
    foreign_links {
        Utf8(std::str::Utf8Error);
        AddrParse(std::net::AddrParseError);
    }
}

fn main() -&gt; Result&lt;()&gt; {
    let bytes = b&quot;2001:db8::1&quot;;

    // Bytes 格式化为 string
    let s = str::from_utf8(bytes)?;

    // String 解析为 IP address
    let addr: IpAddr = s.parse()?;

    println!(&quot;{:?}&quot;, addr);
    Ok(())
}

</code></pre></pre>
<p>使用 <code>error_chain!</code> 宏自定义 <code>Error</code> 和 <code>Result</code> 类型，以及来自两种标准库的错误类型的自动转换。自动转换使得 <code>?</code> 操作符正常运作。</p>
<p>在默认情况下——基于可读性目的——错误处理模板是隐藏的，如下代码所示。要阅读完整代码，请单击位于代码段右上角的“展开”（<i class="fa fa-expand"></i>）按钮。</p>
<pre><pre class="playground"><code class="language-rust edition2018"><span class="boring">use error_chain::error_chain;
</span>
use url::{Url, Position};
<span class="boring">
</span><span class="boring">error_chain! {
</span><span class="boring">    foreign_links {
</span><span class="boring">        UrlParse(url::ParseError);
</span><span class="boring">    }
</span><span class="boring">}
</span>
fn main() -&gt; Result&lt;()&gt; {
    let parsed = Url::parse(&quot;https://httpbin.org/cookies/set?k2=v2&amp;k1=v1&quot;)?;
    let cleaned: &amp;str = &amp;parsed[..Position::AfterPath];
    println!(&quot;cleaned: {}&quot;, cleaned);
    Ok(())
}
</code></pre></pre>
<p>要了解更多关于 Rust 错误处理的背景知识，请阅读 <a href="https://rust-lang.budshome.com/ch09-00-error-handling.html">Rust 程序设计语言（2018）中的错误处理章节</a>，以及这篇<a href="https://brson.github.io/2016/11/30/starting-with-error-chain">博客文章</a>。</p>
<h2><a class="header" href="#关于-crate-的说明" id="关于-crate-的说明">关于 crate 的说明</a></h2>
<p>本指南的最终目的是对 Rust crate 生态系统的广泛覆盖，但目前还处于引导和演示过程中，因此覆盖范围有限。我们希望从小范围开始，然后慢慢拓展，这将有助于指南更快地成为高质量的资源，并使其在增长过程中保持一致的质量水平。</p>
<p>目前，本指南聚焦在标准库、以及“核心”或“基础”方面的 crate ——这些 crate 构成了最常见的编程任务，而生态系统的其它部分则是以此为基础构建的。</p>
<p>本指南与 <a href="https://internals.rust-lang.org/t/rust-libz-blitz/5184">Rust Libz Blitz</a> 密切相关，后者是一个用于识别并提高 crate 质量的项目，因此它在很大程度上推迟了 crate 的选择。任何已经走完评估过程的 crate，都在本指南的撰写范围内，而且等待评估的 crate 也是如此。</p>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#算法-1" id="算法-1">算法</a></h1>
<!--
> [algorithms.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/algorithms.md)
> <br />
> commit - 2eee7043988e4289f16b5deca9f3b36e2516362b - 2020.04.18
-->
<h2><a class="header" href="#生成随机值-1" id="生成随机值-1">生成随机值</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="algorithms/randomness.html#%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E6%95%B0">生成随机数</a></td><td><a href="https://docs.rs/rand/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand" alt="rand-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="algorithms/randomness.html#%E7%94%9F%E6%88%90%E8%8C%83%E5%9B%B4%E5%86%85%E9%9A%8F%E6%9C%BA%E6%95%B0">生成范围内随机数</a></td><td><a href="https://docs.rs/rand/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand" alt="rand-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="algorithms/randomness.html#%E7%94%9F%E6%88%90%E7%BB%99%E5%AE%9A%E5%88%86%E5%B8%83%E9%9A%8F%E6%9C%BA%E6%95%B0">生成给定分布随机数</a></td><td><a href="https://docs.rs/rand/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand" alt="rand-badge" /></a> <a href="https://docs.rs/rand_distr/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand_distr" alt="rand_distr-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="algorithms/randomness.html#%E7%94%9F%E6%88%90%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B%E9%9A%8F%E6%9C%BA%E5%80%BC">生成自定义类型随机值</a></td><td><a href="https://docs.rs/rand/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand" alt="rand-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="algorithms/randomness.html#%E4%BB%8E%E4%B8%80%E7%BB%84%E5%AD%97%E6%AF%8D%E6%95%B0%E5%AD%97%E5%AD%97%E7%AC%A6%E5%88%9B%E5%BB%BA%E9%9A%8F%E6%9C%BA%E5%AF%86%E7%A0%81">从一组字母数字字符创建随机密码</a></td><td><a href="https://docs.rs/rand/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand" alt="rand-badge" /></a></td><td><a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a></td></tr>
<tr><td><a href="algorithms/randomness.html#%E4%BB%8E%E4%B8%80%E7%BB%84%E7%94%A8%E6%88%B7%E5%AE%9A%E4%B9%89%E5%AD%97%E7%AC%A6%E5%88%9B%E5%BB%BA%E9%9A%8F%E6%9C%BA%E5%AF%86%E7%A0%81">从一组用户定义字符创建随机密码</a></td><td><a href="https://docs.rs/rand/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand" alt="rand-badge" /></a></td><td><a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#vector-排序-1" id="vector-排序-1">Vector 排序</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="algorithms/sorting.html#%E6%95%B4%E6%95%B0-vector-%E6%8E%92%E5%BA%8F">整数 Vector 排序</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="algorithms/sorting.html#%E6%B5%AE%E7%82%B9%E6%95%B0-vector-%E6%8E%92%E5%BA%8F">浮点数 Vector 排序</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="algorithms/sorting.html#%E7%BB%93%E6%9E%84%E4%BD%93-vector-%E6%8E%92%E5%BA%8F">结构体 Vector 排序</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#生成随机值-2" id="生成随机值-2">生成随机值</a></h1>
<!--
> [algorithms/randomness.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/algorithms/randomness.md)
> <br />
> commit - 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#生成随机数" id="生成随机数">生成随机数</a></h2>
<!--
> [algorithms/randomness/rand.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/algorithms/randomness/rand.md)
> <br />
> commit - c6d6b58835980bd307a5974c6742cedf3cca022c - 2018.09.20
-->
<p><a href="https://docs.rs/rand/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand" alt="rand-badge" /></a> <a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></p>
<p>在随机数生成器 <a href="https://docs.rs/rand/*/rand/trait.Rng.html"><code>rand::Rng</code></a> 的帮助下，通过 <a href="https://docs.rs/rand/*/rand/fn.thread_rng.html"><code>rand::thread_rng</code></a> 生成随机数。可以开启多个线程，每个线程都有一个初始化的生成器。整数在其类型范围内均匀分布，浮点数是从 0 均匀分布到 1，但不包括 1。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use rand::Rng;

fn main() {
    let mut rng = rand::thread_rng();

    let n1: u8 = rng.gen();
    let n2: u16 = rng.gen();
    println!(&quot;Random u8: {}&quot;, n1);
    println!(&quot;Random u16: {}&quot;, n2);
    println!(&quot;Random u32: {}&quot;, rng.gen::&lt;u32&gt;());
    println!(&quot;Random i32: {}&quot;, rng.gen::&lt;i32&gt;());
    println!(&quot;Random float: {}&quot;, rng.gen::&lt;f64&gt;());
}
</code></pre></pre>
<h2><a class="header" href="#生成范围内随机数" id="生成范围内随机数">生成范围内随机数</a></h2>
<!--
> [algorithms/randomness/rand-range.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/algorithms/randomness/rand-range.md)
> <br />
> commit - 8d0d2e3fb1f26e4e79a914ea332096a0ba2ba2da - 2021.01.02
-->
<p><a href="https://docs.rs/rand/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand" alt="rand-badge" /></a> <a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></p>
<p>使用 <a href="https://doc.rust-lang.org/rand/*/rand/trait.Rng.html#method.gen_range"><code>Rng::gen_range</code></a>，在半开放的 <code>[0, 10)</code> 范围内（不包括 <code>10</code>）生成一个随机值。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use rand::Rng;

fn main() {
    let mut rng = rand::thread_rng();
    println!(&quot;Integer: {}&quot;, rng.gen_range(0..10));
    println!(&quot;Float: {}&quot;, rng.gen_range(0.0..10.0));
}
</code></pre></pre>
<p>使用 <a href="https://docs.rs/rand/*/rand/distributions/uniform/struct.Uniform.html"><code>Uniform</code></a> 模块可以得到<a href="https://en.wikipedia.org/wiki/Uniform_distribution_(continuous)">均匀分布</a>的值。下述代码和上述代码具有相同的效果，但在相同范围内重复生成数字时，下述代码性能可能会更好。</p>
<pre><pre class="playground"><code class="language-rust edition2018">
use rand::distributions::{Distribution, Uniform};

fn main() {
    let mut rng = rand::thread_rng();
    let die = Uniform::from(1..7);

    loop {
        let throw = die.sample(&amp;mut rng);
        println!(&quot;Roll the die: {}&quot;, throw);
        if throw == 6 {
            break;
        }
    }
}
</code></pre></pre>
<h2><a class="header" href="#生成给定分布随机数" id="生成给定分布随机数">生成给定分布随机数</a></h2>
<!--
> [algorithms/randomness/rand-dist.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/algorithms/randomness/rand-dist.md)
> <br />
> commit - 203b1085212a7b857d9a29bdc6a763515e77e0f9 - 2020.06.08
-->
<p><a href="https://docs.rs/rand_distr/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand_distr" alt="rand_distr-badge" /></a> <a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></p>
<p>默认情况下，随机数在 <code>rand</code> crate 中是<a href="https://en.wikipedia.org/wiki/Uniform_distribution_(continuous)">均匀分布</a>。<a href="https://docs.rs/rand_distr/*/rand_distr/index.html"><code>rand_distr</code></a> crate 提供其它的分布类型。如要使用，首先实例化一个分布，然后在随机数生成器 <a href="https://docs.rs/rand/*/rand/trait.Rng.html"><code>rand::Rng</code></a> 的帮助下，使用 <a href="https://docs.rs/rand/*/rand/distributions/trait.Distribution.html#tymethod.sample"><code>Distribution::sample</code></a> 从该分布中进行采样。</p>
<p>关于更多信息，阅读<a href="https://docs.rs/rand_distr/*/rand_distr/index.html">可用分布文档</a>。如下是一个使用<a href="https://docs.rs/rand_distr/*/rand_distr/struct.Normal.html"><code>正态（Normal）</code></a>分布的实例。</p>
<pre><code class="language-rust edition2018 ignore">use rand_distr::{Distribution, Normal, NormalError};
use rand::thread_rng;

fn main() -&gt; Result&lt;(), NormalError&gt; {
    let mut rng = thread_rng();
    let normal = Normal::new(2.0, 3.0)?;
    let v = normal.sample(&amp;mut rng);
    println!(&quot;{} is from a N(2, 9) distribution&quot;, v);
    Ok(())
}
</code></pre>
<h2><a class="header" href="#生成自定义类型随机值" id="生成自定义类型随机值">生成自定义类型随机值</a></h2>
<!--
> [algorithms/randomness/rand-custom.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/algorithms/randomness/rand-custom.md)
> <br />
> commit - 203b1085212a7b857d9a29bdc6a763515e77e0f9 - 2020.06.08
-->
<p><a href="https://docs.rs/rand/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand" alt="rand-badge" /></a> <a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></p>
<p>随机生成一个元组 <code>(i32, bool, f64)</code> 和用户定义类型为 <code>Point</code> 的变量。为  <a href="https://docs.rs/rand/*/rand/distributions/struct.Standard.html"><code>Standard</code></a>  实现 <a href="https://docs.rs/rand/*/rand/distributions/trait.Distribution.html"><code>Distribution</code></a> trait，以允许随机生成。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use rand::Rng;
use rand::distributions::{Distribution, Standard};

#[derive(Debug)]
struct Point {
    x: i32,
    y: i32,
}

impl Distribution&lt;Point&gt; for Standard {
    fn sample&lt;R: Rng + ?Sized&gt;(&amp;self, rng: &amp;mut R) -&gt; Point {
        let (rand_x, rand_y) = rng.gen();
        Point {
            x: rand_x,
            y: rand_y,
        }
    }
}

fn main() {
    let mut rng = rand::thread_rng();
    let rand_tuple = rng.gen::&lt;(i32, bool, f64)&gt;();
    let rand_point: Point = rng.gen();
    println!(&quot;Random tuple: {:?}&quot;, rand_tuple);
    println!(&quot;Random Point: {:?}&quot;, rand_point);
}
</code></pre></pre>
<h2><a class="header" href="#从一组字母数字字符创建随机密码" id="从一组字母数字字符创建随机密码">从一组字母数字字符创建随机密码</a></h2>
<!--
> [algorithms/randomness/rand-passwd.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/algorithms/randomness/rand-passwd.md)
> <br />
> commit - 8d0d2e3fb1f26e4e79a914ea332096a0ba2ba2da - 2021.01.02
-->
<p><a href="https://docs.rs/rand/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand" alt="rand-badge" /></a> <a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a></p>
<p>随机生成一个给定长度的 ASCII 字符串，范围为 <code>A-Z，a-z，0-9</code>，使用<a href="https://docs.rs/rand/*/rand/distributions/struct.Alphanumeric.html">字母数字</a>样本。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use rand::{thread_rng, Rng};
use rand::distributions::Alphanumeric;

fn main() {
    let rand_string: String = thread_rng()
        .sample_iter(&amp;Alphanumeric)
        .take(30)
        .map(char::from)
        .collect();

    println!(&quot;{}&quot;, rand_string);
}
</code></pre></pre>
<h2><a class="header" href="#从一组用户定义字符创建随机密码" id="从一组用户定义字符创建随机密码">从一组用户定义字符创建随机密码</a></h2>
<!--
> [algorithms/randomness/rand-choose.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/algorithms/randomness/rand-choose.md)
> <br />
> commit - 8d0d2e3fb1f26e4e79a914ea332096a0ba2ba2da - 2021.01.02
-->
<p><a href="https://docs.rs/rand/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand" alt="rand-badge" /></a> <a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a></p>
<p>使用用户自定义的字节字符串，使用 <a href="https://docs.rs/rand/*/rand/trait.Rng.html#method.gen_range"><code>gen_range</code></a> 函数，随机生成一个给定长度的 ASCII 字符串。</p>
<pre><pre class="playground"><code class="language-rust edition2018">fn main() {
    use rand::Rng;
    const CHARSET: &amp;[u8] = b&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ\
                            abcdefghijklmnopqrstuvwxyz\
                            0123456789)(*&amp;^%$#@!~&quot;;
    const PASSWORD_LEN: usize = 30;
    let mut rng = rand::thread_rng();

    let password: String = (0..PASSWORD_LEN)
        .map(|_| {
            let idx = rng.gen_range(0..CHARSET.len());
            CHARSET[idx] as char
        })
        .collect();

    println!(&quot;{:?}&quot;, password);
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#vector-排序-2" id="vector-排序-2">Vector 排序</a></h1>
<!--
> [algorithms/sorting.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/algorithms/sorting.md)
> <br />
> commit - c6d6b58835980bd307a5974c6742cedf3cca022c - 2018.09.20
-->
<h2><a class="header" href="#整数-vector-排序" id="整数-vector-排序">整数 Vector 排序</a></h2>
<!--
> [algorithms/sorting/sort.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/algorithms/sorting/sort.md)
> <br />
> commit - b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a> <a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></p>
<p>这个实例通过 <a href="https://doc.rust-lang.org/std/vec/struct.Vec.html#method.sort"><code>vec::sort</code></a> 对一个整数 Vector 进行排序。另一种方法是使用 <a href="https://doc.rust-lang.org/std/vec/struct.Vec.html#method.sort_unstable"><code>vec::sort_unstable</code></a>，后者运行速度更快一些，但不保持相等元素的顺序。</p>
<pre><pre class="playground"><code class="language-rust edition2018">fn main() {
    let mut vec = vec![1, 5, 10, 2, 15];
    
    vec.sort();

    assert_eq!(vec, vec![1, 2, 5, 10, 15]);
}
</code></pre></pre>
<h2><a class="header" href="#浮点数-vector-排序" id="浮点数-vector-排序">浮点数 Vector 排序</a></h2>
<!--
> [algorithms/sorting/sort_float.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/algorithms/sorting/sort_float.md)
> <br />
> commit - b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a> <a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></p>
<p>f32 或 f64 的 vector，可以使用 <a href="https://doc.rust-lang.org/std/primitive.slice.html#method.sort_by"><code>vec::sort_by</code></a> 和 <a href="https://doc.rust-lang.org/std/cmp/trait.PartialOrd.html#tymethod.partial_cmp"><code>PartialOrd::partial_cmp</code></a> 对其进行排序。</p>
<pre><pre class="playground"><code class="language-rust edition2018">fn main() {
    let mut vec = vec![1.1, 1.15, 5.5, 1.123, 2.0];

    vec.sort_by(|a, b| a.partial_cmp(b).unwrap());

    assert_eq!(vec, vec![1.1, 1.123, 1.15, 2.0, 5.5]);
}
</code></pre></pre>
<h2><a class="header" href="#结构体-vector-排序" id="结构体-vector-排序">结构体 Vector 排序</a></h2>
<!--
> [algorithms/sorting/sort_struct.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/algorithms/sorting/sort_struct.md)
> <br />
> commit - b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a> <a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></p>
<p>依据自然顺序（按名称和年龄），对具有 <code>name</code> 和 <code>age</code> 属性的 Person 结构体 Vector 排序。为了使 Person 可排序，你需要四个 traits：<a href="https://doc.rust-lang.org/std/cmp/trait.Eq.html"><code>Eq</code></a>、<a href="https://doc.rust-lang.org/std/cmp/trait.PartialEq.html"><code>PartialEq</code></a>、<a href="https://doc.rust-lang.org/std/cmp/trait.Ord.html"><code>Ord</code></a>，以及 <a href="https://doc.rust-lang.org/std/cmp/trait.PartialOrd.html"><code>PartialOrd</code></a>。这些 traits 可以被简单地派生。你也可以使用 <a href="https://doc.rust-lang.org/std/vec/struct.Vec.html#method.sort_by"><code>vec:sort_by</code></a> 方法自定义比较函数，仅按照年龄排序。</p>
<pre><pre class="playground"><code class="language-rust edition2018">#[derive(Debug, Eq, Ord, PartialEq, PartialOrd)]
struct Person {
    name: String,
    age: u32
}

impl Person {
    pub fn new(name: String, age: u32) -&gt; Self {
        Person {
            name,
            age
        }
    }
}

fn main() {
    let mut people = vec![
        Person::new(&quot;Zoe&quot;.to_string(), 25),
        Person::new(&quot;Al&quot;.to_string(), 60),
        Person::new(&quot;John&quot;.to_string(), 1),
    ];

    // 根据获得的自然顺序（name 和 age）对 people 进行排序
    people.sort();

    assert_eq!(
        people,
        vec![
            Person::new(&quot;Al&quot;.to_string(), 60),
            Person::new(&quot;John&quot;.to_string(), 1),
            Person::new(&quot;Zoe&quot;.to_string(), 25),
        ]);

    // 根据 age 值对 people 进行排序
    people.sort_by(|a, b| b.age.cmp(&amp;a.age));

    assert_eq!(
        people,
        vec![
            Person::new(&quot;Al&quot;.to_string(), 60),
            Person::new(&quot;Zoe&quot;.to_string(), 25),
            Person::new(&quot;John&quot;.to_string(), 1),
        ]);

}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#命令行-1" id="命令行-1">命令行</a></h1>
<!--
> [cli.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/cli.md)
> <br />
> commit - d4e44638ee8b87bb49459980e4eebd3a1d7463c8 - 2018.10.03
-->
<h2><a class="header" href="#参数解析-1" id="参数解析-1">参数解析</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="cli/arguments.html#%E8%A7%A3%E6%9E%90%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0">解析命令行参数</a></td><td><a href="https://docs.rs/clap/"><img src="https://badge-cache.kominick.com/crates/v/clap.svg?label=clap" alt="clap-badge" /></a></td><td><a href="https://crates.io/categories/command-line-interface"><img src="https://badge-cache.kominick.com/badge/command_line--x.svg?style=social" alt="cat-command-line-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#ansi-终端-1" id="ansi-终端-1">ANSI 终端</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="cli/ansi_terminal.html#ansi-%E7%BB%88%E7%AB%AF">ANSI 终端</a></td><td><a href="https://docs.rs/ansi_term/"><img src="https://badge-cache.kominick.com/crates/v/base64.svg?label=ansi_term" alt="ansi_term-badge" /></a></td><td><a href="https://crates.io/categories/command-line-interface"><img src="https://badge-cache.kominick.com/badge/command_line--x.svg?style=social" alt="cat-command-line-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#参数解析-2" id="参数解析-2">参数解析</a></h1>
<!--
> [cli/arguments.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/cli/arguments.md)
> <br />
> commit - d4e44638ee8b87bb49459980e4eebd3a1d7463c8 - 2018.10.03
-->
<h2><a class="header" href="#解析命令行参数" id="解析命令行参数">解析命令行参数</a></h2>
<!--
> [cli/arguments/clap-basic.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/cli/arguments/clap-basic.md)
> <br />
> commit - b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/clap/"><img src="https://badge-cache.kominick.com/crates/v/clap.svg?label=clap" alt="clap-badge" /></a> <a href="https://crates.io/categories/command-line-interface"><img src="https://badge-cache.kominick.com/badge/command_line--x.svg?style=social" alt="cat-command-line-badge" /></a></p>
<p>此应用程序使用 <code>clap</code> 构建器样式描述其命令行界面的结构。<a href="https://docs.rs/clap/">文档</a>还提供了另外两种可用的方法去实例化应用程序。</p>
<p>在构建器样式中，<code>with_name</code> 函数是 <code>value_of</code> 方法将用于检索传递值的唯一标识符。<code>short</code> 和 <code>long</code> 选项控制用户将要键入的标志；short 标志看起来像 <code>-f</code>，long 标志看起来像 <code>--file</code>。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use clap::{Arg, App};

fn main() {
    let matches = App::new(&quot;My Test Program&quot;)
        .version(&quot;0.1.0&quot;)
        .author(&quot;Hackerman Jones &lt;hckrmnjones@hack.gov&gt;&quot;)
        .about(&quot;Teaches argument parsing&quot;)
        .arg(Arg::with_name(&quot;file&quot;)
                 .short(&quot;f&quot;)
                 .long(&quot;file&quot;)
                 .takes_value(true)
                 .help(&quot;A cool file&quot;))
        .arg(Arg::with_name(&quot;num&quot;)
                 .short(&quot;n&quot;)
                 .long(&quot;number&quot;)
                 .takes_value(true)
                 .help(&quot;Five less than your favorite number&quot;))
        .get_matches();

    let myfile = matches.value_of(&quot;file&quot;).unwrap_or(&quot;input.txt&quot;);
    println!(&quot;The file passed is: {}&quot;, myfile);

    let num_str = matches.value_of(&quot;num&quot;);
    match num_str {
        None =&gt; println!(&quot;No idea what your favorite number is.&quot;),
        Some(s) =&gt; {
            match s.parse::&lt;i32&gt;() {
                Ok(n) =&gt; println!(&quot;Your favorite number must be {}.&quot;, n + 5),
                Err(_) =&gt; println!(&quot;That's not a number! {}&quot;, s),
            }
        }
    }
}
</code></pre></pre>
<p>使用信息由 <code>clap</code> 生成。实例应用程序的用法如下所示。</p>
<pre><code>My Test Program 0.1.0
Hackerman Jones &lt;hckrmnjones@hack.gov&gt;
Teaches argument parsing

USAGE:
    testing [OPTIONS]

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information

OPTIONS:
    -f, --file &lt;file&gt;     A cool file
    -n, --number &lt;num&gt;    Five less than your favorite number
</code></pre>
<p>我们可以通过运行如下命令来测试应用程序。</p>
<pre><code>$ cargo run -- -f myfile.txt -n 251
</code></pre>
<p>输出为：</p>
<pre><code>The file passed is: myfile.txt
Your favorite number must be 256.
</code></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#ansi-终端-2" id="ansi-终端-2">ANSI 终端</a></h1>
<!--
> [cli/ansi_terminal.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/cli/ansi_terminal.md)
> <br />
> commit - d4e44638ee8b87bb49459980e4eebd3a1d7463c8 - 2018.10.03
-->
<h2><a class="header" href="#ansi-终端-3" id="ansi-终端-3">ANSI 终端</a></h2>
<!--
> [cli/ansi_terminal/ansi_term-basic.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/cli/ansi_terminal/ansi_term-basic.md)
> <br />
> commit - ffaa6acec85e1837558384cc7ac191715931f8c9 - 2018.06.14
-->
<p><a href="https://docs.rs/ansi_term/"><img src="https://badge-cache.kominick.com/crates/v/base64.svg?label=ansi_term" alt="ansi_term-badge" /></a> <a href="https://crates.io/categories/command-line-interface"><img src="https://badge-cache.kominick.com/badge/command_line--x.svg?style=social" alt="cat-command-line-badge" /></a></p>
<p>此程序描述了 <a href="https://crates.io/crates/ansi_term"><code>ansi_term</code></a> crate 的使用方法，以及它如何用于控制 ANSI 终端上的颜色和格式，如蓝色粗体文本或黄色下划线文本。</p>
<p><a href="https://crates.io/crates/ansi_term"><code>ansi_term</code></a> 中有两种主要的数据结构：<a href="https://docs.rs/ansi_term/*/ansi_term/type.ANSIString.html"><code>ANSIString</code></a> 和 <a href="https://docs.rs/ansi_term/*/ansi_term/struct.Style.html"><code>Style</code></a>。<a href="https://docs.rs/ansi_term/*/ansi_term/struct.Style.html"><code>Style</code></a> 包含样式信息：颜色，是否粗体文本，或者是否闪烁，或者其它样式。还有 Colour 变量，代表简单的前景色样式。<a href="https://docs.rs/ansi_term/*/ansi_term/type.ANSIString.html"><code>ANSIString</code></a> 是与 <a href="https://docs.rs/ansi_term/*/ansi_term/struct.Style.html"><code>Style</code></a> 配对的字符串。</p>
<p><strong>注意</strong>：英式英语中使用 <em>Colour</em> 而不是 <em>Color</em>，不要混淆。</p>
<h3><a class="header" href="#打印彩色文本到终端" id="打印彩色文本到终端">打印彩色文本到终端</a></h3>
<pre><pre class="playground"><code class="language-rust edition2018">use ansi_term::Colour;

fn main() {
    println!(&quot;This is {} in color, {} in color and {} in color&quot;,
             Colour::Red.paint(&quot;red&quot;),
             Colour::Blue.paint(&quot;blue&quot;),
             Colour::Green.paint(&quot;green&quot;));
}
</code></pre></pre>
<h3><a class="header" href="#终端中的粗体文本" id="终端中的粗体文本">终端中的粗体文本</a></h3>
<p>对于比简单的前景色变化更复杂的事情，代码需要构造 <code>Style</code> 结构体。<a href="https://docs.rs/ansi_term/0.11.0/ansi_term/struct.Style.html#method.new"><code>Style::new()</code></a> 创建结构体，并链接属性。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use ansi_term::Style;

fn main() {
    println!(&quot;{} and this is not&quot;,
             Style::new().bold().paint(&quot;This is Bold&quot;));
}
</code></pre></pre>
<h3><a class="header" href="#终端中的粗体和彩色文本" id="终端中的粗体和彩色文本">终端中的粗体和彩色文本</a></h3>
<p><code>Colour</code> 模块实现了许多类似 <code>Style</code> 的函数，并且可以链接方法。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use ansi_term::Colour;
use ansi_term::Style;

fn main(){
    println!(&quot;{}, {} and {}&quot;,
             Colour::Yellow.paint(&quot;This is colored&quot;),
             Style::new().bold().paint(&quot;this is bold&quot;),
             Colour::Yellow.bold().paint(&quot;this is bold and colored&quot;));
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#压缩-1" id="压缩-1">压缩</a></h1>
<!--
> [compression.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/compression.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#使用-tar-包-1" id="使用-tar-包-1">使用 tar 包</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="compression/tar.html#%E8%A7%A3%E5%8E%8B-tar-%E5%8C%85">解压 tar 包</a></td><td><a href="https://docs.rs/flate2/"><img src="https://badge-cache.kominick.com/crates/v/flate2.svg?label=flate2" alt="flate2-badge" /></a> <a href="https://docs.rs/tar/"><img src="https://badge-cache.kominick.com/crates/v/tar.svg?label=tar" alt="tar-badge" /></a></td><td><a href="https://crates.io/categories/compression"><img src="https://badge-cache.kominick.com/badge/compression--x.svg?style=social" alt="cat-compression-badge" /></a></td></tr>
<tr><td><a href="compression/tar.html#%E5%8E%8B%E7%BC%A9%E7%9B%AE%E5%BD%95%E4%B8%BA-tar-%E5%8C%85">压缩目录为 tar 包</a></td><td><a href="https://docs.rs/flate2/"><img src="https://badge-cache.kominick.com/crates/v/flate2.svg?label=flate2" alt="flate2-badge" /></a> <a href="https://docs.rs/tar/"><img src="https://badge-cache.kominick.com/crates/v/tar.svg?label=tar" alt="tar-badge" /></a></td><td><a href="https://crates.io/categories/compression"><img src="https://badge-cache.kominick.com/badge/compression--x.svg?style=social" alt="cat-compression-badge" /></a></td></tr>
<tr><td><a href="compression/tar.html#%E4%BB%8E%E8%B7%AF%E5%BE%84%E7%A7%BB%E9%99%A4%E5%89%8D%E7%BC%80%E6%97%B6%E8%A7%A3%E5%8E%8B-tar-%E5%8C%85">从路径移除前缀时，解压 tar 包</a></td><td><a href="https://docs.rs/flate2/"><img src="https://badge-cache.kominick.com/crates/v/flate2.svg?label=flate2" alt="flate2-badge" /></a> <a href="https://docs.rs/tar/"><img src="https://badge-cache.kominick.com/crates/v/tar.svg?label=tar" alt="tar-badge" /></a></td><td><a href="https://crates.io/categories/compression"><img src="https://badge-cache.kominick.com/badge/compression--x.svg?style=social" alt="cat-compression-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#使用-tar-包-2" id="使用-tar-包-2">使用 tar 包</a></h1>
<!--
> [compression/tar.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/compression/tar.md)
> <br />
> commit - 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#解压-tar-包" id="解压-tar-包">解压 tar 包</a></h2>
<!--
> [compression/tar/tar-decompress.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/compression/tar/tar-decompress.md)
> <br />
> commit - b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/flate2/"><img src="https://badge-cache.kominick.com/crates/v/flate2.svg?label=flate2" alt="flate2-badge" /></a> <a href="https://docs.rs/tar/"><img src="https://badge-cache.kominick.com/crates/v/tar.svg?label=tar" alt="tar-badge" /></a> <a href="https://crates.io/categories/compression"><img src="https://badge-cache.kominick.com/badge/compression--x.svg?style=social" alt="cat-compression-badge" /></a></p>
<p>从当前工作目录中的压缩包 <code>archive.tar.gz</code>，解压（<a href="https://docs.rs/flate2/*/flate2/read/struct.GzDecoder.html"><code>GzDecoder</code></a>）和提取（<a href="https://docs.rs/tar/*/tar/struct.Archive.html#method.unpack"><code>Archive::unpack</code></a>）所有文件，并放在同一位置。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">
use std::fs::File;
use flate2::read::GzDecoder;
use tar::Archive;

fn main() -&gt; Result&lt;(), std::io::Error&gt; {
    let path = &quot;archive.tar.gz&quot;;

    let tar_gz = File::open(path)?;
    let tar = GzDecoder::new(tar_gz);
    let mut archive = Archive::new(tar);
    archive.unpack(&quot;.&quot;)?;

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#压缩目录为-tar-包" id="压缩目录为-tar-包">压缩目录为 tar 包</a></h2>
<!--
> [compression/tar/tar-compress.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/compression/tar/tar-compress.md)
> <br />
> commit - b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/flate2/"><img src="https://badge-cache.kominick.com/crates/v/flate2.svg?label=flate2" alt="flate2-badge" /></a> <a href="https://docs.rs/tar/"><img src="https://badge-cache.kominick.com/crates/v/tar.svg?label=tar" alt="tar-badge" /></a> <a href="https://crates.io/categories/compression"><img src="https://badge-cache.kominick.com/badge/compression--x.svg?style=social" alt="cat-compression-badge" /></a></p>
<p>压缩 <code>/var/log</code> 目录内的内容到 <code>archive.tar.gz</code> 压缩包中。</p>
<p>创建一个用 <a href="https://docs.rs/flate2/*/flate2/write/struct.GzEncoder.html"><code>GzEncoder</code></a> 和 <a href="https://docs.rs/tar/*/tar/struct.Builder.html"><code>tar::Builder</code></a> 包裹的 <a href="https://doc.rust-lang.org/std/fs/struct.File.html"><code>File</code></a>。</p>
<p>使用 <a href="https://docs.rs/tar/*/tar/struct.Builder.html#method.append_dir_all"><code>Builder::append_dir_all</code></a>，将 <code>/var/log</code> 目录内的内容递归添加到 <code>backup/logs</code> 路径下的归档文件中。在将数据写入压缩包 <code>archive.tar.gz</code> 之前，<a href="https://docs.rs/flate2/*/flate2/write/struct.GzEncoder.html"><code>GzEncoder</code></a> 负责清晰地将数据压缩。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">
use std::fs::File;
use flate2::Compression;
use flate2::write::GzEncoder;

fn main() -&gt; Result&lt;(), std::io::Error&gt; {
    let tar_gz = File::create(&quot;archive.tar.gz&quot;)?;
    let enc = GzEncoder::new(tar_gz, Compression::default());
    let mut tar = tar::Builder::new(enc);
    tar.append_dir_all(&quot;backup/logs&quot;, &quot;/var/log&quot;)?;
    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#从路径移除前缀时解压-tar-包" id="从路径移除前缀时解压-tar-包">从路径移除前缀时，解压 tar 包</a></h2>
<!--
> [compression/tar/tar-strip-prefix.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/compression/tar/tar-strip-prefix.md)
> <br />
> commit - b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/flate2/"><img src="https://badge-cache.kominick.com/crates/v/flate2.svg?label=flate2" alt="flate2-badge" /></a> <a href="https://docs.rs/tar/"><img src="https://badge-cache.kominick.com/crates/v/tar.svg?label=tar" alt="tar-badge" /></a> <a href="https://crates.io/categories/compression"><img src="https://badge-cache.kominick.com/badge/compression--x.svg?style=social" alt="cat-compression-badge" /></a></p>
<p>循环遍历 <a href="https://docs.rs/tar/*/tar/struct.Archive.html#method.entries"><code>Archive::entries</code></a>。使用 <a href="https://doc.rust-lang.org/std/path/struct.Path.html#method.strip_prefix"><code>Path::strip_prefix</code></a> 移除指定的路径前缀（<code>bundle/logs</code>）。最终，通过 <a href="https://docs.rs/tar/*/tar/struct.Entry.html#method.unpack"><code>Entry::unpack</code></a> 提取 <a href="https://docs.rs/tar/*/tar/struct.Entry.html"><code>tar::Entry</code></a>（tar 包中的内容）。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run"><span class="boring">use error_chain::error_chain;
</span>use std::fs::File;
use std::path::PathBuf;
use flate2::read::GzDecoder;
use tar::Archive;
<span class="boring">
</span><span class="boring">error_chain! {
</span><span class="boring">  foreign_links {
</span><span class="boring">    Io(std::io::Error);
</span><span class="boring">    StripPrefixError(::std::path::StripPrefixError);
</span><span class="boring">  }
</span><span class="boring">}
</span>
fn main() -&gt; Result&lt;()&gt; {
    let file = File::open(&quot;archive.tar.gz&quot;)?;
    let mut archive = Archive::new(GzDecoder::new(file));
    let prefix = &quot;bundle/logs&quot;;

    println!(&quot;Extracted the following files:&quot;);
    archive
        .entries()?
        .filter_map(|e| e.ok())
        .map(|mut entry| -&gt; Result&lt;PathBuf&gt; {
            let path = entry.path()?.strip_prefix(prefix)?.to_owned();
            entry.unpack(&amp;path)?;
            Ok(path)
        })
        .filter_map(|e| e.ok())
        .for_each(|x| println!(&quot;&gt; {}&quot;, x.display()));

    Ok(())
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#并发并行-1" id="并发并行-1">并发/并行</a></h1>
<!--
> [concurrency.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/concurrency.md)
> <br />
> commit 3c32c84475a2d99aa1d1b2d5d2e480aeada47293 - 2020.06.07
-->
<h2><a class="header" href="#显式线程-1" id="显式线程-1">显式线程</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="concurrency/threads.html#%E7%94%9F%E6%88%90%E7%9F%AD%E6%9C%9F%E7%BA%BF%E7%A8%8B">生成短期线程</a></td><td><a href="https://docs.rs/crossbeam/"><img src="https://badge-cache.kominick.com/crates/v/crossbeam.svg?label=crossbeam" alt="crossbeam-badge" /></a></td><td><a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a></td></tr>
<tr><td><a href="concurrency/threads.html#%E5%88%9B%E5%BB%BA%E5%B9%B6%E5%8F%91%E7%9A%84%E6%95%B0%E6%8D%AE%E7%AE%A1%E9%81%93">创建并发的数据管道</a></td><td><a href="https://docs.rs/crossbeam/"><img src="https://badge-cache.kominick.com/crates/v/crossbeam.svg?label=crossbeam" alt="crossbeam-badge" /></a></td><td><a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a></td></tr>
<tr><td><a href="concurrency/threads.html#%E5%9C%A8%E4%B8%A4%E4%B8%AA%E7%BA%BF%E7%A8%8B%E9%97%B4%E4%BC%A0%E9%80%92%E6%95%B0%E6%8D%AE">在两个线程间传递数据</a></td><td><a href="https://docs.rs/crossbeam/"><img src="https://badge-cache.kominick.com/crates/v/crossbeam.svg?label=crossbeam" alt="crossbeam-badge" /></a></td><td><a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a></td></tr>
<tr><td><a href="concurrency/threads.html#%E4%BF%9D%E6%8C%81%E5%85%A8%E5%B1%80%E5%8F%AF%E5%8F%98%E7%8A%B6%E6%80%81">保持全局可变状态</a></td><td><a href="https://docs.rs/lazy_static/"><img src="https://badge-cache.kominick.com/crates/v/lazy_static.svg?label=lazy_static" alt="lazy_static-badge" /></a></td><td><a href="https://crates.io/categories/rust-patterns"><img src="https://badge-cache.kominick.com/badge/rust_patterns--x.svg?style=social" alt="cat-rust-patterns-badge" /></a></td></tr>
<tr><td><a href="concurrency/threads.html#%E5%AF%B9%E6%89%80%E6%9C%89-iso-%E6%96%87%E4%BB%B6%E7%9A%84-sha256-%E5%80%BC%E5%B9%B6%E5%8F%91%E6%B1%82%E5%92%8C">对所有 iso 文件的 SHA256 值并发求和</a></td><td><a href="https://docs.rs/threadpool/"><img src="https://badge-cache.kominick.com/crates/v/threadpool.svg?label=threadpool" alt="threadpool-badge" /></a> <a href="https://docs.rs/walkdir/"><img src="https://badge-cache.kominick.com/crates/v/walkdir.svg?label=walkdir" alt="walkdir-badge" /></a> <a href="https://docs.rs/num_cpus/"><img src="https://badge-cache.kominick.com/crates/v/num_cpus.svg?label=num_cpus" alt="num_cpus-badge" /></a> <a href="https://briansmith.org/rustdoc/ring/"><img src="https://badge-cache.kominick.com/crates/v/ring.svg?label=ring" alt="ring-badge" /></a></td><td><a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
<tr><td><a href="concurrency/threads.html#%E5%B0%86%E7%BB%98%E5%88%B6%E5%88%86%E5%BD%A2%E7%9A%84%E7%BA%BF%E7%A8%8B%E5%88%86%E6%B4%BE%E5%88%B0%E7%BA%BF%E7%A8%8B%E6%B1%A0">将绘制分形的线程分派到线程池</a></td><td><a href="https://docs.rs/threadpool/"><img src="https://badge-cache.kominick.com/crates/v/threadpool.svg?label=threadpool" alt="threadpool-badge" /></a> <a href="https://docs.rs/num/"><img src="https://badge-cache.kominick.com/crates/v/num.svg?label=num" alt="num-badge" /></a> <a href="https://docs.rs/num_cpus/"><img src="https://badge-cache.kominick.com/crates/v/num_cpus.svg?label=num_cpus" alt="num_cpus-badge" /></a> <a href="https://docs.rs/image/"><img src="https://badge-cache.kominick.com/crates/v/image.svg?label=image" alt="image-badge" /></a></td><td><a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a><a href="https://crates.io/categories/rendering"><img src="https://badge-cache.kominick.com/badge/rendering--x.svg?style=social" alt="cat-rendering-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#数据并行-1" id="数据并行-1">数据并行</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="concurrency/parallel.html#%E5%B9%B6%E8%A1%8C%E6%94%B9%E5%8F%98%E6%95%B0%E7%BB%84%E4%B8%AD%E5%85%83%E7%B4%A0">并行改变数组中元素</a></td><td><a href="https://docs.rs/rayon/"><img src="https://badge-cache.kominick.com/crates/v/rayon.svg?label=rayon" alt="rayon-badge" /></a></td><td><a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a></td></tr>
<tr><td><a href="concurrency/parallel.html#%E5%B9%B6%E8%A1%8C%E6%B5%8B%E8%AF%95%E9%9B%86%E5%90%88%E4%B8%AD%E4%BB%BB%E6%84%8F%E6%88%96%E6%89%80%E6%9C%89%E7%9A%84%E5%85%83%E7%B4%A0%E6%98%AF%E5%90%A6%E5%8C%B9%E9%85%8D%E7%BB%99%E5%AE%9A%E6%96%AD%E8%A8%80">并行测试集合中任意或所有的元素是否匹配给定断言</a></td><td><a href="https://docs.rs/rayon/"><img src="https://badge-cache.kominick.com/crates/v/rayon.svg?label=rayon" alt="rayon-badge" /></a></td><td><a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a></td></tr>
<tr><td><a href="concurrency/parallel.html#%E4%BD%BF%E7%94%A8%E7%BB%99%E5%AE%9A%E6%96%AD%E8%A8%80%E5%B9%B6%E8%A1%8C%E6%90%9C%E7%B4%A2%E9%A1%B9">使用给定断言并行搜索项</a></td><td><a href="https://docs.rs/rayon/"><img src="https://badge-cache.kominick.com/crates/v/rayon.svg?label=rayon" alt="rayon-badge" /></a></td><td><a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a></td></tr>
<tr><td><a href="concurrency/parallel.html#%E5%AF%B9-vector-%E5%B9%B6%E8%A1%8C%E6%8E%92%E5%BA%8F">对 vector 并行排序</a></td><td><a href="https://docs.rs/rayon/"><img src="https://badge-cache.kominick.com/crates/v/rayon.svg?label=rayon" alt="rayon-badge" /></a> <a href="https://docs.rs/rand/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand" alt="rand-badge" /></a></td><td><a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a></td></tr>
<tr><td><a href="concurrency/parallel.html#map-reduce-%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97">Map-reduce 并行计算</a></td><td><a href="https://docs.rs/rayon/"><img src="https://badge-cache.kominick.com/crates/v/rayon.svg?label=rayon" alt="rayon-badge" /></a></td><td><a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a></td></tr>
<tr><td><a href="concurrency/parallel.html#%E5%B9%B6%E8%A1%8C%E7%94%9F%E6%88%90-jpg-%E7%BC%A9%E7%95%A5%E5%9B%BE">并行生成 jpg 缩略图</a></td><td><a href="https://docs.rs/rayon/"><img src="https://badge-cache.kominick.com/crates/v/rayon.svg?label=rayon" alt="rayon-badge" /></a> <a href="https://docs.rs/glob/"><img src="https://badge-cache.kominick.com/crates/v/glob.svg?label=glob" alt="glob-badge" /></a> <a href="https://docs.rs/image/"><img src="https://badge-cache.kominick.com/crates/v/image.svg?label=image" alt="image-badge" /></a></td><td><a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#显式线程-2" id="显式线程-2">显式线程</a></h1>
<!--
> [concurrency/threads.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/concurrency/threads.md)
> <br />
> commit 3c32c84475a2d99aa1d1b2d5d2e480aeada47293 - 2020.06.07
-->
<h2><a class="header" href="#生成短期线程" id="生成短期线程">生成短期线程</a></h2>
<!--
> [concurrency/thread/crossbeam-spawn.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/concurrency/thread/crossbeam-spawn.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/crossbeam/"><img src="https://badge-cache.kominick.com/crates/v/crossbeam.svg?label=crossbeam" alt="crossbeam-badge" /></a> <a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a></p>
<p>本实例使用 <a href="https://docs.rs/crossbeam/">crossbeam</a> crate 为并发和并行编程提供了数据结构和函数。<a href="https://docs.rs/crossbeam/*/crossbeam/thread/struct.Scope.html#method.spawn"><code>Scope::spawn</code></a> 生成一个新的作用域线程，该线程确保传入 <a href="https://docs.rs/crossbeam/*/crossbeam/fn.scope.html"><code>crossbeam::scope</code></a> 函数的闭包在返回之前终止，这意味着您可以从调用的函数中引用数据。</p>
<p>本实例将数组一分为二，并在不同的线程中并行计算。</p>
<pre><pre class="playground"><code class="language-rust edition2018">fn main() {
    let arr = &amp;[1, 25, -4, 10];
    let max = find_max(arr);
    assert_eq!(max, Some(25));
}

fn find_max(arr: &amp;[i32]) -&gt; Option&lt;i32&gt; {
    const THRESHOLD: usize = 2;
  
    if arr.len() &lt;= THRESHOLD {
        return arr.iter().cloned().max();
    }

    let mid = arr.len() / 2;
    let (left, right) = arr.split_at(mid);
  
    crossbeam::scope(|s| {
        let thread_l = s.spawn(|_| find_max(left));
        let thread_r = s.spawn(|_| find_max(right));
  
        let max_l = thread_l.join().unwrap()?;
        let max_r = thread_r.join().unwrap()?;
  
        Some(max_l.max(max_r))
    }).unwrap()
}
</code></pre></pre>
<h2><a class="header" href="#创建并发的数据管道" id="创建并发的数据管道">创建并发的数据管道</a></h2>
<!--
> [concurrency/thread/crossbeam-complex.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/concurrency/thread/crossbeam-complex.md)
> <br />
> commit 4789410122527d556a3520204e5bab637326e13f - 2020.07.31
-->
<p><a href="https://docs.rs/crossbeam/"><img src="https://badge-cache.kominick.com/crates/v/crossbeam.svg?label=crossbeam" alt="crossbeam-badge" /></a> <a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a></p>
<p>下面的实例使用 <a href="https://docs.rs/crossbeam/">crossbeam</a> 和 <a href="https://docs.rs/crossbeam-channel/*/crossbeam_channel/index.html">crossbeam-channel</a> 两个 crate 创建了一个并行的管道，与 ZeroMQ <a href="http://zguide.zeromq.org/page:all#Divide-and-Conquer">指南</a> 中所描述的类似：管道有一个数据源和一个数据接收器，数据在从源到接收器的过程中由两个工作线程并行处理。</p>
<p>我们使用容量由 <a href="https://docs.rs/crossbeam-channel/*/crossbeam_channel/fn.bounded.html"><code>crossbeam_channel::bounded</code></a> 分配的有界信道。生产者必须在它自己的线程上，因为它产生的消息比工作线程处理它们的速度快（因为工作线程休眠了半秒）——这意味着生产者将在对 <code>[crossbeam_channel::Sender::send</code>] 调用时阻塞半秒，直到其中一个工作线程对信道中的数据处理完毕。也请注意，信道中的数据由最先接收它的任何工作线程调用，因此每个消息都传递给单个工作线程，而不是传递给两个工作线程。</p>
<p>通过迭代器 <a href="https://docs.rs/crossbeam-channel/*/crossbeam_channel/struct.Receiver.html#method.iter"><code>crossbeam_channel::Receiver::iter</code></a> 方法从信道读取数据，这将会造成阻塞，要么等待新消息，要么直到信道关闭。因为信道是在 <a href="https://docs.rs/crossbeam/*/crossbeam/fn.scope.html"><code>crossbeam::scope</code></a> 范围内创建的，我们必须通过 <code>drop</code> 手动关闭它们，以防止整个程序阻塞工作线程的 for 循环。你可以将对 <code>drop</code> 的调用视作不再发送消息的信号。</p>
<pre><pre class="playground"><code class="language-rust">extern crate crossbeam;
extern crate crossbeam_channel;

use std::thread;
use std::time::Duration;
use crossbeam_channel::bounded;

fn main() {
    let (snd1, rcv1) = bounded(1);
    let (snd2, rcv2) = bounded(1);
    let n_msgs = 4;
    let n_workers = 2;

    crossbeam::scope(|s| {
        // 生产者线程
        s.spawn(|_| {
            for i in 0..n_msgs {
                snd1.send(i).unwrap();
                println!(&quot;Source sent {}&quot;, i);
            }
            // 关闭信道 —— 这是退出的必要条件
            // for 巡海在工作线程中
            drop(snd1);
        });

        // 由 2 个县城并行处理
        for _ in 0..n_workers {
            // 从数据源发送数据到接收器，接收器接收数据
            let (sendr, recvr) = (snd2.clone(), rcv1.clone());
            // 在不同的线程中衍生工人
            s.spawn(move |_| {
            thread::sleep(Duration::from_millis(500));
                // 接收数据，直到信道关闭前
                for msg in recvr.iter() {
                    println!(&quot;Worker {:?} received {}.&quot;,
                             thread::current().id(), msg);
                    sendr.send(msg * 2).unwrap();
                }
            });
        }
        // 关闭信道，否则接收器不会关闭
        // 退出 for 循坏
        drop(snd2);

        // 接收器
        for msg in rcv2.iter() {
            println!(&quot;Sink received {}&quot;, msg);
        }
    }).unwrap();
}
</code></pre></pre>
<h1><a class="header" href="#在两个线程间传递数据" id="在两个线程间传递数据">在两个线程间传递数据</a></h1>
<!--
> [concurrency/thread/crossbeam-spsc.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/concurrency/thread/crossbeam-spsc.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/crossbeam/"><img src="https://badge-cache.kominick.com/crates/v/crossbeam.svg?label=crossbeam" alt="crossbeam-badge" /></a> <a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a></p>
<p>这个实例示范了在单生产者、单消费者（SPSC）环境中使用 <a href="https://docs.rs/crossbeam-channel/*/crossbeam_channel/index.html">crossbeam-channel</a>。我们构建的<a href="concurrency/threads.html#%E7%94%9F%E6%88%90%E7%9F%AD%E6%9C%9F%E7%BA%BF%E7%A8%8B">生成短期线程</a>实例中，使用 <a href="https://docs.rs/crossbeam/*/crossbeam/fn.scope.html"><code>crossbeam::scope</code></a> 和 <a href="https://docs.rs/crossbeam/*/crossbeam/thread/struct.Scope.html#method.spawn"><code>Scope::spawn</code></a> 来管理生产者线程。在两个线程之间，使用 <a href="https://docs.rs/crossbeam-channel/*/crossbeam_channel/fn.unbounded.html"><code>crossbeam_channel::unbounded</code></a> 信道交换数据，这意味着可存储消息的数量没有限制。生产者线程在消息之间休眠半秒。</p>
<pre><pre class="playground"><code class="language-rust edition2018">
use std::{thread, time};
use crossbeam_channel::unbounded;

fn main() {
    let (snd, rcv) = unbounded();
    let n_msgs = 5;
    crossbeam::scope(|s| {
        s.spawn(|_| {
            for i in 0..n_msgs {
                snd.send(i).unwrap();
                thread::sleep(time::Duration::from_millis(100));
            }
        });
    }).unwrap();
    for _ in 0..n_msgs {
        let msg = rcv.recv().unwrap();
        println!(&quot;Received {}&quot;, msg);
    }
}
</code></pre></pre>
<h2><a class="header" href="#保持全局可变状态" id="保持全局可变状态">保持全局可变状态</a></h2>
<!--
> [concurrency/thread/global-mut-state.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/concurrency/thread/global-mut-state.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/lazy_static/"><img src="https://badge-cache.kominick.com/crates/v/lazy_static.svg?label=lazy_static" alt="lazy_static-badge" /></a> <a href="https://crates.io/categories/rust-patterns"><img src="https://badge-cache.kominick.com/badge/rust_patterns--x.svg?style=social" alt="cat-rust-patterns-badge" /></a></p>
<p>使用 <a href="https://docs.rs/lazy_static/">lazy_static</a> 声明全局状态。<a href="https://docs.rs/lazy_static/">lazy_static</a> 创建了一个全局可用的 <code>static ref</code>，它需要 <a href="https://doc.rust-lang.org/std/sync/struct.Mutex.html"><code>Mutex</code></a> 来允许变化（请参阅 <a href="https://doc.rust-lang.org/std/sync/struct.RwLock.html"><code>RwLock</code></a>）。在 <a href="https://doc.rust-lang.org/std/sync/struct.Mutex.html"><code>Mutex</code></a> 的包裹下，保证了状态不能被多个线程同时访问，从而防止出现争用情况。必须获取 <a href="https://doc.rust-lang.org/std/sync/struct.MutexGuard.html"><code>MutexGuard</code></a>，方可读取或更改存储在 <a href="https://doc.rust-lang.org/std/sync/struct.Mutex.html"><code>Mutex</code></a> 中的值。</p>
<pre><pre class="playground"><code class="language-rust edition2018"><span class="boring">use error_chain::error_chain;
</span>use lazy_static::lazy_static;
use std::sync::Mutex;
<span class="boring">
</span><span class="boring">error_chain!{ }
</span>
lazy_static! {
    static ref FRUIT: Mutex&lt;Vec&lt;String&gt;&gt; = Mutex::new(Vec::new());
}

fn insert(fruit: &amp;str) -&gt; Result&lt;()&gt; {
    let mut db = FRUIT.lock().map_err(|_| &quot;Failed to acquire MutexGuard&quot;)?;
    db.push(fruit.to_string());
    Ok(())
}

fn main() -&gt; Result&lt;()&gt; {
    insert(&quot;apple&quot;)?;
    insert(&quot;orange&quot;)?;
    insert(&quot;peach&quot;)?;
    {
        let db = FRUIT.lock().map_err(|_| &quot;Failed to acquire MutexGuard&quot;)?;

        db.iter().enumerate().for_each(|(i, item)| println!(&quot;{}: {}&quot;, i, item));
    }
    insert(&quot;grape&quot;)?;
    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#对所有-iso-文件的-sha256-值并发求和" id="对所有-iso-文件的-sha256-值并发求和">对所有 iso 文件的 SHA256 值并发求和</a></h2>
<!--
> [concurrency/thread/threadpool-walk.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/concurrency/thread/threadpool-walk.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/threadpool/"><img src="https://badge-cache.kominick.com/crates/v/threadpool.svg?label=threadpool" alt="threadpool-badge" /></a> <a href="https://docs.rs/num_cpus/"><img src="https://badge-cache.kominick.com/crates/v/num_cpus.svg?label=num_cpus" alt="num_cpus-badge" /></a> <a href="https://docs.rs/walkdir/"><img src="https://badge-cache.kominick.com/crates/v/walkdir.svg?label=walkdir" alt="walkdir-badge" /></a> <a href="https://briansmith.org/rustdoc/ring/"><img src="https://badge-cache.kominick.com/crates/v/ring.svg?label=ring" alt="ring-badge" /></a> <a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></p>
<p>下面的实例计算了当前目录中每个扩展名为 iso 的文件的 SHA256 哈希值。线程池生成的线程数与使用 <a href="https://docs.rs/num_cpus/*/num_cpus/fn.get.html"><code>num_cpus::get</code></a> 获取的系统内核数相等。<a href="https://docs.rs/walkdir/*/walkdir/struct.WalkDir.html#method.new"><code>Walkdir::new</code></a> 遍历当前目录，并调用 <a href="https://docs.rs/threadpool/*/threadpool/struct.ThreadPool.html#method.execute"><code>execute</code></a> 来执行读取和计算 SHA256 哈希值的操作。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">
use walkdir::WalkDir;
use std::fs::File;
use std::io::{BufReader, Read, Error};
use std::path::Path;
use threadpool::ThreadPool;
use std::sync::mpsc::channel;
use ring::digest::{Context, Digest, SHA256};

<span class="boring">// Verify the iso extension
</span><span class="boring">fn is_iso(entry: &amp;Path) -&gt; bool {
</span><span class="boring">    match entry.extension() {
</span><span class="boring">        Some(e) if e.to_string_lossy().to_lowercase() == &quot;iso&quot; =&gt; true,
</span><span class="boring">        _ =&gt; false,
</span><span class="boring">    }
</span><span class="boring">}
</span>
fn compute_digest&lt;P: AsRef&lt;Path&gt;&gt;(filepath: P) -&gt; Result&lt;(Digest, P), Error&gt; {
    let mut buf_reader = BufReader::new(File::open(&amp;filepath)?);
    let mut context = Context::new(&amp;SHA256);
    let mut buffer = [0; 1024];

    loop {
        let count = buf_reader.read(&amp;mut buffer)?;
        if count == 0 {
            break;
        }
        context.update(&amp;buffer[..count]);
    }

    Ok((context.finish(), filepath))
}

fn main() -&gt; Result&lt;(), Error&gt; {
    let pool = ThreadPool::new(num_cpus::get());

    let (tx, rx) = channel();

    for entry in WalkDir::new(&quot;/home/user/Downloads&quot;)
        .follow_links(true)
        .into_iter()
        .filter_map(|e| e.ok())
        .filter(|e| !e.path().is_dir() &amp;&amp; is_iso(e.path())) {
            let path = entry.path().to_owned();
            let tx = tx.clone();
            pool.execute(move || {
                let digest = compute_digest(path);
                tx.send(digest).expect(&quot;Could not send data!&quot;);
            });
        }

    drop(tx);
    for t in rx.iter() {
        let (sha, path) = t?;
        println!(&quot;{:?} {:?}&quot;, sha, path);
    }
    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#将绘制分形的线程分派到线程池" id="将绘制分形的线程分派到线程池">将绘制分形的线程分派到线程池</a></h2>
<!--
> [concurrency/thread/threadpool-fractal.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/concurrency/thread/threadpool-fractal.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/threadpool/"><img src="https://badge-cache.kominick.com/crates/v/threadpool.svg?label=threadpool" alt="threadpool-badge" /></a> <a href="https://docs.rs/num/"><img src="https://badge-cache.kominick.com/crates/v/num.svg?label=num" alt="num-badge" /></a> <a href="https://docs.rs/num_cpus/"><img src="https://badge-cache.kominick.com/crates/v/num_cpus.svg?label=num_cpus" alt="num_cpus-badge" /></a> <a href="https://docs.rs/image/"><img src="https://badge-cache.kominick.com/crates/v/image.svg?label=image" alt="image-badge" /></a> <a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a><a href="https://crates.io/categories/rendering"><img src="https://badge-cache.kominick.com/badge/rendering--x.svg?style=social" alt="cat-rendering-badge" /></a></p>
<p>此实例通过从<a href="https://en.wikipedia.org/wiki/Julia_set">朱莉娅集</a>绘制分形来生成图像，该集合具有用于分布式计算的线程池。</p>
<p><a href="https://cloud.githubusercontent.com/assets/221000/26546700/9be34e80-446b-11e7-81dc-dd9871614ea1.png"><img src="https://cloud.githubusercontent.com/assets/221000/26546700/9be34e80-446b-11e7-81dc-dd9871614ea1.png" width="300" /></a></p>
<p>使用 <a href="https://docs.rs/image/*/image/struct.ImageBuffer.html#method.new"><code>ImageBuffer::new</code></a> 为指定宽度和高度的输出图像分配内存，<a href="https://docs.rs/image/*/image/struct.Rgb.html#method.from_channels"><code>Rgb::from_channels</code></a> 信道则计算输出图像的 RGB 像素值。使用 <a href="https://docs.rs/threadpool/*/threadpool/struct.ThreadPool.html"><code>ThreadPool</code></a> 创建线程池，线程池中的线程数量和使用 <a href="https://docs.rs/num_cpus/*/num_cpus/fn.get.html"><code>num_cpus::get</code></a> 获取的系统内核数相等。<a href="https://docs.rs/threadpool/*/threadpool/struct.ThreadPool.html#method.execute"><code>ThreadPool::execute</code></a> 将每个像素作为单独的作业接收。</p>
<p><a href="https://doc.rust-lang.org/std/sync/mpsc/fn.channel.html"><code>mpsc::channel</code></a> 信道接收作业，<a href="https://doc.rust-lang.org/std/sync/mpsc/struct.Receiver.html#method.recv"><code>Receiver::recv</code></a> 接收器则检索作业。<a href="https://docs.rs/image/*/image/struct.ImageBuffer.html#method.put_pixel"><code>ImageBuffer::put_pixel</code></a> 处理数据，设置像素颜色。最后，<a href="https://docs.rs/image/*/image/struct.ImageBuffer.html#method.save"><code>ImageBuffer::save</code></a> 将图像存储为 <code>output.png</code>。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run"><span class="boring">use error_chain::error_chain;
</span>use std::sync::mpsc::{channel, RecvError};
use threadpool::ThreadPool;
use num::complex::Complex;
use image::{ImageBuffer, Pixel, Rgb};
<span class="boring">
</span><span class="boring">error_chain! {
</span><span class="boring">    foreign_links {
</span><span class="boring">        MpscRecv(RecvError);
</span><span class="boring">        Io(std::io::Error);
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">// 将强度值转换为 RGB 值的函数
</span><span class="boring">// 基于 http://www.efg2.com/Lab/ScienceAndEngineering/Spectra.htm
</span><span class="boring">fn wavelength_to_rgb(wavelength: u32) -&gt; Rgb&lt;u8&gt; {
</span><span class="boring">    let wave = wavelength as f32;
</span><span class="boring">
</span><span class="boring">    let (r, g, b) = match wavelength {
</span><span class="boring">        380..=439 =&gt; ((440. - wave) / (440. - 380.), 0.0, 1.0),
</span><span class="boring">        440..=489 =&gt; (0.0, (wave - 440.) / (490. - 440.), 1.0),
</span><span class="boring">        490..=509 =&gt; (0.0, 1.0, (510. - wave) / (510. - 490.)),
</span><span class="boring">        510..=579 =&gt; ((wave - 510.) / (580. - 510.), 1.0, 0.0),
</span><span class="boring">        580..=644 =&gt; (1.0, (645. - wave) / (645. - 580.), 0.0),
</span><span class="boring">        645..=780 =&gt; (1.0, 0.0, 0.0),
</span><span class="boring">        _ =&gt; (0.0, 0.0, 0.0),
</span><span class="boring">    };
</span><span class="boring">
</span><span class="boring">    let factor = match wavelength {
</span><span class="boring">        380..=419 =&gt; 0.3 + 0.7 * (wave - 380.) / (420. - 380.),
</span><span class="boring">        701..=780 =&gt; 0.3 + 0.7 * (780. - wave) / (780. - 700.),
</span><span class="boring">        _ =&gt; 1.0,
</span><span class="boring">    };
</span><span class="boring">
</span><span class="boring">    let (r, g, b) = (normalize(r, factor), normalize(g, factor), normalize(b, factor));
</span><span class="boring">    Rgb::from_channels(r, g, b, 0)
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">// 将茱莉亚集距离映射为强度值
</span><span class="boring">fn julia(c: Complex&lt;f32&gt;, x: u32, y: u32, width: u32, height: u32, max_iter: u32) -&gt; u32 {
</span><span class="boring">    let width = width as f32;
</span><span class="boring">    let height = height as f32;
</span><span class="boring">
</span><span class="boring">    let mut z = Complex {
</span><span class="boring">        // scale and translate the point to image coordinates
</span><span class="boring">        re: 3.0 * (x as f32 - 0.5 * width) / width,
</span><span class="boring">        im: 2.0 * (y as f32 - 0.5 * height) / height,
</span><span class="boring">    };
</span><span class="boring">
</span><span class="boring">    let mut i = 0;
</span><span class="boring">    for t in 0..max_iter {
</span><span class="boring">        if z.norm() &gt;= 2.0 {
</span><span class="boring">            break;
</span><span class="boring">        }
</span><span class="boring">        z = z * z + c;
</span><span class="boring">        i = t;
</span><span class="boring">    }
</span><span class="boring">    i
</span><span class="boring">}
</span><span class="boring">
</span><span class="boring">// 规格 RGB 颜色值范围内的强度值
</span><span class="boring">fn normalize(color: f32, factor: f32) -&gt; u8 {
</span><span class="boring">    ((color * factor).powf(0.8) * 255.) as u8
</span><span class="boring">}
</span>
fn main() -&gt; Result&lt;()&gt; {
    let (width, height) = (1920, 1080);
    let mut img = ImageBuffer::new(width, height);
    let iterations = 300;

    let c = Complex::new(-0.8, 0.156);

    let pool = ThreadPool::new(num_cpus::get());
    let (tx, rx) = channel();

    for y in 0..height {
        let tx = tx.clone();
        pool.execute(move || for x in 0..width {
                         let i = julia(c, x, y, width, height, iterations);
                         let pixel = wavelength_to_rgb(380 + i * 400 / iterations);
                         tx.send((x, y, pixel)).expect(&quot;Could not send data!&quot;);
                     });
    }

    for _ in 0..(width * height) {
        let (x, y, pixel) = rx.recv()?;
        img.put_pixel(x, y, pixel);
    }
    let _ = img.save(&quot;output.png&quot;)?;
    Ok(())
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#数据并行-2" id="数据并行-2">数据并行</a></h1>
<!--
> [concurrency/parallel.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/concurrency/parallel.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#并行改变数组中元素" id="并行改变数组中元素">并行改变数组中元素</a></h2>
<!--
> [concurrency/parallel/rayon-iter-mut.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/concurrency/parallel/rayon-iter-mut.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/rayon/"><img src="https://badge-cache.kominick.com/crates/v/rayon.svg?label=rayon" alt="rayon-badge" /></a> <a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a></p>
<p>下面的实例使用了 <code>rayon</code> crate，这是一个 Rust 程序设计语言的数据并行库。<code>rayon</code> 为任何并行可迭代的数据类型提供 <a href="https://docs.rs/rayon/*/rayon/iter/trait.IntoParallelRefMutIterator.html#tymethod.par_iter_mut"><code>par_iter_mut</code></a> 方法。这是一个类迭代器的链，可以对链内的数据并行计算。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use rayon::prelude::*;

fn main() {
    let mut arr = [0, 7, 9, 11];
    arr.par_iter_mut().for_each(|p| *p -= 1);
    println!(&quot;{:?}&quot;, arr);
}
</code></pre></pre>
<h2><a class="header" href="#并行测试集合中任意或所有的元素是否匹配给定断言" id="并行测试集合中任意或所有的元素是否匹配给定断言">并行测试集合中任意或所有的元素是否匹配给定断言</a></h2>
<!--
> [concurrency/parallel/rayon-any-all.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/concurrency/parallel/rayon-any-all.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/rayon/"><img src="https://badge-cache.kominick.com/crates/v/rayon.svg?label=rayon" alt="rayon-badge" /></a> <a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a></p>
<p>这个实例示范如何使用 <a href="https://docs.rs/rayon/*/rayon/iter/trait.ParallelIterator.html#method.any"><code>rayon::any</code></a> 和 <a href="https://docs.rs/rayon/*/rayon/iter/trait.ParallelIterator.html#method.all"><code>rayon::all</code></a> 方法，这两个方法是分别与 <a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.any"><code>std::any</code></a> 和 <a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.all"><code>std::all</code></a> 相对应的并行方法。<a href="https://docs.rs/rayon/*/rayon/iter/trait.ParallelIterator.html#method.any"><code>rayon::any</code></a> 并行检查迭代器的任意元素是否与断言匹配，并在找到一个匹配的元素时就返回。<a href="https://docs.rs/rayon/*/rayon/iter/trait.ParallelIterator.html#method.all"><code>rayon::all</code></a> 并行检查迭代器的所有元素是否与断言匹配，并在找到不匹配的元素时立即返回。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use rayon::prelude::*;

fn main() {
    let mut vec = vec![2, 4, 6, 8];

    assert!(!vec.par_iter().any(|n| (*n % 2) != 0));
    assert!(vec.par_iter().all(|n| (*n % 2) == 0));
    assert!(!vec.par_iter().any(|n| *n &gt; 8 ));
    assert!(vec.par_iter().all(|n| *n &lt;= 8 ));

    vec.push(9);

    assert!(vec.par_iter().any(|n| (*n % 2) != 0));
    assert!(!vec.par_iter().all(|n| (*n % 2) == 0));
    assert!(vec.par_iter().any(|n| *n &gt; 8 ));
    assert!(!vec.par_iter().all(|n| *n &lt;= 8 )); 
}
</code></pre></pre>
<h2><a class="header" href="#使用给定断言并行搜索项" id="使用给定断言并行搜索项">使用给定断言并行搜索项</a></h2>
<!--
> [concurrency/parallel/rayon-parallel-search.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/concurrency/parallel/rayon-parallel-search.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/rayon/"><img src="https://badge-cache.kominick.com/crates/v/rayon.svg?label=rayon" alt="rayon-badge" /></a> <a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a></p>
<p>下面的实例使用 <a href="https://docs.rs/rayon/*/rayon/iter/trait.ParallelIterator.html#method.find_any"><code>rayon::find_any</code></a> 和 <a href="https://docs.rs/rayon/*/rayon/iter/trait.IntoParallelRefIterator.html#tymethod.par_iter"><code>par_iter</code></a> 并行搜索 vector 集合，以查找满足指定闭包中的断言的元素。</p>
<p>如果有多个元素满足 <a href="https://docs.rs/rayon/*/rayon/iter/trait.ParallelIterator.html#method.find_any"><code>rayon::find_any</code></a> 闭包参数中定义的断言，<code>rayon</code> 将返回搜索发现的第一个元素，但不一定是 vector 集合的第一个元素。 </p>
<p>请注意，实例中闭包的参数是对引用的引用（<code>&amp;&amp;x</code>）。有关更多详细信息，请参阅关于 <a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.find"><code>std::find</code></a> 的讨论。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use rayon::prelude::*;

fn main() {
    let v = vec![6, 2, 1, 9, 3, 8, 11];

    let f1 = v.par_iter().find_any(|&amp;&amp;x| x == 9);
    let f2 = v.par_iter().find_any(|&amp;&amp;x| x % 2 == 0 &amp;&amp; x &gt; 6);
    let f3 = v.par_iter().find_any(|&amp;&amp;x| x &gt; 8);

    assert_eq!(f1, Some(&amp;9));
    assert_eq!(f2, Some(&amp;8));
    assert!(f3 &gt; Some(&amp;8));
}
</code></pre></pre>
<h2><a class="header" href="#对-vector-并行排序" id="对-vector-并行排序">对 vector 并行排序</a></h2>
<!--
> [concurrency/parallel/rayon-parallel-sort.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/concurrency/parallel/rayon-parallel-sort.md)
> <br />
> commit 203b1085212a7b857d9a29bdc6a763515e77e0f9 - 2020.06.08
-->
<p><a href="https://docs.rs/rayon/"><img src="https://badge-cache.kominick.com/crates/v/rayon.svg?label=rayon" alt="rayon-badge" /></a> <a href="https://docs.rs/rand/"><img src="https://badge-cache.kominick.com/crates/v/rand.svg?label=rand" alt="rand-badge" /></a> <a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a></p>
<p>本实例对字符串 vector 并行排序。</p>
<p>首先，分配空字符串 vector；然后，通过 <code>par_iter_mut().for_each</code> 并行对 vector 填充随机值。尽管存在<a href="https://docs.rs/rayon/*/rayon/slice/trait.ParallelSliceMut.html">多种选择</a>，可以对可枚举数据类型进行排序，但 <a href="https://docs.rs/rayon/*/rayon/slice/trait.ParallelSliceMut.html#method.par_sort_unstable"><code>par_sort_unstable</code></a> 通常比<a href="https://docs.rs/rayon/*/rayon/slice/trait.ParallelSliceMut.html#method.par_sort">稳定排序（相同的值排序后相对顺序不变）</a>算法快。</p>
<pre><pre class="playground"><code class="language-rust edition2018">
use rand::{Rng, thread_rng};
use rand::distributions::Alphanumeric;
use rayon::prelude::*;

fn main() {
  let mut vec = vec![String::new(); 100_000];
  vec.par_iter_mut().for_each(|p| {
    let mut rng = thread_rng();
    *p = (0..5).map(|_| rng.sample(&amp;Alphanumeric)).collect()
  });
  vec.par_sort_unstable();
}
</code></pre></pre>
<h2><a class="header" href="#map-reduce-并行计算" id="map-reduce-并行计算">Map-reduce 并行计算</a></h2>
<!--
> [concurrency/parallel/rayon-map-reduce.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/concurrency/parallel/rayon-map-reduce.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/rayon/"><img src="https://badge-cache.kominick.com/crates/v/rayon.svg?label=rayon" alt="rayon-badge" /></a> <a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a></p>
<p>此实例使用 <a href="https://docs.rs/rayon/*/rayon/iter/trait.ParallelIterator.html#method.filter"><code>rayon::filter</code></a>、<a href="https://docs.rs/rayon/*/rayon/iter/trait.ParallelIterator.html#method.map"><code>rayon::map</code></a>，以及 <a href="https://docs.rs/rayon/*/rayon/iter/trait.ParallelIterator.html#method.reduce"><code>rayon::reduce</code></a> 计算 <code>Person</code> 对象中年龄超过 30 岁的那些人的平均年龄。</p>
<p><a href="https://docs.rs/rayon/*/rayon/iter/trait.ParallelIterator.html#method.filter"><code>rayon::filter</code></a> 过滤集合中满足给定断言的元素。<a href="https://docs.rs/rayon/*/rayon/iter/trait.ParallelIterator.html#method.map"><code>rayon::map</code></a> 对每个元素执行一次计算，创建一个新的迭代；然后，基于前一次的 reduce 计算结果和当前元素一起，<a href="https://docs.rs/rayon/*/rayon/iter/trait.ParallelIterator.html#method.reduce"><code>rayon::reduce</code></a> 执行新的计算。也可以查看 <a href="https://docs.rs/rayon/*/rayon/iter/trait.ParallelIterator.html#method.sum"><code>rayon::sum</code></a>，它与本实例中的 reduce 计算具有相同的结果。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use rayon::prelude::*;

struct Person {
    age: u32,
}

fn main() {
    let v: Vec&lt;Person&gt; = vec![
        Person { age: 23 },
        Person { age: 19 },
        Person { age: 42 },
        Person { age: 17 },
        Person { age: 17 },
        Person { age: 31 },
        Person { age: 30 },
    ];

    let num_over_30 = v.par_iter().filter(|&amp;x| x.age &gt; 30).count() as f32;
    let sum_over_30 = v.par_iter()
        .map(|x| x.age)
        .filter(|&amp;x| x &gt; 30)
        .reduce(|| 0, |x, y| x + y);

    let alt_sum_30: u32 = v.par_iter()
        .map(|x| x.age)
        .filter(|&amp;x| x &gt; 30)
        .sum();

    let avg_over_30 = sum_over_30 as f32 / num_over_30;
    let alt_avg_over_30 = alt_sum_30 as f32/ num_over_30;

    assert!((avg_over_30 - alt_avg_over_30).abs() &lt; std::f32::EPSILON);
    println!(&quot;The average age of people older than 30 is {}&quot;, avg_over_30);
}
</code></pre></pre>
<h2><a class="header" href="#并行生成-jpg-缩略图" id="并行生成-jpg-缩略图">并行生成 jpg 缩略图</a></h2>
<!--
> [concurrency/parallel/rayon-thumbnails.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/concurrency/parallel/rayon-thumbnails.md)
> <br />
> commit 203b1085212a7b857d9a29bdc6a763515e77e0f9 - 2020.06.08
-->
<p><a href="https://docs.rs/rayon/"><img src="https://badge-cache.kominick.com/crates/v/rayon.svg?label=rayon" alt="rayon-badge" /></a> <a href="https://docs.rs/glob/"><img src="https://badge-cache.kominick.com/crates/v/glob.svg?label=glob" alt="glob-badge" /></a> <a href="https://docs.rs/image/"><img src="https://badge-cache.kominick.com/crates/v/image.svg?label=image" alt="image-badge" /></a> <a href="https://crates.io/categories/concurrency"><img src="https://badge-cache.kominick.com/badge/concurrency--x.svg?style=social" alt="cat-concurrency-badge" /></a> <a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></p>
<p>本实例为当前目录中的所有 .jpg 图像文件生成缩略图，然后将生成的缩略图保存在一个名为 <code>thumbnails</code> 的新文件夹中。</p>
<p><a href="https://docs.rs/glob/*/glob/fn.glob_with.html"><code>glob::glob_with</code></a> 在当前目录中查找 jpeg 图像文件，<code>rayon</code> 通过 <a href="https://docs.rs/rayon/*/rayon/iter/trait.IntoParallelRefIterator.html#tymethod.par_iter"><code>par_iter</code></a> 方法调用 <a href="https://docs.rs/image/*/image/enum.DynamicImage.html#method.resize"><code>DynamicImage::resize</code></a>，并行地调整图像大小。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run"><span class="boring">use error_chain::error_chain;
</span>
use std::path::Path;
use std::fs::create_dir_all;

<span class="boring">use error_chain::ChainedError;
</span>use glob::{glob_with, MatchOptions};
use image::{FilterType, ImageError};
use rayon::prelude::*;

<span class="boring">error_chain! {
</span><span class="boring">    foreign_links {
</span><span class="boring">        Image(ImageError);
</span><span class="boring">        Io(std::io::Error);
</span><span class="boring">        Glob(glob::PatternError);
</span><span class="boring">    }
</span><span class="boring">}
</span>
fn main() -&gt; Result&lt;()&gt; {
    let options: MatchOptions = Default::default();
    let files: Vec&lt;_&gt; = glob_with(&quot;*.jpg&quot;, options)?
        .filter_map(|x| x.ok())
        .collect();

    if files.len() == 0 {
        error_chain::bail!(&quot;No .jpg files found in current directory&quot;);
    }

    let thumb_dir = &quot;thumbnails&quot;;
    create_dir_all(thumb_dir)?;

    println!(&quot;Saving {} thumbnails into '{}'...&quot;, files.len(), thumb_dir);

    let image_failures: Vec&lt;_&gt; = files
        .par_iter()
        .map(|path| {
            make_thumbnail(path, thumb_dir, 300)
                .map_err(|e| e.chain_err(|| path.display().to_string()))
        })
        .filter_map(|x| x.err())
        .collect();

    image_failures.iter().for_each(|x| println!(&quot;{}&quot;, x.display_chain()));

    println!(&quot;{} thumbnails saved successfully&quot;, files.len() - image_failures.len());
    Ok(())
}

fn make_thumbnail&lt;PA, PB&gt;(original: PA, thumb_dir: PB, longest_edge: u32) -&gt; Result&lt;()&gt;
where
    PA: AsRef&lt;Path&gt;,
    PB: AsRef&lt;Path&gt;,
{
    let img = image::open(original.as_ref())?;
    let file_path = thumb_dir.as_ref().join(original);

    Ok(img.resize(longest_edge, longest_edge, FilterType::Nearest)
        .save(file_path)?)
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#密码学-1" id="密码学-1">密码学</a></h1>
<!--
> [cryptography.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/cryptography.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#散列哈希-1" id="散列哈希-1">散列（哈希）</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="cryptography/hashing.html#%E8%AE%A1%E7%AE%97%E6%96%87%E4%BB%B6%E7%9A%84-sha-256-%E6%91%98%E8%A6%81">计算文件的 SHA-256 摘要</a></td><td><a href="https://briansmith.org/rustdoc/ring/"><img src="https://badge-cache.kominick.com/crates/v/ring.svg?label=ring" alt="ring-badge" /></a> <a href="https://docs.rs/data-encoding/"><img src="https://badge-cache.kominick.com/crates/v/data-encoding.svg?label=data-encoding" alt="data-encoding-badge" /></a></td><td><a href="https://crates.io/categories/cryptography"><img src="https://badge-cache.kominick.com/badge/cryptography--x.svg?style=social" alt="cat-cryptography-badge" /></a></td></tr>
<tr><td><a href="cryptography/hashing.html#%E4%BD%BF%E7%94%A8-hmac-%E6%91%98%E8%A6%81%E5%AF%B9%E6%B6%88%E6%81%AF%E8%BF%9B%E8%A1%8C%E7%AD%BE%E5%90%8D%E5%92%8C%E9%AA%8C%E8%AF%81">使用 HMAC 摘要对消息进行签名和验证</a></td><td><a href="https://briansmith.org/rustdoc/ring/"><img src="https://badge-cache.kominick.com/crates/v/ring.svg?label=ring" alt="ring-badge" /></a></td><td><a href="https://crates.io/categories/cryptography"><img src="https://badge-cache.kominick.com/badge/cryptography--x.svg?style=social" alt="cat-cryptography-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#加密-1" id="加密-1">加密</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="cryptography/encryption.html#%E4%BD%BF%E7%94%A8-pbkdf2-%E5%AF%B9%E5%AF%86%E7%A0%81%E8%BF%9B%E8%A1%8C%E5%8A%A0%E5%AF%86salt%E5%92%8C%E6%95%A3%E5%88%97hash%E8%BF%90%E7%AE%97">使用 PBKDF2 对密码进行加密（salt）和散列（hash）运算</a></td><td><a href="https://briansmith.org/rustdoc/ring/"><img src="https://badge-cache.kominick.com/crates/v/ring.svg?label=ring" alt="ring-badge" /></a> <a href="https://docs.rs/data-encoding/"><img src="https://badge-cache.kominick.com/crates/v/data-encoding.svg?label=data-encoding" alt="data-encoding-badge" /></a></td><td><a href="https://crates.io/categories/cryptography"><img src="https://badge-cache.kominick.com/badge/cryptography--x.svg?style=social" alt="cat-cryptography-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#散列哈希-2" id="散列哈希-2">散列（哈希）</a></h1>
<!--
> [cryptography/hashing.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/cryptography/hashing.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#计算文件的-sha-256-摘要" id="计算文件的-sha-256-摘要">计算文件的 SHA-256 摘要</a></h2>
<!--
> [cryptography/hashing/sha-digest.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/cryptography/hashing/sha-digest.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://briansmith.org/rustdoc/ring/"><img src="https://badge-cache.kominick.com/crates/v/ring.svg?label=ring" alt="ring-badge" /></a> <a href="https://docs.rs/data-encoding/"><img src="https://badge-cache.kominick.com/crates/v/data-encoding.svg?label=data-encoding" alt="data-encoding-badge" /></a> <a href="https://crates.io/categories/cryptography"><img src="https://badge-cache.kominick.com/badge/cryptography--x.svg?style=social" alt="cat-cryptography-badge" /></a></p>
<p>如下实例中，先创建文件，写入一些数据。然后使用 <a href="https://briansmith.org/rustdoc/ring/digest/struct.Context.html"><code>digest::Context</code></a> 计算文件内容的 SHA-256 摘要 <a href="https://briansmith.org/rustdoc/ring/digest/struct.Digest.html"><code>digest::Digest</code></a>。</p>
<pre><pre class="playground"><code class="language-rust edition2018"><span class="boring">use error_chain::error_chain;
</span>use data_encoding::HEXUPPER;
use ring::digest::{Context, Digest, SHA256};
use std::fs::File;
use std::io::{BufReader, Read, Write};
<span class="boring">
</span><span class="boring">error_chain! {
</span><span class="boring">    foreign_links {
</span><span class="boring">        Io(std::io::Error);
</span><span class="boring">        Decode(data_encoding::DecodeError);
</span><span class="boring">    }
</span><span class="boring">}
</span>
fn sha256_digest&lt;R: Read&gt;(mut reader: R) -&gt; Result&lt;Digest&gt; {
    let mut context = Context::new(&amp;SHA256);
    let mut buffer = [0; 1024];

    loop {
        let count = reader.read(&amp;mut buffer)?;
        if count == 0 {
            break;
        }
        context.update(&amp;buffer[..count]);
    }

    Ok(context.finish())
}

fn main() -&gt; Result&lt;()&gt; {
    let path = &quot;file.txt&quot;;

    let mut output = File::create(path)?;
    write!(output, &quot;We will generate a digest of this text&quot;)?;

    let input = File::open(path)?;
    let reader = BufReader::new(input);
    let digest = sha256_digest(reader)?;

    println!(&quot;SHA-256 digest is {}&quot;, HEXUPPER.encode(digest.as_ref()));

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#使用-hmac-摘要对消息进行签名和验证" id="使用-hmac-摘要对消息进行签名和验证">使用 HMAC 摘要对消息进行签名和验证</a></h2>
<!--
> [cryptography/hashing/hmac.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/cryptography/hashing/hmac.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://briansmith.org/rustdoc/ring/"><img src="https://badge-cache.kominick.com/crates/v/ring.svg?label=ring" alt="ring-badge" /></a> <a href="https://crates.io/categories/cryptography"><img src="https://badge-cache.kominick.com/badge/cryptography--x.svg?style=social" alt="cat-cryptography-badge" /></a></p>
<p>使用 <a href="https://briansmith.org/rustdoc/ring/hmac/"><code>ring::hmac</code></a> 创建字符串的签名 <a href="https://briansmith.org/rustdoc/ring/hmac/struct.Signature.html"><code>hmac::Signature</code></a>，然后验证签名是否正确。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use ring::{hmac, rand};
use ring::rand::SecureRandom;
use ring::error::Unspecified;

fn main() -&gt; Result&lt;(), Unspecified&gt; {
    let mut key_value = [0u8; 48];
    let rng = rand::SystemRandom::new();
    rng.fill(&amp;mut key_value)?;
    let key = hmac::Key::new(hmac::HMAC_SHA256, &amp;key_value);

    let message = &quot;Legitimate and important message.&quot;;
    let signature = hmac::sign(&amp;key, message.as_bytes());
    hmac::verify(&amp;key, message.as_bytes(), signature.as_ref())?;

    Ok(())
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#加密-2" id="加密-2">加密</a></h1>
<!--
> [cryptography/encryption.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/cryptography/encryption.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#使用-pbkdf2-对密码进行加密salt和散列hash运算" id="使用-pbkdf2-对密码进行加密salt和散列hash运算">使用 PBKDF2 对密码进行加密（salt）和散列（hash）运算</a></h2>
<!--
> [cryptography/encryption/pbkdf2.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/cryptography/encryption/pbkdf2.md)
> <br />
> commit 203b1085212a7b857d9a29bdc6a763515e77e0f9 - 2020.06.08
-->
<p><a href="https://briansmith.org/rustdoc/ring/"><img src="https://badge-cache.kominick.com/crates/v/ring.svg?label=ring" alt="ring-badge" /></a> <a href="https://docs.rs/data-encoding/"><img src="https://badge-cache.kominick.com/crates/v/data-encoding.svg?label=data-encoding" alt="data-encoding-badge" /></a> <a href="https://crates.io/categories/cryptography"><img src="https://badge-cache.kominick.com/badge/cryptography--x.svg?style=social" alt="cat-cryptography-badge" /></a></p>
<p>对于通过 PBKDF2 密钥派生函数 <a href="https://briansmith.org/rustdoc/ring/pbkdf2/fn.derive.html"><code>pbkdf2::derive</code></a> 生成的加密（加盐算法）密码，使用 <a href="https://briansmith.org/rustdoc/ring/pbkdf2/index.html"><code>ring::pbkdf2</code></a> 进行散列（哈希）运算，使用 <a href="https://briansmith.org/rustdoc/ring/pbkdf2/fn.verify.html"><code>pbkdf2::verify</code></a> 验证散列（哈希）运算是否正确。salt 值是使用 <a href="https://briansmith.org/rustdoc/ring/rand/trait.SecureRandom.html#tymethod.fill"><code>SecureRandom::fill</code></a> 生成的，salt 字节数组被其安全生成的随机数填充。</p>
<pre><pre class="playground"><code class="language-rust edition2018">
use data_encoding::HEXUPPER;
use ring::error::Unspecified;
use ring::rand::SecureRandom;
use ring::{digest, pbkdf2, rand};
use std::num::NonZeroU32;

fn main() -&gt; Result&lt;(), Unspecified&gt; {
    const CREDENTIAL_LEN: usize = digest::SHA512_OUTPUT_LEN;
    let n_iter = NonZeroU32::new(100_000).unwrap();
    let rng = rand::SystemRandom::new();

    let mut salt = [0u8; CREDENTIAL_LEN];
    rng.fill(&amp;mut salt)?;

    let password = &quot;Guess Me If You Can!&quot;;
    let mut pbkdf2_hash = [0u8; CREDENTIAL_LEN];
    pbkdf2::derive(
        pbkdf2::PBKDF2_HMAC_SHA512,
        n_iter,
        &amp;salt,
        password.as_bytes(),
        &amp;mut pbkdf2_hash,
    );
    println!(&quot;Salt: {}&quot;, HEXUPPER.encode(&amp;salt));
    println!(&quot;PBKDF2 hash: {}&quot;, HEXUPPER.encode(&amp;pbkdf2_hash));

    let should_succeed = pbkdf2::verify(
        pbkdf2::PBKDF2_HMAC_SHA512,
        n_iter,
        &amp;salt,
        password.as_bytes(),
        &amp;pbkdf2_hash,
    );
    let wrong_password = &quot;Definitely not the correct password&quot;;
    let should_fail = pbkdf2::verify(
        pbkdf2::PBKDF2_HMAC_SHA512,
        n_iter,
        &amp;salt,
        wrong_password.as_bytes(),
        &amp;pbkdf2_hash,
    );

    assert!(should_succeed.is_ok());
    assert!(!should_fail.is_ok());

    Ok(())
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#数据结构-1" id="数据结构-1">数据结构</a></h1>
<!--
> [data_structures.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/data_structures.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#位域-1" id="位域-1">位域</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="data_structures/bitfield.html#%E5%AE%9A%E4%B9%89%E5%B9%B6%E6%93%8D%E4%BD%9C%E4%BD%8D%E5%9F%9F%E9%A3%8E%E6%A0%BC%E7%9A%84%E7%B1%BB%E5%9E%8B">定义并操作位域风格的类型</a></td><td><a href="https://docs.rs/bitflags/"><img src="https://badge-cache.kominick.com/crates/v/bitflags.svg?label=bitflags" alt="bitflags-badge" /></a></td><td><a href="https://crates.io/categories/no-std"><img src="https://badge-cache.kominick.com/badge/no_std--x.svg?style=social" alt="cat-no-std-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#位域-2" id="位域-2">位域</a></h1>
<!--
> [data_structures/bitfield.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/data_structures/bitfield.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#定义并操作位域风格的类型" id="定义并操作位域风格的类型">定义并操作位域风格的类型</a></h2>
<!--
> [data_structures/bitfield/bitfield.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/data_structures/bitfield/bitfield.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/bitflags/"><img src="https://badge-cache.kominick.com/crates/v/bitflags.svg?label=bitflags" alt="bitflags-badge" /></a> <a href="https://crates.io/categories/no-std"><img src="https://badge-cache.kominick.com/badge/no_std--x.svg?style=social" alt="cat-no-std-badge" /></a></p>
<p>如下实例在 <a href="https://docs.rs/bitflags/*/bitflags/macro.bitflags.html"><code>bitflags!</code></a> 宏的帮助下创建类型安全的位域类型 <code>MyFlags</code>，并为其实现基本的<code>清理</code>操作（<code>clear</code> 方法）以及 <a href="https://doc.rust-lang.org/std/fmt/trait.Display.html"><code>Display</code></a> trait。随后，展示了基本的按位操作和格式化。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use bitflags::bitflags;
use std::fmt;

bitflags! {
    struct MyFlags: u32 {
        const FLAG_A       = 0b00000001;
        const FLAG_B       = 0b00000010;
        const FLAG_C       = 0b00000100;
        const FLAG_ABC     = Self::FLAG_A.bits
                           | Self::FLAG_B.bits
                           | Self::FLAG_C.bits;
    }
}

impl MyFlags {
    pub fn clear(&amp;mut self) -&gt; &amp;mut MyFlags {
        self.bits = 0;  
        self
    }
}

impl fmt::Display for MyFlags {
    fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; fmt::Result {
        write!(f, &quot;{:032b}&quot;, self.bits)
    }
}

fn main() {
    let e1 = MyFlags::FLAG_A | MyFlags::FLAG_C;
    let e2 = MyFlags::FLAG_B | MyFlags::FLAG_C;
    assert_eq!((e1 | e2), MyFlags::FLAG_ABC);   
    assert_eq!((e1 &amp; e2), MyFlags::FLAG_C);    
    assert_eq!((e1 - e2), MyFlags::FLAG_A);    
    assert_eq!(!e2, MyFlags::FLAG_A);           

    let mut flags = MyFlags::FLAG_ABC;
    assert_eq!(format!(&quot;{}&quot;, flags), &quot;00000000000000000000000000000111&quot;);
    assert_eq!(format!(&quot;{}&quot;, flags.clear()), &quot;00000000000000000000000000000000&quot;);
    assert_eq!(format!(&quot;{:?}&quot;, MyFlags::FLAG_B), &quot;FLAG_B&quot;);
    assert_eq!(format!(&quot;{:?}&quot;, MyFlags::FLAG_A | MyFlags::FLAG_B), &quot;FLAG_A | FLAG_B&quot;);
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#数据库-1" id="数据库-1">数据库</a></h1>
<!--
> [database.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/database.md)
> <br />
> commit 5824ee21eb8100b5795053a6d3bd61ed8b569cac - 2019.04.12
-->
<h2><a class="header" href="#sqlite-1" id="sqlite-1">SQLite</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="database/sqlite.html#%E5%88%9B%E5%BB%BA-sqlite-%E6%95%B0%E6%8D%AE%E5%BA%93">创建 SQLite 数据库</a></td><td><a href="https://crates.io/crates/rusqlite/"><img src="https://badge-cache.kominick.com/crates/v/rusqlite.svg?label=rusqlite" alt="rusqlite-badge" /></a></td><td><a href="https://crates.io/categories/database"><img src="https://badge-cache.kominick.com/badge/database--x.svg?style=social" alt="cat-database-badge" /></a></td></tr>
<tr><td><a href="database/sqlite.html#%E6%95%B0%E6%8D%AE%E6%8F%92%E5%85%A5%E5%92%8C%E6%9F%A5%E8%AF%A2">数据插入和查询</a></td><td><a href="https://crates.io/crates/rusqlite/"><img src="https://badge-cache.kominick.com/crates/v/rusqlite.svg?label=rusqlite" alt="rusqlite-badge" /></a></td><td><a href="https://crates.io/categories/database"><img src="https://badge-cache.kominick.com/badge/database--x.svg?style=social" alt="cat-database-badge" /></a></td></tr>
<tr><td><a href="database/sqlite.html#%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86">事务处理</a></td><td><a href="https://crates.io/crates/rusqlite/"><img src="https://badge-cache.kominick.com/crates/v/rusqlite.svg?label=rusqlite" alt="rusqlite-badge" /></a></td><td><a href="https://crates.io/categories/database"><img src="https://badge-cache.kominick.com/badge/database--x.svg?style=social" alt="cat-database-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#使用-postgres-1" id="使用-postgres-1">使用 Postgres</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="database/postgres.html#postgres-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E5%88%9B%E5%BB%BA%E8%A1%A8">Postgres 数据库中创建表</a></td><td><a href="https://docs.rs/postgres/0.15.2/postgres/"><img src="https://badge-cache.kominick.com/crates/v/postgres.svg?label=postgres" alt="postgres-badge" /></a></td><td><a href="https://crates.io/categories/database"><img src="https://badge-cache.kominick.com/badge/database--x.svg?style=social" alt="cat-database-badge" /></a></td></tr>
<tr><td><a href="database/postgres.html#%E6%95%B0%E6%8D%AE%E6%8F%92%E5%85%A5%E5%92%8C%E6%9F%A5%E8%AF%A2">数据插入和查询</a></td><td><a href="https://docs.rs/postgres/0.15.2/postgres/"><img src="https://badge-cache.kominick.com/crates/v/postgres.svg?label=postgres" alt="postgres-badge" /></a></td><td><a href="https://crates.io/categories/database"><img src="https://badge-cache.kominick.com/badge/database--x.svg?style=social" alt="cat-database-badge" /></a></td></tr>
<tr><td><a href="database/postgres.html#%E6%95%B0%E6%8D%AE%E8%81%9A%E5%90%88">数据聚合</a></td><td><a href="https://docs.rs/postgres/0.15.2/postgres/"><img src="https://badge-cache.kominick.com/crates/v/postgres.svg?label=postgres" alt="postgres-badge" /></a></td><td><a href="https://crates.io/categories/database"><img src="https://badge-cache.kominick.com/badge/database--x.svg?style=social" alt="cat-database-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#sqlite-2" id="sqlite-2">SQLite</a></h1>
<!--
> [database/sqlite.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/database/sqlite.md)
> <br />
> commit 32637281938284f5b43ce6f33f5f844293e0f3d1 - 2019.01.26
-->
<h2><a class="header" href="#创建-sqlite-数据库" id="创建-sqlite-数据库">创建 SQLite 数据库</a></h2>
<!--
> [database/sqlite/initialization.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/database/sqlite/initialization.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://crates.io/crates/rusqlite/"><img src="https://badge-cache.kominick.com/crates/v/rusqlite.svg?label=rusqlite" alt="rusqlite-badge" /></a> <a href="https://crates.io/categories/database"><img src="https://badge-cache.kominick.com/badge/database--x.svg?style=social" alt="cat-database-badge" /></a></p>
<p>使用 <code>rusqlite</code> crate 打开 SQLite 数据库连接。Windows 上编译 <code>rusqlite</code> crate 请参考<a href="https://github.com/jgallagher/rusqlite#user-content-notes-on-building-rusqlite-and-libsqlite3-sys">文档</a>。</p>
<p>如果数据库不存在，<a href="https://docs.rs/rusqlite/*/rusqlite/struct.Connection.html#method.open"><code>Connection::open</code></a> 方法将创建它。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use rusqlite::{Connection, Result};
use rusqlite::NO_PARAMS;

fn main() -&gt; Result&lt;()&gt; {
    let conn = Connection::open(&quot;cats.db&quot;)?;

    conn.execute(
        &quot;create table if not exists cat_colors (
             id integer primary key,
             name text not null unique
         )&quot;,
        NO_PARAMS,
    )?;
    conn.execute(
        &quot;create table if not exists cats (
             id integer primary key,
             name text not null,
             color_id integer not null references cat_colors(id)
         )&quot;,
        NO_PARAMS,
    )?;

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#数据插入和查询" id="数据插入和查询">数据插入和查询</a></h2>
<!--
> [database/sqlite/insert_select.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/database/sqlite/insert_select.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://crates.io/crates/rusqlite/"><img src="https://badge-cache.kominick.com/crates/v/rusqlite.svg?label=rusqlite" alt="rusqlite-badge" /></a> <a href="https://crates.io/categories/database"><img src="https://badge-cache.kominick.com/badge/database--x.svg?style=social" alt="cat-database-badge" /></a></p>
<p><a href="https://docs.rs/rusqlite/*/rusqlite/struct.Connection.html#method.open"><code>Connection::open</code></a> 将打开在前一章节实例中创建的数据库 <code>cats</code> 的连接。下面的实例使用 <code>Connection</code> 的 <a href="https://docs.rs/rusqlite/*/rusqlite/struct.Connection.html#method.execute"><code>execute</code></a> 方法将数据插入 <code>cat_colors</code> 和 <code>cats</code> 两张表中。首先，将数据插入到 <code>cat_colors</code> 表中。随后，使用 <code>Connection</code> 的 <a href="https://docs.rs/rusqlite/*/rusqlite/struct.Connection.html#method.last_insert_rowid"><code>last_insert_rowid</code></a> 方法来获取 <code>cat_colors</code> 表最后插入记录的 <code>id</code>。当向 <code>cats</code> 表中插入数据时，使用此 <code>id</code>。然后，使用 <a href="https://docs.rs/rusqlite/*/rusqlite/struct.Connection.html#method.prepare"><code>prepare</code></a> 方法准备执行 select 查询操作，该方法提供 <a href="https://docs.rs/rusqlite/*/rusqlite/struct.Statement.html"><code>statement</code></a> 结构体。最后，使用 <a href="https://docs.rs/rusqlite/*/rusqlite/struct.Statement.html"><code>statement</code></a> 的 <a href="https://docs.rs/rusqlite/*/rusqlite/struct.Statement.html#method.query_map"><code>query_map</code></a> 方法执行查询。</p>
<pre><pre class="playground"><code class="language-rust no_run">
use rusqlite::NO_PARAMS;
use rusqlite::{Connection, Result};
use std::collections::HashMap;

#[derive(Debug)]
struct Cat {
    name: String,
    color: String,
}

fn main() -&gt; Result&lt;()&gt; {
    let conn = Connection::open(&quot;cats.db&quot;)?;

    let mut cat_colors = HashMap::new();
    cat_colors.insert(String::from(&quot;Blue&quot;), vec![&quot;Tigger&quot;, &quot;Sammy&quot;]);
    cat_colors.insert(String::from(&quot;Black&quot;), vec![&quot;Oreo&quot;, &quot;Biscuit&quot;]);

    for (color, catnames) in &amp;cat_colors {
        conn.execute(
            &quot;INSERT INTO cat_colors (name) values (?1)&quot;,
            &amp;[&amp;color.to_string()],
        )?;
        let last_id: String = conn.last_insert_rowid().to_string();

        for cat in catnames {
            conn.execute(
                &quot;INSERT INTO cats (name, color_id) values (?1, ?2)&quot;,
                &amp;[&amp;cat.to_string(), &amp;last_id],
            )?;
        }
    }
    let mut stmt = conn.prepare(
        &quot;SELECT c.name, cc.name from cats c
         INNER JOIN cat_colors cc
         ON cc.id = c.color_id;&quot;,
    )?;

    let cats = stmt.query_map(NO_PARAMS, |row| {
        Ok(Cat {
            name: row.get(0)?,
            color: row.get(1)?,
        })
    })?;

    for cat in cats {
        println!(&quot;Found cat {:?}&quot;, cat);
    }

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#事务处理" id="事务处理">事务处理</a></h2>
<!--
> [database/sqlite/transactions.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/database/sqlite/transactions.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://crates.io/crates/rusqlite/"><img src="https://badge-cache.kominick.com/crates/v/rusqlite.svg?label=rusqlite" alt="rusqlite-badge" /></a> <a href="https://crates.io/categories/database"><img src="https://badge-cache.kominick.com/badge/database--x.svg?style=social" alt="cat-database-badge" /></a></p>
<p><a href="https://docs.rs/rusqlite/*/rusqlite/struct.Connection.html#method.open"><code>Connection::open</code></a> 将打开来自前述实例的数据库 <code>cats.db</code>。</p>
<p>使用 <a href="https://docs.rs/rusqlite/*/rusqlite/struct.Connection.html#method.transaction"><code>Connection::transaction</code></a> 开始事务，除非使用 <a href="https://docs.rs/rusqlite/*/rusqlite/struct.Transaction.html#method.commit"><code>Transaction::commit</code></a> 显式提交，否则事务将回滚。</p>
<p>在下面的实例中，颜色表对颜色名称具有唯一性约束。当尝试插入重复的颜色时，事务会回滚。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use rusqlite::{Connection, Result, NO_PARAMS};

fn main() -&gt; Result&lt;()&gt; {
    let mut conn = Connection::open(&quot;cats.db&quot;)?;

    successful_tx(&amp;mut conn)?;

    let res = rolled_back_tx(&amp;mut conn);
    assert!(res.is_err());

    Ok(())
}

fn successful_tx(conn: &amp;mut Connection) -&gt; Result&lt;()&gt; {
    let tx = conn.transaction()?;

    tx.execute(&quot;delete from cat_colors&quot;, NO_PARAMS)?;
    tx.execute(&quot;insert into cat_colors (name) values (?1)&quot;, &amp;[&amp;&quot;lavender&quot;])?;
    tx.execute(&quot;insert into cat_colors (name) values (?1)&quot;, &amp;[&amp;&quot;blue&quot;])?;

    tx.commit()
}

fn rolled_back_tx(conn: &amp;mut Connection) -&gt; Result&lt;()&gt; {
    let tx = conn.transaction()?;

    tx.execute(&quot;delete from cat_colors&quot;, NO_PARAMS)?;
    tx.execute(&quot;insert into cat_colors (name) values (?1)&quot;, &amp;[&amp;&quot;lavender&quot;])?;
    tx.execute(&quot;insert into cat_colors (name) values (?1)&quot;, &amp;[&amp;&quot;blue&quot;])?;
    tx.execute(&quot;insert into cat_colors (name) values (?1)&quot;, &amp;[&amp;&quot;lavender&quot;])?;

    tx.commit()
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#使用-postgres-2" id="使用-postgres-2">使用 Postgres</a></h1>
<!--
> [database/postgres.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/database/postgres.md)
> <br />
> commit 5824ee21eb8100b5795053a6d3bd61ed8b569cac - 2019.04.12
-->
<h2><a class="header" href="#postgres-数据库中创建表" id="postgres-数据库中创建表">Postgres 数据库中创建表</a></h2>
<!--
> [database/postgres/create_tables.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/database/postgres/create_tables.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/postgres/0.15.2/postgres/"><img src="https://badge-cache.kominick.com/crates/v/postgres.svg?label=postgres" alt="postgres-badge" /></a> <a href="https://crates.io/categories/database"><img src="https://badge-cache.kominick.com/badge/database--x.svg?style=social" alt="cat-database-badge" /></a></p>
<p>Postgres 数据库中，使用 <a href="https://docs.rs/postgres/0.17.2/postgres/"><code>postgres</code></a> crate 创建表。</p>
<p><a href="https://docs.rs/postgres/0.17.2/postgres/struct.Client.html#method.connect"><code>Client::connect</code></a> 用于连接到现有数据库。本实例中使用 <code>Client::connect</code> 格式化连接数据库的 URL 字符串。假设存在一个数据库：名为 <code>library</code>，用户名为 <code>postgres</code>，密码为 <code>postgres</code>。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use postgres::{Client, NoTls, Error};

fn main() -&gt; Result&lt;(), Error&gt; {
    let mut client = Client::connect(&quot;postgresql://postgres:postgres@localhost/library&quot;, NoTls)?;
    
    client.batch_execute(&quot;
        CREATE TABLE IF NOT EXISTS author (
            id              SERIAL PRIMARY KEY,
            name            VARCHAR NOT NULL,
            country         VARCHAR NOT NULL
            )
    &quot;)?;

    client.batch_execute(&quot;
        CREATE TABLE IF NOT EXISTS book  (
            id              SERIAL PRIMARY KEY,
            title           VARCHAR NOT NULL,
            author_id       INTEGER NOT NULL REFERENCES author
            )
    &quot;)?;

    Ok(())

}
</code></pre></pre>
<h2><a class="header" href="#数据插入和查询-1" id="数据插入和查询-1">数据插入和查询</a></h2>
<!--
> [database/postgres/insert_query_data.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/database/postgres/insert_query_data.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/postgres/0.15.2/postgres/"><img src="https://badge-cache.kominick.com/crates/v/postgres.svg?label=postgres" alt="postgres-badge" /></a> <a href="https://crates.io/categories/database"><img src="https://badge-cache.kominick.com/badge/database--x.svg?style=social" alt="cat-database-badge" /></a></p>
<p>下述实例中使用 <code>Client</code> 的 <a href="https://docs.rs/postgres/0.17.2/postgres/struct.Client.html#method.execute"><code>execute</code></a> 方法将数据插入到 <code>author</code> 表中。然后，使用 <code>Client</code> 的 <a href="https://docs.rs/postgres/0.17.2/postgres/struct.Client.html#method.query"><code>query</code></a> 方法查询 <code>author</code> 表中的数据。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use postgres::{Client, NoTls, Error};
use std::collections::HashMap;

struct Author {
    _id: i32,
    name: String,
    country: String
}

fn main() -&gt; Result&lt;(), Error&gt; {
    let mut client = Client::connect(&quot;postgresql://postgres:postgres@localhost/library&quot;, 
                                    NoTls)?;
    
    let mut authors = HashMap::new();
    authors.insert(String::from(&quot;Chinua Achebe&quot;), &quot;Nigeria&quot;);
    authors.insert(String::from(&quot;Rabindranath Tagore&quot;), &quot;India&quot;);
    authors.insert(String::from(&quot;Anita Nair&quot;), &quot;India&quot;);

    for (key, value) in &amp;authors {
        let author = Author {
            _id: 0,
            name: key.to_string(),
            country: value.to_string()
        };

        client.execute(
                &quot;INSERT INTO author (name, country) VALUES ($1, $2)&quot;,
                &amp;[&amp;author.name, &amp;author.country],
        )?;
    }

    for row in client.query(&quot;SELECT id, name, country FROM author&quot;, &amp;[])? {
        let author = Author {
            _id: row.get(0),
            name: row.get(1),
            country: row.get(2),
        };
        println!(&quot;Author {} is from {}&quot;, author.name, author.country);
    }

    Ok(())

}
</code></pre></pre>
<h2><a class="header" href="#数据聚合" id="数据聚合">数据聚合</a></h2>
<!--
> [database/postgres/aggregate_data.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/database/postgres/aggregate_data.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/postgres/0.15.2/postgres/"><img src="https://badge-cache.kominick.com/crates/v/postgres.svg?label=postgres" alt="postgres-badge" /></a> <a href="https://crates.io/categories/database"><img src="https://badge-cache.kominick.com/badge/database--x.svg?style=social" alt="cat-database-badge" /></a></p>
<p>下述实例按照降序列出了<a href="https://github.com/MuseumofModernArt/collection/blob/master/Artists.csv"><code>美国纽约州现代艺术博物馆</code></a>数据库中首批 7999 位艺术家的国籍。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use postgres::{Client, Error, NoTls};

struct Nation {
    nationality: String,
    count: i64,
}

fn main() -&gt; Result&lt;(), Error&gt; {
    let mut client = Client::connect(
        &quot;postgresql://postgres:postgres@127.0.0.1/moma&quot;,
        NoTls,
    )?;

    for row in client.query 
	(&quot;SELECT nationality, COUNT(nationality) AS count 
	FROM artists GROUP BY nationality ORDER BY count DESC&quot;, &amp;[])? {
        
        let (nationality, count) : (Option&lt;String&gt;, Option&lt;i64&gt;) 
		= (row.get (0), row.get (1));
        
        if nationality.is_some () &amp;&amp; count.is_some () {

            let nation = Nation{
                nationality: nationality.unwrap(),
                count: count.unwrap(),
        };
            println!(&quot;{} {}&quot;, nation.nationality, nation.count);
            
        }
    }

    Ok(())
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#日期及时间-1" id="日期及时间-1">日期及时间</a></h1>
<!--
> [datetime.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/datetime.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#期间和计算-1" id="期间和计算-1">期间和计算</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="datetime/duration.html#%E6%B5%8B%E9%87%8F%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4">测量运行时间</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/date-and-time"><img src="https://badge-cache.kominick.com/badge/time--x.svg?style=social" alt="cat-time-badge" /></a></td></tr>
<tr><td><a href="datetime/duration.html#%E6%89%A7%E8%A1%8C%E6%97%A5%E6%9C%9F%E6%A3%80%E6%9F%A5%E5%92%8C%E6%97%B6%E9%97%B4%E8%AE%A1%E7%AE%97">执行日期检查和时间计算</a></td><td><a href="https://docs.rs/chrono/"><img src="https://badge-cache.kominick.com/crates/v/chrono.svg?label=chrono" alt="chrono-badge" /></a></td><td><a href="https://crates.io/categories/date-and-time"><img src="https://badge-cache.kominick.com/badge/date_and_time--x.svg?style=social" alt="cat-date-and-time-badge" /></a></td></tr>
<tr><td><a href="datetime/duration.html#%E6%97%B6%E9%97%B4%E7%9A%84%E6%97%B6%E5%8C%BA%E8%BD%AC%E6%8D%A2">时间的时区转换</a></td><td><a href="https://docs.rs/chrono/"><img src="https://badge-cache.kominick.com/crates/v/chrono.svg?label=chrono" alt="chrono-badge" /></a></td><td><a href="https://crates.io/categories/date-and-time"><img src="https://badge-cache.kominick.com/badge/date_and_time--x.svg?style=social" alt="cat-date-and-time-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#解析与显示-1" id="解析与显示-1">解析与显示</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="datetime/parse.html#%E6%A3%80%E6%9F%A5%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4">检查日期和时间</a></td><td><a href="https://docs.rs/chrono/"><img src="https://badge-cache.kominick.com/crates/v/chrono.svg?label=chrono" alt="chrono-badge" /></a></td><td><a href="https://crates.io/categories/date-and-time"><img src="https://badge-cache.kominick.com/badge/date_and_time--x.svg?style=social" alt="cat-date-and-time-badge" /></a></td></tr>
<tr><td><a href="datetime/parse.html#%E6%97%A5%E6%9C%9F%E5%92%8C-unix-%E6%97%B6%E9%97%B4%E6%88%B3%E7%9A%84%E4%BA%92%E7%9B%B8%E8%BD%AC%E6%8D%A2">日期和 UNIX 时间戳的互相转换</a></td><td><a href="https://docs.rs/chrono/"><img src="https://badge-cache.kominick.com/crates/v/chrono.svg?label=chrono" alt="chrono-badge" /></a></td><td><a href="https://crates.io/categories/date-and-time"><img src="https://badge-cache.kominick.com/badge/date_and_time--x.svg?style=social" alt="cat-date-and-time-badge" /></a></td></tr>
<tr><td><a href="datetime/parse.html#%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E7%9A%84%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%98%BE%E7%A4%BA">日期和时间的格式化显示</a></td><td><a href="https://docs.rs/chrono/"><img src="https://badge-cache.kominick.com/crates/v/chrono.svg?label=chrono" alt="chrono-badge" /></a></td><td><a href="https://crates.io/categories/date-and-time"><img src="https://badge-cache.kominick.com/badge/date_and_time--x.svg?style=social" alt="cat-date-and-time-badge" /></a></td></tr>
<tr><td><a href="datetime/parse.html#%E5%B0%86%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%A7%A3%E6%9E%90%E4%B8%BA-datetime-%E7%BB%93%E6%9E%84%E4%BD%93">将字符串解析为 DateTime 结构体</a></td><td><a href="https://docs.rs/chrono/"><img src="https://badge-cache.kominick.com/crates/v/chrono.svg?label=chrono" alt="chrono-badge" /></a></td><td><a href="https://crates.io/categories/date-and-time"><img src="https://badge-cache.kominick.com/badge/date_and_time--x.svg?style=social" alt="cat-date-and-time-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#期间和计算-2" id="期间和计算-2">期间和计算</a></h1>
<!--
> [datetime/duration.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/datetime/duration.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#测量运行时间" id="测量运行时间">测量运行时间</a></h2>
<!--
> [datetime/duration/profile.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/datetime/duration/profile.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a> <a href="https://crates.io/categories/date-and-time"><img src="https://badge-cache.kominick.com/badge/time--x.svg?style=social" alt="cat-time-badge" /></a></p>
<p>测量从 <a href="https://doc.rust-lang.org/std/time/struct.Instant.html#method.now"><code>time::Instant::now</code></a> 开始运行的时间 <a href="https://doc.rust-lang.org/std/time/struct.Instant.html#method.elapsed"><code>time::Instant::elapsed</code></a>。</p>
<p>调用 <a href="https://doc.rust-lang.org/std/time/struct.Instant.html#method.elapsed"><code>time::Instant::elapsed</code></a> 将返回 <a href="https://doc.rust-lang.org/std/time/struct.Duration.html"><code>time::Duration</code></a>，我们将在实例末尾打印该时间。此方法不会更改或者重置 <a href="https://doc.rust-lang.org/std/time/struct.Instant.html"><code>time::Instant</code></a> 对象。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use std::time::{Duration, Instant};
<span class="boring">use std::thread;
</span><span class="boring">
</span><span class="boring">fn expensive_function() {
</span><span class="boring">    thread::sleep(Duration::from_secs(1));
</span><span class="boring">}
</span>
fn main() {
    let start = Instant::now();
    expensive_function();
    let duration = start.elapsed();

    println!(&quot;Time elapsed in expensive_function() is: {:?}&quot;, duration);
}
</code></pre></pre>
<h2><a class="header" href="#执行日期检查和时间计算" id="执行日期检查和时间计算">执行日期检查和时间计算</a></h2>
<!--
> [datetime/duration/checked.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/datetime/duration/checked.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/chrono/"><img src="https://badge-cache.kominick.com/crates/v/chrono.svg?label=chrono" alt="chrono-badge" /></a> <a href="https://crates.io/categories/date-and-time"><img src="https://badge-cache.kominick.com/badge/date_and_time--x.svg?style=social" alt="cat-date-and-time-badge" /></a></p>
<p>使用 <a href="https://docs.rs/chrono/*/chrono/struct.Date.html#method.checked_add_signed"><code>DateTime::checked_add_signed</code></a> 计算并显示两周之后的日期和时间，使用 <a href="https://docs.rs/chrono/*/chrono/struct.Date.html#method.checked_sub_signed"><code>DateTime::checked_sub_signed</code></a> 计算并显示前一天的日期。如果无法计算出日期和时间，这些方法将返回 None。</p>
<p>可以在 <a href="https://docs.rs/chrono/*/chrono/format/strftime/index.html"><code>chrono::format::strftime</code></a> 中找到适用于 <a href="https://docs.rs/chrono/*/chrono/struct.DateTime.html#method.format"><code>DateTime::format</code></a> 的转义序列。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use chrono::{DateTime, Duration, Utc};

fn day_earlier(date_time: DateTime&lt;Utc&gt;) -&gt; Option&lt;DateTime&lt;Utc&gt;&gt; {
    date_time.checked_sub_signed(Duration::days(1))
}

fn main() {
    let now = Utc::now();
    println!(&quot;{}&quot;, now);

    let almost_three_weeks_from_now = now.checked_add_signed(Duration::weeks(2))
            .and_then(|in_2weeks| in_2weeks.checked_add_signed(Duration::weeks(1)))
            .and_then(day_earlier);

    match almost_three_weeks_from_now {
        Some(x) =&gt; println!(&quot;{}&quot;, x),
        None =&gt; eprintln!(&quot;Almost three weeks from now overflows!&quot;),
    }

    match now.checked_add_signed(Duration::max_value()) {
        Some(x) =&gt; println!(&quot;{}&quot;, x),
        None =&gt; eprintln!(&quot;We can't use chrono to tell the time for the Solar System to complete more than one full orbit around the galactic center.&quot;),
    }
}
</code></pre></pre>
<h2><a class="header" href="#时间的时区转换" id="时间的时区转换">时间的时区转换</a></h2>
<!--
> [datetime/duration/timezone.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/datetime/duration/timezone.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/chrono/"><img src="https://badge-cache.kominick.com/crates/v/chrono.svg?label=chrono" alt="chrono-badge" /></a> <a href="https://crates.io/categories/date-and-time"><img src="https://badge-cache.kominick.com/badge/date_and_time--x.svg?style=social" alt="cat-date-and-time-badge" /></a></p>
<p>使用 <a href="https://docs.rs/chrono/*/chrono/offset/struct.Local.html#method.now"><code>offset::Local::now</code></a> 获取本地时间并显示，然后使用 <a href="https://docs.rs/chrono/*/chrono/struct.DateTime.html#method.from_utc"><code>DateTime::from_utc</code></a> 结构体方法将其转换为 UTC 标准格式。最后，使用 <a href="https://docs.rs/chrono/*/chrono/offset/struct.FixedOffset.html"><code>offset::FixedOffset</code></a> 结构体，可以将 UTC 时间转换为 UTC+8 和 UTC-2。</p>
<pre><pre class="playground"><code class="language-rust edition2018">
use chrono::{DateTime, FixedOffset, Local, Utc};

fn main() {
    let local_time = Local::now();
    let utc_time = DateTime::&lt;Utc&gt;::from_utc(local_time.naive_utc(), Utc);
    let china_timezone = FixedOffset::east(8 * 3600);
    let rio_timezone = FixedOffset::west(2 * 3600);
    println!(&quot;Local time now is {}&quot;, local_time);
    println!(&quot;UTC time now is {}&quot;, utc_time);
    println!(
        &quot;Time in Hong Kong now is {}&quot;,
        utc_time.with_timezone(&amp;china_timezone)
    );
    println!(&quot;Time in Rio de Janeiro now is {}&quot;, utc_time.with_timezone(&amp;rio_timezone));
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#解析与显示-2" id="解析与显示-2">解析与显示</a></h1>
<!--
> [datetime/parse.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/datetime/parse.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#检查日期和时间" id="检查日期和时间">检查日期和时间</a></h2>
<!--
> [datetime/parse/current.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/datetime/parse/current.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/chrono/"><img src="https://badge-cache.kominick.com/crates/v/chrono.svg?label=chrono" alt="chrono-badge" /></a> <a href="https://crates.io/categories/date-and-time"><img src="https://badge-cache.kominick.com/badge/date_and_time--x.svg?style=social" alt="cat-date-and-time-badge" /></a></p>
<p>通过 <a href="https://docs.rs/chrono/*/chrono/trait.Timelike.html"><code>Timelike</code></a> 获取当前 UTC <a href="https://docs.rs/chrono/*/chrono/struct.DateTime.html"><code>DateTime</code></a> 及其时/分/秒，通过 <a href="https://docs.rs/chrono/*/chrono/trait.Datelike.html"><code>Datelike</code></a> 获取其年/月/日/工作日。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use chrono::{Datelike, Timelike, Utc};

fn main() {
    let now = Utc::now();

    let (is_pm, hour) = now.hour12();
    println!(
        &quot;The current UTC time is {:02}:{:02}:{:02} {}&quot;,
        hour,
        now.minute(),
        now.second(),
        if is_pm { &quot;PM&quot; } else { &quot;AM&quot; }
    );
    println!(
        &quot;And there have been {} seconds since midnight&quot;,
        now.num_seconds_from_midnight()
    );

    let (is_common_era, year) = now.year_ce();
    println!(
        &quot;The current UTC date is {}-{:02}-{:02} {:?} ({})&quot;,
        year,
        now.month(),
        now.day(),
        now.weekday(),
        if is_common_era { &quot;CE&quot; } else { &quot;BCE&quot; }
    );
    println!(
        &quot;And the Common Era began {} days ago&quot;,
        now.num_days_from_ce()
    );
}
</code></pre></pre>
<h2><a class="header" href="#日期和-unix-时间戳的互相转换" id="日期和-unix-时间戳的互相转换">日期和 UNIX 时间戳的互相转换</a></h2>
<!--
> [datetime/parse/timestamp.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/datetime/parse/timestamp.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/chrono/"><img src="https://badge-cache.kominick.com/crates/v/chrono.svg?label=chrono" alt="chrono-badge" /></a> <a href="https://crates.io/categories/date-and-time"><img src="https://badge-cache.kominick.com/badge/date_and_time--x.svg?style=social" alt="cat-date-and-time-badge" /></a></p>
<p>使用 <a href="https://docs.rs/chrono/*/chrono/naive/struct.NaiveDateTime.html#method.timestamp"><code>NaiveDateTime::timestamp</code></a> 将由 <a href="https://docs.rs/chrono/*/chrono/naive/struct.NaiveDate.html#method.from_ymd"><code>NaiveDate::from_ymd</code></a> 生成的日期和由 <a href="https://docs.rs/chrono/*/chrono/naive/struct.NaiveTime.html#method.from_hms"><code>NaiveTime::from_hms</code></a> 生成的时间转换为 <a href="https://en.wikipedia.org/wiki/Unix_time">UNIX 时间戳</a>。然后，它使用 <a href="https://docs.rs/chrono/*/chrono/naive/struct.NaiveDateTime.html#method.from_timestamp"><code>NaiveDateTime::from_timestamp</code></a> 计算自 UTC 时间 1970 年 01 月 01 日 00:00:00 开始的 10 亿秒后的日期。</p>
<pre><pre class="playground"><code class="language-rust edition2018">
use chrono::{NaiveDate, NaiveDateTime};

fn main() {
    let date_time: NaiveDateTime = NaiveDate::from_ymd(2017, 11, 12).and_hms(17, 33, 44);
    println!(
        &quot;Number of seconds between 1970-01-01 00:00:00 and {} is {}.&quot;,
        date_time, date_time.timestamp());

    let date_time_after_a_billion_seconds = NaiveDateTime::from_timestamp(1_000_000_000, 0);
    println!(
        &quot;Date after a billion seconds since 1970-01-01 00:00:00 was {}.&quot;,
        date_time_after_a_billion_seconds);
}
</code></pre></pre>
<h2><a class="header" href="#日期和时间的格式化显示" id="日期和时间的格式化显示">日期和时间的格式化显示</a></h2>
<!--
> [datetime/parse/format.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/datetime/parse/format.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/chrono/"><img src="https://badge-cache.kominick.com/crates/v/chrono.svg?label=chrono" alt="chrono-badge" /></a> <a href="https://crates.io/categories/date-and-time"><img src="https://badge-cache.kominick.com/badge/date_and_time--x.svg?style=social" alt="cat-date-and-time-badge" /></a></p>
<p>使用 <a href="https://docs.rs/chrono/*/chrono/offset/struct.Utc.html#method.now"><code>Utc::now</code></a> 获取并显示当前 UTC 时间。使用 <a href="https://docs.rs/chrono/*/chrono/struct.DateTime.html#method.to_rfc2822"><code>DateTime::to_rfc2822</code></a> 将当前时间格式化为熟悉的 <a href="https://www.ietf.org/rfc/rfc2822.txt">RFC 2822</a> 格式，使用 <a href="https://docs.rs/chrono/*/chrono/struct.DateTime.html#method.to_rfc3339"><code>DateTime::to_rfc3339</code></a> 将当前时间格式化为熟悉的 <a href="https://www.ietf.org/rfc/rfc3339.txt">RFC 3339</a> 格式，也可以使用 <a href="https://docs.rs/chrono/*/chrono/struct.DateTime.html#method.format"><code>DateTime::format</code></a> 自定义时间格式。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use chrono::{DateTime, Utc};

fn main() {
    let now: DateTime&lt;Utc&gt; = Utc::now();

    println!(&quot;UTC now is: {}&quot;, now);
    println!(&quot;UTC now in RFC 2822 is: {}&quot;, now.to_rfc2822());
    println!(&quot;UTC now in RFC 3339 is: {}&quot;, now.to_rfc3339());
    println!(&quot;UTC now in a custom format is: {}&quot;, now.format(&quot;%a %b %e %T %Y&quot;));
}
</code></pre></pre>
<h2><a class="header" href="#将字符串解析为-datetime-结构体" id="将字符串解析为-datetime-结构体">将字符串解析为 DateTime 结构体</a></h2>
<!--
> [datetime/parse/string.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/datetime/parse/string.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/chrono/"><img src="https://badge-cache.kominick.com/crates/v/chrono.svg?label=chrono" alt="chrono-badge" /></a> <a href="https://crates.io/categories/date-and-time"><img src="https://badge-cache.kominick.com/badge/date_and_time--x.svg?style=social" alt="cat-date-and-time-badge" /></a></p>
<p>熟悉的时间格式 <a href="https://www.ietf.org/rfc/rfc2822.txt">RFC 2822</a>、<a href="https://www.ietf.org/rfc/rfc3339.txt">RFC 3339</a>，以及自定义时间格式，通常用字符串表达。要将这些字符串解析为 <a href="https://docs.rs/chrono/*/chrono/struct.DateTime.html"><code>DateTime</code></a> 结构体，可以分别用 <a href="https://docs.rs/chrono/*/chrono/struct.DateTime.html#method.parse_from_rfc2822"><code>DateTime::parse_from_rfc2822</code></a>、<a href="https://docs.rs/chrono/*/chrono/struct.DateTime.html#method.parse_from_rfc3339"><code>DateTime::parse_from_rfc3339</code></a>，以及 <a href="https://docs.rs/chrono/*/chrono/struct.DateTime.html#method.parse_from_str"><code>DateTime::parse_from_str</code></a>。</p>
<p>可以在 <a href="https://docs.rs/chrono/*/chrono/format/strftime/index.html"><code>chrono::format::strftime</code></a> 中找到适用于 <a href="https://docs.rs/chrono/*/chrono/struct.DateTime.html#method.parse_from_str"><code>DateTime::parse_from_str</code></a> 的转义序列。注意：<a href="https://docs.rs/chrono/*/chrono/struct.DateTime.html#method.parse_from_str"><code>DateTime::parse_from_str</code></a> 要求这些 DateTime 结构体必须是可创建的，以便它唯一地标识日期和时间。要解析不带时区的日期和时间，请使用 <a href="https://docs.rs/chrono/*/chrono/naive/struct.NaiveDate.html"><code>NaiveDate</code></a>、<a href="https://docs.rs/chrono/*/chrono/naive/struct.NaiveTime.html"><code>NaiveTime</code></a>，以及 <a href="https://docs.rs/chrono/*/chrono/naive/struct.NaiveDateTime.html"><code>NaiveDateTime</code></a>。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use chrono::{DateTime, NaiveDate, NaiveDateTime, NaiveTime};
use chrono::format::ParseError;


fn main() -&gt; Result&lt;(), ParseError&gt; {
    let rfc2822 = DateTime::parse_from_rfc2822(&quot;Tue, 1 Jul 2003 10:52:37 +0200&quot;)?;
    println!(&quot;{}&quot;, rfc2822);

    let rfc3339 = DateTime::parse_from_rfc3339(&quot;1996-12-19T16:39:57-08:00&quot;)?;
    println!(&quot;{}&quot;, rfc3339);

    let custom = DateTime::parse_from_str(&quot;5.8.1994 8:00 am +0000&quot;, &quot;%d.%m.%Y %H:%M %P %z&quot;)?;
    println!(&quot;{}&quot;, custom);

    let time_only = NaiveTime::parse_from_str(&quot;23:56:04&quot;, &quot;%H:%M:%S&quot;)?;
    println!(&quot;{}&quot;, time_only);

    let date_only = NaiveDate::parse_from_str(&quot;2015-09-05&quot;, &quot;%Y-%m-%d&quot;)?;
    println!(&quot;{}&quot;, date_only);

    let no_timezone = NaiveDateTime::parse_from_str(&quot;2015-09-05 23:56:04&quot;, &quot;%Y-%m-%d %H:%M:%S&quot;)?;
    println!(&quot;{}&quot;, no_timezone);

    Ok(())
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#开发工具-1" id="开发工具-1">开发工具</a></h1>
<!--
> [development_tools.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#调试工具-1" id="调试工具-1">调试工具</a></h2>
<!--
> [development_tools/debugging.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools/debugging.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#日志信息-1" id="日志信息-1">日志信息</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="/development_tools/debugging/log.html#%E8%AE%B0%E5%BD%95%E8%B0%83%E8%AF%95%E4%BF%A1%E6%81%AF%E5%88%B0%E6%8E%A7%E5%88%B6%E5%8F%B0">记录调试信息到控制台</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/env_logger/"><img src="https://badge-cache.kominick.com/crates/v/env_logger.svg?label=env_logger" alt="env_logger-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
<tr><td><a href="/development_tools/debugging/log.html#%E8%AE%B0%E5%BD%95%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%E5%88%B0%E6%8E%A7%E5%88%B6%E5%8F%B0">记录错误信息到控制台</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/env_logger/"><img src="https://badge-cache.kominick.com/crates/v/env_logger.svg?label=env_logger" alt="env_logger-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
<tr><td><a href="/development_tools/debugging/log.html#%E8%AE%B0%E5%BD%95%E4%BF%A1%E6%81%AF%E6%97%B6%E7%94%A8%E6%A0%87%E5%87%86%E8%BE%93%E5%87%BA-stdout-%E6%9B%BF%E6%8D%A2%E6%A0%87%E5%87%86%E9%94%99%E8%AF%AF-stderr">记录信息时，用标准输出 stdout 替换标准错误 stderr</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/env_logger/"><img src="https://badge-cache.kominick.com/crates/v/env_logger.svg?label=env_logger" alt="env_logger-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
<tr><td><a href="/development_tools/debugging/log.html#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%E5%99%A8%E8%AE%B0%E5%BD%95%E4%BF%A1%E6%81%AF">使用自定义日志记录器记录信息</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
<tr><td><a href="/development_tools/debugging/log.html#%E8%AE%B0%E5%BD%95%E5%88%B0-unix-%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97">记录到 Unix 系统日志</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/syslog/"><img src="https://badge-cache.kominick.com/crates/v/syslog.svg?label=syslog" alt="syslog-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#日志配置-1" id="日志配置-1">日志配置</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="/development_tools/debugging/config_log.html#%E5%90%AF%E7%94%A8%E6%AF%8F%E4%B8%AA%E6%A8%A1%E5%9D%97%E7%9A%84%E6%97%A5%E5%BF%97%E7%BA%A7%E5%88%AB">启用每个模块的日志级别</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/env_logger/"><img src="https://badge-cache.kominick.com/crates/v/env_logger.svg?label=env_logger" alt="env_logger-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
<tr><td><a href="/development_tools/debugging/config_log.html#%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E8%AE%BE%E7%BD%AE%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95">用自定义环境变量设置日志记录</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/env_logger/"><img src="https://badge-cache.kominick.com/crates/v/env_logger.svg?label=env_logger" alt="env_logger-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
<tr><td><a href="/development_tools/debugging/config_log.html#%E5%9C%A8%E6%97%A5%E5%BF%97%E4%BF%A1%E6%81%AF%E4%B8%AD%E5%8C%85%E5%90%AB%E6%97%B6%E9%97%B4%E6%88%B3">在日志信息中包含时间戳</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/env_logger/"><img src="https://badge-cache.kominick.com/crates/v/env_logger.svg?label=env_logger" alt="env_logger-badge" /></a> <a href="https://docs.rs/chrono/"><img src="https://badge-cache.kominick.com/crates/v/chrono.svg?label=chrono" alt="chrono-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
<tr><td><a href="/development_tools/debugging/config_log.html#%E5%B0%86%E4%BF%A1%E6%81%AF%E8%AE%B0%E5%BD%95%E5%88%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BD%8D%E7%BD%AE">将信息记录到自定义位置</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/log4rs/"><img src="https://badge-cache.kominick.com/crates/v/log4rs.svg?label=log4rs" alt="log4rs-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h2><a class="header" href="#版本控制-1" id="版本控制-1">版本控制</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="development_tools/versioning.html#%E8%A7%A3%E6%9E%90%E5%B9%B6%E9%80%92%E5%A2%9E%E7%89%88%E6%9C%AC%E5%AD%97%E7%AC%A6%E4%B8%B2">解析并递增版本字符串</a></td><td><a href="https://docs.rs/semver/"><img src="https://badge-cache.kominick.com/crates/v/semver.svg?label=semver" alt="semver-badge" /></a></td><td><a href="https://crates.io/categories/config"><img src="https://badge-cache.kominick.com/badge/config--x.svg?style=social" alt="cat-config-badge" /></a></td></tr>
<tr><td><a href="development_tools/versioning.html#%E8%A7%A3%E6%9E%90%E5%A4%8D%E6%9D%82%E7%9A%84%E7%89%88%E6%9C%AC%E5%AD%97%E7%AC%A6%E4%B8%B2">解析复杂的版本字符串</a></td><td><a href="https://docs.rs/semver/"><img src="https://badge-cache.kominick.com/crates/v/semver.svg?label=semver" alt="semver-badge" /></a></td><td><a href="https://crates.io/categories/config"><img src="https://badge-cache.kominick.com/badge/config--x.svg?style=social" alt="cat-config-badge" /></a></td></tr>
<tr><td><a href="development_tools/versioning.html#%E6%A3%80%E6%9F%A5%E7%BB%99%E5%AE%9A%E7%89%88%E6%9C%AC%E6%98%AF%E5%90%A6%E4%B8%BA%E9%A2%84%E5%8F%91%E5%B8%83%E7%89%88%E6%9C%AC">检查给定版本是否为预发布版本</a></td><td><a href="https://docs.rs/semver/"><img src="https://badge-cache.kominick.com/crates/v/semver.svg?label=semver" alt="semver-badge" /></a></td><td><a href="https://crates.io/categories/config"><img src="https://badge-cache.kominick.com/badge/config--x.svg?style=social" alt="cat-config-badge" /></a></td></tr>
<tr><td><a href="development_tools/versioning.html#%E6%9F%A5%E8%AF%A2%E9%80%82%E9%85%8D%E7%BB%99%E5%AE%9A%E8%8C%83%E5%9B%B4%E7%9A%84%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC">查询适配给定范围的最新版本</a></td><td><a href="https://docs.rs/semver/"><img src="https://badge-cache.kominick.com/crates/v/semver.svg?label=semver" alt="semver-badge" /></a></td><td><a href="https://crates.io/categories/config"><img src="https://badge-cache.kominick.com/badge/config--x.svg?style=social" alt="cat-config-badge" /></a></td></tr>
<tr><td><a href="development_tools/versioning.html#%E6%A3%80%E6%9F%A5%E5%A4%96%E9%83%A8%E5%91%BD%E4%BB%A4%E7%9A%84%E7%89%88%E6%9C%AC%E5%85%BC%E5%AE%B9%E6%80%A7">检查外部命令的版本兼容性</a></td><td><a href="https://docs.rs/semver/"><img src="https://badge-cache.kominick.com/crates/v/semver.svg?label=semver" alt="semver-badge" /></a></td><td><a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a> <a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#构建时-1" id="构建时-1">构建时</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="development_tools/build_tools.html#%E7%BC%96%E8%AF%91%E5%B9%B6%E9%9D%99%E6%80%81%E9%93%BE%E6%8E%A5%E5%88%B0%E7%BB%91%E5%AE%9A%E7%9A%84-c-%E8%AF%AD%E8%A8%80%E5%BA%93">编译并静态链接到绑定的 C 语言库</a></td><td><a href="https://docs.rs/cc"><img src="https://badge-cache.kominick.com/crates/v/cc.svg?label=cc" alt="cc-badge" /></a></td><td><a href="https://crates.io/categories/development-tools"><img src="https://badge-cache.kominick.com/badge/development_tools--x.svg?style=social" alt="cat-development-tools-badge" /></a></td></tr>
<tr><td><a href="development_tools/build_tools.html#%E7%BC%96%E8%AF%91%E5%B9%B6%E9%9D%99%E6%80%81%E9%93%BE%E6%8E%A5%E5%88%B0%E7%BB%91%E5%AE%9A%E7%9A%84-c-%E8%AF%AD%E8%A8%80%E5%BA%93-1">编译并静态链接到绑定的 C++ 语言库</a></td><td><a href="https://docs.rs/cc"><img src="https://badge-cache.kominick.com/crates/v/cc.svg?label=cc" alt="cc-badge" /></a></td><td><a href="https://crates.io/categories/development-tools"><img src="https://badge-cache.kominick.com/badge/development_tools--x.svg?style=social" alt="cat-development-tools-badge" /></a></td></tr>
<tr><td><a href="development_tools/build_tools.html#%E7%BC%96%E8%AF%91-c-%E8%AF%AD%E8%A8%80%E5%BA%93%E6%97%B6%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AE%BE%E7%BD%AE">编译 C 语言库时自定义设置</a></td><td><a href="https://docs.rs/cc"><img src="https://badge-cache.kominick.com/crates/v/cc.svg?label=cc" alt="cc-badge" /></a></td><td><a href="https://crates.io/categories/development-tools"><img src="https://badge-cache.kominick.com/badge/development_tools--x.svg?style=social" alt="cat-development-tools-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h2><a class="header" href="#调试工具-2" id="调试工具-2">调试工具</a></h2>
<!--
> [development_tools/debugging.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools/debugging.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#日志信息-2" id="日志信息-2">日志信息</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="development_tools//development_tools/debugging/log.html#%E8%AE%B0%E5%BD%95%E8%B0%83%E8%AF%95%E4%BF%A1%E6%81%AF%E5%88%B0%E6%8E%A7%E5%88%B6%E5%8F%B0">记录调试信息到控制台</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/env_logger/"><img src="https://badge-cache.kominick.com/crates/v/env_logger.svg?label=env_logger" alt="env_logger-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
<tr><td><a href="development_tools//development_tools/debugging/log.html#%E8%AE%B0%E5%BD%95%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF%E5%88%B0%E6%8E%A7%E5%88%B6%E5%8F%B0">记录错误信息到控制台</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/env_logger/"><img src="https://badge-cache.kominick.com/crates/v/env_logger.svg?label=env_logger" alt="env_logger-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
<tr><td><a href="development_tools//development_tools/debugging/log.html#%E8%AE%B0%E5%BD%95%E4%BF%A1%E6%81%AF%E6%97%B6%E7%94%A8%E6%A0%87%E5%87%86%E8%BE%93%E5%87%BA-stdout-%E6%9B%BF%E6%8D%A2%E6%A0%87%E5%87%86%E9%94%99%E8%AF%AF-stderr">记录信息时，用标准输出 stdout 替换标准错误 stderr</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/env_logger/"><img src="https://badge-cache.kominick.com/crates/v/env_logger.svg?label=env_logger" alt="env_logger-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
<tr><td><a href="development_tools//development_tools/debugging/log.html#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%E5%99%A8%E8%AE%B0%E5%BD%95%E4%BF%A1%E6%81%AF">使用自定义日志记录器记录信息</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
<tr><td><a href="development_tools//development_tools/debugging/log.html#%E8%AE%B0%E5%BD%95%E5%88%B0-unix-%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%BF%97">记录到 Unix 系统日志</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/syslog/"><img src="https://badge-cache.kominick.com/crates/v/syslog.svg?label=syslog" alt="syslog-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#日志配置-2" id="日志配置-2">日志配置</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="development_tools//development_tools/debugging/config_log.html#%E5%90%AF%E7%94%A8%E6%AF%8F%E4%B8%AA%E6%A8%A1%E5%9D%97%E7%9A%84%E6%97%A5%E5%BF%97%E7%BA%A7%E5%88%AB">启用每个模块的日志级别</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/env_logger/"><img src="https://badge-cache.kominick.com/crates/v/env_logger.svg?label=env_logger" alt="env_logger-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
<tr><td><a href="development_tools//development_tools/debugging/config_log.html#%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E8%AE%BE%E7%BD%AE%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95">用自定义环境变量设置日志记录</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/env_logger/"><img src="https://badge-cache.kominick.com/crates/v/env_logger.svg?label=env_logger" alt="env_logger-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
<tr><td><a href="development_tools//development_tools/debugging/config_log.html#%E5%9C%A8%E6%97%A5%E5%BF%97%E4%BF%A1%E6%81%AF%E4%B8%AD%E5%8C%85%E5%90%AB%E6%97%B6%E9%97%B4%E6%88%B3">在日志信息中包含时间戳</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/env_logger/"><img src="https://badge-cache.kominick.com/crates/v/env_logger.svg?label=env_logger" alt="env_logger-badge" /></a> <a href="https://docs.rs/chrono/"><img src="https://badge-cache.kominick.com/crates/v/chrono.svg?label=chrono" alt="chrono-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
<tr><td><a href="development_tools//development_tools/debugging/config_log.html#%E5%B0%86%E4%BF%A1%E6%81%AF%E8%AE%B0%E5%BD%95%E5%88%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BD%8D%E7%BD%AE">将信息记录到自定义位置</a></td><td><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/log4rs/"><img src="https://badge-cache.kominick.com/crates/v/log4rs.svg?label=log4rs" alt="log4rs-badge" /></a></td><td><a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#日志信息-3" id="日志信息-3">日志信息</a></h1>
<!--
> [development_tools/debugging/log.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools/debugging/log.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#记录调试信息到控制台" id="记录调试信息到控制台">记录调试信息到控制台</a></h2>
<!--
> [development_tools/debugging/log/log-debug.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools/debugging/log/log-debug.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/env_logger/"><img src="https://badge-cache.kominick.com/crates/v/env_logger.svg?label=env_logger" alt="env_logger-badge" /></a> <a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></p>
<p><code>log</code> crate 提供了日志工具，<code>env_logger</code> crate 通过环境变量配置日志记录。<a href="https://docs.rs/log/*/log/macro.debug.html"><code>log::debug!</code></a> 宏的工作方式类似于其它 <a href="https://doc.rust-lang.org/std/fmt/"><code>std::fmt</code></a> 格式化的字符串。</p>
<pre><pre class="playground"><code class="language-rust edition2018">
fn execute_query(query: &amp;str) {
    log::debug!(&quot;Executing query: {}&quot;, query);
}

fn main() {
    env_logger::init();

    execute_query(&quot;DROP TABLE students&quot;);
}
</code></pre></pre>
<p>运行上述代码时，并没有输出信息被打印。因为默认情况下，日志级别为 <code>error</code>，任何较低级别的日志信息都将被忽略。</p>
<p>设置 <code>RUST_LOG</code> 环境变量以打印消息：</p>
<pre><code>$ RUST_LOG=debug cargo run
</code></pre>
<p>Cargo 运行后，会在输出的最后一行打印出调试信息：</p>
<pre><code>DEBUG:main: Executing query: DROP TABLE students
</code></pre>
<h2><a class="header" href="#记录错误信息到控制台" id="记录错误信息到控制台">记录错误信息到控制台</a></h2>
<!--
> [development_tools/debugging/log/log-error.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools/debugging/log/log-error.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/env_logger/"><img src="https://badge-cache.kominick.com/crates/v/env_logger.svg?label=env_logger" alt="env_logger-badge" /></a> <a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></p>
<p>正确的错误处理会将异常视为错误。下述实例中，通过 <code>log</code> 便捷宏 <a href="https://docs.rs/log/*/log/macro.error.html"><code>log::error!</code></a>，将错误记录到 stderr。</p>
<pre><pre class="playground"><code class="language-rust edition2018">
fn execute_query(_query: &amp;str) -&gt; Result&lt;(), &amp;'static str&gt; {
    Err(&quot;I'm afraid I can't do that&quot;)
}

fn main() {
    env_logger::init();

    let response = execute_query(&quot;DROP TABLE students&quot;);
    if let Err(err) = response {
        log::error!(&quot;Failed to execute query: {}&quot;, err);
    }
}
</code></pre></pre>
<h2><a class="header" href="#记录信息时用标准输出-stdout-替换标准错误-stderr" id="记录信息时用标准输出-stdout-替换标准错误-stderr">记录信息时，用标准输出 stdout 替换标准错误 stderr</a></h2>
<!--
> [development_tools/debugging/log/log-stdout.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools/debugging/log/log-stdout.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/env_logger/"><img src="https://badge-cache.kominick.com/crates/v/env_logger.svg?label=env_logger" alt="env_logger-badge" /></a> <a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></p>
<p>使用 <a href="https://docs.rs/env_logger/*/env_logger/struct.Builder.html#method.target"><code>Builder::target</code></a> 创建自定义的日志记录器配置，将日志输出的目标设置为 <a href="https://docs.rs/env_logger/*/env_logger/fmt/enum.Target.html"><code>Target::Stdout</code></a>。</p>
<pre><pre class="playground"><code class="language-rust edition2018">
use env_logger::{Builder, Target};

fn main() {
    Builder::new()
        .target(Target::Stdout)
        .init();

    log::error!(&quot;This error has been printed to Stdout&quot;);
}
</code></pre></pre>
<h2><a class="header" href="#使用自定义日志记录器记录信息" id="使用自定义日志记录器记录信息">使用自定义日志记录器记录信息</a></h2>
<!--
> [development_tools/debugging/log/log-custom-logger.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools/debugging/log/log-custom-logger.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></p>
<p>本实例实现一个打印到 stdout 的自定义记录器 <code>ConsoleLogger</code>。为了使用日志宏，<code>ConsoleLogger</code> 实现了 <a href="https://docs.rs/log/*/log/trait.Log.html"><code>log::Log</code></a> trait，通过 <a href="https://docs.rs/log/*/log/fn.set_logger.html"><code>log::set_logger</code></a> 安置。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use log::{Record, Level, Metadata, LevelFilter, SetLoggerError};

static CONSOLE_LOGGER: ConsoleLogger = ConsoleLogger;

struct ConsoleLogger;

impl log::Log for ConsoleLogger {
  fn enabled(&amp;self, metadata: &amp;Metadata) -&gt; bool {
     metadata.level() &lt;= Level::Info
    }

    fn log(&amp;self, record: &amp;Record) {
        if self.enabled(record.metadata()) {
            println!(&quot;Rust says: {} - {}&quot;, record.level(), record.args());
        }
    }

    fn flush(&amp;self) {}
}

fn main() -&gt; Result&lt;(), SetLoggerError&gt; {
    log::set_logger(&amp;CONSOLE_LOGGER)?;
    log::set_max_level(LevelFilter::Info);

    log::info!(&quot;hello log&quot;);
    log::warn!(&quot;warning&quot;);
    log::error!(&quot;oops&quot;);
    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#记录到-unix-系统日志" id="记录到-unix-系统日志">记录到 Unix 系统日志</a></h2>
<!--
> [development_tools/debugging/log/log-syslog.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools/debugging/log/log-syslog.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/syslog/"><img src="https://badge-cache.kominick.com/crates/v/syslog.svg?label=syslog" alt="syslog-badge" /></a> <a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></p>
<p>本实例实现将信息记录到 <a href="https://www.gnu.org/software/libc/manual/html_node/Overview-of-Syslog.html">UNIX syslog</a>。使用 <a href="https://docs.rs/syslog/*/syslog/fn.init.html"><code>syslog::init</code></a> 初始化记录器后端。<a href="https://docs.rs/syslog/*/syslog/enum.Facility.html"><code>syslog::Facility</code></a> 记录提交日志项分类的程序，<a href="https://docs.rs/log/*/log/enum.LevelFilter.html"><code>log::LevelFilter</code></a> 表示欲记录日志的等级，<code>Option&lt;&amp;str&gt;</code> 定义应用程序名称（可选）。</p>
<pre><pre class="playground"><code class="language-rust edition2018"><span class="boring">#[cfg(target_os = &quot;linux&quot;)]
</span><span class="boring">#[cfg(target_os = &quot;linux&quot;)]
</span>use syslog::{Facility, Error};

<span class="boring">#[cfg(target_os = &quot;linux&quot;)]
</span>fn main() -&gt; Result&lt;(), Error&gt; {
    syslog::init(Facility::LOG_USER,
                 log::LevelFilter::Debug,
                 Some(&quot;My app name&quot;))?;
    log::debug!(&quot;this is a debug {}&quot;, &quot;message&quot;);
    log::error!(&quot;this is an error!&quot;);
    Ok(())
}

<span class="boring">#[cfg(not(target_os = &quot;linux&quot;))]
</span><span class="boring">fn main() {
</span><span class="boring">    println!(&quot;So far, only Linux systems are supported.&quot;);
</span><span class="boring">}
</span></code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#日志配置-3" id="日志配置-3">日志配置</a></h1>
<!--
> [development_tools/debugging/config_log.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools/debugging/config_log.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#启用每个模块的日志级别" id="启用每个模块的日志级别">启用每个模块的日志级别</a></h2>
<!--
> [development_tools/debugging/config_log/log-mod.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools/debugging/config_log/log-mod.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/env_logger/"><img src="https://badge-cache.kominick.com/crates/v/env_logger.svg?label=env_logger" alt="env_logger-badge" /></a> <a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></p>
<p>创建两个模块：<code>foo</code> 和其嵌套的 <code>foo::bar</code>，日志记录指令分别由 <a href="https://docs.rs/env_logger/*/env_logger/#enabling-logging"><code>RUST_LOG</code></a> 环境变量控制。</p>
<pre><pre class="playground"><code class="language-rust edition2018">
mod foo {
    mod bar {
        pub fn run() {
            log::warn!(&quot;[bar] warn&quot;);
            log::info!(&quot;[bar] info&quot;);
            log::debug!(&quot;[bar] debug&quot;);
        }
    }

    pub fn run() {
        log::warn!(&quot;[foo] warn&quot;);
        log::info!(&quot;[foo] info&quot;);
        log::debug!(&quot;[foo] debug&quot;);
        bar::run();
    }
}

fn main() {
    env_logger::init();
    log::warn!(&quot;[root] warn&quot;);
    log::info!(&quot;[root] info&quot;);
    log::debug!(&quot;[root] debug&quot;);
    foo::run();
}
</code></pre></pre>
<p><a href="https://docs.rs/env_logger/*/env_logger/#enabling-logging"><code>RUST_LOG</code></a> 环境变量控制 <a href="https://docs.rs/env_logger/"><code>env_logger</code></a> 的输出。模块声明采用逗号分隔各项，格式类似于 <code>path::to::module=log_level</code>。按如下方式运行 <code>test</code> 应用程序：</p>
<pre><code class="language-bash">RUST_LOG=&quot;warn,test::foo=info,test::foo::bar=debug&quot; ./test
</code></pre>
<p>将日志等级 <a href="https://docs.rs/log/*/log/enum.Level.html"><code>log::Level</code></a> 的默认值设置为 <code>warn</code>，将模块 <code>foo</code> 和其嵌套的模块 <code>foo::bar</code> 的日志等级设置为 <code>info</code> 和 <code>debug</code>。</p>
<pre><code class="language-bash">WARN:test: [root] warn
WARN:test::foo: [foo] warn
INFO:test::foo: [foo] info
WARN:test::foo::bar: [bar] warn
INFO:test::foo::bar: [bar] info
DEBUG:test::foo::bar: [bar] debug
</code></pre>
<h2><a class="header" href="#用自定义环境变量设置日志记录" id="用自定义环境变量设置日志记录">用自定义环境变量设置日志记录</a></h2>
<!--
> [development_tools/debugging/config_log/log-env-variable.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools/debugging/config_log/log-env-variable.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/env_logger/"><img src="https://badge-cache.kominick.com/crates/v/env_logger.svg?label=env_logger" alt="env_logger-badge" /></a> <a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></p>
<p><a href="https://docs.rs/env_logger/*/env_logger/struct.Builder.html"><code>Builder</code></a> 配置日志记录。</p>
<p><a href="https://docs.rs/env_logger/*/env_logger/struct.Builder.html#method.parse"><code>Builder::parse</code></a> 以 <a href="https://docs.rs/env_logger/*/env_logger/#enabling-logging"><code>RUST_LOG</code></a> 语法的形式解析 <code>MY_APP_LOG</code> 环境变量的内容。然后，<a href="https://docs.rs/env_logger/*/env_logger/struct.Builder.html#method.init"><code>Builder::init</code></a> 初始化记录器。所有这些步骤通常由 <a href="https://docs.rs/env_logger/*/env_logger/fn.init.html"><code>env_logger::init</code></a> 在内部完成。</p>
<pre><pre class="playground"><code class="language-rust edition2018">
use std::env;
use env_logger::Builder;

fn main() {
    Builder::new()
        .parse(&amp;env::var(&quot;MY_APP_LOG&quot;).unwrap_or_default())
        .init();

    log::info!(&quot;informational message&quot;);
    log::warn!(&quot;warning message&quot;);
    log::error!(&quot;this is an error {}&quot;, &quot;message&quot;);
}
</code></pre></pre>
<h2><a class="header" href="#在日志信息中包含时间戳" id="在日志信息中包含时间戳">在日志信息中包含时间戳</a></h2>
<!--
> [development_tools/debugging/config_log/log-timestamp.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools/debugging/config_log/log-timestamp.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/env_logger/"><img src="https://badge-cache.kominick.com/crates/v/env_logger.svg?label=env_logger" alt="env_logger-badge" /></a> <a href="https://docs.rs/chrono/"><img src="https://badge-cache.kominick.com/crates/v/chrono.svg?label=chrono" alt="chrono-badge" /></a> <a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></p>
<p>使用 <a href="https://docs.rs/env_logger/*/env_logger/struct.Builder.html"><code>Builder</code></a> 创建自定义记录器配置。每个日志项调用 <a href="https://docs.rs/chrono/*/chrono/offset/struct.Local.html#method.now"><code>Local::now</code></a> 以获取本地时区中的当前 <a href="https://docs.rs/chrono/*/chrono/datetime/struct.DateTime.html"><code>DateTime</code></a>，并使用 <a href="https://docs.rs/chrono/*/chrono/struct.DateTime.html#method.format"><code>DateTime::format</code></a> 和 <a href="https://docs.rs/chrono/*/chrono/format/strftime/index.html#specifiers"><code>strftime::specifiers</code></a> 来格式化最终日志中使用的时间戳。</p>
<p>如下实例调用 <a href="https://docs.rs/env_logger/*/env_logger/struct.Builder.html#method.format"><code>Builder::format</code></a> 设置一个闭包，该闭包用时间戳、<a href="https://docs.rs/log/*/log/struct.Record.html#method.level"><code>Record::level</code></a> 和正文（<a href="https://docs.rs/log/*/log/struct.Record.html#method.args"><code>Record::args</code></a>）对每个信息文本进行格式化。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use std::io::Write;
use chrono::Local;
use env_logger::Builder;
use log::LevelFilter;

fn main() {
    Builder::new()
        .format(|buf, record| {
            writeln!(buf,
                &quot;{} [{}] - {}&quot;,
                Local::now().format(&quot;%Y-%m-%dT%H:%M:%S&quot;),
                record.level(),
                record.args()
            )
        })
        .filter(None, LevelFilter::Info)
        .init();

    log::warn!(&quot;warn&quot;);
    log::info!(&quot;info&quot;);
    log::debug!(&quot;debug&quot;);
}
</code></pre></pre>
<p>stderr 输入将含有：</p>
<pre><code>2017-05-22T21:57:06 [WARN] - warn
2017-05-22T21:57:06 [INFO] - info
</code></pre>
<h2><a class="header" href="#将信息记录到自定义位置" id="将信息记录到自定义位置">将信息记录到自定义位置</a></h2>
<!--
> [development_tools/debugging/config_log/log-custom.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools/debugging/config_log/log-custom.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/log/"><img src="https://badge-cache.kominick.com/crates/v/log.svg?label=log" alt="log-badge" /></a> <a href="https://docs.rs/log4rs/"><img src="https://badge-cache.kominick.com/crates/v/log4rs.svg?label=log4rs" alt="log4rs-badge" /></a> <a href="https://crates.io/categories/debugging"><img src="https://badge-cache.kominick.com/badge/debugging--x.svg?style=social" alt="cat-debugging-badge" /></a></p>
<p><a href="https://docs.rs/log4rs/">log4rs</a> 将日志输出配置到自定义位置。<a href="https://docs.rs/log4rs/">log4rs</a> 可以使用外部 YAML 文件或生成器配置。</p>
<p>使用文件附加器 <a href="https://docs.rs/log4rs/*/log4rs/append/file/struct.FileAppender.html"><code>log4rs::append::file::FileAppender</code></a> 创建日志配置，文件附加器定义日志记录的目标位置。日志配置使用 <a href="https://docs.rs/log4rs/*/log4rs/encode/pattern/index.html"><code>log4rs::encode::pattern</code></a> 中的自定义模式进行编码，将配置项分配给 <a href="https://docs.rs/log4rs/*/log4rs/config/struct.Config.html"><code>log4rs::config::Config</code></a>，并设置默认的日志等级 <a href="https://docs.rs/log/*/log/enum.LevelFilter.html"><code>log::LevelFilter</code></a>。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run"><span class="boring">use error_chain::error_chain;
</span>
use log::LevelFilter;
use log4rs::append::file::FileAppender;
use log4rs::encode::pattern::PatternEncoder;
use log4rs::config::{Appender, Config, Root};
<span class="boring">
</span><span class="boring">error_chain! {
</span><span class="boring">    foreign_links {
</span><span class="boring">        Io(std::io::Error);
</span><span class="boring">        LogConfig(log4rs::config::Errors);
</span><span class="boring">        SetLogger(log::SetLoggerError);
</span><span class="boring">    }
</span><span class="boring">}
</span>
fn main() -&gt; Result&lt;()&gt; {
    let logfile = FileAppender::builder()
        .encoder(Box::new(PatternEncoder::new(&quot;{l} - {m}\n&quot;)))
        .build(&quot;log/output.log&quot;)?;

    let config = Config::builder()
        .appender(Appender::builder().build(&quot;logfile&quot;, Box::new(logfile)))
        .build(Root::builder()
                   .appender(&quot;logfile&quot;)
                   .build(LevelFilter::Info))?;

    log4rs::init_config(config)?;

    log::info!(&quot;Hello, world!&quot;);

    Ok(())
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#版本控制-2" id="版本控制-2">版本控制</a></h1>
<!--
> [development_tools/versioning.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools/versioning.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#解析并递增版本字符串" id="解析并递增版本字符串">解析并递增版本字符串</a></h2>
<!--
> [development_tools/versioning/semver-increment.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools/versioning/semver-increment.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/semver/"><img src="https://badge-cache.kominick.com/crates/v/semver.svg?label=semver" alt="semver-badge" /></a> <a href="https://crates.io/categories/config"><img src="https://badge-cache.kominick.com/badge/config--x.svg?style=social" alt="cat-config-badge" /></a></p>
<p>使用 <a href="https://docs.rs/semver/*/semver/struct.Version.html#method.parse"><code>Version::parse</code></a> 从字符串字面量构造语义化版本 <a href="https://docs.rs/semver/*/semver/struct.Version.html"><code>semver::Version</code></a>，然后逐个递增补丁（修订）版本号、副（次要）版本号和主版本号。</p>
<p>注意：根据<a href="http://semver.org/">语义化版本控制规范</a>，增加副（次要）版本号时会将补丁（修订）版本号重置为 0，增加主版本号时会将副（次要）版本号和补丁（修订）版本号都重置为 0。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use semver::{Version, SemVerError};

fn main() -&gt; Result&lt;(), SemVerError&gt; {
    let mut parsed_version = Version::parse(&quot;0.2.6&quot;)?;

    assert_eq!(
        parsed_version,
        Version {
            major: 0,
            minor: 2,
            patch: 6,
            pre: vec![],
            build: vec![],
        }
    );

    parsed_version.increment_patch();
    assert_eq!(parsed_version.to_string(), &quot;0.2.7&quot;);
    println!(&quot;New patch release: v{}&quot;, parsed_version);

    parsed_version.increment_minor();
    assert_eq!(parsed_version.to_string(), &quot;0.3.0&quot;);
    println!(&quot;New minor release: v{}&quot;, parsed_version);

    parsed_version.increment_major();
    assert_eq!(parsed_version.to_string(), &quot;1.0.0&quot;);
    println!(&quot;New major release: v{}&quot;, parsed_version);

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#解析复杂的版本字符串" id="解析复杂的版本字符串">解析复杂的版本字符串</a></h2>
<!--
> [development_tools/versioning/semver-complex.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools/versioning/semver-complex.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/semver/"><img src="https://badge-cache.kominick.com/crates/v/semver.svg?label=semver" alt="semver-badge" /></a> <a href="https://crates.io/categories/config"><img src="https://badge-cache.kominick.com/badge/config--x.svg?style=social" alt="cat-config-badge" /></a></p>
<p>使用 <a href="https://docs.rs/semver/*/semver/struct.Version.html#method.parse"><code>Version::parse</code></a> 从复杂的版本字符串构造语义化版本 <a href="https://docs.rs/semver/*/semver/struct.Version.html"><code>semver::Version</code></a>。该字符串包含<a href="http://semver.org/">语义化版本控制规范</a>中定义的预发布和构建元数据。</p>
<p>需要注意的是：根据<a href="http://semver.org/">语义化版本控制规范</a>，构建元数据是虽然被解析，但在比较版本时不考虑。换句话说，即使两个版本的构建字符串不同，但它们的版本可能是相等的。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use semver::{Identifier, Version, SemVerError};

fn main() -&gt; Result&lt;(), SemVerError&gt; {
    let version_str = &quot;1.0.49-125+g72ee7853&quot;;
    let parsed_version = Version::parse(version_str)?;

    assert_eq!(
        parsed_version,
        Version {
            major: 1,
            minor: 0,
            patch: 49,
            pre: vec![Identifier::Numeric(125)],
            build: vec![],
        }
    );
    assert_eq!(
        parsed_version.build,
        vec![Identifier::AlphaNumeric(String::from(&quot;g72ee7853&quot;))]
    );

    let serialized_version = parsed_version.to_string();
    assert_eq!(&amp;serialized_version, version_str);

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#检查给定版本是否为预发布版本" id="检查给定版本是否为预发布版本">检查给定版本是否为预发布版本</a></h2>
<!--
> [development_tools/versioning/semver-prerelease.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools/versioning/semver-prerelease.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/semver/"><img src="https://badge-cache.kominick.com/crates/v/semver.svg?label=semver" alt="semver-badge" /></a> <a href="https://crates.io/categories/config"><img src="https://badge-cache.kominick.com/badge/config--x.svg?style=social" alt="cat-config-badge" /></a></p>
<p>给定两个版本，使用 <a href="https://docs.rs/semver/*/semver/struct.Version.html#method.is_prerelease"><code>is_prerelease</code></a> 断言一个是预发布，另一个不是。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use semver::{Version, SemVerError};

fn main() -&gt; Result&lt;(), SemVerError&gt; {
    let version_1 = Version::parse(&quot;1.0.0-alpha&quot;)?;
    let version_2 = Version::parse(&quot;1.0.0&quot;)?;

    assert!(version_1.is_prerelease());
    assert!(!version_2.is_prerelease());

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#查询适配给定范围的最新版本" id="查询适配给定范围的最新版本">查询适配给定范围的最新版本</a></h2>
<!--
> [development_tools/versioning/semver-latest.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools/versioning/semver-latest.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/semver/"><img src="https://badge-cache.kominick.com/crates/v/semver.svg?label=semver" alt="semver-badge" /></a> <a href="https://crates.io/categories/config"><img src="https://badge-cache.kominick.com/badge/config--x.svg?style=social" alt="cat-config-badge" /></a></p>
<p>给定一个版本字符串 &amp;str 的列表，查找最新的语义化版本 <a href="https://docs.rs/semver/*/semver/struct.Version.html"><code>semver::Version</code></a>。<a href="https://docs.rs/semver/*/semver/struct.VersionReq.html"><code>semver::VersionReq</code></a> 用 <a href="https://docs.rs/semver/*/semver/struct.VersionReq.html#method.matches"><code>VersionReq::matches</code></a> 过滤列表，也可以展示语义化版本 <code>semver</code> 的预发布参数设置。</p>
<pre><pre class="playground"><code class="language-rust edition2018"><span class="boring">use error_chain::error_chain;
</span>
use semver::{Version, VersionReq};
<span class="boring">
</span><span class="boring">error_chain! {
</span><span class="boring">    foreign_links {
</span><span class="boring">        SemVer(semver::SemVerError);
</span><span class="boring">        SemVerReq(semver::ReqParseError);
</span><span class="boring">    }
</span><span class="boring">}
</span>
fn find_max_matching_version&lt;'a, I&gt;(version_req_str: &amp;str, iterable: I) -&gt; Result&lt;Option&lt;Version&gt;&gt;
where
    I: IntoIterator&lt;Item = &amp;'a str&gt;,
{
    let vreq = VersionReq::parse(version_req_str)?;

    Ok(
        iterable
            .into_iter()
            .filter_map(|s| Version::parse(s).ok())
            .filter(|s| vreq.matches(s))
            .max(),
    )
}

fn main() -&gt; Result&lt;()&gt; {
    assert_eq!(
        find_max_matching_version(&quot;&lt;= 1.0.0&quot;, vec![&quot;0.9.0&quot;, &quot;1.0.0&quot;, &quot;1.0.1&quot;])?,
        Some(Version::parse(&quot;1.0.0&quot;)?)
    );

    assert_eq!(
        find_max_matching_version(
            &quot;&gt;1.2.3-alpha.3&quot;,
            vec![
                &quot;1.2.3-alpha.3&quot;,
                &quot;1.2.3-alpha.4&quot;,
                &quot;1.2.3-alpha.10&quot;,
                &quot;1.2.3-beta.4&quot;,
                &quot;3.4.5-alpha.9&quot;,
            ]
        )?,
        Some(Version::parse(&quot;1.2.3-beta.4&quot;)?)
    );

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#检查外部命令的版本兼容性" id="检查外部命令的版本兼容性">检查外部命令的版本兼容性</a></h2>
<!--
> [development_tools/versioning/semver-command.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools/versioning/semver-command.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/semver/"><img src="https://badge-cache.kominick.com/crates/v/semver.svg?label=semver" alt="semver-badge" /></a> <a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a> <a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a></p>
<p>本实例使用 <a href="https://doc.rust-lang.org/std/process/struct.Command.html"><code>Command</code></a> 模块运行命令 <code>git --version</code>，然后使用 <a href="https://docs.rs/semver/*/semver/struct.Version.html#method.parse"><code>Version::parse</code></a> 将版本号解析为语义化版本 <a href="https://docs.rs/semver/*/semver/struct.Version.html"><code>semver::Version</code></a>。<a href="https://docs.rs/semver/*/semver/struct.VersionReq.html#method.matches"><code>VersionReq::matches</code></a> 将 <a href="https://docs.rs/semver/*/semver/struct.VersionReq.html"><code>semver::VersionReq</code></a> 与解析的语义化版本进行比较。最终，命令输出类似于“git version x.y.z”。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run"><span class="boring">use error_chain::error_chain;
</span>
use std::process::Command;
use semver::{Version, VersionReq};
<span class="boring">
</span><span class="boring">error_chain! {
</span><span class="boring">    foreign_links {
</span><span class="boring">        Io(std::io::Error);
</span><span class="boring">        Utf8(std::string::FromUtf8Error);
</span><span class="boring">        SemVer(semver::SemVerError);
</span><span class="boring">        SemVerReq(semver::ReqParseError);
</span><span class="boring">    }
</span><span class="boring">}
</span>
fn main() -&gt; Result&lt;()&gt; {
    let version_constraint = &quot;&gt; 1.12.0&quot;;
    let version_test = VersionReq::parse(version_constraint)?;
    let output = Command::new(&quot;git&quot;).arg(&quot;--version&quot;).output()?;

    if !output.status.success() {
        error_chain::bail!(&quot;Command executed with failing error code&quot;);
    }

    let stdout = String::from_utf8(output.stdout)?;
    let version = stdout.split(&quot; &quot;).last().ok_or_else(|| {
        &quot;Invalid command output&quot;
    })?;
    let parsed_version = Version::parse(version)?;

    if !version_test.matches(&amp;parsed_version) {
        error_chain::bail!(&quot;Command version lower than minimum supported version (found {}, need {})&quot;,
            parsed_version, version_constraint);
    }

    Ok(())
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#构建工具" id="构建工具">构建工具</a></h1>
<!--
> [development_tools/build_tools.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools/build_tools.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<p>本节介绍在编译 crate 源代码之前运行的“构建时”工具或代码。按照惯例，构建时代码存放在 <strong>build.rs</strong> 文件，通常称为“构建脚本”。常见的用例包括：Rust 代码生成、绑定的 C/C++/asm 代码的编译。要获取更多信息，请阅读 Cargo（<a href="https://cargo.budshome.com">中文文档</a>） 的<a href="https://cargo.budshome.com/reference/build-scripts.html">构建脚本文档</a>。</p>
<h2><a class="header" href="#编译并静态链接到绑定的-c-语言库" id="编译并静态链接到绑定的-c-语言库">编译并静态链接到绑定的 C 语言库</a></h2>
<!--
> [development_tools/build_tools/cc-bundled-static.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools/build_tools/cc-bundled-static.md)
> <br />
> commit 203b1085212a7b857d9a29bdc6a763515e77e0f9 - 2020.06.08
-->
<p><a href="https://docs.rs/cc"><img src="https://badge-cache.kominick.com/crates/v/cc.svg?label=cc" alt="cc-badge" /></a> <a href="https://crates.io/categories/development-tools"><img src="https://badge-cache.kominick.com/badge/development_tools--x.svg?style=social" alt="cat-development-tools-badge" /></a></p>
<p>为了适应项目中需要混合 C、C++，或 asm 等语言的场景，<a href="https://docs.rs/cc"><strong>cc</strong></a> crate 提供了一个简单的 API，用于将绑定的 C/C++/asm 代码编译成静态库（<strong>.a</strong>），静态库可以通过 <strong>rustc</strong> 静态链接。</p>
<p>下面的实例有一些绑定的 C 语言代码（<strong>src/hello.c</strong>），将从 rust 中调用它们。在编译 rust 源代码之前，<strong>Cargo.toml</strong> 中指定的“构建”文件（<strong>build.rs</strong>）预先运行。使用 <a href="https://docs.rs/cc"><strong>cc</strong></a> crate，将生成一个静态库文件（本实例中为 <strong>libhello.a</strong>，请参阅 <a href="https://docs.rs/cc/*/cc/struct.Build.html#method.compile"><code>compile</code> 文档</a>），通过在 <code>extern</code> 代码块中声明外部函数签名，然后就可以从 rust 中调用该静态库。</p>
<p>本实例中绑定的 C 语言文件非常简单，只需要将一个源文件传递给 <a href="https://docs.rs/cc/*/cc/struct.Build.html"><code>cc::Build</code></a>。对于更复杂的构建需求，<a href="https://docs.rs/cc/*/cc/struct.Build.html"><code>cc::Build</code></a> 提供了一整套构建器方法，用于指定<a href="https://docs.rs/cc/*/cc/struct.Build.html#method.include"><code>（包含）include</code></a>路径和扩展编译器<a href="https://docs.rs/cc/*/cc/struct.Build.html#method.flag"><code>标志（flag）</code></a>。</p>
<h3><a class="header" href="#cargotoml" id="cargotoml"><code>Cargo.toml</code></a></h3>
<pre><code class="language-toml">[package]
...
build = &quot;build.rs&quot;

[build-dependencies]
cc = &quot;1&quot;

[dependencies]
error-chain = &quot;0.11&quot;
</code></pre>
<h3><a class="header" href="#buildrs" id="buildrs"><code>build.rs</code></a></h3>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">fn main() {
    cc::Build::new()
        .file(&quot;src/hello.c&quot;)
        .compile(&quot;hello&quot;);   // 输出 `libhello.a`
}
</code></pre></pre>
<h3><a class="header" href="#srchelloc" id="srchelloc"><code>src/hello.c</code></a></h3>
<pre><code class="language-c">#include &lt;stdio.h&gt;


void hello() {
    printf(&quot;Hello from C!\n&quot;);
}

void greet(const char* name) {
    printf(&quot;Hello, %s!\n&quot;, name);
}
</code></pre>
<h3><a class="header" href="#srcmainrs" id="srcmainrs"><code>src/main.rs</code></a></h3>
<pre><code class="language-rust edition2018 ignore">use error_chain::error_chain;
use std::ffi::CString;
use std::os::raw::c_char;

error_chain! {
    foreign_links {
        NulError(::std::ffi::NulError);
        Io(::std::io::Error);
    }
}
fn prompt(s: &amp;str) -&gt; Result&lt;String&gt; {
    use std::io::Write;
    print!(&quot;{}&quot;, s);
    std::io::stdout().flush()?;
    let mut input = String::new();
    std::io::stdin().read_line(&amp;mut input)?;
    Ok(input.trim().to_string())
}

extern {
    fn hello();
    fn greet(name: *const c_char);
}

fn main() -&gt; Result&lt;()&gt; {
    unsafe { hello() }
    let name = prompt(&quot;What's your name? &quot;)?;
    let c_name = CString::new(name)?;
    unsafe { greet(c_name.as_ptr()) }
    Ok(())
}
</code></pre>
<h2><a class="header" href="#编译并静态链接到绑定的-c-语言库-1" id="编译并静态链接到绑定的-c-语言库-1">编译并静态链接到绑定的 C++ 语言库</a></h2>
<!--
> [development_tools/build_tools/cc-bundled-cpp.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools/build_tools/cc-bundled-cpp.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/cc"><img src="https://badge-cache.kominick.com/crates/v/cc.svg?label=cc" alt="cc-badge" /></a> <a href="https://crates.io/categories/development-tools"><img src="https://badge-cache.kominick.com/badge/development_tools--x.svg?style=social" alt="cat-development-tools-badge" /></a></p>
<p>链接绑定的 C++ 语言库非常类似于链接绑定的 C 语言库。编译并静态链接绑定的 C++ 库时，与链接绑定的 C 语言库相比有两个核心区别：一是通过构造器方法 <a href="https://docs.rs/cc/*/cc/struct.Build.html#method.cpp"><code>cpp(true)</code></a> 指定 C++ 编译器；二是通过在 C++ 源文件顶部添加 <code>extern &quot;C&quot;</code> 代码段，以防止 C++ 编译器的名称篡改。</p>
<h3><a class="header" href="#cargotoml-1" id="cargotoml-1"><code>Cargo.toml</code></a></h3>
<pre><code class="language-toml">[package]
...
build = &quot;build.rs&quot;

[build-dependencies]
cc = &quot;1&quot;
</code></pre>
<h3><a class="header" href="#buildrs-1" id="buildrs-1"><code>build.rs</code></a></h3>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">fn main() {
    cc::Build::new()
        .cpp(true)
        .file(&quot;src/foo.cpp&quot;)
        .compile(&quot;foo&quot;);   
}
</code></pre></pre>
<h3><a class="header" href="#srcfoocpp" id="srcfoocpp"><code>src/foo.cpp</code></a></h3>
<pre><code class="language-cpp">extern &quot;C&quot; {
    int multiply(int x, int y);
}

int multiply(int x, int y) {
    return x*y;
}
</code></pre>
<h3><a class="header" href="#srcmainrs-1" id="srcmainrs-1"><code>src/main.rs</code></a></h3>
<pre><code class="language-rust edition2018 ignore">extern {
    fn multiply(x : i32, y : i32) -&gt; i32;
}

fn main(){
    unsafe {
        println!(&quot;{}&quot;, multiply(5,7));
    }   
}
</code></pre>
<h2><a class="header" href="#编译-c-语言库时自定义设置" id="编译-c-语言库时自定义设置">编译 C 语言库时自定义设置</a></h2>
<!--
> [development_tools/build_tools/cc-defines.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/development_tools/build_tools/cc-defines.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/cc"><img src="https://badge-cache.kominick.com/crates/v/cc.svg?label=cc" alt="cc-badge" /></a> <a href="https://crates.io/categories/development-tools"><img src="https://badge-cache.kominick.com/badge/development_tools--x.svg?style=social" alt="cat-development-tools-badge" /></a></p>
<p>使用 <a href="https://docs.rs/cc/*/cc/struct.Build.html#method.define"><code>cc::Build::define</code></a> 自定义构建绑定的 C 语言代码非常简单。该方法接受 <a href="https://doc.rust-lang.org/std/option/enum.Option.html"><code>Option</code></a> 值，因此可以创建这样的定义：<code>#define APP_NAME &quot;foo&quot;</code>、<code>#define WELCOME</code>（将 <code>None</code> 作为不确定值传递）。如下实例构建了一个绑定的 C 语言文件，其在 <code>build.rs</code> 中设置了动态定义，并在运行时打印 “<strong>Welcome to foo - version 1.0.2</strong>”。Cargo 设定了一些<a href="https://doc.rust-lang.org/cargo/reference/environment-variables.html">环境变量</a>，这些变量可能对某些自定义设置有用。</p>
<h3><a class="header" href="#cargotoml-2" id="cargotoml-2"><code>Cargo.toml</code></a></h3>
<pre><code class="language-toml">[package]
...
version = &quot;1.0.2&quot;
build = &quot;build.rs&quot;

[build-dependencies]
cc = &quot;1&quot;
</code></pre>
<h3><a class="header" href="#buildrs-2" id="buildrs-2"><code>build.rs</code></a></h3>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">fn main() {
    cc::Build::new()
        .define(&quot;APP_NAME&quot;, &quot;\&quot;foo\&quot;&quot;)
        .define(&quot;VERSION&quot;, format!(&quot;\&quot;{}\&quot;&quot;, env!(&quot;CARGO_PKG_VERSION&quot;)).as_str())
        .define(&quot;WELCOME&quot;, None)
        .file(&quot;src/foo.c&quot;)
        .compile(&quot;foo&quot;);
}
</code></pre></pre>
<h3><a class="header" href="#srcfooc" id="srcfooc"><code>src/foo.c</code></a></h3>
<pre><code class="language-c">#include &lt;stdio.h&gt;

void print_app_info() {
#ifdef WELCOME
    printf(&quot;Welcome to &quot;);
#endif
    printf(&quot;%s - version %s\n&quot;, APP_NAME, VERSION);
}
</code></pre>
<h3><a class="header" href="#srcmainrs-2" id="srcmainrs-2"><code>src/main.rs</code></a></h3>
<pre><code class="language-rust edition2018 ignore">extern {
    fn print_app_info();
}

fn main(){
    unsafe {
        print_app_info();
    }   
}
</code></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#编码-1" id="编码-1">编码</a></h1>
<!--
> [encoding.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/encoding.md)
> <br />
> commit 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<h2><a class="header" href="#字符集-1" id="字符集-1">字符集</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="encoding/strings.html#%E7%99%BE%E5%88%86%E6%AF%94%E7%BC%96%E7%A0%81url-%E7%BC%96%E7%A0%81%E5%AD%97%E7%AC%A6%E4%B8%B2">百分比编码（URL 编码）字符串</a></td><td><a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/percent-encoding.svg?label=percent-encoding" alt="percent-encoding-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="encoding/strings.html#%E5%B0%86%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%BC%96%E7%A0%81%E4%B8%BA-applicationx-www-form-urlencoded">将字符串编码为 application/x-www-form-urlencoded</a></td><td><a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="encoding/strings.html#%E7%BC%96%E7%A0%81%E5%92%8C%E8%A7%A3%E7%A0%81%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6">编码和解码十六进制</a></td><td><a href="https://docs.rs/data-encoding/"><img src="https://badge-cache.kominick.com/crates/v/data-encoding.svg?label=data-encoding" alt="data-encoding-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="encoding/strings.html#%E7%BC%96%E7%A0%81%E5%92%8C%E8%A7%A3%E7%A0%81-base64">编码和解码 base64</a></td><td><a href="https://docs.rs/base64/"><img src="https://badge-cache.kominick.com/crates/v/base64.svg?label=base64" alt="base64-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#csv-处理-1" id="csv-处理-1">CSV 处理</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="encoding/csv.html#%E8%AF%BB%E5%8F%96-csv-%E8%AE%B0%E5%BD%95">读取 CSV 记录</a></td><td><a href="https://docs.rs/csv/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=csv" alt="csv-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="encoding/csv.html#%E8%AF%BB%E5%8F%96%E6%9C%89%E4%B8%8D%E5%90%8C%E5%88%86%E9%9A%94%E7%AC%A6%E7%9A%84-csv-%E8%AE%B0%E5%BD%95">读取有不同分隔符的 CSV 记录</a></td><td><a href="https://docs.rs/csv/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=csv" alt="csv-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="encoding/csv.html#%E7%AD%9B%E9%80%89%E5%8C%B9%E9%85%8D%E6%96%AD%E8%A8%80%E7%9A%84-csv-%E8%AE%B0%E5%BD%95">筛选匹配断言的 CSV 记录</a></td><td><a href="https://docs.rs/csv/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=csv" alt="csv-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="encoding/csv.html#%E7%94%A8-serde-%E5%A4%84%E7%90%86%E6%97%A0%E6%95%88%E7%9A%84-csv-%E6%95%B0%E6%8D%AE">用 Serde 处理无效的 CSV 数据</a></td><td><a href="https://docs.rs/csv/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=csv" alt="csv-badge" /></a> <a href="https://docs.rs/serde/"><img src="https://badge-cache.kominick.com/crates/v/serde.svg?label=serde" alt="serde-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="encoding/csv.html#%E5%B0%86%E8%AE%B0%E5%BD%95%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%BA-csv">将记录序列化为 CSV</a></td><td><a href="https://docs.rs/csv/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=csv" alt="csv-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="encoding/csv.html#%E7%94%A8-serde-%E5%B0%86%E8%AE%B0%E5%BD%95%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%BA-csv">用 Serde 将记录序列化为 CSV</a></td><td><a href="https://docs.rs/csv/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=csv" alt="csv-badge" /></a> <a href="https://docs.rs/serde/"><img src="https://badge-cache.kominick.com/crates/v/serde.svg?label=serde" alt="serde-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="encoding/csv.html#%E8%BD%AC%E6%8D%A2-csv-%E6%96%87%E4%BB%B6%E7%9A%84%E5%88%97">转换 CSV 文件的列</a></td><td><a href="https://docs.rs/csv/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=csv" alt="csv-badge" /></a> <a href="https://docs.rs/serde/"><img src="https://badge-cache.kominick.com/crates/v/serde.svg?label=serde" alt="serde-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#结构化数据-1" id="结构化数据-1">结构化数据</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="encoding/complex.html#%E5%AF%B9%E9%9D%9E%E7%BB%93%E6%9E%84%E5%8C%96-json-%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96">对非结构化 JSON 序列化和反序列化</a></td><td><a href="https://docs.rs/serde_json/*/serde_json/"><img src="https://badge-cache.kominick.com/crates/v/serde_json.svg?label=serde_json" alt="serde-json-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="encoding/complex.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-toml-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">反序列化 TOML 配置文件</a></td><td><a href="https://docs.rs/toml/"><img src="https://badge-cache.kominick.com/crates/v/toml.svg?label=toml" alt="toml-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="encoding/complex.html#%E4%BB%A5%E5%B0%8F%E7%AB%AF%E6%A8%A1%E5%BC%8F%E4%BD%8E%E4%BD%8D%E6%A8%A1%E5%BC%8F%E5%AD%97%E8%8A%82%E9%A1%BA%E5%BA%8F%E8%AF%BB%E5%86%99%E6%95%B4%E6%95%B0">以小端模式（低位模式）字节顺序读写整数</a></td><td><a href="https://docs.rs/byteorder/"><img src="https://badge-cache.kominick.com/crates/v/byteorder.svg?label=byteorder" alt="byteorder-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#字符集-2" id="字符集-2">字符集</a></h1>
<!--
> [encoding/strings.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/encoding/strings.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#百分比编码url-编码字符串" id="百分比编码url-编码字符串">百分比编码（URL 编码）字符串</a></h2>
<!--
> [encoding/string/percent-encode.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/encoding/string/percent-encode.md)
> <br />
> commit 203b1085212a7b857d9a29bdc6a763515e77e0f9 - 2020.06.08
-->
<p><a href="https://en.wikipedia.org/wiki/Percent-encoding"><img src="https://badge-cache.kominick.com/crates/v/percent-encoding.svg?label=percent-encoding" alt="percent-encoding-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></p>
<p>使用 <code>percent-encoding</code> crate 中的 <a href="https://docs.rs/percent-encoding/*/percent_encoding/fn.utf8_percent_encode.html"><code>utf8_percent_encode</code></a> 函数对输入字符串进行<a href="https://en.wikipedia.org/wiki/Percent-encoding">百分比编码（URL 编码）</a>。解码使用 <a href="https://docs.rs/percent-encoding/*/percent_encoding/fn.percent_decode.html"><code>percent_decode</code></a> 函数。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use percent_encoding::{utf8_percent_encode, percent_decode, AsciiSet, CONTROLS};
use std::str::Utf8Error;

/// https://url.spec.whatwg.org/#fragment-percent-encode-set
const FRAGMENT: &amp;AsciiSet = &amp;CONTROLS.add(b' ').add(b'&quot;').add(b'&lt;').add(b'&gt;').add(b'`');

fn main() -&gt; Result&lt;(), Utf8Error&gt; {
    let input = &quot;confident, productive systems programming&quot;;

    let iter = utf8_percent_encode(input, FRAGMENT);
    let encoded: String = iter.collect();
    assert_eq!(encoded, &quot;confident,%20productive%20systems%20programming&quot;);

    let iter = percent_decode(encoded.as_bytes());
    let decoded = iter.decode_utf8()?;
    assert_eq!(decoded, &quot;confident, productive systems programming&quot;);

    Ok(())
}
</code></pre></pre>
<p>编码集定义哪些字节（除了非 ASCII 字节和控制键之外）需要进行百分比编码（URL 编码），这个集合的选择取决于上下文。例如，<code>url</code> 对 URL 路径中的 <code>?</code> 编码，而不对查询字符串中的 <code>?</code> 编码。</p>
<p>编码的返回值是 <code>&amp;str</code> 切片的迭代器，然后聚集为一个字符串 <code>String</code>。</p>
<h2><a class="header" href="#将字符串编码为-applicationx-www-form-urlencoded" id="将字符串编码为-applicationx-www-form-urlencoded">将字符串编码为 application/x-www-form-urlencoded</a></h2>
<!--
> [encoding/string/hex.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/encoding/string/hex.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></p>
<p>如下实例使用 <a href="https://docs.rs/url/*/url/form_urlencoded/fn.byte_serialize.html"><code>form_urlencoded::byte_serialize</code></a> 将字符串编码为 <a href="https://url.spec.whatwg.org/#application/x-www-form-urlencoded">application/x-www-form-urlencoded</a> 表单语法，随后使用 <a href="https://docs.rs/url/*/url/form_urlencoded/fn.parse.html"><code>form_urlencoded::parse</code></a> 对其进行解码。这两个函数都返回迭代器，然后这些迭代器聚集为 <code>String</code>。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use url::form_urlencoded::{byte_serialize, parse};

fn main() {
    let urlencoded: String = byte_serialize(&quot;What is ❤?&quot;.as_bytes()).collect();
    assert_eq!(urlencoded, &quot;What+is+%E2%9D%A4%3F&quot;);
    println!(&quot;urlencoded:'{}'&quot;, urlencoded);

    let decoded: String = parse(urlencoded.as_bytes())
        .map(|(key, val)| [key, val].concat())
        .collect();
    assert_eq!(decoded, &quot;What is ❤?&quot;);
    println!(&quot;decoded:'{}'&quot;, decoded);
}
</code></pre></pre>
<h2><a class="header" href="#编码和解码十六进制" id="编码和解码十六进制">编码和解码十六进制</a></h2>
<!--
> [encoding/string/hex.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/encoding/string/hex.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/data-encoding/"><img src="https://badge-cache.kominick.com/crates/v/data-encoding.svg?label=data-encoding" alt="data-encoding-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></p>
<p><a href="https://docs.rs/data-encoding/*/data_encoding/"><code>data_encoding</code></a> crate 提供了 <code>HEXUPPER::encode</code> 方法，该方法接受 <code>&amp;[u8]</code> 参数并返回十六进制数据的字符串 <code>String</code>。</p>
<p>类似地，<a href="https://docs.rs/data-encoding/*/data_encoding/"><code>data_encoding</code></a> crate 提供了 <code>HEXUPPER::decode</code> 方法，该方法接受 <code>&amp;[u8]</code> 参数。如果输入数据被成功解码，则返回 <code>Vec&lt;u8&gt;</code>。</p>
<p>下面的实例将 <code>&amp;[u8]</code> 数据转换为等效的十六进制数据，然后将此值与预期值进行比较。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use data_encoding::{HEXUPPER, DecodeError};

fn main() -&gt; Result&lt;(), DecodeError&gt; {
    let original = b&quot;The quick brown fox jumps over the lazy dog.&quot;;
    let expected = &quot;54686520717569636B2062726F776E20666F78206A756D7073206F76\
        657220746865206C617A7920646F672E&quot;;

    let encoded = HEXUPPER.encode(original);
    assert_eq!(encoded, expected);

    let decoded = HEXUPPER.decode(&amp;encoded.into_bytes())?;
    assert_eq!(&amp;decoded[..], &amp;original[..]);

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#编码和解码-base64" id="编码和解码-base64">编码和解码 base64</a></h2>
<!--
> [encoding/string/base64.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/encoding/string/base64.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/base64/"><img src="https://badge-cache.kominick.com/crates/v/base64.svg?label=base64" alt="base64-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></p>
<p>使用 <a href="https://docs.rs/base64/*/base64/fn.encode.html"><code>encode</code></a> 将字节切片编码为 <code>base64</code> 字符串，对 <code>base64</code> 字符串解码使用 <a href="https://docs.rs/base64/*/base64/fn.decode.html"><code>decode</code></a>。</p>
<pre><pre class="playground"><code class="language-rust edition2018"><span class="boring">use error_chain::error_chain;
</span>
use std::str;
use base64::{encode, decode};
<span class="boring">
</span><span class="boring">error_chain! {
</span><span class="boring">    foreign_links {
</span><span class="boring">        Base64(base64::DecodeError);
</span><span class="boring">        Utf8Error(str::Utf8Error);
</span><span class="boring">    }
</span><span class="boring">}
</span>
fn main() -&gt; Result&lt;()&gt; {
    let hello = b&quot;hello rustaceans&quot;;
    let encoded = encode(hello);
    let decoded = decode(&amp;encoded)?;

    println!(&quot;origin: {}&quot;, str::from_utf8(hello)?);
    println!(&quot;base64 encoded: {}&quot;, encoded);
    println!(&quot;back to origin: {}&quot;, str::from_utf8(&amp;decoded)?);

    Ok(())
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#csv-处理-2" id="csv-处理-2">CSV 处理</a></h1>
<!--
> [encoding/csv.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/encoding/csv.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#读取-csv-记录" id="读取-csv-记录">读取 CSV 记录</a></h2>
<!--
> [encoding/csv/read.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/encoding/csv/read.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/csv/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=csv" alt="csv-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></p>
<p>将标准的 CSV 记录读入 <a href="https://docs.rs/csv/*/csv/struct.StringRecord.html"><code>csv::StringRecord</code></a>——一种弱类型的数据表示方式，它需要 CSV 中的行数据是有效的 UTF-8 字符编码。另外，<a href="https://docs.rs/csv/*/csv/struct.ByteRecord.html"><code>csv::ByteRecord</code></a> 对 UTF-8 不做任何预设。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use csv::Error;

fn main() -&gt; Result&lt;(), Error&gt; {
    let csv = &quot;year,make,model,description
		1948,Porsche,356,Luxury sports car
		1967,Ford,Mustang fastback 1967,American car&quot;;

    let mut reader = csv::Reader::from_reader(csv.as_bytes());
    for record in reader.records() {
        let record = record?;
        println!(
            &quot;In {}, {} built the {} model. It is a {}.&quot;,
            &amp;record[0],
            &amp;record[1],
            &amp;record[2],
            &amp;record[3]
        );
    }

    Ok(())
}
</code></pre></pre>
<p>Serde 将数据反序列化为强类型结构体。具体查阅 <a href="https://docs.rs/csv/*/csv/struct.Reader.html#method.deserialize"><code>csv::Reader::deserialize</code></a> 方法。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use serde::Deserialize;
#[derive(Deserialize)]
struct Record {
    year: u16,
    make: String,
    model: String,
    description: String,
}

fn main() -&gt; Result&lt;(), csv::Error&gt; {
    let csv = &quot;year,make,model,description
1948,Porsche,356,Luxury sports car
1967,Ford,Mustang fastback 1967,American car&quot;;

    let mut reader = csv::Reader::from_reader(csv.as_bytes());

    for record in reader.deserialize() {
        let record: Record = record?;
        println!(
            &quot;In {}, {} built the {} model. It is a {}.&quot;,
            record.year,
            record.make,
            record.model,
            record.description
        );
    }

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#读取有不同分隔符的-csv-记录" id="读取有不同分隔符的-csv-记录">读取有不同分隔符的 CSV 记录</a></h2>
<!--
> [encoding/csv/delimiter.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/encoding/csv/delimiter.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/csv/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=csv" alt="csv-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></p>
<p>使用制表（tab）分隔符 <a href="https://docs.rs/csv/1.0.0-beta.3/csv/struct.ReaderBuilder.html#method.delimiter"><code>delimiter</code></a> 读取 CSV 记录。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use csv::Error;
use serde::Deserialize;
#[derive(Debug, Deserialize)]
struct Record {
    name: String,
    place: String,
    #[serde(deserialize_with = &quot;csv::invalid_option&quot;)]
    id: Option&lt;u64&gt;,
}

use csv::ReaderBuilder;

fn main() -&gt; Result&lt;(), Error&gt; {
    let data = &quot;name\tplace\tid
		Mark\tMelbourne\t46
		Ashley\tZurich\t92&quot;;

    let mut reader = ReaderBuilder::new().delimiter(b'\t').from_reader(data.as_bytes());
    for result in reader.deserialize::&lt;Record&gt;() {
        println!(&quot;{:?}&quot;, result?);
    }

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#筛选匹配断言的-csv-记录" id="筛选匹配断言的-csv-记录">筛选匹配断言的 CSV 记录</a></h2>
<!--
> [encoding/csv/filter.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/encoding/csv/filter.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/csv/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=csv" alt="csv-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></p>
<p><em>仅仅</em> 返回 <code>data</code> 中字段（field）与 <code>query</code> 匹配的的行。</p>
<pre><pre class="playground"><code class="language-rust edition2018"><span class="boring">use error_chain::error_chain;
</span>
use std::io;
<span class="boring">
</span><span class="boring">error_chain!{
</span><span class="boring">    foreign_links {
</span><span class="boring">        Io(std::io::Error);
</span><span class="boring">        CsvError(csv::Error);
</span><span class="boring">    }
</span><span class="boring">}
</span>
fn main() -&gt; Result&lt;()&gt; {
    let query = &quot;CA&quot;;
    let data = &quot;\
City,State,Population,Latitude,Longitude
Kenai,AK,7610,60.5544444,-151.2583333
Oakman,AL,,33.7133333,-87.3886111
Sandfort,AL,,32.3380556,-85.2233333
West Hollywood,CA,37031,34.0900000,-118.3608333&quot;;

    let mut rdr = csv::ReaderBuilder::new().from_reader(data.as_bytes());
    let mut wtr = csv::Writer::from_writer(io::stdout());

    wtr.write_record(rdr.headers()?)?;

    for result in rdr.records() {
        let record = result?;
        if record.iter().any(|field| field == query) {
            wtr.write_record(&amp;record)?;
        }
    }

    wtr.flush()?;
    Ok(())
}
</code></pre></pre>
<p><em>免责声明：此实例改编自<a href="https://docs.rs/csv/*/csv/tutorial/index.html#filter-by-search">csv crate 教程</a></em>。</p>
<h2><a class="header" href="#用-serde-处理无效的-csv-数据" id="用-serde-处理无效的-csv-数据">用 Serde 处理无效的 CSV 数据</a></h2>
<!--
> [encoding/csv/invalid.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/encoding/csv/invalid.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/csv/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=csv" alt="csv-badge" /></a> <a href="https://docs.rs/serde/"><img src="https://badge-cache.kominick.com/crates/v/serde.svg?label=serde" alt="serde-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></p>
<p>CSV 文件通常包含无效数据。对于这些情形，<code>csv</code> crate 提供了一个自定义的反序列化程序 <a href="https://docs.rs/csv/*/csv/fn.invalid_option.html"><code>csv::invalid_option</code></a>，它自动将无效数据转换为 None 值。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use csv::Error;
use serde::Deserialize;

#[derive(Debug, Deserialize)]
struct Record {
    name: String,
    place: String,
    #[serde(deserialize_with = &quot;csv::invalid_option&quot;)]
    id: Option&lt;u64&gt;,
}

fn main() -&gt; Result&lt;(), Error&gt; {
    let data = &quot;name,place,id
mark,sydney,46.5
ashley,zurich,92
akshat,delhi,37
alisha,colombo,xyz&quot;;

    let mut rdr = csv::Reader::from_reader(data.as_bytes());
    for result in rdr.deserialize() {
        let record: Record = result?;
        println!(&quot;{:?}&quot;, record);
    }

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#将记录序列化为-csv" id="将记录序列化为-csv">将记录序列化为 CSV</a></h2>
<!--
> [encoding/csv/serialize.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/encoding/csv/serialize.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/csv/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=csv" alt="csv-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></p>
<p>本实例展示了如何序列化 Rust 元组。<a href="https://docs.rs/csv/*/csv/struct.Writer.html"><code>csv::writer</code></a> 支持从 Rust 类型到 CSV 记录的自动序列化。<a href="https://docs.rs/csv/*/csv/struct.Writer.html#method.write_record"><code>write_record</code></a> 只写入包含字符串数据的简单记录。具有更复杂值（如数字、浮点和选项）的数据使用 <a href="https://docs.rs/csv/*/csv/struct.Writer.html#method.serialize"><code>serialize</code></a> 进行序列化。因为 <a href="https://docs.rs/csv/*/csv/struct.Writer.html"><code>csv::writer</code></a> 使用内部缓冲区，所以在完成时总是显式刷新 <a href="https://docs.rs/csv/*/csv/struct.Writer.html#method.flush"><code>flush</code></a>。</p>
<pre><pre class="playground"><code class="language-rust edition2018"><span class="boring">use error_chain::error_chain;
</span>
use std::io;
<span class="boring">
</span><span class="boring">error_chain! {
</span><span class="boring">    foreign_links {
</span><span class="boring">        CSVError(csv::Error);
</span><span class="boring">        IOError(std::io::Error);
</span><span class="boring">   }
</span><span class="boring">}
</span>
fn main() -&gt; Result&lt;()&gt; {
    let mut wtr = csv::Writer::from_writer(io::stdout());

    wtr.write_record(&amp;[&quot;Name&quot;, &quot;Place&quot;, &quot;ID&quot;])?;

    wtr.serialize((&quot;Mark&quot;, &quot;Sydney&quot;, 87))?;
    wtr.serialize((&quot;Ashley&quot;, &quot;Dublin&quot;, 32))?;
    wtr.serialize((&quot;Akshat&quot;, &quot;Delhi&quot;, 11))?;

    wtr.flush()?;
    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#用-serde-将记录序列化为-csv" id="用-serde-将记录序列化为-csv">用 Serde 将记录序列化为 CSV</a></h2>
<!--
> [encoding/csv/serde-serialize.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/encoding/csv/serde-serialize.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/csv/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=csv" alt="csv-badge" /></a> <a href="https://docs.rs/serde/"><img src="https://badge-cache.kominick.com/crates/v/serde.svg?label=serde" alt="serde-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></p>
<p>下面的实例展示如何使用 <a href="https://docs.rs/serde/">serde</a> crate 将自定义结构体序列化为 CSV 记录。</p>
<pre><pre class="playground"><code class="language-rust edition2018"><span class="boring">use error_chain::error_chain;
</span>use serde::Serialize;
use std::io;
<span class="boring">
</span><span class="boring">error_chain! {
</span><span class="boring">   foreign_links {
</span><span class="boring">       IOError(std::io::Error);
</span><span class="boring">       CSVError(csv::Error);
</span><span class="boring">   }
</span><span class="boring">}
</span>
#[derive(Serialize)]
struct Record&lt;'a&gt; {
    name: &amp;'a str,
    place: &amp;'a str,
    id: u64,
}

fn main() -&gt; Result&lt;()&gt; {
    let mut wtr = csv::Writer::from_writer(io::stdout());

    let rec1 = Record { name: &quot;Mark&quot;, place: &quot;Melbourne&quot;, id: 56};
    let rec2 = Record { name: &quot;Ashley&quot;, place: &quot;Sydney&quot;, id: 64};
    let rec3 = Record { name: &quot;Akshat&quot;, place: &quot;Delhi&quot;, id: 98};

    wtr.serialize(rec1)?;
    wtr.serialize(rec2)?;
    wtr.serialize(rec3)?;

    wtr.flush()?;

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#转换-csv-文件的列" id="转换-csv-文件的列">转换 CSV 文件的列</a></h2>
<!--
> [encoding/csv/transform.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/encoding/csv/transform.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/csv/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=csv" alt="csv-badge" /></a> <a href="https://docs.rs/serde/"><img src="https://badge-cache.kominick.com/crates/v/serde.svg?label=serde" alt="serde-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></p>
<p>将包含颜色名称和十六进制颜色值的 CSV 文件转换为具有颜色名称和 rgb 颜色值的 CSV 文件。使用 <a href="https://docs.rs/csv/">csv</a> crate 读写 csv 文件，使用 <a href="https://docs.rs/serde/">serde</a> crate 对行输入字节进行反序列化，对行输出字节进行序列化。</p>
<p>详细请参阅 <a href="https://docs.rs/csv/*/csv/struct.Reader.html#method.deserialize"><code>csv::Reader::deserialize</code></a>、<a href="https://docs.rs/serde/*/serde/trait.Deserialize.html"><code>serde::Deserialize</code></a>，以及 <a href="https://doc.rust-lang.org/std/str/trait.FromStr.html"><code>std::str::FromStr</code></a>。</p>
<pre><pre class="playground"><code class="language-rust edition2018"><span class="boring">use error_chain::error_chain;
</span>use csv::{Reader, Writer};
use serde::{de, Deserialize, Deserializer};
use std::str::FromStr;
<span class="boring">
</span><span class="boring">error_chain! {
</span><span class="boring">   foreign_links {
</span><span class="boring">       CsvError(csv::Error);
</span><span class="boring">       ParseInt(std::num::ParseIntError);
</span><span class="boring">       CsvInnerError(csv::IntoInnerError&lt;Writer&lt;Vec&lt;u8&gt;&gt;&gt;);
</span><span class="boring">       IO(std::fmt::Error);
</span><span class="boring">       UTF8(std::string::FromUtf8Error);
</span><span class="boring">   }
</span><span class="boring">}
</span>
#[derive(Debug)]
struct HexColor {
    red: u8,
    green: u8,
    blue: u8,
}

#[derive(Debug, Deserialize)]
struct Row {
    color_name: String,
    color: HexColor,
}

impl FromStr for HexColor {
    type Err = Error;

    fn from_str(hex_color: &amp;str) -&gt; std::result::Result&lt;Self, Self::Err&gt; {
        let trimmed = hex_color.trim_matches('#');
        if trimmed.len() != 6 {
            Err(&quot;Invalid length of hex string&quot;.into())
        } else {
            Ok(HexColor {
                red: u8::from_str_radix(&amp;trimmed[..2], 16)?,
                green: u8::from_str_radix(&amp;trimmed[2..4], 16)?,
                blue: u8::from_str_radix(&amp;trimmed[4..6], 16)?,
            })
        }
    }
}

impl&lt;'de&gt; Deserialize&lt;'de&gt; for HexColor {
    fn deserialize&lt;D&gt;(deserializer: D) -&gt; std::result::Result&lt;Self, D::Error&gt;
    where
        D: Deserializer&lt;'de&gt;,
    {
        let s = String::deserialize(deserializer)?;
        FromStr::from_str(&amp;s).map_err(de::Error::custom)
    }
}

fn main() -&gt; Result&lt;()&gt; {
    let data = &quot;color_name,color
red,#ff0000
green,#00ff00
blue,#0000FF
periwinkle,#ccccff
magenta,#ff00ff&quot;
        .to_owned();
    let mut out = Writer::from_writer(vec![]);
    let mut reader = Reader::from_reader(data.as_bytes());
    for result in reader.deserialize::&lt;Row&gt;() {
        let res = result?;
        out.serialize((
            res.color_name,
            res.color.red,
            res.color.green,
            res.color.blue,
        ))?;
    }
    let written = String::from_utf8(out.into_inner()?)?;
    assert_eq!(Some(&quot;magenta,255,0,255&quot;), written.lines().last());
    println!(&quot;{}&quot;, written);
    Ok(())
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#结构化数据-2" id="结构化数据-2">结构化数据</a></h1>
<!--
> [encoding/complex.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/encoding/complex.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#对非结构化-json-序列化和反序列化" id="对非结构化-json-序列化和反序列化">对非结构化 JSON 序列化和反序列化</a></h2>
<!--
> [encoding/complex/json.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/encoding/complex/json.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/serde_json/*/serde_json/"><img src="https://badge-cache.kominick.com/crates/v/serde_json.svg?label=serde_json" alt="serde-json-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></p>
<p><a href="https://docs.serde.rs/serde_json/"><code>serde_json</code></a> crate 提供了 <a href="https://docs.serde.rs/serde_json/fn.from_str.html"><code>from_str</code></a> 函数来解析 JSON 切片 <code>&amp;str</code>。</p>
<p>非结构化 JSON 可以被解析为一个通用的 <a href="https://docs.serde.rs/serde_json/enum.Value.html"><code>serde_json::Value</code></a> 类型，该类型能够表示任何有效的 JSON 数据。</p>
<p>下面的实例展示如何解析 JSON 切片 <code>&amp;str</code>，期望值被 <a href="https://docs.serde.rs/serde_json/macro.json.html"><code>json!</code></a> 宏声明。</p>
<pre><pre class="playground"><code class="language-rust edition2018"> use serde_json::json;
use serde_json::{Value, Error};

fn main() -&gt; Result&lt;(), Error&gt; {
    let j = r#&quot;{
                 &quot;userid&quot;: 103609,
                 &quot;verified&quot;: true,
                 &quot;access_privileges&quot;: [
                   &quot;user&quot;,
                   &quot;admin&quot;
                 ]
               }&quot;#;

    let parsed: Value = serde_json::from_str(j)?;

    let expected = json!({
        &quot;userid&quot;: 103609,
        &quot;verified&quot;: true,
        &quot;access_privileges&quot;: [
            &quot;user&quot;,
            &quot;admin&quot;
        ]
    });

    assert_eq!(parsed, expected);

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#反序列化-toml-配置文件" id="反序列化-toml-配置文件">反序列化 TOML 配置文件</a></h2>
<!--
> [encoding/complex/toml.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/encoding/complex/toml.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/toml/"><img src="https://badge-cache.kominick.com/crates/v/toml.svg?label=toml" alt="toml-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></p>
<p>将一些 TOML 配置项解析为一个通用的值 <code>toml::Value</code>，该值能够表示任何有效的 TOML 数据。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use toml::{Value, de::Error};

fn main() -&gt; Result&lt;(), Error&gt; {
    let toml_content = r#&quot;
          [package]
          name = &quot;your_package&quot;
          version = &quot;0.1.0&quot;
          authors = [&quot;You! &lt;you@example.org&gt;&quot;]

          [dependencies]
          serde = &quot;1.0&quot;
          &quot;#;

    let package_info: Value = toml::from_str(toml_content)?;

    assert_eq!(package_info[&quot;dependencies&quot;][&quot;serde&quot;].as_str(), Some(&quot;1.0&quot;));
    assert_eq!(package_info[&quot;package&quot;][&quot;name&quot;].as_str(),
               Some(&quot;your_package&quot;));

    Ok(())
}
</code></pre></pre>
<p>使用 <a href="https://docs.rs/serde/">Serde</a> crate 将 TOML 解析为自定义的结构体。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use serde::Deserialize;

use toml::de::Error;
use std::collections::HashMap;

#[derive(Deserialize)]
struct Config {
    package: Package,
    dependencies: HashMap&lt;String, String&gt;,
}

#[derive(Deserialize)]
struct Package {
    name: String,
    version: String,
    authors: Vec&lt;String&gt;,
}

fn main() -&gt; Result&lt;(), Error&gt; {
    let toml_content = r#&quot;
          [package]
          name = &quot;your_package&quot;
          version = &quot;0.1.0&quot;
          authors = [&quot;You! &lt;you@example.org&gt;&quot;]

          [dependencies]
          serde = &quot;1.0&quot;
          &quot;#;

    let package_info: Config = toml::from_str(toml_content)?;

    assert_eq!(package_info.package.name, &quot;your_package&quot;);
    assert_eq!(package_info.package.version, &quot;0.1.0&quot;);
    assert_eq!(package_info.package.authors, vec![&quot;You! &lt;you@example.org&gt;&quot;]);
    assert_eq!(package_info.dependencies[&quot;serde&quot;], &quot;1.0&quot;);

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#以小端模式低位模式字节顺序读写整数" id="以小端模式低位模式字节顺序读写整数">以小端模式（低位模式）字节顺序读写整数</a></h2>
<!--
> [encoding/complex/endian-byte.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/encoding/complex/endian-byte.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/byteorder/"><img src="https://badge-cache.kominick.com/crates/v/byteorder.svg?label=byteorder" alt="byteorder-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></p>
<p>字节序 <code>byteorder</code> 可以反转结构化数据的有效字节。当通过网络接收信息时，这可能是必要的，例如接收到的字节来自另一个系统。</p>
<pre><pre class="playground"><code class="language-rust edition2018">
use byteorder::{LittleEndian, ReadBytesExt, WriteBytesExt};
use std::io::Error;

#[derive(Default, PartialEq, Debug)]
struct Payload {
    kind: u8,
    value: u16,
}

fn main() -&gt; Result&lt;(), Error&gt; {
    let original_payload = Payload::default();
    let encoded_bytes = encode(&amp;original_payload)?;
    let decoded_payload = decode(&amp;encoded_bytes)?;
    assert_eq!(original_payload, decoded_payload);
    Ok(())
}

fn encode(payload: &amp;Payload) -&gt; Result&lt;Vec&lt;u8&gt;, Error&gt; {
    let mut bytes = vec![];
    bytes.write_u8(payload.kind)?;
    bytes.write_u16::&lt;LittleEndian&gt;(payload.value)?;
    Ok(bytes)
}

fn decode(mut bytes: &amp;[u8]) -&gt; Result&lt;Payload, Error&gt; {
    let payload = Payload {
        kind: bytes.read_u8()?,
        value: bytes.read_u16::&lt;LittleEndian&gt;()?,
    };
    Ok(payload)
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#错误处理-1" id="错误处理-1">错误处理</a></h1>
<!--
> [errors.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/errors.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#处理错误变量-1" id="处理错误变量-1">处理错误变量</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="errors/handle.html#%E5%9C%A8-main-%E6%96%B9%E6%B3%95%E4%B8%AD%E5%AF%B9%E9%94%99%E8%AF%AF%E9%80%82%E5%BD%93%E5%A4%84%E7%90%86">在 main 方法中对错误适当处理</a></td><td><a href="https://docs.rs/error-chain/"><img src="https://badge-cache.kominick.com/crates/v/error-chain.svg?label=error-chain" alt="error-chain-badge" /></a></td><td><a href="https://crates.io/categories/rust-patterns"><img src="https://badge-cache.kominick.com/badge/rust_patterns--x.svg?style=social" alt="cat-rust-patterns-badge" /></a></td></tr>
<tr><td><a href="errors/handle.html#%E9%81%BF%E5%85%8D%E5%9C%A8%E9%94%99%E8%AF%AF%E8%BD%AC%E5%8F%98%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%81%97%E6%BC%8F%E9%94%99%E8%AF%AF">避免在错误转变过程中遗漏错误</a></td><td><a href="https://docs.rs/error-chain/"><img src="https://badge-cache.kominick.com/crates/v/error-chain.svg?label=error-chain" alt="error-chain-badge" /></a></td><td><a href="https://crates.io/categories/rust-patterns"><img src="https://badge-cache.kominick.com/badge/rust_patterns--x.svg?style=social" alt="cat-rust-patterns-badge" /></a></td></tr>
<tr><td><a href="errors/handle.html#%E8%8E%B7%E5%8F%96%E5%A4%8D%E6%9D%82%E9%94%99%E8%AF%AF%E5%9C%BA%E6%99%AF%E7%9A%84%E5%9B%9E%E6%BA%AF">获取复杂错误场景的回溯</a></td><td><a href="https://docs.rs/error-chain/"><img src="https://badge-cache.kominick.com/crates/v/error-chain.svg?label=error-chain" alt="error-chain-badge" /></a></td><td><a href="https://crates.io/categories/rust-patterns"><img src="https://badge-cache.kominick.com/badge/rust_patterns--x.svg?style=social" alt="cat-rust-patterns-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#处理错误变量-2" id="处理错误变量-2">处理错误变量</a></h1>
<!--
> [errors/handle.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/errors/handle.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#在-main-方法中对错误适当处理" id="在-main-方法中对错误适当处理">在 main 方法中对错误适当处理</a></h2>
<!--
> [errors/handle/main.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/errors/handle/main.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/error-chain/"><img src="https://badge-cache.kominick.com/crates/v/error-chain.svg?label=error-chain" alt="error-chain-badge" /></a> <a href="https://crates.io/categories/rust-patterns"><img src="https://badge-cache.kominick.com/badge/rust_patterns--x.svg?style=social" alt="cat-rust-patterns-badge" /></a></p>
<p>处理尝试打开不存在的文件时发生的错误，是通过使用 <a href="https://docs.rs/error-chain/">error-chain</a> crate 来实现的。<a href="https://docs.rs/error-chain/">error-chain</a> crate 包含大量的模板代码，用于 <a href="https://rust-lang.budshome.com/ch09-00-error-handling.html">Rust 中的错误处理</a>。</p>
<p><a href="https://docs.rs/error-chain/*/error_chain/#foreign-links"><code>foreign_links</code></a> 代码块内的 <code>Io(std::io::Error)</code> 函数允许由 <a href="https://doc.rust-lang.org/std/io/struct.Error.html"><code>std::io::Error</code></a> 所报错误信息到 <a href="https://docs.rs/error-chain/*/error_chain/macro.error_chain.html"><code>error_chain!</code></a> 所定义错误类型的自动转换，<a href="https://docs.rs/error-chain/*/error_chain/macro.error_chain.html"><code>error_chain!</code></a> 所定义错误类型将实现 <a href="https://doc.rust-lang.org/std/error/trait.Error.html"><code>Error</code></a> trait。</p>
<p>下文的实例将通过打开 Unix 文件 <code>/proc/uptime</code> 并解析内容以获得其中第一个数字，从而告诉系统运行了多长时间。除非出现错误，否则返回正常运行时间。</p>
<p>本书中的其他实例将隐藏 <a href="https://docs.rs/error-chain/">error-chain</a> 模板，如果需要查看，可以通过 ⤢ 按钮展开代码。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use error_chain::error_chain;

use std::fs::File;
use std::io::Read;

error_chain!{
    foreign_links {
        Io(std::io::Error);
        ParseInt(::std::num::ParseIntError);
    }
}

fn read_uptime() -&gt; Result&lt;u64&gt; {
    let mut uptime = String::new();
    File::open(&quot;/proc/uptime&quot;)?.read_to_string(&amp;mut uptime)?;

    Ok(uptime
        .split('.')
        .next()
        .ok_or(&quot;Cannot parse uptime data&quot;)?
        .parse()?)
}

fn main() {
    match read_uptime() {
        Ok(uptime) =&gt; println!(&quot;uptime: {} seconds&quot;, uptime),
        Err(err) =&gt; eprintln!(&quot;error: {}&quot;, err),
    };
}
</code></pre></pre>
<h2><a class="header" href="#避免在错误转变过程中遗漏错误" id="避免在错误转变过程中遗漏错误">避免在错误转变过程中遗漏错误</a></h2>
<!--
> [errors/handle/retain.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/errors/handle/retain.md)
> <br />
> commit dd4efa8dcd8e611326caa01c08db8f227aa909d6 - 2020.06.07
-->
<p><a href="https://docs.rs/error-chain/"><img src="https://badge-cache.kominick.com/crates/v/error-chain.svg?label=error-chain" alt="error-chain-badge" /></a> <a href="https://crates.io/categories/rust-patterns"><img src="https://badge-cache.kominick.com/badge/rust_patterns--x.svg?style=social" alt="cat-rust-patterns-badge" /></a></p>
<p><a href="https://docs.rs/error-chain/">error-chain</a> crate 使得<a href="https://docs.rs/error-chain/*/error_chain/#matching-errors">匹配</a>函数返回的不同错误类型成为可能，并且相对简洁。<a href="https://docs.rs/error-chain/*/error_chain/example_generated/enum.ErrorKind.html"><code>ErrorKind</code></a> 是枚举类型，可以确定错误类型。</p>
<p>下文实例使用 <a href="https://docs.rs/reqwest/">reqwest</a>::<a href="https://docs.rs/reqwest/*/reqwest/blocking/index.html">blocking</a> 来查询一个随机整数生成器的 web 服务，并将服务器响应的字符串转换为整数。Rust 标准库 <a href="https://docs.rs/reqwest/">reqwest</a> 和 web 服务都可能会产生错误，所以使用 <a href="https://docs.rs/error-chain/*/error_chain/#foreign-links"><code>foreign_links</code></a> 定义易于辨认理解的 Rust 错误。另外，用于 web 服务错误信息的 <a href="https://docs.rs/error-chain/*/error_chain/example_generated/enum.ErrorKind.html"><code>ErrorKind</code></a> 变量，使用 <code>error_chain!</code> 宏的 <code>errors</code> 代码块定义。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use error_chain::error_chain;

error_chain! {
    foreign_links {
        Io(std::io::Error);
        Reqwest(reqwest::Error);
        ParseIntError(std::num::ParseIntError);
    }
    errors { RandomResponseError(t: String) }
}

fn parse_response(response: reqwest::blocking::Response) -&gt; Result&lt;u32&gt; {
  let mut body = response.text()?;
  body.pop();
  body
    .parse::&lt;u32&gt;()
    .chain_err(|| ErrorKind::RandomResponseError(body))
}

fn run() -&gt; Result&lt;()&gt; {
  let url =
    format!(&quot;https://www.random.org/integers/?num=1&amp;min=0&amp;max=10&amp;col=1&amp;base=10&amp;format=plain&quot;);
  let response = reqwest::blocking::get(&amp;url)?;
  let random_value: u32 = parse_response(response)?;
  println!(&quot;a random number between 0 and 10: {}&quot;, random_value);
  Ok(())
}

fn main() {
  if let Err(error) = run() {
    match *error.kind() {
      ErrorKind::Io(_) =&gt; println!(&quot;Standard IO error: {:?}&quot;, error),
      ErrorKind::Reqwest(_) =&gt; println!(&quot;Reqwest error: {:?}&quot;, error),
      ErrorKind::ParseIntError(_) =&gt; println!(&quot;Standard parse int error: {:?}&quot;, error),
      ErrorKind::RandomResponseError(_) =&gt; println!(&quot;User defined error: {:?}&quot;, error),
      _ =&gt; println!(&quot;Other error: {:?}&quot;, error),
    }
  }
}
</code></pre></pre>
<h2><a class="header" href="#获取复杂错误场景的回溯" id="获取复杂错误场景的回溯">获取复杂错误场景的回溯</a></h2>
<!--
> [errors/handle/backtrace.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/errors/handle/backtrace.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/error-chain/"><img src="https://badge-cache.kominick.com/crates/v/error-chain.svg?label=error-chain" alt="error-chain-badge" /></a> <a href="https://crates.io/categories/rust-patterns"><img src="https://badge-cache.kominick.com/badge/rust_patterns--x.svg?style=social" alt="cat-rust-patterns-badge" /></a></p>
<p>本实例展示了如何处理一个复杂的错误场景，并且打印出错误回溯。依赖于 <a href="https://docs.rs/error-chain/*/error_chain/index.html#chaining-errors"><code>chain_err</code></a>，通过附加新的错误来扩展错误信息。从而可以展开错误堆栈，这样提供了更好的上下文来理解错误的产生原因。</p>
<p>下述代码尝试将值 <code>256</code> 反序列化为 <code>u8</code>。首先 Serde 产生错误，然后是 csv，最后是用户代码。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use error_chain::error_chain;
<span class="boring">use serde::Deserialize;
</span><span class="boring">
</span><span class="boring">use std::fmt;
</span><span class="boring">
</span><span class="boring">error_chain! {
</span><span class="boring">    foreign_links {
</span><span class="boring">        Reader(csv::Error);
</span><span class="boring">    }
</span><span class="boring">}
</span>
#[derive(Debug, Deserialize)]
struct Rgb {
    red: u8,
    blue: u8,
    green: u8,
}

impl Rgb {
    fn from_reader(csv_data: &amp;[u8]) -&gt; Result&lt;Rgb&gt; {
        let color: Rgb = csv::Reader::from_reader(csv_data)
            .deserialize()
            .nth(0)
            .ok_or(&quot;Cannot deserialize the first CSV record&quot;)?
            .chain_err(|| &quot;Cannot deserialize RGB color&quot;)?;

        Ok(color)
    }
}

<span class="boring">impl fmt::UpperHex for Rgb {
</span><span class="boring">    fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; fmt::Result {
</span><span class="boring">        let hexa = u32::from(self.red) &lt;&lt; 16 | u32::from(self.blue) &lt;&lt; 8 | u32::from(self.green);
</span><span class="boring">        write!(f, &quot;{:X}&quot;, hexa)
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span>fn run() -&gt; Result&lt;()&gt; {
    let csv = &quot;red,blue,green
102,256,204&quot;;

    let rgb = Rgb::from_reader(csv.as_bytes()).chain_err(|| &quot;Cannot read CSV data&quot;)?;
    println!(&quot;{:?} to hexadecimal #{:X}&quot;, rgb, rgb);

    Ok(())
}

fn main() {
    if let Err(ref errors) = run() {
        eprintln!(&quot;Error level - description&quot;);
        errors
            .iter()
            .enumerate()
            .for_each(|(index, error)| eprintln!(&quot;└&gt; {} - {}&quot;, index, error));

        if let Some(backtrace) = errors.backtrace() {
            eprintln!(&quot;{:?}&quot;, backtrace);
        }
<span class="boring">
</span><span class="boring">        // In a real use case, errors should handled. For example:
</span><span class="boring">        // ::std::process::exit(1);
</span>    }
}
</code></pre></pre>
<p>错误回溯信息如下：</p>
<pre><code class="language-text">Error level - description
└&gt; 0 - Cannot read CSV data
└&gt; 1 - Cannot deserialize RGB color
└&gt; 2 - CSV deserialize error: record 1 (line: 2, byte: 15): field 1: number too large to fit in target type
└&gt; 3 - field 1: number too large to fit in target type
</code></pre>
<p>可以通过附加命令参数 <code>RUST_BACKTRACE=1</code> 运行实例，以显示与此错误相关的详细<a href="https://docs.rs/error-chain/*/error_chain/trait.ChainedError.html#tymethod.backtrace">回溯</a>。</p>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#文件系统-1" id="文件系统-1">文件系统</a></h1>
<!--
> [file.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/file.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#文件读写-1" id="文件读写-1">文件读写</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="file/read-write.html#%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%A1%8C">读取文件的字符串行</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
<tr><td><a href="file/read-write.html#%E9%81%BF%E5%85%8D%E8%AF%BB%E5%8F%96%E5%86%99%E5%85%A5%E5%90%8C%E4%B8%80%E6%96%87%E4%BB%B6">避免读取写入同一文件</a></td><td><a href="https://docs.rs/same-file/"><img src="https://badge-cache.kominick.com/crates/v/same_file.svg?label=same_file" alt="same_file-badge" /></a></td><td><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
<tr><td><a href="file/read-write.html#%E4%BD%BF%E7%94%A8%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%84%E9%9A%8F%E6%9C%BA%E8%AE%BF%E9%97%AE%E6%96%87%E4%BB%B6">使用内存映射随机访问文件</a></td><td><a href="https://docs.rs/memmap/"><img src="https://badge-cache.kominick.com/crates/v/memmap.svg?label=memmap" alt="memmap-badge" /></a></td><td><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#目录遍历-1" id="目录遍历-1">目录遍历</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="file/dir.html#%E8%BF%87%E5%8E%BB-24-%E5%B0%8F%E6%97%B6%E5%86%85%E4%BF%AE%E6%94%B9%E8%BF%87%E7%9A%84%E6%96%87%E4%BB%B6%E5%90%8D">过去 24 小时内修改过的文件名</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a> <a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a></td></tr>
<tr><td><a href="file/dir.html#%E6%9F%A5%E6%89%BE%E7%BB%99%E5%AE%9A%E8%B7%AF%E5%BE%84%E7%9A%84%E5%BE%AA%E7%8E%AF">查找给定路径的循环</a></td><td><a href="https://docs.rs/same-file/"><img src="https://badge-cache.kominick.com/crates/v/same_file.svg?label=same_file" alt="same_file-badge" /></a></td><td><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
<tr><td><a href="file/dir.html#%E9%80%92%E5%BD%92%E6%9F%A5%E6%89%BE%E9%87%8D%E5%90%8D%E6%96%87%E4%BB%B6">递归查找重名文件</a></td><td><a href="https://docs.rs/walkdir/"><img src="https://badge-cache.kominick.com/crates/v/walkdir.svg?label=walkdir" alt="walkdir-badge" /></a></td><td><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
<tr><td><a href="file/dir.html#%E4%BD%BF%E7%94%A8%E7%BB%99%E5%AE%9A%E6%96%AD%E8%A8%80%E9%80%92%E5%BD%92%E6%9F%A5%E6%89%BE%E6%89%80%E6%9C%89%E6%96%87%E4%BB%B6">使用给定断言递归查找所有文件</a></td><td><a href="https://docs.rs/walkdir/"><img src="https://badge-cache.kominick.com/crates/v/walkdir.svg?label=walkdir" alt="walkdir-badge" /></a></td><td><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
<tr><td><a href="file/dir.html#%E8%B7%B3%E8%BF%87%E9%9A%90%E8%97%8F%E6%96%87%E4%BB%B6%E9%81%8D%E5%8E%86%E7%9B%AE%E5%BD%95">跳过隐藏文件遍历目录</a></td><td><a href="https://docs.rs/walkdir/"><img src="https://badge-cache.kominick.com/crates/v/walkdir.svg?label=walkdir" alt="walkdir-badge" /></a></td><td><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
<tr><td><a href="file/dir.html#%E5%9C%A8%E7%BB%99%E5%AE%9A%E6%B7%B1%E5%BA%A6%E7%9A%84%E7%9B%AE%E5%BD%95%E9%80%92%E5%BD%92%E8%AE%A1%E7%AE%97%E6%96%87%E4%BB%B6%E5%A4%A7%E5%B0%8F">在给定深度的目录，递归计算文件大小</a></td><td><a href="https://docs.rs/walkdir/"><img src="https://badge-cache.kominick.com/crates/v/walkdir.svg?label=walkdir" alt="walkdir-badge" /></a></td><td><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
<tr><td><a href="file/dir.html#%E9%80%92%E5%BD%92%E6%9F%A5%E6%89%BE%E6%89%80%E6%9C%89-png-%E6%96%87%E4%BB%B6">递归查找所有 png 文件</a></td><td><a href="https://docs.rs/glob/"><img src="https://badge-cache.kominick.com/crates/v/glob.svg?label=glob" alt="glob-badge" /></a></td><td><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
<tr><td><a href="file/dir.html#%E5%BF%BD%E7%95%A5%E6%96%87%E4%BB%B6%E5%90%8D%E5%A4%A7%E5%B0%8F%E5%86%99%E4%BD%BF%E7%94%A8%E7%BB%99%E5%AE%9A%E6%A8%A1%E5%BC%8F%E6%9F%A5%E6%89%BE%E6%89%80%E6%9C%89%E6%96%87%E4%BB%B6">忽略文件名大小写，使用给定模式查找所有文件</a></td><td><a href="https://docs.rs/glob/"><img src="https://badge-cache.kominick.com/crates/v/glob.svg?label=glob" alt="glob-badge" /></a></td><td><a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#文件读写-2" id="文件读写-2">文件读写</a></h1>
<!--
> [file/dir.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/file/read-write.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#读取文件的字符串行" id="读取文件的字符串行">读取文件的字符串行</a></h2>
<!--
> [file/read-write/read-file.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/file/read-write/read-file.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a> <a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></p>
<p>我们向文件写入三行信息，然后使用 <a href="https://doc.rust-lang.org/std/io/trait.BufRead.html#method.lines"><code>BufRead::lines</code></a> 创建的迭代器 <a href="https://doc.rust-lang.org/std/io/struct.Lines.html"><code>Lines</code></a> 读取文件，一次读回一行。<a href="https://doc.rust-lang.org/std/fs/struct.File.html"><code>File</code></a> 模块实现了提供 <a href="https://doc.rust-lang.org/std/io/struct.BufReader.html"><code>BufReader</code></a> 结构体的 <a href="https://doc.rust-lang.org/std/io/trait.Read.html"><code>Read</code></a> trait。<a href="https://doc.rust-lang.org/std/fs/struct.File.html#method.create"><code>File::create</code></a> 打开文件 <a href="https://doc.rust-lang.org/std/fs/struct.File.html"><code>File</code></a> 进行写入，<a href="https://doc.rust-lang.org/std/fs/struct.File.html#method.open"><code>File::open</code></a> 则进行读取。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use std::fs::File;
use std::io::{Write, BufReader, BufRead, Error};

fn main() -&gt; Result&lt;(), Error&gt; {
    let path = &quot;lines.txt&quot;;

    let mut output = File::create(path)?;
    write!(output, &quot;Rust\n💖\nFun&quot;)?;

    let input = File::open(path)?;
    let buffered = BufReader::new(input);

    for line in buffered.lines() {
        println!(&quot;{}&quot;, line?);
    }

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#避免读取写入同一文件" id="避免读取写入同一文件">避免读取写入同一文件</a></h2>
<!--
> [file/read-write/same-file.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/file/read-write/same-file.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/same-file/"><img src="https://badge-cache.kominick.com/crates/v/same_file.svg?label=same_file" alt="same_file-badge" /></a> <a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></p>
<p>对文件使用 <a href="https://docs.rs/same-file/*/same_file/struct.Handle.html"><code>same_file::Handle</code></a> 结构体，可以测试文件句柄是否等同。在本实例中，将对要读取和写入的文件句柄进行相等性测试。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use same_file::Handle;
use std::fs::File;
use std::io::{BufRead, BufReader, Error, ErrorKind};
use std::path::Path;

fn main() -&gt; Result&lt;(), Error&gt; {
    let path_to_read = Path::new(&quot;new.txt&quot;);

    let stdout_handle = Handle::stdout()?;
    let handle = Handle::from_path(path_to_read)?;

    if stdout_handle == handle {
        return Err(Error::new(
            ErrorKind::Other,
            &quot;You are reading and writing to the same file&quot;,
        ));
    } else {
        let file = File::open(&amp;path_to_read)?;
        let file = BufReader::new(file);
        for (num, line) in file.lines().enumerate() {
            println!(&quot;{} : {}&quot;, num, line?.to_uppercase());
        }
    }

    Ok(())
}
</code></pre></pre>
<pre><code class="language-bash">cargo run
</code></pre>
<p>显示文件 new.txt 的内容。</p>
<pre><code class="language-bash">cargo run &gt;&gt; ./new.txt
</code></pre>
<p>报错，因为是同一文件。</p>
<h2><a class="header" href="#使用内存映射随机访问文件" id="使用内存映射随机访问文件">使用内存映射随机访问文件</a></h2>
<!--
> [file/read-write/memmap.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/file/read-write/memmap.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/memmap/"><img src="https://badge-cache.kominick.com/crates/v/memmap.svg?label=memmap" alt="memmap-badge" /></a> <a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></p>
<p>使用 <a href="https://docs.rs/memmap/">memmap</a> 创建文件的内存映射，并模拟文件的一些非序列读取。使用内存映射意味着您仅需索引一个切片，而不是使用 <a href="https://doc.rust-lang.org/std/fs/struct.File.html#method.seek"><code>seek</code></a> 方法来导航整个文件。</p>
<p><a href="https://docs.rs/memmap/*/memmap/struct.Mmap.html#method.map"><code>Mmap::map</code></a> 函数假定内存映射后的文件没有被另一个进程同时更改，否则会出现<a href="https://baike.baidu.com/item/%E7%AB%9E%E4%BA%89%E5%8D%B1%E5%AE%B3/3525767">竞态条件</a>。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use memmap::Mmap;
use std::fs::File;
use std::io::{Write, Error};

fn main() -&gt; Result&lt;(), Error&gt; {
<span class="boring">    write!(File::create(&quot;content.txt&quot;)?, &quot;My hovercraft is full of eels!&quot;)?;
</span><span class="boring">
</span>    let file = File::open(&quot;content.txt&quot;)?;
    let map = unsafe { Mmap::map(&amp;file)? };

    let random_indexes = [0, 1, 2, 19, 22, 10, 11, 29];
    assert_eq!(&amp;map[3..13], b&quot;hovercraft&quot;);
    let random_bytes: Vec&lt;u8&gt; = random_indexes.iter()
        .map(|&amp;idx| map[idx])
        .collect();
    assert_eq!(&amp;random_bytes[..], b&quot;My loaf!&quot;);
    Ok(())
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#目录遍历-2" id="目录遍历-2">目录遍历</a></h1>
<!--
> [file/dir.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/file/dir.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#过去-24-小时内修改过的文件名" id="过去-24-小时内修改过的文件名">过去 24 小时内修改过的文件名</a></h2>
<!--
> [file/dir/modified.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/file/dir/modified.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a> <a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></p>
<p>通过调用 <a href="https://doc.rust-lang.org/std/env/fn.current_dir.html"><code>env::current_dir</code></a> 获取当前工作目录，然后通过 <a href="https://doc.rust-lang.org/std/fs/fn.read_dir.html"><code>fs::read_dir</code></a> 读取目录中的每个条目，通过 <a href="https://doc.rust-lang.org/std/fs/struct.DirEntry.html#method.path"><code>DirEntry::path</code></a> 提取条目路径，以及通过通过 <a href="https://doc.rust-lang.org/std/fs/struct.Metadata.html"><code>fs::Metadata</code></a> 获取条目元数据。<a href="https://doc.rust-lang.org/std/fs/struct.Metadata.html#method.modified"><code>Metadata::modified</code></a> 返回条目自上次更改以来的运行时间 <a href="https://doc.rust-lang.org/std/time/struct.SystemTime.html#method.elapsed"><code>SystemTime::elapsed</code></a>。<a href="https://doc.rust-lang.org/std/time/struct.Duration.html#method.as_secs"><code>Duration::as_secs</code></a> 将时间转换为秒，并与 24 小时（24 * 60 * 60 秒）进行比较。<a href="https://doc.rust-lang.org/std/fs/struct.Metadata.html#method.is_file"><code>Metadata::is_file</code></a> 用于筛选出目录。</p>
<pre><pre class="playground"><code class="language-rust edition2018"><span class="boring">use error_chain::error_chain;
</span><span class="boring">
</span>use std::{env, fs};

<span class="boring">error_chain! {
</span><span class="boring">    foreign_links {
</span><span class="boring">        Io(std::io::Error);
</span><span class="boring">        SystemTimeError(std::time::SystemTimeError);
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span>fn main() -&gt; Result&lt;()&gt; {
    let current_dir = env::current_dir()?;
    println!(
        &quot;Entries modified in the last 24 hours in {:?}:&quot;,
        current_dir
    );

    for entry in fs::read_dir(current_dir)? {
        let entry = entry?;
        let path = entry.path();

        let metadata = fs::metadata(&amp;path)?;
        let last_modified = metadata.modified()?.elapsed()?.as_secs();

        if last_modified &lt; 24 * 3600 &amp;&amp; metadata.is_file() {
            println!(
                &quot;Last modified: {:?} seconds, is read only: {:?}, size: {:?} bytes, filename: {:?}&quot;,
                last_modified,
                metadata.permissions().readonly(),
                metadata.len(),
                path.file_name().ok_or(&quot;No filename&quot;)?
            );
        }
    }

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#查找给定路径的循环" id="查找给定路径的循环">查找给定路径的循环</a></h2>
<!--
> [file/dir/loops.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/file/dir/loops.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/same-file/"><img src="https://badge-cache.kominick.com/crates/v/same_file.svg?label=same_file" alt="same_file-badge" /></a> <a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></p>
<p>使用 <a href="https://docs.rs/same-file/*/same_file/fn.is_same_file.html"><code>same_file::is_same_file</code></a> 检测给定路径的循环。例如，可以通过软连接（符号链接）在 Unix 系统上创建循环：</p>
<pre><code class="language-bash">mkdir -p /tmp/foo/bar/baz
ln -s /tmp/foo/  /tmp/foo/bar/baz/qux
</code></pre>
<p>下面的实例将断言存在一个循环。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use std::io;
use std::path::{Path, PathBuf};
use same_file::is_same_file;

fn contains_loop&lt;P: AsRef&lt;Path&gt;&gt;(path: P) -&gt; io::Result&lt;Option&lt;(PathBuf, PathBuf)&gt;&gt; {
    let path = path.as_ref();
    let mut path_buf = path.to_path_buf();
    while path_buf.pop() {
        if is_same_file(&amp;path_buf, path)? {
            return Ok(Some((path_buf, path.to_path_buf())));
        } else if let Some(looped_paths) = contains_loop(&amp;path_buf)? {
            return Ok(Some(looped_paths));
        }
    }
    return Ok(None);
}

fn main() {
    assert_eq!(
        contains_loop(&quot;/tmp/foo/bar/baz/qux/bar/baz&quot;).unwrap(),
        Some((
            PathBuf::from(&quot;/tmp/foo&quot;),
            PathBuf::from(&quot;/tmp/foo/bar/baz/qux&quot;)
        ))
    );
}
</code></pre></pre>
<h2><a class="header" href="#递归查找重名文件" id="递归查找重名文件">递归查找重名文件</a></h2>
<!--
> [file/dir/duplicate-name.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/file/dir/duplicate-name.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/walkdir/"><img src="https://badge-cache.kominick.com/crates/v/walkdir.svg?label=walkdir" alt="walkdir-badge" /></a> <a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></p>
<p>在当前目录中递归查找重复的文件名，只打印一次。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use std::collections::HashMap;
use walkdir::WalkDir;

fn main() {
    let mut filenames = HashMap::new();

    for entry in WalkDir::new(&quot;.&quot;)
            .into_iter()
            .filter_map(Result::ok)
            .filter(|e| !e.file_type().is_dir()) {
        let f_name = String::from(entry.file_name().to_string_lossy());
        let counter = filenames.entry(f_name.clone()).or_insert(0);
        *counter += 1;

        if *counter == 2 {
            println!(&quot;{}&quot;, f_name);
        }
    }
}
</code></pre></pre>
<h2><a class="header" href="#使用给定断言递归查找所有文件" id="使用给定断言递归查找所有文件">使用给定断言递归查找所有文件</a></h2>
<!--
> [file/dir/find-file.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/file/dir/find-file.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/walkdir/"><img src="https://badge-cache.kominick.com/crates/v/walkdir.svg?label=walkdir" alt="walkdir-badge" /></a> <a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></p>
<p>在当前目录中查找最近一天内修改的 JSON 文件。使用 <a href="https://docs.rs/walkdir/*/walkdir/struct.WalkDir.html#method.follow_links"><code>follow_links</code></a> 确保软链接（符号链接）像普通目录和文件一样被按照当前查找规则执行。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run"><span class="boring">use error_chain::error_chain;
</span>
use walkdir::WalkDir;
<span class="boring">
</span><span class="boring">error_chain! {
</span><span class="boring">    foreign_links {
</span><span class="boring">        WalkDir(walkdir::Error);
</span><span class="boring">        Io(std::io::Error);
</span><span class="boring">        SystemTime(std::time::SystemTimeError);
</span><span class="boring">    }
</span><span class="boring">}
</span>
fn main() -&gt; Result&lt;()&gt; {
    for entry in WalkDir::new(&quot;.&quot;)
            .follow_links(true)
            .into_iter()
            .filter_map(|e| e.ok()) {
        let f_name = entry.file_name().to_string_lossy();
        let sec = entry.metadata()?.modified()?;

        if f_name.ends_with(&quot;.json&quot;) &amp;&amp; sec.elapsed()?.as_secs() &lt; 86400 {
            println!(&quot;{}&quot;, f_name);
        }
    }

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#跳过隐藏文件遍历目录" id="跳过隐藏文件遍历目录">跳过隐藏文件遍历目录</a></h2>
<!--
> [file/dir/skip-dot.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/file/dir/skip-dot.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/walkdir/"><img src="https://badge-cache.kominick.com/crates/v/walkdir.svg?label=walkdir" alt="walkdir-badge" /></a> <a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></p>
<p>递归下行到子目录的过程中，使用 <a href="https://docs.rs/walkdir/*/walkdir/struct.IntoIter.html#method.filter_entry"><code>filter_entry</code></a> 对目录中的条目传递 <code>is_not_hidden</code> 断言，从而跳过隐藏的文件和目录。<a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.filter"><code>Iterator::filter</code></a> 可应用到要检索的任何目录 <a href="https://docs.rs/walkdir/*/walkdir/struct.DirEntry.html"><code>WalkDir::DirEntry</code></a>，即使父目录是隐藏目录。</p>
<p>根目录 <code>&quot;.&quot;</code> 的检索结果，通过在断言 <code>is_not_hidden</code> 中使用 <a href="https://docs.rs/walkdir/*/walkdir/struct.DirEntry.html#method.depth"><code>WalkDir::depth</code></a> 参数生成。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use walkdir::{DirEntry, WalkDir};

fn is_not_hidden(entry: &amp;DirEntry) -&gt; bool {
    entry
         .file_name()
         .to_str()
         .map(|s| entry.depth() == 0 || !s.starts_with(&quot;.&quot;))
         .unwrap_or(false)
}

fn main() {
    WalkDir::new(&quot;.&quot;)
        .into_iter()
        .filter_entry(|e| is_not_hidden(e))
        .filter_map(|v| v.ok())
        .for_each(|x| println!(&quot;{}&quot;, x.path().display()));
}
</code></pre></pre>
<h2><a class="header" href="#在给定深度的目录递归计算文件大小" id="在给定深度的目录递归计算文件大小">在给定深度的目录，递归计算文件大小</a></h2>
<!--
> [file/dir/sizes.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/file/dir/sizes.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/walkdir/"><img src="https://badge-cache.kominick.com/crates/v/walkdir.svg?label=walkdir" alt="walkdir-badge" /></a> <a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></p>
<p>通过 <a href="https://docs.rs/walkdir/*/walkdir/struct.WalkDir.html#method.min_depth"><code>WalkDir::min_depth</code></a> 和 <a href="https://docs.rs/walkdir/*/walkdir/struct.WalkDir.html#method.max_depth"><code>WalkDir::max_depth</code></a> 方法，可以灵活设置目录的递归深度。下面的实例计算了 3 层子文件夹深度的所有文件的大小总和，计算中忽略根文件夹中的文件。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use walkdir::WalkDir;

fn main() {
    let total_size = WalkDir::new(&quot;.&quot;)
        .min_depth(1)
        .max_depth(3)
        .into_iter()
        .filter_map(|entry| entry.ok())
        .filter_map(|entry| entry.metadata().ok())
        .filter(|metadata| metadata.is_file())
        .fold(0, |acc, m| acc + m.len());

    println!(&quot;Total size: {} bytes.&quot;, total_size);
}
</code></pre></pre>
<h2><a class="header" href="#递归查找所有-png-文件" id="递归查找所有-png-文件">递归查找所有 png 文件</a></h2>
<!--
> [file/dir/png.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/file/dir/png.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/glob/"><img src="https://badge-cache.kominick.com/crates/v/glob.svg?label=glob" alt="glob-badge" /></a> <a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></p>
<p>递归地查找当前目录中的所有 PNG 文件。在本实例中，<code>**</code> 模式用于匹配当前目录及其所有子目录。</p>
<p>在路径任意部分使用 <code>**</code> 模式，例如，<code>/media/**/*.png</code> 匹配 <code>media</code> 及其子目录中的所有 PNG 文件。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run"><span class="boring">use error_chain::error_chain;
</span>
use glob::glob;
<span class="boring">
</span><span class="boring">error_chain! {
</span><span class="boring">    foreign_links {
</span><span class="boring">        Glob(glob::GlobError);
</span><span class="boring">        Pattern(glob::PatternError);
</span><span class="boring">    }
</span><span class="boring">}
</span>
fn main() -&gt; Result&lt;()&gt; {
    for entry in glob(&quot;**/*.png&quot;)? {
        println!(&quot;{}&quot;, entry?.display());
    }

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#忽略文件名大小写使用给定模式查找所有文件" id="忽略文件名大小写使用给定模式查找所有文件">忽略文件名大小写，使用给定模式查找所有文件</a></h2>
<!--
> [file/dir/ignore-case.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/file/dir/ignore-case.md)
> <br />
> commit 203b1085212a7b857d9a29bdc6a763515e77e0f9 - 2020.06.08
-->
<p><a href="https://docs.rs/glob/"><img src="https://badge-cache.kominick.com/crates/v/glob.svg?label=glob" alt="glob-badge" /></a> <a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></p>
<p>在 <code>/media/</code> 目录中查找与正则表达模式 <code>img_[0-9]*.png</code> 匹配的所有图像文件。</p>
<p>一个自定义 <a href="https://docs.rs/glob/*/glob/struct.MatchOptions.html"><code>MatchOptions</code></a> 结构体被传递给 <a href="https://docs.rs/glob/*/glob/fn.glob_with.html"><code>glob_with</code></a> 函数，使全局命令模式下不区分大小写，同时保持其他选项的默认值 <a href="https://doc.rust-lang.org/std/default/trait.Default.html"><code>Default</code></a>。</p>
<blockquote>
<p>译者注：<code>glob</code> 是 <code>glob command</code> 的简写。在 shell 里面，用 <code>*</code> 等匹配模式来匹配文件，如：ls src/*.rs。</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use error_chain::error_chain;
use glob::{glob_with, MatchOptions};

error_chain! {
    foreign_links {
        Glob(glob::GlobError);
        Pattern(glob::PatternError);
    }
}

fn main() -&gt; Result&lt;()&gt; {
    let options = MatchOptions {
        case_sensitive: false,
        ..Default::default()
    };

    for entry in glob_with(&quot;/media/img_[0-9]*.png&quot;, options)? {
        println!(&quot;{}&quot;, entry?.display());
    }

    Ok(())
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#硬件支持-1" id="硬件支持-1">硬件支持</a></h1>
<!--
> [hardware.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/hardware.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#处理器-1" id="处理器-1">处理器</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="hardware/processor.html#%E6%A3%80%E6%9F%A5%E9%80%BB%E8%BE%91-cpu-%E5%86%85%E6%A0%B8%E7%9A%84%E6%95%B0%E9%87%8F">检查逻辑 cpu 内核的数量</a></td><td><a href="https://docs.rs/num_cpus/"><img src="https://badge-cache.kominick.com/crates/v/num_cpus.svg?label=num_cpus" alt="num_cpus-badge" /></a></td><td><a href="https://crates.io/categories/hardware-support"><img src="https://badge-cache.kominick.com/badge/hardware_support--x.svg?style=social" alt="cat-hardware-support-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#处理器-2" id="处理器-2">处理器</a></h1>
<!--
> [hardware/processor.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/hardware/processor.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#检查逻辑-cpu-内核的数量" id="检查逻辑-cpu-内核的数量">检查逻辑 cpu 内核的数量</a></h2>
<!--
> [hardware/processor/cpu-count.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/hardware/processor/cpu-count.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/num_cpus/"><img src="https://badge-cache.kominick.com/crates/v/num_cpus.svg?label=num_cpus" alt="num_cpus-badge" /></a> <a href="https://crates.io/categories/hardware-support"><img src="https://badge-cache.kominick.com/badge/hardware_support--x.svg?style=social" alt="cat-hardware-support-badge" /></a></p>
<p>使用 [<code>num_cpus::get</code>] 显示当前机器中的逻辑 CPU 内核的数量。</p>
<pre><pre class="playground"><code class="language-rust edition2018">fn main() {
    println!(&quot;Number of logical cores is {}&quot;, num_cpus::get());
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#内存管理-1" id="内存管理-1">内存管理</a></h1>
<!--
> [mem.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/mem.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#常量-1" id="常量-1">常量</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="mem/global_static.html#%E5%A3%B0%E6%98%8E%E5%BB%B6%E8%BF%9F%E8%AE%A1%E7%AE%97%E5%B8%B8%E9%87%8F">声明延迟计算常量</a></td><td><a href="https://docs.rs/lazy_static/"><img src="https://badge-cache.kominick.com/crates/v/lazy_static.svg?label=lazy_static" alt="lazy_static-badge" /></a></td><td><a href="https://crates.io/categories/caching"><img src="https://badge-cache.kominick.com/badge/caching--x.svg?style=social" alt="cat-caching-badge" /></a> <a href="https://crates.io/categories/rust-patterns"><img src="https://badge-cache.kominick.com/badge/rust_patterns--x.svg?style=social" alt="cat-rust-patterns-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#常量-2" id="常量-2">常量</a></h1>
<!--
> [mem/global_static.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/mem/global_static.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#声明延迟计算常量" id="声明延迟计算常量">声明延迟计算常量</a></h2>
<!--
> [mem/global_static/lazy-constant.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/mem/global_static/lazy-constant.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/lazy_static/"><img src="https://badge-cache.kominick.com/crates/v/lazy_static.svg?label=lazy_static" alt="lazy_static-badge" /></a> <a href="https://crates.io/categories/caching"><img src="https://badge-cache.kominick.com/badge/caching--x.svg?style=social" alt="cat-caching-badge" /></a> <a href="https://crates.io/categories/rust-patterns"><img src="https://badge-cache.kominick.com/badge/rust_patterns--x.svg?style=social" alt="cat-rust-patterns-badge" /></a></p>
<p>声明延迟计算的常量 <a href="https://doc.rust-lang.org/std/collections/struct.HashMap.html"><code>HashMap</code></a>。<a href="https://doc.rust-lang.org/std/collections/struct.HashMap.html"><code>HashMap</code></a> 将被计算一次，随后存储在全局静态（全局堆栈）引用。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use lazy_static::lazy_static;
use std::collections::HashMap;

lazy_static! {
    static ref PRIVILEGES: HashMap&lt;&amp;'static str, Vec&lt;&amp;'static str&gt;&gt; = {
        let mut map = HashMap::new();
        map.insert(&quot;James&quot;, vec![&quot;user&quot;, &quot;admin&quot;]);
        map.insert(&quot;Jim&quot;, vec![&quot;user&quot;]);
        map
    };
}

fn show_access(name: &amp;str) {
    let access = PRIVILEGES.get(name);
    println!(&quot;{}: {:?}&quot;, name, access);
}

fn main() {
    let access = PRIVILEGES.get(&quot;James&quot;);
    println!(&quot;James: {:?}&quot;, access);

    show_access(&quot;Jim&quot;);
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#网络-1" id="网络-1">网络</a></h1>
<!--
> [net.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/net.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#服务器-1" id="服务器-1">服务器</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="net/server.html#%E7%9B%91%E5%90%AC%E6%9C%AA%E4%BD%BF%E7%94%A8%E7%9A%84-tcpip-%E7%AB%AF%E5%8F%A3">监听未使用的 TCP/IP 端口</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#服务器-2" id="服务器-2">服务器</a></h1>
<!--
> [net/server.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/net/server.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#监听未使用的-tcpip-端口" id="监听未使用的-tcpip-端口">监听未使用的 TCP/IP 端口</a></h2>
<!--
> [net/server/listen-unused.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/net/server/listen-unused.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></p>
<p>在本实例中，程序将监听显示在控制台上的端口，直到一个请求被发出。当将端口设置为 0 时，<code>SocketAddrV4</code> 会分配一个随机端口。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use std::net::{SocketAddrV4, Ipv4Addr, TcpListener};
use std::io::{Read, Error};

fn main() -&gt; Result&lt;(), Error&gt; {
    let loopback = Ipv4Addr::new(127, 0, 0, 1);
    let socket = SocketAddrV4::new(loopback, 0);
    let listener = TcpListener::bind(socket)?;
    let port = listener.local_addr()?;
    println!(&quot;Listening on {}, access this port to end the program&quot;, port);
    let (mut tcp_stream, addr) = listener.accept()?; // 阻塞，直到被请求
    println!(&quot;Connection received! {:?} is sending data.&quot;, addr);
    let mut input = String::new();
    let _ = tcp_stream.read_to_string(&amp;mut input)?;
    println!(&quot;{:?} says {}&quot;, addr, input);
    Ok(())
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#操作系统-1" id="操作系统-1">操作系统</a></h1>
<!--
> [os.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/os.md)
> <br />
> commit bba147f18531934c904b1c5afaed3e6550b1c1c0 - 2020.06.14
-->
<h2><a class="header" href="#外部命令-1" id="外部命令-1">外部命令</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="os/external.html#%E8%BF%90%E8%A1%8C%E5%A4%96%E9%83%A8%E5%91%BD%E4%BB%A4%E5%B9%B6%E5%A4%84%E7%90%86-stdout">运行外部命令并处理 stdout</a></td><td><a href="https://docs.rs/regex/"><img src="https://badge-cache.kominick.com/crates/v/regex.svg?label=regex" alt="regex-badge" /></a></td><td><a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a> <a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></td></tr>
<tr><td><a href="os/external.html#%E8%BF%90%E8%A1%8C%E4%BC%A0%E9%80%92-stdin-%E7%9A%84%E5%A4%96%E9%83%A8%E5%91%BD%E4%BB%A4%E5%B9%B6%E6%A3%80%E6%9F%A5%E9%94%99%E8%AF%AF%E4%BB%A3%E7%A0%81">运行传递 stdin 的外部命令，并检查错误代码</a></td><td><a href="https://docs.rs/regex/"><img src="https://badge-cache.kominick.com/crates/v/regex.svg?label=regex" alt="regex-badge" /></a></td><td><a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a> <a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></td></tr>
<tr><td><a href="os/external.html#%E8%BF%90%E8%A1%8C%E7%AE%A1%E9%81%93%E4%BC%A0%E8%BE%93%E7%9A%84%E5%A4%96%E9%83%A8%E5%91%BD%E4%BB%A4">运行管道传输的外部命令</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a></td></tr>
<tr><td><a href="os/external.html#%E5%B0%86%E5%AD%90%E8%BF%9B%E7%A8%8B%E7%9A%84-stdout-%E5%92%8C-stderr-%E9%87%8D%E5%AE%9A%E5%90%91%E5%88%B0%E5%90%8C%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6">将子进程的 stdout 和 stderr 重定向到同一个文件</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a></td></tr>
<tr><td><a href="os/external.html#%E6%8C%81%E7%BB%AD%E5%A4%84%E7%90%86%E5%AD%90%E8%BF%9B%E7%A8%8B%E7%9A%84%E8%BE%93%E5%87%BA">持续处理子进程的输出</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a><a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></td></tr>
<tr><td><a href="os/external.html#%E8%AF%BB%E5%8F%96%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F">读取环境变量</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#外部命令-2" id="外部命令-2">外部命令</a></h1>
<!--
> [os/external.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/os/external.md)
> <br />
> commit bba147f18531934c904b1c5afaed3e6550b1c1c0 - 2020.06.14
-->
<h2><a class="header" href="#运行外部命令并处理-stdout" id="运行外部命令并处理-stdout">运行外部命令并处理 stdout</a></h2>
<!--
> [os/external/process-output.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/os/external/process-output.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/regex/"><img src="https://badge-cache.kominick.com/crates/v/regex.svg?label=regex" alt="regex-badge" /></a> <a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a> <a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></p>
<p>将 <code>git log --oneline</code> 作为外部命令 <a href="https://doc.rust-lang.org/std/process/struct.Command.html"><code>Command</code></a> 运行，并使用 <a href="https://docs.rs/regex/*/regex/struct.Regex.html"><code>Regex</code></a> 检查其 <a href="https://doc.rust-lang.org/std/process/struct.Output.html"><code>Output</code></a>，以获取最后 5 次提交的哈希值和消息。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run"><span class="boring">use error_chain::error_chain;
</span>
use std::process::Command;
use regex::Regex;
<span class="boring">
</span><span class="boring">error_chain!{
</span><span class="boring">    foreign_links {
</span><span class="boring">        Io(std::io::Error);
</span><span class="boring">        Regex(regex::Error);
</span><span class="boring">        Utf8(std::string::FromUtf8Error);
</span><span class="boring">    }
</span><span class="boring">}
</span>
#[derive(PartialEq, Default, Clone, Debug)]
struct Commit {
    hash: String,
    message: String,
}

fn main() -&gt; Result&lt;()&gt; {
    let output = Command::new(&quot;git&quot;).arg(&quot;log&quot;).arg(&quot;--oneline&quot;).output()?;

    if !output.status.success() {
        error_chain::bail!(&quot;Command executed with failing error code&quot;);
    }

    let pattern = Regex::new(r&quot;(?x)
                               ([0-9a-fA-F]+) # 提交的哈希值
                               (.*)           # 提交信息&quot;)?;

    String::from_utf8(output.stdout)?
        .lines()
        .filter_map(|line| pattern.captures(line))
        .map(|cap| {
                 Commit {
                     hash: cap[1].to_string(),
                     message: cap[2].trim().to_string(),
                 }
             })
        .take(5)
        .for_each(|x| println!(&quot;{:?}&quot;, x));

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#运行传递-stdin-的外部命令并检查错误代码" id="运行传递-stdin-的外部命令并检查错误代码">运行传递 stdin 的外部命令，并检查错误代码</a></h2>
<!--
> [os/external/send-input.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/os/external/send-input.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a> <a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a></p>
<p>使用外部命令 <a href="https://doc.rust-lang.org/std/process/struct.Command.html"><code>Command</code></a> 打开 <code>python</code> 解释器，并传递一条 python 语句供其执行，然后解析语句的输出结构体 <a href="https://doc.rust-lang.org/std/process/struct.Output.html"><code>Output</code></a>。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run"><span class="boring">use error_chain::error_chain;
</span><span class="boring">
</span>use std::collections::HashSet;
use std::io::Write;
use std::process::{Command, Stdio};
<span class="boring">
</span><span class="boring">error_chain!{
</span><span class="boring">    errors { CmdError }
</span><span class="boring">    foreign_links {
</span><span class="boring">        Io(std::io::Error);
</span><span class="boring">        Utf8(std::string::FromUtf8Error);
</span><span class="boring">    }
</span><span class="boring">}
</span>
fn main() -&gt; Result&lt;()&gt; {
    let mut child = Command::new(&quot;python&quot;).stdin(Stdio::piped())
        .stderr(Stdio::piped())
        .stdout(Stdio::piped())
        .spawn()?;

    child.stdin
        .as_mut()
        .ok_or(&quot;Child process stdin has not been captured!&quot;)?
        .write_all(b&quot;import this; copyright(); credits(); exit()&quot;)?;

    let output = child.wait_with_output()?;

    if output.status.success() {
        let raw_output = String::from_utf8(output.stdout)?;
        let words = raw_output.split_whitespace()
            .map(|s| s.to_lowercase())
            .collect::&lt;HashSet&lt;_&gt;&gt;();
        println!(&quot;Found {} unique words:&quot;, words.len());
        println!(&quot;{:#?}&quot;, words);
        Ok(())
    } else {
        let err = String::from_utf8(output.stderr)?;
        error_chain::bail!(&quot;External command failed:\n {}&quot;, err)
    }
}
</code></pre></pre>
<h2><a class="header" href="#运行管道传输的外部命令" id="运行管道传输的外部命令">运行管道传输的外部命令</a></h2>
<!--
> [os/external/piped.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/os/external/piped.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a> <a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a></p>
<p>显示当前工作目录中前 10 大的文件和子目录，它等同于运行： <code>du -ah . | sort -hr | head -n 10</code>。</p>
<p>每个命令 <a href="https://doc.rust-lang.org/std/process/struct.Command.html"><code>Command</code></a> 代表一个进程，子进程的输出是通过父进程和子进程之间的管道 <a href="https://doc.rust-lang.org/std/process/struct.Stdio.html"><code>Stdio::piped</code></a> 捕获的。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run"><span class="boring">use error_chain::error_chain;
</span><span class="boring">
</span>use std::process::{Command, Stdio};
<span class="boring">
</span><span class="boring">error_chain! {
</span><span class="boring">    foreign_links {
</span><span class="boring">        Io(std::io::Error);
</span><span class="boring">        Utf8(std::string::FromUtf8Error);
</span><span class="boring">    }
</span><span class="boring">}
</span>
fn main() -&gt; Result&lt;()&gt; {
    let directory = std::env::current_dir()?;
    let mut du_output_child = Command::new(&quot;du&quot;)
        .arg(&quot;-ah&quot;)
        .arg(&amp;directory)
        .stdout(Stdio::piped())
        .spawn()?;

    if let Some(du_output) = du_output_child.stdout.take() {
        let mut sort_output_child = Command::new(&quot;sort&quot;)
            .arg(&quot;-hr&quot;)
            .stdin(du_output)
            .stdout(Stdio::piped())
            .spawn()?;

        du_output_child.wait()?;

        if let Some(sort_output) = sort_output_child.stdout.take() {
            let head_output_child = Command::new(&quot;head&quot;)
                .args(&amp;[&quot;-n&quot;, &quot;10&quot;])
                .stdin(sort_output)
                .stdout(Stdio::piped())
                .spawn()?;

            let head_stdout = head_output_child.wait_with_output()?;

            sort_output_child.wait()?;

            println!(
                &quot;Top 10 biggest files and directories in '{}':\n{}&quot;,
                directory.display(),
                String::from_utf8(head_stdout.stdout).unwrap()
            );
        }
    }

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#将子进程的-stdout-和-stderr-重定向到同一个文件" id="将子进程的-stdout-和-stderr-重定向到同一个文件">将子进程的 stdout 和 stderr 重定向到同一个文件</a></h2>
<!--
> [os/external/error-file.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/os/external/error-file.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a> <a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a></p>
<p>生成子进程并将 <code>stdout</code> 和 <code>stderr</code> 重定向到同一个文件。它遵循与<a href="os/external.html#%E8%BF%90%E8%A1%8C%E7%AE%A1%E9%81%93%E4%BC%A0%E8%BE%93%E7%9A%84%E5%A4%96%E9%83%A8%E5%91%BD%E4%BB%A4">运行管道传输的外部命令</a>相同的思想，但是 <a href="https://doc.rust-lang.org/std/process/struct.Stdio.html"><code>process::Stdio</code></a> 会将输出写入指定的文件。对 <code>stdout</code> 和 <code>stderr</code> 而言，<a href="https://doc.rust-lang.org/std/fs/struct.File.html#method.try_clone"><code>File::try_clone</code></a> 引用相同的文件句柄。它将确保两个句柄使用相同的光标位置进行写入。</p>
<p>下面的实例等同于运行 Unix shell 命令 <code>ls . oops &gt;out.txt 2&gt;&amp;1</code>。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use std::fs::File;
use std::io::Error;
use std::process::{Command, Stdio};

fn main() -&gt; Result&lt;(), Error&gt; {
    let outputs = File::create(&quot;out.txt&quot;)?;
    let errors = outputs.try_clone()?;

    Command::new(&quot;ls&quot;)
        .args(&amp;[&quot;.&quot;, &quot;oops&quot;])
        .stdout(Stdio::from(outputs))
        .stderr(Stdio::from(errors))
        .spawn()?
        .wait_with_output()?;

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#持续处理子进程的输出" id="持续处理子进程的输出">持续处理子进程的输出</a></h2>
<!--
> [os/external/continuous.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/os/external/continuous.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a> <a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a></p>
<p>在<a href="os/external.html#%E8%BF%90%E8%A1%8C%E5%A4%96%E9%83%A8%E5%91%BD%E4%BB%A4%E5%B9%B6%E5%A4%84%E7%90%86-stdout">运行外部命令并处理-stdout</a> 实例中，直到外部命令 <a href="https://doc.rust-lang.org/std/process/struct.Command.html"><code>Command</code></a> 完成，stdout 的处理才开始。下面的实例调用 <a href="https://doc.rust-lang.org/std/process/struct.Stdio.html"><code>Stdio::piped</code></a> 创建管道，并在 <a href="https://doc.rust-lang.org/std/io/struct.BufReader.html"><code>BufReader</code></a> 被更新后立即读取 <code>stdout</code>，持续不断地处理。</p>
<p>下面的实例等同于 Unix shell 命令 <code>journalctl | grep usb</code>。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use std::process::{Command, Stdio};
use std::io::{BufRead, BufReader, Error, ErrorKind};

fn main() -&gt; Result&lt;(), Error&gt; {
    let stdout = Command::new(&quot;journalctl&quot;)
        .stdout(Stdio::piped())
        .spawn()?
        .stdout
        .ok_or_else(|| Error::new(ErrorKind::Other,&quot;Could not capture standard output.&quot;))?;

    let reader = BufReader::new(stdout);

    reader
        .lines()
        .filter_map(|line| line.ok())
        .filter(|line| line.find(&quot;usb&quot;).is_some())
        .for_each(|line| println!(&quot;{}&quot;, line));

     Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#读取环境变量" id="读取环境变量">读取环境变量</a></h2>
<!--
> [os/external/read-env-variable.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/os/external/read-env-variable.md)
> <br />
> commit bba147f18531934c904b1c5afaed3e6550b1c1c0 - 2020.06.14
-->
<p><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a> <a href="https://crates.io/categories/os"><img src="https://badge-cache.kominick.com/badge/OS--x.svg?style=social" alt="cat-os-badge" /></a></p>
<p>通过 <a href="https://doc.rust-lang.org/std/env/fn.var.html">std::env::var</a> 读取环境变量。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use std::env;
use std::fs;
use std::io::Error;

fn main() -&gt; Result&lt;(), Error&gt; {
    // 从环境变量 `CONFIG` 读取配置路径 `config_path`。
    // 如果 `CONFIG` 未设置，采用默认配置路径。
    let config_path = env::var(&quot;CONFIG&quot;)
        .unwrap_or(&quot;/etc/myapp/config&quot;.to_string());

    let config: String = fs::read_to_string(config_path)?;
    println!(&quot;Config: {}&quot;, config);

    Ok(())
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#科学计算-1" id="科学计算-1">科学计算</a></h1>
<!--
> [science.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science.md)
> <br />
> commit 580e16feff644155826c7494cebe4d9c053d43f7 - 2018.10.09
-->
<h2><a class="header" href="#数学-1" id="数学-1">数学</a></h2>
<!--
> [science/mathematics.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science/mathematics.md)
> <br />
> commit 714e9f4fcd2fc7649abd87eef00b13b3b571c655 2020.12.31
-->
<h2><a class="header" href="#线性代数-1" id="线性代数-1">线性代数</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="/science/mathematics/linear_algebra.html#vector-%E8%8C%83%E6%95%B0">Vector 范数</a></td><td><a href="https://docs.rs/ndarray"><img src="https://badge-cache.kominick.com/crate/ndarray.svg?label=ndarray" alt="ndarray-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="/science/mathematics/linear_algebra.html#vector-%E6%AF%94%E8%BE%83">Vector 比较</a></td><td><a href="https://docs.rs/ndarray"><img src="https://badge-cache.kominick.com/crate/ndarray.svg?label=ndarray" alt="ndarray-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="/science/mathematics/linear_algebra.html#%E7%9F%A9%E9%98%B5%E7%9B%B8%E5%8A%A0">矩阵相加</a></td><td><a href="https://docs.rs/ndarray"><img src="https://badge-cache.kominick.com/crate/ndarray.svg?label=ndarray" alt="ndarray-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="/science/mathematics/linear_algebra.html#%E7%9F%A9%E9%98%B5%E7%9B%B8%E4%B9%98">矩阵相乘</a></td><td><a href="https://docs.rs/ndarray"><img src="https://badge-cache.kominick.com/crate/ndarray.svg?label=ndarray" alt="ndarray-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="/science/mathematics/linear_algebra.html#%E6%A0%87%E9%87%8Fvector%E7%9F%A9%E9%98%B5%E7%9B%B8%E4%B9%98">标量、vector、矩阵相乘</a></td><td><a href="https://docs.rs/ndarray"><img src="https://badge-cache.kominick.com/crate/ndarray.svg?label=ndarray" alt="ndarray-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="/science/mathematics/linear_algebra.html#%E7%9F%A9%E9%98%B5%E6%B1%82%E9%80%86">矩阵求逆</a></td><td><a href="https://docs.rs/nalgebra"><img src="https://badge-cache.kominick.com/crate/nalgebra.svg?label=nalgebra" alt="nalgebra-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="/science/mathematics/linear_algebra.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A9%E9%98%B5">（反）序列化矩阵</a></td><td><a href="https://docs.rs/ndarray"><img src="https://badge-cache.kominick.com/crate/ndarray.svg?label=ndarray" alt="ndarray-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#三角学-1" id="三角学-1">三角学</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="/science/mathematics/trigonometry.html#%E8%AE%A1%E7%AE%97%E4%B8%89%E8%A7%92%E5%BD%A2%E7%9A%84%E8%BE%B9%E9%95%BF">计算三角形的边长</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="/science/mathematics/trigonometry.html#%E9%AA%8C%E8%AF%81%E6%AD%A3%E5%88%87tan%E7%AD%89%E4%BA%8E%E6%AD%A3%E5%BC%A6sin%E9%99%A4%E4%BB%A5%E4%BD%99%E5%BC%A6cos">验证正切（tan）等于正弦（sin）除以余弦（cos）</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="/science/mathematics/trigonometry.html#%E5%9C%B0%E7%90%83%E4%B8%8A%E4%B8%A4%E7%82%B9%E4%B9%8B%E9%97%B4%E7%9A%84%E8%B7%9D%E7%A6%BB">地球上两点之间的距离</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#复数-1" id="复数-1">复数</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="/science/mathematics/complex_numbers.html#%E5%88%9B%E5%BB%BA%E5%A4%8D%E6%95%B0">创建复数</a></td><td><a href="https://docs.rs/num/"><img src="https://badge-cache.kominick.com/crates/v/num.svg?label=num" alt="num-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="/science/mathematics/complex_numbers.html#%E5%A4%8D%E6%95%B0%E7%9B%B8%E5%8A%A0">复数相加</a></td><td><a href="https://docs.rs/num/"><img src="https://badge-cache.kominick.com/crates/v/num.svg?label=num" alt="num-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="/science/mathematics/complex_numbers.html#%E5%A4%8D%E6%95%B0%E7%9A%84%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0">复数的数学函数</a></td><td><a href="https://docs.rs/num/"><img src="https://badge-cache.kominick.com/crates/v/num.svg?label=num" alt="num-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#统计学-1" id="统计学-1">统计学</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="/science/mathematics/statistics.html#%E9%9B%86%E4%B8%AD%E8%B6%8B%E5%8A%BF%E5%BA%A6%E9%87%8F">集中趋势度量</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="/science/mathematics/statistics.html#%E8%AE%A1%E7%AE%97%E6%A0%87%E5%87%86%E5%81%8F%E5%B7%AE">计算标准偏差</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#其它数学计算-1" id="其它数学计算-1">其它数学计算</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="/science/mathematics/miscellaneous.html#%E5%A4%A7%E6%95%B0">大数</a></td><td><a href="https://docs.rs/num/"><img src="https://badge-cache.kominick.com/crates/v/num.svg?label=num" alt="num-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h2><a class="header" href="#数学-2" id="数学-2">数学</a></h2>
<!--
> [science/mathematics.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science/mathematics.md)
> <br />
> commit 714e9f4fcd2fc7649abd87eef00b13b3b571c655 2020.12.31
-->
<h2><a class="header" href="#线性代数-2" id="线性代数-2">线性代数</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="science//science/mathematics/linear_algebra.html#vector-%E8%8C%83%E6%95%B0">Vector 范数</a></td><td><a href="https://docs.rs/ndarray"><img src="https://badge-cache.kominick.com/crate/ndarray.svg?label=ndarray" alt="ndarray-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="science//science/mathematics/linear_algebra.html#vector-%E6%AF%94%E8%BE%83">Vector 比较</a></td><td><a href="https://docs.rs/ndarray"><img src="https://badge-cache.kominick.com/crate/ndarray.svg?label=ndarray" alt="ndarray-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="science//science/mathematics/linear_algebra.html#%E7%9F%A9%E9%98%B5%E7%9B%B8%E5%8A%A0">矩阵相加</a></td><td><a href="https://docs.rs/ndarray"><img src="https://badge-cache.kominick.com/crate/ndarray.svg?label=ndarray" alt="ndarray-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="science//science/mathematics/linear_algebra.html#%E7%9F%A9%E9%98%B5%E7%9B%B8%E4%B9%98">矩阵相乘</a></td><td><a href="https://docs.rs/ndarray"><img src="https://badge-cache.kominick.com/crate/ndarray.svg?label=ndarray" alt="ndarray-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="science//science/mathematics/linear_algebra.html#%E6%A0%87%E9%87%8Fvector%E7%9F%A9%E9%98%B5%E7%9B%B8%E4%B9%98">标量、vector、矩阵相乘</a></td><td><a href="https://docs.rs/ndarray"><img src="https://badge-cache.kominick.com/crate/ndarray.svg?label=ndarray" alt="ndarray-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="science//science/mathematics/linear_algebra.html#%E7%9F%A9%E9%98%B5%E6%B1%82%E9%80%86">矩阵求逆</a></td><td><a href="https://docs.rs/nalgebra"><img src="https://badge-cache.kominick.com/crate/nalgebra.svg?label=nalgebra" alt="nalgebra-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="science//science/mathematics/linear_algebra.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9F%A9%E9%98%B5">（反）序列化矩阵</a></td><td><a href="https://docs.rs/ndarray"><img src="https://badge-cache.kominick.com/crate/ndarray.svg?label=ndarray" alt="ndarray-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#三角学-2" id="三角学-2">三角学</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="science//science/mathematics/trigonometry.html#%E8%AE%A1%E7%AE%97%E4%B8%89%E8%A7%92%E5%BD%A2%E7%9A%84%E8%BE%B9%E9%95%BF">计算三角形的边长</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="science//science/mathematics/trigonometry.html#%E9%AA%8C%E8%AF%81%E6%AD%A3%E5%88%87tan%E7%AD%89%E4%BA%8E%E6%AD%A3%E5%BC%A6sin%E9%99%A4%E4%BB%A5%E4%BD%99%E5%BC%A6cos">验证正切（tan）等于正弦（sin）除以余弦（cos）</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="science//science/mathematics/trigonometry.html#%E5%9C%B0%E7%90%83%E4%B8%8A%E4%B8%A4%E7%82%B9%E4%B9%8B%E9%97%B4%E7%9A%84%E8%B7%9D%E7%A6%BB">地球上两点之间的距离</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#复数-2" id="复数-2">复数</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="science//science/mathematics/complex_numbers.html#%E5%88%9B%E5%BB%BA%E5%A4%8D%E6%95%B0">创建复数</a></td><td><a href="https://docs.rs/num/"><img src="https://badge-cache.kominick.com/crates/v/num.svg?label=num" alt="num-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="science//science/mathematics/complex_numbers.html#%E5%A4%8D%E6%95%B0%E7%9B%B8%E5%8A%A0">复数相加</a></td><td><a href="https://docs.rs/num/"><img src="https://badge-cache.kominick.com/crates/v/num.svg?label=num" alt="num-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="science//science/mathematics/complex_numbers.html#%E5%A4%8D%E6%95%B0%E7%9A%84%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0">复数的数学函数</a></td><td><a href="https://docs.rs/num/"><img src="https://badge-cache.kominick.com/crates/v/num.svg?label=num" alt="num-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#统计学-2" id="统计学-2">统计学</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="science//science/mathematics/statistics.html#%E9%9B%86%E4%B8%AD%E8%B6%8B%E5%8A%BF%E5%BA%A6%E9%87%8F">集中趋势度量</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
<tr><td><a href="science//science/mathematics/statistics.html#%E8%AE%A1%E7%AE%97%E6%A0%87%E5%87%86%E5%81%8F%E5%B7%AE">计算标准偏差</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#其它数学计算-2" id="其它数学计算-2">其它数学计算</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="science//science/mathematics/miscellaneous.html#%E5%A4%A7%E6%95%B0">大数</a></td><td><a href="https://docs.rs/num/"><img src="https://badge-cache.kominick.com/crates/v/num.svg?label=num" alt="num-badge" /></a></td><td><a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#线性代数-3" id="线性代数-3">线性代数</a></h1>
<!--
> [science/mathematics/linear_algebra.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science/mathematics/linear_algebra.md)
> <br />
> commit 019c0a0d2cb2ffde562da4c466d090f5854c7995 - 2020.06.14
-->
<h2><a class="header" href="#矩阵相加" id="矩阵相加">矩阵相加</a></h2>
<!--
> [science/mathematics/linear_algebra/add-matrices.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science/mathematics/linear_algebra/add-matrices.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/crate/ndarray/*"><img src="https://badge-cache.kominick.com/crate/ndarray.svg?label=ndarray" alt="ndarray-badge" /></a> <a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></p>
<p>使用 <a href="https://docs.rs/ndarray/*/ndarray/fn.arr2.html"><code>ndarray::arr2</code></a> 创建两个二维（2-D）矩阵，并按元素方式求和。</p>
<p>注意：sum 的计算方式为 <code>let sum = &amp;a + &amp;b</code>，借用 <code>&amp;</code> 运算符获得 <code>a</code> 和 <code>b</code> 的引用，可避免销毁他们，使它们可以稍后显示。这样，就创建了一个包含其和的新数组。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use ndarray::arr2;

fn main() {
    let a = arr2(&amp;[[1, 2, 3],
                   [4, 5, 6]]);

    let b = arr2(&amp;[[6, 5, 4],
                   [3, 2, 1]]);

    let sum = &amp;a + &amp;b;

    println!(&quot;{}&quot;, a);
    println!(&quot;+&quot;);
    println!(&quot;{}&quot;, b);
    println!(&quot;=&quot;);
    println!(&quot;{}&quot;, sum);
}
</code></pre></pre>
<h2><a class="header" href="#矩阵相乘" id="矩阵相乘">矩阵相乘</a></h2>
<!--
> [science/mathematics/linear_algebra/multiply-matrices.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science/mathematics/linear_algebra/multiply-matrices.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/crate/ndarray/*"><img src="https://badge-cache.kominick.com/crate/ndarray.svg?label=ndarray" alt="ndarray-badge" /></a> <a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></p>
<p>使用 <a href="https://docs.rs/ndarray/*/ndarray/fn.arr2.html"><code>ndarray::arr2</code></a> 创建两个矩阵，并使用 <a href="https://docs.rs/ndarray/*/ndarray/struct.ArrayBase.html#method.dot-1"><code>ndarray::ArrayBase::dot</code></a> 对它们执行矩阵乘法。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use ndarray::arr2;

fn main() {
    let a = arr2(&amp;[[1, 2, 3],
                   [4, 5, 6]]);

    let b = arr2(&amp;[[6, 3],
                   [5, 2],
                   [4, 1]]);

    println!(&quot;{}&quot;, a.dot(&amp;b));
}
</code></pre></pre>
<h2><a class="header" href="#标量vector矩阵相乘" id="标量vector矩阵相乘">标量、vector、矩阵相乘</a></h2>
<!--
> [science/mathematics/linear_algebra/multiply-scalar-vector-matrix.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science/mathematics/linear_algebra/multiply-scalar-vector-matrix.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/crate/ndarray/*"><img src="https://badge-cache.kominick.com/crate/ndarray.svg?label=ndarray" alt="ndarray-badge" /></a> <a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></p>
<p>使用 <a href="https://docs.rs/ndarray/*/ndarray/fn.arr1.html"><code>ndarray::arr1</code></a> 创建一维（1-D）数组（vector），使用 <a href="https://docs.rs/ndarray/*/ndarray/fn.arr2.html"><code>ndarray::arr2</code></a> 创建二维（2-D）数组（矩阵）。</p>
<p>首先，一个标量乘以一个 vector 得到另一个 vector。然后，使用 <a href="https://docs.rs/ndarray/*/ndarray/struct.ArrayBase.html#method.dot-1"><code>ndarray::Array2::dot</code></a> 将矩阵乘以新的 vector（矩阵相乘使用 <code>dot</code> 函数，而 <code>*</code> 运算符执行元素方式的乘法）。</p>
<p>在 <code>ndarray</code> crate 中，根据上下文，一维数组可以解释为行 vector 或列 vector。如果 vector 表示的方向很重要，则必须使用只有一行或一列的二维（2-D）数组。在本实例中，vector 是右侧的一维（1-D）数组，因此 <code>dot</code> 函数将其处理为列 vector。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use ndarray::{arr1, arr2, Array1};

fn main() {
    let scalar = 4;

    let vector = arr1(&amp;[1, 2, 3]);

    let matrix = arr2(&amp;[[4, 5, 6],
                        [7, 8, 9]]);

    let new_vector: Array1&lt;_&gt; = scalar * vector;
    println!(&quot;{}&quot;, new_vector);

    let new_matrix = matrix.dot(&amp;new_vector);
    println!(&quot;{}&quot;, new_matrix);
}
</code></pre></pre>
<h2><a class="header" href="#vector-比较" id="vector-比较">Vector 比较</a></h2>
<!--
> [science/mathematics/linear_algebra/vector-comparison.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science/mathematics/linear_algebra/vector-comparison.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/crate/ndarray/*"><img src="https://badge-cache.kominick.com/crate/ndarray.svg?label=ndarray" alt="ndarray-badge" /></a></p>
<p><a href="https://docs.rs/crate/ndarray/*">ndarray</a> crate 支持多种创建数组的方法——此实例使用 <code>from</code> 从 <code>std::Vec</code> 创建数组 <a href="https://docs.rs/ndarray/*/ndarray/struct.ArrayBase.html"><code>ndarray::Array</code></a>。然后，对数组以元素方式求和。</p>
<p>下面的实例按元素方式比较两个浮点型 vector。浮点数的存储通常不精确，因此很难进行精确的比较。但是，<a href="https://docs.rs/approx/*/approx/index.html"><code>approx</code></a> crate 中的 <a href="https://docs.rs/approx/*/approx/macro.assert_abs_diff_eq.html"><code>assert_abs_diff_eq!</code></a> 宏允许方便地比较浮点型元素。要将 <code>approx</code> 和 <code>ndarray</code> 两个 crate一起使用，必须在 <code>Cargo.toml</code> 文件中的 <code>ndarray</code> 依赖项添加 <code>approx</code> 特性。例如：<code>ndarray = { version = &quot;0.13&quot;, features = [&quot;approx&quot;] }</code>。</p>
<p>此实例还包含其他所有权示例。在这里，<code>let z = a + b</code> 执行后，会销毁 <code>a</code> and <code>b</code>，然后所有权会转移到 <code>z</code>。或者，<code>let w = &amp;c + &amp;d</code> 创建一个新的 vector，而不销毁 <code>c</code> 或者 <code>d</code>，允许以后对它们进行修改。有关其他详细信息，请参见<a href="https://docs.rs/ndarray/*/ndarray/struct.ArrayBase.html#binary-operators-with-two-arrays">带有两个数组的二进制运算符</a>。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use approx::assert_abs_diff_eq;
use ndarray::Array;

fn main() {
  let a = Array::from(vec![1., 2., 3., 4., 5.]);
  let b = Array::from(vec![5., 4., 3., 2., 1.]);
  let mut c = Array::from(vec![1., 2., 3., 4., 5.]);
  let mut d = Array::from(vec![5., 4., 3., 2., 1.]);

  let z = a + b;
  let w =  &amp;c + &amp;d;

  assert_abs_diff_eq!(z, Array::from(vec![6., 6., 6., 6., 6.]));

  println!(&quot;c = {}&quot;, c);
  c[0] = 10.;
  d[1] = 10.;

  assert_abs_diff_eq!(w, Array::from(vec![6., 6., 6., 6., 6.]));

}
</code></pre></pre>
<h2><a class="header" href="#vector-范数" id="vector-范数">Vector 范数</a></h2>
<!--
> [science/mathematics/linear_algebra/vector-norm.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science/mathematics/linear_algebra/vector-norm.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/crate/ndarray/*"><img src="https://badge-cache.kominick.com/crate/ndarray.svg?label=ndarray" alt="ndarray-badge" /></a></p>
<p>这个实例展示了 <a href="https://docs.rs/ndarray/*/ndarray/type.Array1.html"><code>Array1</code></a> 类型、<a href="https://docs.rs/ndarray/*/ndarray/type.ArrayView1.html"><code>ArrayView1</code></a> 类型、<a href="https://docs.rs/ndarray/*/ndarray/struct.ArrayBase.html#method.fold"><code>fold</code></a> 方法，以及 <a href="https://docs.rs/ndarray/*/ndarray/struct.ArrayBase.html#method.dot"><code>dot</code></a> 方法在计算给定 vector 的 <a href="http://mathworld.wolfram.com/L1-Norm.html">l1</a> 和 <a href="http://mathworld.wolfram.com/L2-Norm.html">l2</a> 范数时的用法。
+ <code>l2_norm</code> 函数是两者中较简单的，它计算一个 vector 与自身的点积（dot product，数量积）的平方根。
+ <code>l1_norm</code> 函数通过 <code>fold</code> 运算来计算元素的绝对值（也可以通过 <code>x.mapv(f64::abs).scalar_sum()</code> 执行，但是会为 <code>mapv</code> 的结果分配一个新的数组）。</p>
<p>请注意：<code>l1_norm</code> 和 <code>l2_norm</code> 都采用 <a href="https://docs.rs/ndarray/*/ndarray/type.ArrayView1.html"><code>ArrayView1</code></a> 类型。这个实例考虑了 vector 范数，所以范数函数只需要接受一维视图（<a href="https://docs.rs/ndarray/*/ndarray/type.ArrayView1.html"><code>ArrayView1</code></a>）。虽然函数可以使用类型为 <code>&amp;Array1&lt;f64&gt;</code> 的参数，但这将要求调用方引用拥有所有权的数组，这比访问视图更为严格（因为视图可以从任意数组或视图创建，而不仅仅是从拥有所有权的数组创建）。</p>
<p><code>Array</code> 和 <code>ArrayView</code> 都是 <code>ArrayBase</code> 的类型别名。于是，大多数的调用方参数类型可以是 <code>&amp;ArrayBase&lt;S, Ix1&gt; where S: Data</code>，这样调用方就可以使用 <code>&amp;array</code> 或者 <code>&amp;view</code> 而不是 <code>x.view()</code>。如果该函数是公共 API 的一部分，那么对于用户来说，这可能是一个更好的选择。对于内部函数，更简明的 <code>ArrayView1&lt;f64&gt;</code> 或许更合适。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use ndarray::{array, Array1, ArrayView1};

fn l1_norm(x: ArrayView1&lt;f64&gt;) -&gt; f64 {
    x.fold(0., |acc, elem| acc + elem.abs())
}

fn l2_norm(x: ArrayView1&lt;f64&gt;) -&gt; f64 {
    x.dot(&amp;x).sqrt()
}

fn normalize(mut x: Array1&lt;f64&gt;) -&gt; Array1&lt;f64&gt; {
    let norm = l2_norm(x.view());
    x.mapv_inplace(|e| e/norm);
    x
}

fn main() {
    let x = array![1., 2., 3., 4., 5.];
    println!(&quot;||x||_2 = {}&quot;, l2_norm(x.view()));
    println!(&quot;||x||_1 = {}&quot;, l1_norm(x.view()));
    println!(&quot;Normalizing x yields {:?}&quot;, normalize(x));
}
</code></pre></pre>
<h2><a class="header" href="#矩阵求逆" id="矩阵求逆">矩阵求逆</a></h2>
<!--
> [science/mathematics/linear_algebra/invert-matrix.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science/mathematics/linear_algebra/invert-matrix.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/nalgebra"><img src="https://badge-cache.kominick.com/crate/nalgebra.svg?label=nalgebra" alt="nalgebra-badge" /></a> <a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></p>
<p>用 <a href="https://docs.rs/nalgebra/*/nalgebra/base/type.Matrix3.html"><code>nalgebra::Matrix3</code></a> 创建一个 3x3 的矩阵，如果可能的话，将其求逆。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use nalgebra::Matrix3;

fn main() {
    let m1 = Matrix3::new(2.0, 1.0, 1.0, 3.0, 2.0, 1.0, 2.0, 1.0, 2.0);
    println!(&quot;m1 = {}&quot;, m1);
    match m1.try_inverse() {
        Some(inv) =&gt; {
            println!(&quot;The inverse of m1 is: {}&quot;, inv);
        }
        None =&gt; {
            println!(&quot;m1 is not invertible!&quot;);
        }
    }
}
</code></pre></pre>
<h2><a class="header" href="#反序列化矩阵" id="反序列化矩阵">（反）序列化矩阵</a></h2>
<!--
> [science/mathematics/linear_algebra/deserialize-matrix.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science/mathematics/linear_algebra/deserialize-matrix.md)
> <br />
> commit 019c0a0d2cb2ffde562da4c466d090f5854c7995 - 2020.06.14
-->
<p><a href="https://docs.rs/crate/ndarray/*"><img src="https://badge-cache.kominick.com/crate/ndarray.svg?label=ndarray" alt="ndarray-badge" /></a> <a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></p>
<p>本实例实现将矩阵序列化为 JSON，以及从 JSON 反序列化出矩阵。序列化由 <a href="https://docs.rs/serde_json/*/serde_json/fn.to_string.html"><code>serde_json::to_string</code></a> 处理，<a href="https://docs.rs/serde_json/*/serde_json/fn.from_str.html"><code>serde_json::from_str</code></a> 则执行反序列化。</p>
<p>请注意：序列化后再反序列化将返回原始矩阵。</p>
<pre><pre class="playground"><code class="language-rust">extern crate nalgebra;
extern crate serde_json;

use nalgebra::DMatrix;

fn main() -&gt; Result&lt;(), std::io::Error&gt; {
    let row_slice: Vec&lt;i32&gt; = (1..5001).collect();
    let matrix = DMatrix::from_row_slice(50, 100, &amp;row_slice);

    // 序列化矩阵
    let serialized_matrix = serde_json::to_string(&amp;matrix)?;

    // 反序列化出矩阵
    let deserialized_matrix: DMatrix&lt;i32&gt; = serde_json::from_str(&amp;serialized_matrix)?;

    // 验证反序列化出的矩阵 `deserialized_matrix` 等同于原始矩阵 `matrix`
    assert!(deserialized_matrix == matrix);

    Ok(())
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#三角学-3" id="三角学-3">三角学</a></h1>
<!--
> [science/mathematics/trigonometry.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science/mathematics/trigonometry.md)
> <br />
> commit 580e16feff644155826c7494cebe4d9c053d43f7 - 2018.10.09
-->
<h2><a class="header" href="#计算三角形的边长" id="计算三角形的边长">计算三角形的边长</a></h2>
<!--
> [science/mathematics/trigonometry/side-length.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science/mathematics/trigonometry/side-length.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a> <a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></p>
<p>计算直角三角形斜边的长度，其中斜边的角度为 2 弧度，对边长度为 80。</p>
<pre><pre class="playground"><code class="language-rust edition2018">fn main() {
    let angle: f64 = 2.0;
    let side_length = 80.0;

    let hypotenuse = side_length / angle.sin();

    println!(&quot;Hypotenuse: {}&quot;, hypotenuse);
}
</code></pre></pre>
<h2><a class="header" href="#验证正切tan等于正弦sin除以余弦cos" id="验证正切tan等于正弦sin除以余弦cos">验证正切（tan）等于正弦（sin）除以余弦（cos）</a></h2>
<!--
> [science/mathematics/trigonometry/tan-sin-cos.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science/mathematics/trigonometry/tan-sin-cos.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a> <a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></p>
<p>验证 tan(x) 是否等于 sin(x)/cos(x)，其中 x=6。</p>
<pre><pre class="playground"><code class="language-rust edition2018">fn main() {
    let x: f64 = 6.0;

    let a = x.tan();
    let b = x.sin() / x.cos();

    assert_eq!(a, b);
}
</code></pre></pre>
<h2><a class="header" href="#地球上两点之间的距离" id="地球上两点之间的距离">地球上两点之间的距离</a></h2>
<!--
> [science/mathematics/trigonometry/latitude-longitude.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science/mathematics/trigonometry/latitude-longitude.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></p>
<p>默认情况下，Rust 提供了数学上的<a href="https://doc.rust-lang.org/std/primitive.f64.html#methods">浮点数方法</a>，例如：三角函数、平方根、弧度和度数之间的转换函数等。</p>
<p>下面的实例使用<a href="https://en.wikipedia.org/wiki/Haversine_formula">半正矢公式</a>计算地球上两点之间的距离（以公里为单位）。两个点用一对经纬度表示，然后，<a href="https://doc.rust-lang.org/std/primitive.f64.html#method.to_radians"><code>to_radians</code></a> 将它们转换为弧度。<a href="https://doc.rust-lang.org/std/primitive.f64.html#method.sin"><code>sin</code></a>、<a href="https://doc.rust-lang.org/std/primitive.f64.html#method.cos"><code>cos</code></a>、<a href="https://doc.rust-lang.org/std/primitive.f64.html#method.powi"><code>powi</code></a> 以及 <a href="https://doc.rust-lang.org/std/primitive.f64.html#method.sqrt"><code>sqrt</code></a> 计算中心角。最终，可以计算出距离。</p>
<pre><pre class="playground"><code class="language-rust edition2018">fn main() {
    let earth_radius_kilometer = 6371.0_f64;
    let (paris_latitude_degrees, paris_longitude_degrees) = (48.85341_f64, -2.34880_f64);
    let (london_latitude_degrees, london_longitude_degrees) = (51.50853_f64, -0.12574_f64);

    let paris_latitude = paris_latitude_degrees.to_radians();
    let london_latitude = london_latitude_degrees.to_radians();

    let delta_latitude = (paris_latitude_degrees - london_latitude_degrees).to_radians();
    let delta_longitude = (paris_longitude_degrees - london_longitude_degrees).to_radians();

    let central_angle_inner = (delta_latitude / 2.0).sin().powi(2)
        + paris_latitude.cos() * london_latitude.cos() * (delta_longitude / 2.0).sin().powi(2);
    let central_angle = 2.0 * central_angle_inner.sqrt().asin();

    let distance = earth_radius_kilometer * central_angle;

    println!(
        &quot;Distance between Paris and London on the surface of Earth is {:.1} kilometers&quot;,
        distance
    );
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#复数-3" id="复数-3">复数</a></h1>
<!--
> [science/mathematics/complex_numbers.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science/mathematics/complex_numbers.md)
> <br />
> commit 580e16feff644155826c7494cebe4d9c053d43f7 - 2018.10.09
-->
<h2><a class="header" href="#创建复数" id="创建复数">创建复数</a></h2>
<!--
> [science/mathematics/complex_numbers/create-complex.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science/mathematics/complex_numbers/create-complex.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/num/"><img src="https://badge-cache.kominick.com/crates/v/num.svg?label=num" alt="num-badge" /></a> <a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></p>
<p>创建类型 <a href="https://autumnai.github.io/cuticula/num/complex/struct.Complex.html"><code>num::complex::Complex</code></a> 的复数，复数的实部和虚部必须是同一类型。</p>
<pre><pre class="playground"><code class="language-rust edition2018">fn main() {
    let complex_integer = num::complex::Complex::new(10, 20);
    let complex_float = num::complex::Complex::new(10.1, 20.1);

    println!(&quot;Complex integer: {}&quot;, complex_integer);
    println!(&quot;Complex float: {}&quot;, complex_float);
}
</code></pre></pre>
<h2><a class="header" href="#复数相加" id="复数相加">复数相加</a></h2>
<!--
> [science/mathematics/complex_numbers/add-complex.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science/mathematics/complex_numbers/add-complex.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/num/"><img src="https://badge-cache.kominick.com/crates/v/num.svg?label=num" alt="num-badge" /></a> <a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></p>
<p>对复数执行数学运算与对内置类型执行数学运算是一样的：计算的数字必须是相同的类型（如浮点数或整数）。</p>
<pre><pre class="playground"><code class="language-rust edition2018">fn main() {
    let complex_num1 = num::complex::Complex::new(10.0, 20.0); // 必须为浮点数
    let complex_num2 = num::complex::Complex::new(3.1, -4.2);

    let sum = complex_num1 + complex_num2;

    println!(&quot;Sum: {}&quot;, sum);
}
</code></pre></pre>
<h2><a class="header" href="#复数的数学函数" id="复数的数学函数">复数的数学函数</a></h2>
<!--
> [science/mathematics/complex_numbers/mathematical-functions.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science/mathematics/complex_numbers/mathematical-functions.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/num/"><img src="https://badge-cache.kominick.com/crates/v/num.svg?label=num" alt="num-badge" /></a> <a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></p>
<p>在与其他数学函数交互时，复数有一系列有趣的特性，尤其是和自然常数 e（欧拉数）类似的正弦相关函数。要将这些函数与复数一起使用，复数类型有几个内置函数，详细请参阅 <a href="https://autumnai.github.io/cuticula/num/complex/struct.Complex.html"><code>num::complex::Complex</code></a>。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use std::f64::consts::PI;
use num::complex::Complex;

fn main() {
    let x = Complex::new(0.0, 2.0*PI);

    println!(&quot;e^(2i * pi) = {}&quot;, x.exp()); // =~1
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#统计学-3" id="统计学-3">统计学</a></h1>
<!--
> [science/mathematics/statistics.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science/mathematics/statistics.md)
> <br />
> commit fad847ef2d0b9e39c013f6ec8fa14cb4224c4133 - 2018.12.28
-->
<h3><a class="header" href="#集中趋势度量" id="集中趋势度量">集中趋势度量</a></h3>
<!--
> [science/mathematics/statistics/central-tendency.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science/mathematics/statistics/central-tendency.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a> <a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></p>
<p>本节实例计算 Rust 数组中包含的数据集的集中趋势度量。对于一个空的数据集，可能没有平均数、中位数或众数去计算，因此每个函数都返回 [<code>Option</code>] ，由调用者处理。</p>
<p>第一个实例是通过对数据引用生成一个迭代器，然后计算平均数（所有测量值的总和除以测量值的计数），并使用 [<code>sum</code>] 和 [<code>len</code>] 函数分别确定值的总和及值的计数。</p>
<pre><pre class="playground"><code class="language-rust edition2018">fn main() {
    let data = [3, 1, 6, 1, 5, 8, 1, 8, 10, 11];

    let sum = data.iter().sum::&lt;i32&gt;() as f32;
    let count = data.len();

    let mean = match count {
       positive if positive &gt; 0 =&gt; Some(sum  / count as f32),
       _ =&gt; None
    };

    println!(&quot;Mean of the data is {:?}&quot;, mean);
}
</code></pre></pre>
<p>第二个实例使用快速选择算法（quick select algorithm）计算中位数，该算法只对已知可能包含中位数的数据集的分区进行排序，从而避免了完整[排序][<code>sort</code>]。该算法使用 [<code>cmp</code>] 和 [<code>Ordering</code>] 简便地地决定要检查的下一个分区，并使用 [<code>split_at</code>] 为每个步骤的下一个分区选择一个任意的枢轴量。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use std::cmp::Ordering;

fn partition(data: &amp;[i32]) -&gt; Option&lt;(Vec&lt;i32&gt;, i32, Vec&lt;i32&gt;)&gt; {
    match data.len() {
        0 =&gt; None,
        _ =&gt; {
            let (pivot_slice, tail) = data.split_at(1);
            let pivot = pivot_slice[0];
            let (left, right) = tail.iter()
                .fold((vec![], vec![]), |mut splits, next| {
                    {
                        let (ref mut left, ref mut right) = &amp;mut splits;
                        if next &lt; &amp;pivot {
                            left.push(*next);
                        } else {
                            right.push(*next);
                        }
                    }
                    splits
                });

            Some((left, pivot, right))
        }
    }
}

fn select(data: &amp;[i32], k: usize) -&gt; Option&lt;i32&gt; {
    let part = partition(data);

    match part {
        None =&gt; None,
        Some((left, pivot, right)) =&gt; {
            let pivot_idx = left.len();

            match pivot_idx.cmp(&amp;k) {
                Ordering::Equal =&gt; Some(pivot),
                Ordering::Greater =&gt; select(&amp;left, k),
                Ordering::Less =&gt; select(&amp;right, k - (pivot_idx + 1)),
            }
        },
    }
}

fn median(data: &amp;[i32]) -&gt; Option&lt;f32&gt; {
    let size = data.len();

    match size {
        even if even % 2 == 0 =&gt; {
            let fst_med = select(data, (even / 2) - 1);
            let snd_med = select(data, even / 2);

            match (fst_med, snd_med) {
                (Some(fst), Some(snd)) =&gt; Some((fst + snd) as f32 / 2.0),
                _ =&gt; None
            }
        },
        odd =&gt; select(data, odd / 2).map(|x| x as f32)
    }
}

fn main() {
    let data = [3, 1, 6, 1, 5, 8, 1, 8, 10, 11];

    let part = partition(&amp;data);
    println!(&quot;Partition is {:?}&quot;, part);

    let sel = select(&amp;data, 5);
    println!(&quot;Selection at ordered index {} is {:?}&quot;, 5, sel);

    let med = median(&amp;data);
    println!(&quot;Median is {:?}&quot;, med);
}
</code></pre></pre>
<p>最后一个实例使用可变的 [<code>HashMap</code>] 来计算众数，[<code>fold</code>] 和 [<code>entry</code>] API 用来从集合中收集每个不同整数的计数。[<code>HashMap</code>] 中最常见的值可以用 [<code>max_by_key</code>] 取得。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use std::collections::HashMap;

fn main() {
    let data = [3, 1, 6, 1, 5, 8, 1, 8, 10, 11];

    let frequencies = data.iter().fold(HashMap::new(), |mut freqs, value| {
        *freqs.entry(value).or_insert(0) += 1;
        freqs
    });

    let mode = frequencies
        .into_iter()
        .max_by_key(|&amp;(_, count)| count)
        .map(|(value, _)| *value);

    println!(&quot;Mode of the data is {:?}&quot;, mode);
}
</code></pre></pre>
<h3><a class="header" href="#计算标准偏差" id="计算标准偏差">计算标准偏差</a></h3>
<!--
> [science/mathematics/statistics/standard-deviation.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science/mathematics/statistics/standard-deviation.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a> <a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></p>
<p>本实例计算一组测量值的标准偏差和 z 分数（z-score）。</p>
<p>标准偏差定义为方差的平方根（用 f32 浮点型的 [<code>sqrt</code>] 计算），其中方差是每个测量值与<a href="science/mathematics/statistics.html#%E9%9B%86%E4%B8%AD%E8%B6%8B%E5%8A%BF%E5%BA%A6%E9%87%8F"><code>平均数</code></a>之间的平方差的<a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.sum"><code>和</code></a>除以测量次数。</p>
<p>z 分数（z-score）是指单个测量值偏离数据集<a href="science/mathematics/statistics.html#%E9%9B%86%E4%B8%AD%E8%B6%8B%E5%8A%BF%E5%BA%A6%E9%87%8F"><code>平均数</code></a>的标准差数。</p>
<pre><pre class="playground"><code class="language-rust edition2018">fn mean(data: &amp;[i32]) -&gt; Option&lt;f32&gt; {
    let sum = data.iter().sum::&lt;i32&gt;() as f32;
    let count = data.len();

    match count {
        positive if positive &gt; 0 =&gt; Some(sum / count as f32),
        _ =&gt; None,
    }
}

fn std_deviation(data: &amp;[i32]) -&gt; Option&lt;f32&gt; {
    match (mean(data), data.len()) {
        (Some(data_mean), count) if count &gt; 0 =&gt; {
            let variance = data.iter().map(|value| {
                let diff = data_mean - (*value as f32);

                diff * diff
            }).sum::&lt;f32&gt;() / count as f32;

            Some(variance.sqrt())
        },
        _ =&gt; None
    }
}

fn main() {
    let data = [3, 1, 6, 1, 5, 8, 1, 8, 10, 11];

    let data_mean = mean(&amp;data);
    println!(&quot;Mean is {:?}&quot;, data_mean);

    let data_std_deviation = std_deviation(&amp;data);
    println!(&quot;Standard deviation is {:?}&quot;, data_std_deviation);

    let zscore = match (data_mean, data_std_deviation) {
        (Some(mean), Some(std_deviation)) =&gt; {
            let diff = data[4] as f32 - mean;

            Some(diff / std_deviation)
        },
        _ =&gt; None
    };
    println!(&quot;Z-score of data at index 4 (with value {}) is {:?}&quot;, data[4], zscore);
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#其它数学计算-3" id="其它数学计算-3">其它数学计算</a></h1>
<!--
> [science/mathematics/miscellaneous.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science/mathematics/miscellaneous.md)
> <br />
> commit c786f03e921abf024a929c4492e3c6c6ab6a5cb2 - 2018.12.08
-->
<h2><a class="header" href="#大数" id="大数">大数</a></h2>
<!--
> [science/mathematics/miscellaneous/big-integers.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/science/mathematics/miscellaneous/big-integers.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/num/"><img src="https://badge-cache.kominick.com/crates/v/num.svg?label=num" alt="num-badge" /></a> <a href="https://crates.io/categories/science"><img src="https://badge-cache.kominick.com/badge/science--x.svg?style=social" alt="cat-science-badge" /></a></p>
<p><a href="https://docs.rs/num/0.2.0/num/struct.BigInt.html"><code>BigInt</code></a> 使得超过 128 位的大整数计算成为可能。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use num::bigint::{BigInt, ToBigInt};

fn factorial(x: i32) -&gt; BigInt {
    if let Some(mut factorial) = 1.to_bigint() {
        for i in 1..(x+1) {
            factorial = factorial * i;
        }
        factorial
    }
    else {
        panic!(&quot;Failed to calculate factorial!&quot;);
    }
}

fn main() {
    println!(&quot;{}! equals {}&quot;, 100, factorial(100));
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#文本处理-1" id="文本处理-1">文本处理</a></h1>
<!--
> [os.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/text.md)
> <br />
> commit f1ad9ad44c355d12b7759dca2f700f254ca86114 - 2019.04.13
-->
<h2><a class="header" href="#正则表达式-1" id="正则表达式-1">正则表达式</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="text/regex.html#%E9%AA%8C%E8%AF%81%E5%B9%B6%E6%8F%90%E5%8F%96%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF">验证并提取电子邮件登录信息</a></td><td><a href="https://docs.rs/regex/"><img src="https://badge-cache.kominick.com/crates/v/regex.svg?label=regex" alt="regex-badge" /></a> <a href="https://docs.rs/lazy_static/"><img src="https://badge-cache.kominick.com/crates/v/lazy_static.svg?label=lazy_static" alt="lazy_static-badge" /></a></td><td><a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></td></tr>
<tr><td><a href="text/regex.html#%E4%BB%8E%E6%96%87%E6%9C%AC%E6%8F%90%E5%8F%96%E6%A0%87%E7%AD%BE%E5%85%83%E7%B4%A0%E5%94%AF%E4%B8%80%E7%9A%84%E5%88%97%E8%A1%A8">从文本提取标签元素唯一的列表</a></td><td><a href="https://docs.rs/regex/"><img src="https://badge-cache.kominick.com/crates/v/regex.svg?label=regex" alt="regex-badge" /></a> <a href="https://docs.rs/lazy_static/"><img src="https://badge-cache.kominick.com/crates/v/lazy_static.svg?label=lazy_static" alt="lazy_static-badge" /></a></td><td><a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></td></tr>
<tr><td><a href="text/regex.html#%E4%BB%8E%E6%96%87%E6%9C%AC%E6%8F%90%E5%8F%96%E7%94%B5%E8%AF%9D%E5%8F%B7%E7%A0%81">从文本提取电话号码</a></td><td><a href="https://docs.rs/regex/"><img src="https://badge-cache.kominick.com/crates/v/regex.svg?label=regex" alt="regex-badge" /></a></td><td><a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></td></tr>
<tr><td><a href="text/regex.html#%E9%80%9A%E8%BF%87%E5%8C%B9%E9%85%8D%E5%A4%9A%E4%B8%AA%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%9D%A5%E7%AD%9B%E9%80%89%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6">通过匹配多个正则表达式来筛选日志文件</a></td><td><a href="https://docs.rs/regex/"><img src="https://badge-cache.kominick.com/crates/v/regex.svg?label=regex" alt="regex-badge" /></a></td><td><a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></td></tr>
<tr><td><a href="text/regex.html#%E6%96%87%E6%9C%AC%E6%A8%A1%E5%BC%8F%E6%9B%BF%E6%8D%A2">文本模式替换</a></td><td><a href="https://docs.rs/regex/"><img src="https://badge-cache.kominick.com/crates/v/regex.svg?label=regex" alt="regex-badge" /></a> <a href="https://docs.rs/lazy_static/"><img src="https://badge-cache.kominick.com/crates/v/lazy_static.svg?label=lazy_static" alt="lazy_static-badge" /></a></td><td><a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#字符串解析-1" id="字符串解析-1">字符串解析</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="text/string_parsing.html#%E6%94%B6%E9%9B%86-unicode-%E5%AD%97%E7%AC%A6">收集 Unicode 字符</a></td><td><a href="https://docs.rs/unicode-segmentation/"><img src="https://badge-cache.kominick.com/crates/v/unicode-segmentation.svg?label=unicode-segmentation" alt="unicode-segmentation-badge" /></a></td><td><a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="text/string_parsing.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%93%E6%9E%84%E4%BD%93%E5%B9%B6%E5%AE%9E%E7%8E%B0-fromstr-trait">自定义<code>结构体</code>并实现 <code>FromStr</code> trait</a></td><td><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a></td><td><a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#正则表达式-2" id="正则表达式-2">正则表达式</a></h1>
<!--
> [text/regex.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/text/regex.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#验证并提取电子邮件登录信息" id="验证并提取电子邮件登录信息">验证并提取电子邮件登录信息</a></h2>
<!--
> [text/regex/email.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/text/regex/email.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/regex/"><img src="https://badge-cache.kominick.com/crates/v/regex.svg?label=regex" alt="regex-badge" /></a> <a href="https://docs.rs/lazy_static/"><img src="https://badge-cache.kominick.com/crates/v/lazy_static.svg?label=lazy_static" alt="lazy_static-badge" /></a> <a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></p>
<p>验证电子邮件地址的格式是否正确，并提取 @ 符号之前的所有内容。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use lazy_static::lazy_static;

use regex::Regex;

fn extract_login(input: &amp;str) -&gt; Option&lt;&amp;str&gt; {
    lazy_static! {
        static ref RE: Regex = Regex::new(r&quot;(?x)
            ^(?P&lt;login&gt;[^@\s]+)@
            ([[:word:]]+\.)*
            [[:word:]]+$
            &quot;).unwrap();
    }
    RE.captures(input).and_then(|cap| {
        cap.name(&quot;login&quot;).map(|login| login.as_str())
    })
}

fn main() {
    assert_eq!(extract_login(r&quot;I❤email@example.com&quot;), Some(r&quot;I❤email&quot;));
    assert_eq!(
        extract_login(r&quot;sdf+sdsfsd.as.sdsd@jhkk.d.rl&quot;),
        Some(r&quot;sdf+sdsfsd.as.sdsd&quot;)
    );
    assert_eq!(extract_login(r&quot;More@Than@One@at.com&quot;), None);
    assert_eq!(extract_login(r&quot;Not an email@email&quot;), None);
}
</code></pre></pre>
<h2><a class="header" href="#从文本提取标签元素唯一的列表" id="从文本提取标签元素唯一的列表">从文本提取标签元素唯一的列表</a></h2>
<!--
> [text/regex/hashtags.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/text/regex/hashtags.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/regex/"><img src="https://badge-cache.kominick.com/crates/v/regex.svg?label=regex" alt="regex-badge" /></a> <a href="https://docs.rs/lazy_static/"><img src="https://badge-cache.kominick.com/crates/v/lazy_static.svg?label=lazy_static" alt="lazy_static-badge" /></a> <a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></p>
<p>本实例展示从文本中提取、排序和去除标签列表的重复元素。</p>
<p>这里给出的标签正则表达式只捕获以字母开头的拉丁语标签，完整的 <a href="https://github.com/twitter/twitter-text/blob/c9fc09782efe59af4ee82855768cfaf36273e170/java/src/com/twitter/Regex.java#L255">twitter 标签正则表达式</a>要复杂得多。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use lazy_static::lazy_static;

use regex::Regex;
use std::collections::HashSet;

fn extract_hashtags(text: &amp;str) -&gt; HashSet&lt;&amp;str&gt; {
    lazy_static! {
        static ref HASHTAG_REGEX : Regex = Regex::new(
                r&quot;\#[a-zA-Z][0-9a-zA-Z_]*&quot;
            ).unwrap();
    }
    HASHTAG_REGEX.find_iter(text).map(|mat| mat.as_str()).collect()
}

fn main() {
    let tweet = &quot;Hey #world, I just got my new #dog, say hello to Till. #dog #forever #2 #_ &quot;;
    let tags = extract_hashtags(tweet);
    assert!(tags.contains(&quot;#dog&quot;) &amp;&amp; tags.contains(&quot;#forever&quot;) &amp;&amp; tags.contains(&quot;#world&quot;));
    assert_eq!(tags.len(), 3);
}
</code></pre></pre>
<h2><a class="header" href="#从文本提取电话号码" id="从文本提取电话号码">从文本提取电话号码</a></h2>
<!--
> [text/regex/phone.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/text/regex/phone.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/regex/"><img src="https://badge-cache.kominick.com/crates/v/regex.svg?label=regex" alt="regex-badge" /></a> <a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></p>
<p>使用 <a href="https://docs.rs/regex/*/regex/struct.Regex.html#method.captures_iter"><code>Regex::captures_iter</code></a> 处理一个文本字符串，以捕获多个电话号码。这里的例子中是美国电话号码格式。</p>
<pre><pre class="playground"><code class="language-rust edition2018"><span class="boring">use error_chain::error_chain;
</span>
use regex::Regex;
use std::fmt;
<span class="boring">
</span><span class="boring">error_chain!{
</span><span class="boring">    foreign_links {
</span><span class="boring">        Regex(regex::Error);
</span><span class="boring">        Io(std::io::Error);
</span><span class="boring">    }
</span><span class="boring">}
</span>
struct PhoneNumber&lt;'a&gt; {
    area: &amp;'a str,
    exchange: &amp;'a str,
    subscriber: &amp;'a str,
}

impl&lt;'a&gt; fmt::Display for PhoneNumber&lt;'a&gt; {
    fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; fmt::Result {
        write!(f, &quot;1 ({}) {}-{}&quot;, self.area, self.exchange, self.subscriber)
    }
}

fn main() -&gt; Result&lt;()&gt; {
    let phone_text = &quot;
    +1 505 881 9292 (v) +1 505 778 2212 (c) +1 505 881 9297 (f)
    (202) 991 9534
    Alex 5553920011
    1 (800) 233-2010
    1.299.339.1020&quot;;

    let re = Regex::new(
        r#&quot;(?x)
          (?:\+?1)?                       # 国家代码，可选项
          [\s\.]?
          (([2-9]\d{2})|\(([2-9]\d{2})\)) # 地区代码
          [\s\.\-]?
          ([2-9]\d{2})                    # 交换代码
          [\s\.\-]?
          (\d{4})                         # 用户号码&quot;#,
    )?;

    let phone_numbers = re.captures_iter(phone_text).filter_map(|cap| {
        let groups = (cap.get(2).or(cap.get(3)), cap.get(4), cap.get(5));
        match groups {
            (Some(area), Some(ext), Some(sub)) =&gt; Some(PhoneNumber {
                area: area.as_str(),
                exchange: ext.as_str(),
                subscriber: sub.as_str(),
            }),
            _ =&gt; None,
        }
    });

    assert_eq!(
        phone_numbers.map(|m| m.to_string()).collect::&lt;Vec&lt;_&gt;&gt;(),
        vec![
            &quot;1 (505) 881-9292&quot;,
            &quot;1 (505) 778-2212&quot;,
            &quot;1 (505) 881-9297&quot;,
            &quot;1 (202) 991-9534&quot;,
            &quot;1 (555) 392-0011&quot;,
            &quot;1 (800) 233-2010&quot;,
            &quot;1 (299) 339-1020&quot;,
        ]
    );

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#通过匹配多个正则表达式来筛选日志文件" id="通过匹配多个正则表达式来筛选日志文件">通过匹配多个正则表达式来筛选日志文件</a></h2>
<!--
> [text/regex/filter-log.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/text/regex/filter-log.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/regex/"><img src="https://badge-cache.kominick.com/crates/v/regex.svg?label=regex" alt="regex-badge" /></a> <a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></p>
<p>读取名为 <code>application.log</code> 的文件，并且只输出包含下列内容的行：“version X.X.X”、端口为 443 的 IP 地址（如 “192.168.0.1:443”）、特定警告。</p>
<p>正则表达集构造器 <a href="https://docs.rs/regex/*/regex/struct.RegexSetBuilder.html"><code>regex::RegexSetBuilder</code></a> 构建了正则表达式集 <a href="https://docs.rs/regex/*/regex/struct.RegexSet.html"><code>regex::RegexSet</code></a>。由于反斜杠在正则表达式中非常常见，因此使用<a href="https://rust-reference.budshome.com/tokens.html#%E5%AD%97%E9%9D%A2%E9%87%8F">原始字符串字面量</a>可以使它们更具可读性。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run"><span class="boring">use error_chain::error_chain;
</span>
use std::fs::File;
use std::io::{BufReader, BufRead};
use regex::RegexSetBuilder;

<span class="boring">error_chain! {
</span><span class="boring">    foreign_links {
</span><span class="boring">        Io(std::io::Error);
</span><span class="boring">        Regex(regex::Error);
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span>fn main() -&gt; Result&lt;()&gt; {
    let log_path = &quot;application.log&quot;;
    let buffered = BufReader::new(File::open(log_path)?);

    let set = RegexSetBuilder::new(&amp;[
        r#&quot;version &quot;\d\.\d\.\d&quot;&quot;#,
        r#&quot;\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}:443&quot;#,
        r#&quot;warning.*timeout expired&quot;#,
    ]).case_insensitive(true)
        .build()?;

    buffered
        .lines()
        .filter_map(|line| line.ok())
        .filter(|line| set.is_match(line.as_str()))
        .for_each(|x| println!(&quot;{}&quot;, x));

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#文本模式替换" id="文本模式替换">文本模式替换</a></h2>
<!--
> [text/regex/replace.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/text/regex/replace.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/regex/"><img src="https://badge-cache.kominick.com/crates/v/regex.svg?label=regex" alt="regex-badge" /></a> <a href="https://docs.rs/lazy_static/"><img src="https://badge-cache.kominick.com/crates/v/lazy_static.svg?label=lazy_static" alt="lazy_static-badge" /></a> <a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></p>
<p>将所有出现的国际标准 ISO 8601 日期模式 <em>YYYY-MM-DD</em> 替换为具有斜杠的等效美式英语日期模式。例如： <code>2013-01-15</code> 替换为 <code>01/15/2013</code>。</p>
<p><a href="https://docs.rs/regex/*/regex/struct.Regex.html#method.replace_all"><code>Regex::replace_all</code></a> 方法将替换整个正则表示匹配的所有内容。<code>&amp;str</code> 实现了 <code>Replacer</code> trait，它允许类似 <code>$abcde</code> 的变量引用相应的搜索匹配模式（search regex）中的命名捕获组 <code>(?P&lt;abcde&gt;REGEX)</code>。有关示例和转义的详细信息，请参阅<a href="https://docs.rs/regex/*/regex/struct.Regex.html#replacement-string-syntax">替换字符串语法</a>。</p>
<blockquote>
<p>译者注：正则表达式的使用，需要了解匹配规则：全文匹配（match regex）、搜索匹配（search regex）、替换匹配（replace regex）。</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust edition2018">use lazy_static::lazy_static;

use std::borrow::Cow;
use regex::Regex;

fn reformat_dates(before: &amp;str) -&gt; Cow&lt;str&gt; {
    lazy_static! {
        static ref ISO8601_DATE_REGEX : Regex = Regex::new(
            r&quot;(?P&lt;y&gt;\d{4})-(?P&lt;m&gt;\d{2})-(?P&lt;d&gt;\d{2})&quot;
            ).unwrap();
    }
    ISO8601_DATE_REGEX.replace_all(before, &quot;$m/$d/$y&quot;)
}

fn main() {
    let before = &quot;2012-03-14, 2013-01-15 and 2014-07-05&quot;;
    let after = reformat_dates(before);
    assert_eq!(after, &quot;03/14/2012, 01/15/2013 and 07/05/2014&quot;);
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#字符串解析-2" id="字符串解析-2">字符串解析</a></h1>
<!--
> [text/string_parsing.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/text/string_parsing.md)
> <br />
> commit f1ad9ad44c355d12b7759dca2f700f254ca86114 - 2019.04.13
-->
<h2><a class="header" href="#收集-unicode-字符" id="收集-unicode-字符">收集 Unicode 字符</a></h2>
<!--
> [text/string_parsing/graphemes.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/text/string_parsing/graphemes.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/unicode-segmentation/1.2.1/unicode_segmentation/"><img src="https://badge-cache.kominick.com/crates/v/unicode-segmentation.svg?label=unicode-segmentation" alt="unicode-segmentation-badge" /></a> <a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></p>
<p>使用 <a href="https://docs.rs/unicode-segmentation/1.2.1/unicode_segmentation/"><code>unicode-segmentation</code></a> crate 中的 <a href="https://docs.rs/unicode-segmentation/*/unicode_segmentation/trait.UnicodeSegmentation.html#tymethod.graphemes"><code>UnicodeSegmentation::graphemes</code></a> 函数，从 UTF-8 字符串中收集个别的 Unicode 字符。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use unicode_segmentation::UnicodeSegmentation;

fn main() {
    let name = &quot;José Guimarães\r\n&quot;;
    let graphemes = UnicodeSegmentation::graphemes(name, true)
    	.collect::&lt;Vec&lt;&amp;str&gt;&gt;();
	assert_eq!(graphemes[3], &quot;é&quot;);
}
</code></pre></pre>
<h2><a class="header" href="#自定义结构体并实现-fromstr-trait" id="自定义结构体并实现-fromstr-trait">自定义<code>结构体</code>并实现 <code>FromStr</code> trait</a></h2>
<!--
> [text/string_parsing/from_str.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/text/string_parsing/from_str.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://doc.rust-lang.org/std"><img src="https://badge-cache.kominick.com/badge/std-1.29.1-blue.svg" alt="std-badge" /></a> <a href="https://crates.io/categories/text-processing"><img src="https://badge-cache.kominick.com/badge/text_processing--x.svg?style=social" alt="cat-text-processing-badge" /></a></p>
<p>本实例中，创建一个自定义结构体 <code>RGB</code> 并实现 <code>FromStr</code> trait，以将提供的颜色十六进制代码转换为其 RGB 颜色代码。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use std::str::FromStr;

#[derive(Debug, PartialEq)]
struct RGB {
    r: u8,
    g: u8,
    b: u8,
}

impl FromStr for RGB {
    type Err = std::num::ParseIntError;

    // 解析格式为 '#rRgGbB..' 的颜色十六进制代码
    // 将其转换为 'RGB' 实例
    fn from_str(hex_code: &amp;str) -&gt; Result&lt;Self, Self::Err&gt; {
	
        // u8::from_str_radix(src: &amp;str, radix: u32) 
        // 将给定的字符串切片转换为 u8
        let r: u8 = u8::from_str_radix(&amp;hex_code[1..3], 16)?;
        let g: u8 = u8::from_str_radix(&amp;hex_code[3..5], 16)?;
        let b: u8 = u8::from_str_radix(&amp;hex_code[5..7], 16)?;

        Ok(RGB { r, g, b })
    }
}

fn main() {
    let code: &amp;str = &amp;r&quot;#fa7268&quot;;
    match RGB::from_str(code) {
        Ok(rgb) =&gt; {
            println!(
                r&quot;The RGB color code is: R: {} G: {} B: {}&quot;,
                rgb.r, rgb.g, rgb.b
            );
        }
        Err(_) =&gt; {
            println!(&quot;{} is not a valid color hex code!&quot;, code);
        }
    }

    // 测试 from_str 函数执行是否符合预期
    assert_eq!(
        RGB::from_str(&amp;r&quot;#fa7268&quot;).unwrap(),
        RGB {
            r: 250,
            g: 114,
            b: 104
        }
    );
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#web-编程-1" id="web-编程-1">Web 编程</a></h1>
<!--
> [web.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web.md)
> <br />
> commit dd4efa8dcd8e611326caa01c08db8f227aa909d6 - 2020.06.07
-->
<h2><a class="header" href="#抓取网页-1" id="抓取网页-1">抓取网页</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="web/scraping.html#%E4%BB%8E-html-%E7%BD%91%E9%A1%B5%E4%B8%AD%E6%8F%90%E5%8F%96%E6%89%80%E6%9C%89%E9%93%BE%E6%8E%A5">从 HTML 网页中提取所有链接</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/select/"><img src="https://badge-cache.kominick.com/crates/v/select.svg?label=select" alt="select-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
<tr><td><a href="web/scraping.html#%E6%A3%80%E6%9F%A5%E7%BD%91%E9%A1%B5%E6%AD%BB%E9%93%BE">检查网页死链</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/select/"><img src="https://badge-cache.kominick.com/crates/v/select.svg?label=select" alt="select-badge" /></a> <a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
<tr><td><a href="web/scraping.html#%E4%BB%8E-mediawiki-%E6%A0%87%E8%AE%B0%E9%A1%B5%E9%9D%A2%E6%8F%90%E5%8F%96%E6%89%80%E6%9C%89%E5%94%AF%E4%B8%80%E6%80%A7%E9%93%BE%E6%8E%A5">从 MediaWiki 标记页面提取所有唯一性链接</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/regex/"><img src="https://badge-cache.kominick.com/crates/v/regex.svg?label=regex" alt="regex-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#url-1" id="url-1">URL</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="web/url.html#%E8%A7%A3%E6%9E%90-url-%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%BA-url-%E7%B1%BB%E5%9E%8B">解析 URL 字符串为 <code>Url</code> 类型</a></td><td><a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
<tr><td><a href="web/url.html#%E9%80%9A%E8%BF%87%E7%A7%BB%E9%99%A4%E8%B7%AF%E5%BE%84%E6%AE%B5%E5%88%9B%E5%BB%BA%E5%9F%BA%E6%9C%AC-url">通过移除路径段创建基本 URL</a></td><td><a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
<tr><td><a href="web/url.html#%E4%BB%8E%E5%9F%BA%E6%9C%AC-url-%E5%88%9B%E5%BB%BA%E6%96%B0-urls">从基本 URL 创建新 URLs</a></td><td><a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
<tr><td><a href="web/url.html#%E6%8F%90%E5%8F%96-url-%E6%BA%90scheme-host-port">提取 URL 源（scheme/ host/ port）</a></td><td><a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
<tr><td><a href="web/url.html#%E4%BB%8E-url-%E7%A7%BB%E9%99%A4%E7%89%87%E6%AE%B5%E6%A0%87%E8%AF%86%E7%AC%A6%E5%92%8C%E6%9F%A5%E8%AF%A2%E5%AF%B9">从 URL 移除片段标识符和查询对</a></td><td><a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#媒体类型mime-1" id="媒体类型mime-1">媒体类型（MIME）</a></h2>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="web/mime.html#%E4%BB%8E%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%8E%B7%E5%8F%96-mime-%E7%B1%BB%E5%9E%8B">从字符串获取 MIME 类型</a></td><td><a href="https://docs.rs/mime/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=mime" alt="mime-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="web/mime.html#%E4%BB%8E%E6%96%87%E4%BB%B6%E5%90%8D%E8%8E%B7%E5%8F%96-mime-%E7%B1%BB%E5%9E%8B">从文件名获取 MIME 类型</a></td><td><a href="https://docs.rs/mime/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=mime" alt="mime-badge" /></a></td><td><a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="web/mime.html#%E8%A7%A3%E6%9E%90-http-%E5%93%8D%E5%BA%94%E7%9A%84-mime-%E7%B1%BB%E5%9E%8B">解析 HTTP 响应的 MIME 类型</a></td><td><a href="https://docs.rs/mime/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=mime" alt="mime-badge" /></a> <a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
</tbody></table>
<h2><a class="header" href="#客户端-1" id="客户端-1">客户端</a></h2>
<!--
> [web/clients.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/clients.md)
> <br />
> commit dd4efa8dcd8e611326caa01c08db8f227aa909d6 - 2020.06.07
-->
<h3><a class="header" href="#请求处理-1" id="请求处理-1">请求处理</a></h3>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="/web/clients/requests.html#%E5%8F%91%E5%87%BA-http-get-%E8%AF%B7%E6%B1%82">发出 HTTP GET 请求</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
<tr><td><a href="/web/clients/requests.html#%E4%B8%BA-rest-%E8%AF%B7%E6%B1%82%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B6%88%E6%81%AF%E6%A0%87%E5%A4%B4%E5%92%8C-url-%E5%8F%82%E6%95%B0">为 REST 请求设置自定义消息标头和 URL 参数</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/hyper/"><img src="https://badge-cache.kominick.com/crates/v/hyper.svg?label=hyper" alt="hyper-badge" /></a> <a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td><td></td></tr>
</tbody></table>
<h3><a class="header" href="#web-api-调用-1" id="web-api-调用-1">Web API 调用</a></h3>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="/web/clients/apis.html#%E6%9F%A5%E8%AF%A2-github-api">查询 GitHub API</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/serde/"><img src="https://badge-cache.kominick.com/crates/v/serde.svg?label=serde" alt="serde-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="/web/clients/apis.html#%E6%A3%80%E6%9F%A5-api-%E8%B5%84%E6%BA%90%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8">检查 API 资源是否存在</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
<tr><td><a href="/web/clients/apis.html#%E4%BD%BF%E7%94%A8-github-api-%E5%88%9B%E5%BB%BA%E5%92%8C%E5%88%A0%E9%99%A4-gist">使用 GitHub API 创建和删除 Gist</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/serde/"><img src="https://badge-cache.kominick.com/crates/v/serde.svg?label=serde" alt="serde-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="/web/clients/apis.html#%E4%BD%BF%E7%94%A8-restful-api-%E5%88%86%E9%A1%B5">使用 RESTful API 分页</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/serde/"><img src="https://badge-cache.kominick.com/crates/v/serde.svg?label=serde" alt="serde-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="/web/clients/apis.html#%E5%A4%84%E7%90%86%E9%80%9F%E7%8E%87%E5%8F%97%E9%99%90-api">处理速率受限 API</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/hyper/"><img src="https://badge-cache.kominick.com/crates/v/hyper.svg?label=hyper" alt="hyper-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td><td></td></tr>
</tbody></table>
<h3><a class="header" href="#下载-1" id="下载-1">下载</a></h3>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="/web/clients/download.html#%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6%E5%88%B0%E4%B8%B4%E6%97%B6%E7%9B%AE%E5%BD%95">下载文件到临时目录</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/tempdir/"><img src="https://badge-cache.kominick.com/crates/v/tempdir.svg?label=tempdir" alt="tempdir-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a> <a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
<tr><td><a href="/web/clients/download.html#%E4%BD%BF%E7%94%A8-http-range-%E8%AF%B7%E6%B1%82%E5%A4%B4%E8%BF%9B%E8%A1%8C%E9%83%A8%E5%88%86%E4%B8%8B%E8%BD%BD">使用 HTTP range 请求头进行部分下载</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
<tr><td><a href="/web/clients/download.html#post-%E6%96%87%E4%BB%B6%E5%88%B0-paste-rs">POST 文件到 paste-rs</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#提取链接" id="提取链接">提取链接</a></h1>
<!--
> [web/scraping.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/scraping.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#从-html-网页中提取所有链接" id="从-html-网页中提取所有链接">从 HTML 网页中提取所有链接</a></h2>
<!--
> [web/scraping/extract-links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/scraping/extract-links.md)
> <br />
> commit dd4efa8dcd8e611326caa01c08db8f227aa909d6 - 2020.06.07
-->
<p><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/select/"><img src="https://badge-cache.kominick.com/crates/v/select.svg?label=select" alt="select-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></p>
<p>使用 <a href="https://docs.rs/reqwest/*/reqwest/fn.get.html"><code>reqwest::get</code></a> 执行 HTTP GET 请求，然后使用 <a href="https://docs.rs/select/*/select/document/struct.Document.html#method.from_read"><code>Document::from_read</code></a> 将响应信息解析为 HTML 文档。以“a”（锚元素）作为结构体 <a href="https://docs.rs/select/*/select/predicate/struct.Name.html"><code>Name</code></a> 的参数，将结构体 <a href="https://docs.rs/select/*/select/predicate/struct.Name.html"><code>Name</code></a> 作为条件，使用 <a href="https://docs.rs/select/*/select/document/struct.Document.html#method.find"><code>find</code></a> 方法检索所有链接。在结构体 <a href="https://docs.rs/select/*/select/selection/struct.Selection.html"><code>Selection</code></a> 上调用 <a href="https://doc.rust-lang.org/core/iter/trait.Iterator.html#method.filter_map"><code>filter_map</code></a> 方法，从具有 “href” <a href="https://docs.rs/select/*/select/node/struct.Node.html#method.attr"><code>attr</code></a>（属性）的链接检索所有 URL。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use error_chain::error_chain;
use select::document::Document;
use select::predicate::Name;

error_chain! {
      foreign_links {
          ReqError(reqwest::Error);
          IoError(std::io::Error);
      }
}

#[tokio::main]
async fn main() -&gt; Result&lt;()&gt; {
  let res = reqwest::get(&quot;https://www.rust-lang.org/en-US/&quot;)
    .await?
    .text()
    .await?;

  Document::from(res.as_str())
    .find(Name(&quot;a&quot;))
    .filter_map(|n| n.attr(&quot;href&quot;))
    .for_each(|x| println!(&quot;{}&quot;, x));

  Ok(())
}

</code></pre></pre>
<h2><a class="header" href="#检查网页死链" id="检查网页死链">检查网页死链</a></h2>
<!--
> [web/scraping/broken.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/scraping/broken.md)
> <br />
> commit 203b1085212a7b857d9a29bdc6a763515e77e0f9 - 2020.06.08
-->
<p><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/select/"><img src="https://badge-cache.kominick.com/crates/v/select.svg?label=select" alt="select-badge" /></a> <a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></p>
<p>调用 <code>get_base_url</code> 方法检索 <code>base URL</code>，如果 HTML 文档有 <code>base</code> 标签，从 <code>base</code> 标记获取 href <a href="https://docs.rs/select/*/select/node/struct.Node.html#method.attr"><code>attr</code></a>，初始 URL 的默认值是 <a href="https://docs.rs/url/*/url/enum.Position.html#variant.BeforePath"><code>Position::BeforePath</code></a>。</p>
<p>遍历 HTML 文档中的链接，并创建一个 <a href="https://docs.rs/tokio/*/tokio/fn.spawn.html"><code>tokio::spawn</code></a> 任务，该任务将使用 <a href="https://docs.rs/url/*/url/struct.ParseOptions.html"><code>url::ParseOptions</code></a> 结构体和 <a href="https://docs.rs/url/*/url/struct.Url.html#method.parse"><code>Url::parse</code></a> 方法解析单个链接。任务执行中，使用 <a href="https://docs.rs/reqwest/">reqwest</a> 向链接发起请求，并验证状态码结构体 <a href="https://docs.rs/reqwest/*/reqwest/struct.StatusCode.html"><code>StatusCode</code></a>。实例中使用 <code>await</code> 异步等待任务完成，然后结束程序。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use error_chain::error_chain;
use reqwest::StatusCode;
use select::document::Document;
use select::predicate::Name;
use std::collections::HashSet;
use url::{Position, Url};

error_chain! {
  foreign_links {
      ReqError(reqwest::Error);
      IoError(std::io::Error);
      UrlParseError(url::ParseError);
      JoinError(tokio::task::JoinError);
  }
}

async fn get_base_url(url: &amp;Url, doc: &amp;Document) -&gt; Result&lt;Url&gt; {
  let base_tag_href = doc.find(Name(&quot;base&quot;)).filter_map(|n| n.attr(&quot;href&quot;)).nth(0);
  let base_url =
    base_tag_href.map_or_else(|| Url::parse(&amp;url[..Position::BeforePath]), Url::parse)?;
  Ok(base_url)
}

async fn check_link(url: &amp;Url) -&gt; Result&lt;bool&gt; {
  let res = reqwest::get(url.as_ref()).await?;
  Ok(res.status() != StatusCode::NOT_FOUND)
}

#[tokio::main]
async fn main() -&gt; Result&lt;()&gt; {
  let url = Url::parse(&quot;https://www.rust-lang.org/en-US/&quot;)?;
  let res = reqwest::get(url.as_ref()).await?.text().await?;
  let document = Document::from(res.as_str());
  let base_url = get_base_url(&amp;url, &amp;document).await?;
  let base_parser = Url::options().base_url(Some(&amp;base_url));
  let links: HashSet&lt;Url&gt; = document
    .find(Name(&quot;a&quot;))
    .filter_map(|n| n.attr(&quot;href&quot;))
    .filter_map(|link| base_parser.parse(link).ok())
    .collect();
    let mut tasks = vec![];

    for link in links {
        tasks.push(tokio::spawn(async move {
            if check_link(&amp;link).await.unwrap() {
                println!(&quot;{} is OK&quot;, link);
            } else {
                println!(&quot;{} is Broken&quot;, link);
            }
        }));
    }

    for task in tasks {
        task.await?
    }

  Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#从-mediawiki-标记页面提取所有唯一性链接" id="从-mediawiki-标记页面提取所有唯一性链接">从 MediaWiki 标记页面提取所有唯一性链接</a></h2>
<!--
> [web/scraping/unique.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/scraping/unique.md)
> <br />
> commit dd4efa8dcd8e611326caa01c08db8f227aa909d6 - 2020.06.07
-->
<p><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/regex/"><img src="https://badge-cache.kominick.com/crates/v/regex.svg?label=regex" alt="regex-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></p>
<p>使用 <a href="https://docs.rs/reqwest/*/reqwest/fn.get.html"><code>reqwest::get</code></a> 获取 MediaWiki 页面的源代码，然后使用 <a href="https://docs.rs/regex/*/regex/struct.Regex.html#method.captures_iter"><code>Regex::captures_iter</code></a> 查找内部和外部链接的所有条目。使用智能指针 <a href="https://doc.rust-lang.org/std/borrow/enum.Cow.html"><code>Cow</code></a> 可以提供对借用数据的不可变引用，避免分配过多的<a href="https://doc.rust-lang.org/std/string/struct.String.html"><code>字符串</code></a>。</p>
<p>阅读 <a href="https://www.mediawiki.org/wiki/Help:Links">MediaWiki 链接语法</a>详细了解。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use lazy_static::lazy_static;
use regex::Regex;
use std::borrow::Cow;
use std::collections::HashSet;
use std::error::Error;

fn extract_links(content: &amp;str) -&gt; HashSet&lt;Cow&lt;str&gt;&gt; {
  lazy_static! {
    static ref WIKI_REGEX: Regex = Regex::new(
      r&quot;(?x)
                \[\[(?P&lt;internal&gt;[^\[\]|]*)[^\[\]]*\]\]    # internal links
                |
                (url=|URL\||\[)(?P&lt;external&gt;http.*?)[ \|}] # external links
            &quot;
    )
    .unwrap();
  }

  let links: HashSet&lt;_&gt; = WIKI_REGEX
    .captures_iter(content)
    .map(|c| match (c.name(&quot;internal&quot;), c.name(&quot;external&quot;)) {
      (Some(val), None) =&gt; Cow::from(val.as_str().to_lowercase()),
      (None, Some(val)) =&gt; Cow::from(val.as_str()),
      _ =&gt; unreachable!(),
    })
    .collect();

  links
}

#[tokio::main]
async fn main() -&gt; Result&lt;(), Box&lt;dyn Error&gt;&gt; {
  let content = reqwest::get(
    &quot;https://en.wikipedia.org/w/index.php?title=Rust_(programming_language)&amp;action=raw&quot;,
  )
  .await?
  .text()
  .await?;

  println!(&quot;{:#?}&quot;, extract_links(content.as_str()));

  Ok(())
}

</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#url-2" id="url-2">URL</a></h1>
<!--
> [web/url.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/url.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#解析-url-字符串为-url-类型" id="解析-url-字符串为-url-类型">解析 URL 字符串为 <code>Url</code> 类型</a></h2>
<!--
> [web/url/parse.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/url/parse.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></p>
<p><code>url</code> crate 中的 <a href="https://docs.rs/url/*/url/struct.Url.html#method.parse"><code>parse</code></a> 方法验证并解析 <code>&amp;str</code> 切片为 <a href="https://docs.rs/url/*/url/struct.Url.html"><code>Url</code></a> 结构体。如果输入字符串的格式不正确，解析方法 <a href="https://docs.rs/url/*/url/struct.Url.html#method.parse"><code>parse</code></a> 会返回 <code>Result&lt;Url, ParseError&gt;</code>。</p>
<p>一旦 URL 被解析，它就可以使用 <code>Url</code> 结构体类型中的所有方法。</p>
<pre><pre class="playground"><code class="language-rust edition2018">
use url::{Url, ParseError};

fn main() -&gt; Result&lt;(), ParseError&gt; {
    let s = &quot;https://github.com/rust-lang/rust/issues?labels=E-easy&amp;state=open&quot;;

    let parsed = Url::parse(s)?;
    println!(&quot;The path part of the URL is: {}&quot;, parsed.path());

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#通过移除路径段创建基本-url" id="通过移除路径段创建基本-url">通过移除路径段创建基本 URL</a></h2>
<!--
> [web/url/base.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/url/base.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></p>
<p>基本 URL（base URL）包括协议和域名。但基本 URL（base URL）不包括目录、文件或查询字符串，这些项都可以从给定的 URL 中剥离出来。创建基本 URL（base URL）时，通过 <a href="https://docs.rs/url/*/url/struct.PathSegmentsMut.html#method.clear"><code>PathSegmentsMut::clear</code></a> 方法移除目录和文件路径，通过方法 <a href="https://docs.rs/url/*/url/struct.Url.html#method.set_query"><code>Url::set_query</code></a> 移除查询字符串。</p>
<pre><pre class="playground"><code class="language-rust edition2018"><span class="boring">use error_chain::error_chain;
</span>
use url::Url;
<span class="boring">
</span><span class="boring">error_chain! {
</span><span class="boring">    foreign_links {
</span><span class="boring">        UrlParse(url::ParseError);
</span><span class="boring">    }
</span><span class="boring">    errors {
</span><span class="boring">        CannotBeABase
</span><span class="boring">    }
</span><span class="boring">}
</span>
fn main() -&gt; Result&lt;()&gt; {
    let full = &quot;https://github.com/rust-lang/cargo?asdf&quot;;

    let url = Url::parse(full)?;
    let base = base_url(url)?;

    assert_eq!(base.as_str(), &quot;https://github.com/&quot;);
    println!(&quot;The base of the URL is: {}&quot;, base);

    Ok(())
}

fn base_url(mut url: Url) -&gt; Result&lt;Url&gt; {
    match url.path_segments_mut() {
        Ok(mut path) =&gt; {
            path.clear();
        }
        Err(_) =&gt; {
            return Err(Error::from_kind(ErrorKind::CannotBeABase));
        }
    }

    url.set_query(None);

    Ok(url)
}
</code></pre></pre>
<h2><a class="header" href="#从基本-url-创建新-urls" id="从基本-url-创建新-urls">从基本 URL 创建新 URLs</a></h2>
<!--
> [web/url/new.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/url/new.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></p>
<p><a href="https://docs.rs/url/*/url/struct.Url.html#method.join"><code>join</code></a> 方法从基路径和相对路径创建新的 URL。</p>
<pre><pre class="playground"><code class="language-rust edition2018">
use url::{Url, ParseError};

fn main() -&gt; Result&lt;(), ParseError&gt; {
    let path = &quot;/rust-lang/cargo&quot;;

    let gh = build_github_url(path)?;

    assert_eq!(gh.as_str(), &quot;https://github.com/rust-lang/cargo&quot;);
    println!(&quot;The joined URL is: {}&quot;, gh);

    Ok(())
}

fn build_github_url(path: &amp;str) -&gt; Result&lt;Url, ParseError&gt; {
    const GITHUB: &amp;'static str = &quot;https://github.com&quot;;

    let base = Url::parse(GITHUB).expect(&quot;hardcoded URL is known to be valid&quot;);
    let joined = base.join(path)?;

    Ok(joined)
}
</code></pre></pre>
<h2><a class="header" href="#提取-url-源scheme--host--port" id="提取-url-源scheme--host--port">提取 URL 源（scheme / host / port）</a></h2>
<!--
> [web/url/origin.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/url/origin.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></p>
<p><a href="https://docs.rs/url/*/url/struct.Url.html"><code>Url</code></a> 结构体定义了多种方法，以便于提取有关它所表示的 URL 的信息。</p>
<pre><pre class="playground"><code class="language-rust edition2018">
use url::{Url, Host, ParseError};

fn main() -&gt; Result&lt;(), ParseError&gt; {
    let s = &quot;ftp://rust-lang.org/examples&quot;;

    let url = Url::parse(s)?;

    assert_eq!(url.scheme(), &quot;ftp&quot;);
    assert_eq!(url.host(), Some(Host::Domain(&quot;rust-lang.org&quot;)));
    assert_eq!(url.port_or_known_default(), Some(21));
    println!(&quot;The origin is as expected!&quot;);

    Ok(())
}
</code></pre></pre>
<p><a href="https://docs.rs/url/*/url/struct.Url.html#method.origin"><code>origin</code></a> 方法产生相同的结果。</p>
<pre><pre class="playground"><code class="language-rust edition2018"><span class="boring">use error_chain::error_chain;
</span>
use url::{Url, Origin, Host};

<span class="boring">error_chain! {
</span><span class="boring">    foreign_links {
</span><span class="boring">        UrlParse(url::ParseError);
</span><span class="boring">    }
</span><span class="boring">}
</span><span class="boring">
</span>fn main() -&gt; Result&lt;()&gt; {
    let s = &quot;ftp://rust-lang.org/examples&quot;;

    let url = Url::parse(s)?;

    let expected_scheme = &quot;ftp&quot;.to_owned();
    let expected_host = Host::Domain(&quot;rust-lang.org&quot;.to_owned());
    let expected_port = 21;
    let expected = Origin::Tuple(expected_scheme, expected_host, expected_port);

    let origin = url.origin();
    assert_eq!(origin, expected);
    println!(&quot;The origin is as expected!&quot;);

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#从-url-移除片段标识符和查询对" id="从-url-移除片段标识符和查询对">从 URL 移除片段标识符和查询对</a></h2>
<!--
> [web/url/fragment.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/url/fragment.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></p>
<p>解析 <a href="https://docs.rs/url/*/url/struct.Url.html"><code>Url</code></a> 结构体，并使用 <a href="https://docs.rs/url/*/url/enum.Position.html"><code>url::Position</code></a> 枚举对其进行切片，以去除不需要的 URL 片段。</p>
<pre><pre class="playground"><code class="language-rust edition2018">

use url::{Url, Position, ParseError};

fn main() -&gt; Result&lt;(), ParseError&gt; {
    let parsed = Url::parse(&quot;https://github.com/rust-lang/rust/issues?labels=E-easy&amp;state=open&quot;)?;
    let cleaned: &amp;str = &amp;parsed[..Position::AfterPath];
    println!(&quot;cleaned: {}&quot;, cleaned);
    Ok(())
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#媒介类型" id="媒介类型">媒介类型</a></h1>
<!--
> [web/mime.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/mime.md)
> <br />
> commit 4b1ed71d95da9620950c59963a585b2344e3fb37 - 2018.07.13
-->
<h2><a class="header" href="#从字符串获取-mime-类型" id="从字符串获取-mime-类型">从字符串获取 MIME 类型</a></h2>
<!--
> [web/mime/string.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/mime/string.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/mime/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=mime" alt="mime-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></p>
<p>下面的实例展示如何使用 <a href="https://docs.rs/mime/">mime</a> crate 从字符串解析出 <a href="https://docs.rs/mime/*/mime/struct.Mime.html"><code>MIME</code></a> 类型。<a href="https://docs.rs/mime/*/mime/struct.FromStrError.html"><code>FromStrError</code></a> 结构体在 <code>unwrap_or</code> 子句中生成默认的 <a href="https://docs.rs/mime/*/mime/struct.Mime.html"><code>MIME</code></a> 类型。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use mime::{Mime, APPLICATION_OCTET_STREAM};

fn main() {
    let invalid_mime_type = &quot;i n v a l i d&quot;;
    let default_mime = invalid_mime_type
        .parse::&lt;Mime&gt;()
        .unwrap_or(APPLICATION_OCTET_STREAM);

    println!(
        &quot;MIME for {:?} used default value {:?}&quot;,
        invalid_mime_type, default_mime
    );

    let valid_mime_type = &quot;TEXT/PLAIN&quot;;
    let parsed_mime = valid_mime_type
        .parse::&lt;Mime&gt;()
        .unwrap_or(APPLICATION_OCTET_STREAM);

    println!(
        &quot;MIME for {:?} was parsed as {:?}&quot;,
        valid_mime_type, parsed_mime
    );
}
</code></pre></pre>
<h2><a class="header" href="#从文件名获取-mime-类型" id="从文件名获取-mime-类型">从文件名获取 MIME 类型</a></h2>
<!--
> [web/mime/filename.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/mime/filename.md)
> <br />
> commit b61c8e588ad8445de36cd5f28e99232b5f858a41 - 2020.06.01
-->
<p><a href="https://docs.rs/mime/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=mime" alt="mime-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></p>
<p>下面的实例展示如何使用 <a href="https://docs.rs/mime/">mime</a> crate 从给定的文件名返回正确的 MIME 类型。程序将检查文件扩展名并与已知的 MIME 类型列表匹配，返回值为 <a href="https://docs.rs/mime/*/mime/struct.Mime.html"><code>mime:Mime</code></a>。</p>
<pre><pre class="playground"><code class="language-rust edition2018">use mime::Mime;

fn find_mimetype (filename : &amp;String) -&gt; Mime{

    let parts : Vec&lt;&amp;str&gt; = filename.split('.').collect();

    let res = match parts.last() {
            Some(v) =&gt;
                match *v {
                    &quot;png&quot; =&gt; mime::IMAGE_PNG,
                    &quot;jpg&quot; =&gt; mime::IMAGE_JPEG,
                    &quot;json&quot; =&gt; mime::APPLICATION_JSON,
                    &amp;_ =&gt; mime::TEXT_PLAIN,
                },
            None =&gt; mime::TEXT_PLAIN,
        };
    return res;
}

fn main() {
    let filenames = vec!(&quot;foobar.jpg&quot;, &quot;foo.bar&quot;, &quot;foobar.png&quot;);
    for file in filenames {
	    let mime = find_mimetype(&amp;file.to_owned());
	 	println!(&quot;MIME for {}: {}&quot;, file, mime);
	 }

}
</code></pre></pre>
<h2><a class="header" href="#解析-http-响应的-mime-类型" id="解析-http-响应的-mime-类型">解析 HTTP 响应的 MIME 类型</a></h2>
<!--
> [web/mime/request.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/mime/request.md)
> <br />
> commit dd4efa8dcd8e611326caa01c08db8f227aa909d6 - 2020.06.07
-->
<p><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/mime/"><img src="https://badge-cache.kominick.com/crates/v/csv.svg?label=mime" alt="mime-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></p>
<p>当从 <code>reqwest</code> 接收到 HTTP 响应时，<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types">MIME 类型</a>或媒体类型可以在实体头部的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type">Content-Type</a> 标头中找到。<a href="https://docs.rs/reqwest/*/reqwest/header/struct.HeaderMap.html#method.get"><code>reqwest::header::HeaderMap::get</code></a> 方法将标头检索为结构体 <a href="https://docs.rs/reqwest/*/reqwest/header/struct.HeaderValue.html"><code>reqwest::header::HeaderValue</code></a>，结构体可以转换为字符串。然后 <code>mime</code> crate 可以解析它，生成 <a href="https://docs.rs/mime/*/mime/struct.Mime.html"><code>mime::Mime</code></a> 值。</p>
<p><a href="https://docs.rs/mime/*/mime/struct.Mime.html"><code>mime</code></a> crate 也定义了一些常用的 MIME 类型。</p>
<p>请注意：<a href="https://docs.rs/reqwest/*/reqwest/header/index.html"><code>reqwest::header</code></a> 模块是从 <a href="https://docs.rs/http/*/http/"><code>http</code></a> crate 导出的。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use error_chain::error_chain;
use mime::Mime;
use std::str::FromStr;
use reqwest::header::CONTENT_TYPE;

 error_chain! {
    foreign_links {
        Reqwest(reqwest::Error);
        Header(reqwest::header::ToStrError);
        Mime(mime::FromStrError);
    }
 }

#[tokio::main]
async fn main() -&gt; Result&lt;()&gt; {
    let response = reqwest::get(&quot;https://www.rust-lang.org/logos/rust-logo-32x32.png&quot;).await?;
    let headers = response.headers();

    match headers.get(CONTENT_TYPE) {
        None =&gt; {
            println!(&quot;The response does not contain a Content-Type header.&quot;);
        }
        Some(content_type) =&gt; {
            let content_type = Mime::from_str(content_type.to_str()?)?;
            let media_type = match (content_type.type_(), content_type.subtype()) {
                (mime::TEXT, mime::HTML) =&gt; &quot;a HTML document&quot;,
                (mime::TEXT, _) =&gt; &quot;a text document&quot;,
                (mime::IMAGE, mime::PNG) =&gt; &quot;a PNG image&quot;,
                (mime::IMAGE, _) =&gt; &quot;an image&quot;,
                _ =&gt; &quot;neither text nor image&quot;,
            };

            println!(&quot;The reponse contains {}.&quot;, media_type);
        }
    };

    Ok(())
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h2><a class="header" href="#客户端-2" id="客户端-2">客户端</a></h2>
<!--
> [web/clients.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/clients.md)
> <br />
> commit dd4efa8dcd8e611326caa01c08db8f227aa909d6 - 2020.06.07
-->
<h3><a class="header" href="#请求处理-2" id="请求处理-2">请求处理</a></h3>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="web//web/clients/requests.html#%E5%8F%91%E5%87%BA-http-get-%E8%AF%B7%E6%B1%82">发出 HTTP GET 请求</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
<tr><td><a href="web//web/clients/requests.html#%E4%B8%BA-rest-%E8%AF%B7%E6%B1%82%E8%AE%BE%E7%BD%AE%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B6%88%E6%81%AF%E6%A0%87%E5%A4%B4%E5%92%8C-url-%E5%8F%82%E6%95%B0">为 REST 请求设置自定义消息标头和 URL 参数</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/hyper/"><img src="https://badge-cache.kominick.com/crates/v/hyper.svg?label=hyper" alt="hyper-badge" /></a> <a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td><td></td></tr>
</tbody></table>
<h3><a class="header" href="#web-api-调用-2" id="web-api-调用-2">Web API 调用</a></h3>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="web//web/clients/apis.html#%E6%9F%A5%E8%AF%A2-github-api">查询 GitHub API</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/serde/"><img src="https://badge-cache.kominick.com/crates/v/serde.svg?label=serde" alt="serde-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="web//web/clients/apis.html#%E6%A3%80%E6%9F%A5-api-%E8%B5%84%E6%BA%90%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8">检查 API 资源是否存在</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
<tr><td><a href="web//web/clients/apis.html#%E4%BD%BF%E7%94%A8-github-api-%E5%88%9B%E5%BB%BA%E5%92%8C%E5%88%A0%E9%99%A4-gist">使用 GitHub API 创建和删除 Gist</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/serde/"><img src="https://badge-cache.kominick.com/crates/v/serde.svg?label=serde" alt="serde-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="web//web/clients/apis.html#%E4%BD%BF%E7%94%A8-restful-api-%E5%88%86%E9%A1%B5">使用 RESTful API 分页</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/serde/"><img src="https://badge-cache.kominick.com/crates/v/serde.svg?label=serde" alt="serde-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></td></tr>
<tr><td><a href="web//web/clients/apis.html#%E5%A4%84%E7%90%86%E9%80%9F%E7%8E%87%E5%8F%97%E9%99%90-api">处理速率受限 API</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/hyper/"><img src="https://badge-cache.kominick.com/crates/v/hyper.svg?label=hyper" alt="hyper-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td><td></td></tr>
</tbody></table>
<h3><a class="header" href="#下载-2" id="下载-2">下载</a></h3>
<table><thead><tr><th>实例名称</th><th>Crates</th><th>类别</th></tr></thead><tbody>
<tr><td><a href="web//web/clients/download.html#%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6%E5%88%B0%E4%B8%B4%E6%97%B6%E7%9B%AE%E5%BD%95">下载文件到临时目录</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/tempdir/"><img src="https://badge-cache.kominick.com/crates/v/tempdir.svg?label=tempdir" alt="tempdir-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a> <a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></td></tr>
<tr><td><a href="web//web/clients/download.html#%E4%BD%BF%E7%94%A8-http-range-%E8%AF%B7%E6%B1%82%E5%A4%B4%E8%BF%9B%E8%A1%8C%E9%83%A8%E5%88%86%E4%B8%8B%E8%BD%BD">使用 HTTP range 请求头进行部分下载</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
<tr><td><a href="web//web/clients/download.html#post-%E6%96%87%E4%BB%B6%E5%88%B0-paste-rs">POST 文件到 paste-rs</a></td><td><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a></td><td><a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></td></tr>
</tbody></table>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#请求处理-3" id="请求处理-3">请求处理</a></h1>
<!--
> [web/clients/requests.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/clients/requests.md)
> <br />
> commit 254ee9bf430590b6dfc88b00934fcf226ef883e8 - 2018.07.12
-->
<h2><a class="header" href="#发出-http-get-请求" id="发出-http-get-请求">发出 HTTP GET 请求</a></h2>
<!--
> [web/clients/requests/get.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/clients/requests/get.md)
> <br />
> commit 6fe24cb266ca8c71c482fabcc4b3f7c7982438dc - 2020.12.18
-->
<p><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></p>
<p>解析提供的 URL，并使用 <a href="https://docs.rs/reqwest/*/reqwest/blocking/fn.get.html"><code>reqwest::blocking::get</code></a> 发起同步 HTTP GET 请求。打印获取的响应消息状态和标头 <a href="https://docs.rs/reqwest/*/reqwest/blocking/struct.Response.html"><code>reqwest::blocking::Response</code></a>。使用 <a href="https://doc.rust-lang.org/std/io/trait.Read.html#method.read_to_string"><code>read_to_string</code></a> 将 HTTP 响应消息主体正文读入到指派的字符串 <a href="https://doc.rust-lang.org/std/string/struct.String.html"><code>String</code></a>。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use error_chain::error_chain;
use std::io::Read;

error_chain! {
    foreign_links {
        Io(std::io::Error);
        HttpRequest(reqwest::Error);
    }
}

fn main() -&gt; Result&lt;()&gt; {
    let mut res = reqwest::blocking::get(&quot;http://httpbin.org/get&quot;)?;
    let mut body = String::new();
    res.read_to_string(&amp;mut body)?;

    println!(&quot;Status: {}&quot;, res.status());
    println!(&quot;Headers:\n{:#?}&quot;, res.headers());
    println!(&quot;Body:\n{}&quot;, body);

    Ok(())
}

</code></pre></pre>
<h3><a class="header" href="#异步" id="异步">异步</a></h3>
<p>常见的方法是通过包含 <a href="https://docs.rs/crate/tokio/0.2.11"><code>tokio</code></a> 在内的类似异步执行器，使主函数执行异步，但检索处理相同的信息。</p>
<p>本实例中，<a href="https://tokio.rs/tokio/tutorial/hello-tokio#the-code"><code>tokio::main</code></a> 处理所有繁重的执行器设置，并允许在 <code>.await</code> 之前不阻塞的按顺序执行代码。</p>
<p>也可以使用 <a href="https://docs.rs/crate/reqwest/0.10.8">reqwest</a> 的异步版本，其请求函数 <a href="https://docs.rs/reqwest/*/reqwest/fn.get.html"><code>reqwest::get</code></a> 和响应结构体 <a href="https://docs.rs/reqwest/*/reqwest/struct.Response.html"><code>reqwest::Response</code></a> 都是异步的。</p>
<pre><pre class="playground"><code class="language-rust no_run">use error_chain::error_chain;

error_chain! {
    foreign_links {
        Io(std::io::Error);
        HttpRequest(reqwest::Error);
    }
}

#[tokio::main]
async fn main() -&gt; Result&lt;()&gt; {
    let res = reqwest::get(&quot;http://httpbin.org/get&quot;).await?;
    println!(&quot;Status: {}&quot;, res.status());
    println!(&quot;Headers:\n{:#?}&quot;, res.headers());

    let body = res.text().await?;
    println!(&quot;Body:\n{}&quot;, body);
    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#为-rest-请求设置自定义消息标头和-url-参数" id="为-rest-请求设置自定义消息标头和-url-参数">为 REST 请求设置自定义消息标头和 URL 参数</a></h2>
<!--
> [web/clients/requests/header.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/clients/requests/header.md)
> <br />
> commit 203b1085212a7b857d9a29bdc6a763515e77e0f9 - 2020.06.08
-->
<p><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/hyper/"><img src="https://badge-cache.kominick.com/crates/v/hyper.svg?label=hyper" alt="hyper-badge" /></a> <a href="https://docs.rs/url/"><img src="https://badge-cache.kominick.com/crates/v/url.svg?label=url" alt="url-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></p>
<p>本实例中为 HTTP GET 请求设置标准的和自定义的 HTTP 消息标头以及 URL 参数。使用 <a href="https://doc.servo.org/hyper/macro.header.html"><code>hyper::header!</code></a> 宏创建 <code>XPoweredBy</code> 类型的自定义消息标头。</p>
<p>使用 <a href="https://docs.rs/url/*/url/struct.Url.html#method.parse_with_params"><code>Url::parse_with_params</code></a> 构建复杂的 URL。使用 <a href="https://docs.rs/reqwest/*/reqwest/struct.RequestBuilder.html#method.header"><code>RequestBuilder::header</code></a> 方法设置标准消息标头 <a href="https://doc.servo.org/hyper/header/struct.UserAgent.html"><code>header::UserAgent</code></a>、<a href="https://doc.servo.org/hyper/header/struct.Authorization.html"><code>header::Authorization</code></a>，以及自定义类型 <code>XPoweredBy</code>，然后使用 <a href="https://docs.rs/reqwest/*/reqwest/struct.RequestBuilder.html#method.send"><code>RequestBuilder::send</code></a> 发起请求。</p>
<p>请求的服务目标为 <a href="http://httpbin.org/headers">http://httpbin.org/headers</a>，其响应结果是包含所有请求的消息标头的 JSON 字典，易于验证。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run"><span class="boring">use error_chain::error_chain;
</span>use serde::Deserialize;

use std::collections::HashMap;
use url::Url;
use reqwest::Client;
use reqwest::header::{UserAgent, Authorization, Bearer};

header! { (XPoweredBy, &quot;X-Powered-By&quot;) =&gt; [String] }

#[derive(Deserialize, Debug)]
pub struct HeadersEcho {
    pub headers: HashMap&lt;String, String&gt;,
}
<span class="boring">
</span><span class="boring">error_chain! {
</span><span class="boring">    foreign_links {
</span><span class="boring">        Reqwest(reqwest::Error);
</span><span class="boring">        UrlParse(url::ParseError);
</span><span class="boring">    }
</span><span class="boring">}
</span>
fn main() -&gt; Result&lt;()&gt; {
    let url = Url::parse_with_params(&quot;http://httpbin.org/headers&quot;,
                                     &amp;[(&quot;lang&quot;, &quot;rust&quot;), (&quot;browser&quot;, &quot;servo&quot;)])?;

    let mut response = Client::new()
        .get(url)
        .header(UserAgent::new(&quot;Rust-test&quot;))
        .header(Authorization(Bearer { token: &quot;DEadBEEfc001cAFeEDEcafBAd&quot;.to_owned() }))
        .header(XPoweredBy(&quot;Guybrush Threepwood&quot;.to_owned()))
        .send()?;

    let out: HeadersEcho = response.json()?;
    assert_eq!(out.headers[&quot;Authorization&quot;],
               &quot;Bearer DEadBEEfc001cAFeEDEcafBAd&quot;);
    assert_eq!(out.headers[&quot;User-Agent&quot;], &quot;Rust-test&quot;);
    assert_eq!(out.headers[&quot;X-Powered-By&quot;], &quot;Guybrush Threepwood&quot;);
    assert_eq!(response.url().as_str(),
               &quot;http://httpbin.org/headers?lang=rust&amp;browser=servo&quot;);

    println!(&quot;{:?}&quot;, out);
    Ok(())
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#web-api-调用-3" id="web-api-调用-3">Web API 调用</a></h1>
<!--
> [web/clients/apis.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/clients/apis.md)
> <br />
> commit 67329add00792d6cfc04b5d4cfb073a5fb12ba53 - 2020.06.14
-->
<h2><a class="header" href="#查询-github-api" id="查询-github-api">查询 GitHub API</a></h2>
<!--
> [web/clients/api/rest-get.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/clients/api/rest-get.md)
> <br />
> commit dd4efa8dcd8e611326caa01c08db8f227aa909d6 - 2020.06.07
-->
<p><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/serde/"><img src="https://badge-cache.kominick.com/crates/v/serde.svg?label=serde" alt="serde-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></p>
<p>使用 <a href="https://docs.rs/reqwest/*/reqwest/fn.get.html"><code>reqwest::get</code></a> 查询 <a href="https://docs.github.com/cn/free-pro-team@latest/rest/reference/activity#list-stargazers">点赞的用户 API v3</a>，以获取某个 GitHub 项目的所有点赞用户的列表。使用 <a href="https://docs.rs/reqwest/*/reqwest/struct.Response.html#method.json"><code>Response::json</code></a> 将响应信息 <a href="https://docs.rs/reqwest/*/reqwest/struct.Response.html"><code>reqwest::Response</code></a> 反序列化为实现了 <a href="https://docs.rs/serde/*/serde/trait.Deserialize.html"><code>serde::Deserialize</code></a> trait 的 <code>User</code> 对象。</p>
<p><a href="https://docs.rs/tokio/0.2.22/tokio/attr.main.html">tokio::main</a> 用于设置异步执行器，该进程异步等待 <a href="https://docs.rs/reqwest/*/reqwest/fn.get.html"><code>reqwest::get</code></a> 完成，然后将响应信息反序列化到用户实例中。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use serde::Deserialize;
use reqwest::Error;

#[derive(Deserialize, Debug)]
struct User {
    login: String,
    id: u32,
}

#[tokio::main]
async fn main() -&gt; Result&lt;(), Error&gt; {
    let request_url = format!(&quot;https://api.github.com/repos/{owner}/{repo}/stargazers&quot;,
                              owner = &quot;rust-lang-nursery&quot;,
                              repo = &quot;rust-cookbook&quot;);
    println!(&quot;{}&quot;, request_url);
    let response = reqwest::get(&amp;request_url).await?;

    let users: Vec&lt;User&gt; = response.json().await?;
    println!(&quot;{:?}&quot;, users);
    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#检查-api-资源是否存在" id="检查-api-资源是否存在">检查 API 资源是否存在</a></h2>
<!--
> [web/clients/api/rest-head.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/clients/api/rest-head.md)
> <br />
> commit 67329add00792d6cfc04b5d4cfb073a5fb12ba53 - 2020.06.14
-->
<p><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></p>
<p>使用消息标头 HEAD 请求（(<a href="https://docs.rs/reqwest/*/reqwest/struct.Client.html#method.head"><code>Client::head</code></a>）查询 GitHub 用户端接口，然后检查响应代码以确定是否成功。这是一种无需接收 HTTP 响应消息主体，即可快速查询 rest 资源的方法。使用 <a href="https://docs.rs/reqwest/*/reqwest/struct.ClientBuilder.html#method.timeout"><code>ClientBuilder::timeout</code></a> 方法配置的 <a href="https://docs.rs/reqwest/*/reqwest/struct.Client.html"><code>reqwest::Client</code></a> 结构体将确保请求不会超时。</p>
<p>由于 <a href="https://docs.rs/reqwest/*/reqwest/struct.ClientBuilder.html#method.build"><code>ClientBuilder::build</code></a> 和 <a href="https://docs.rs/reqwest/*/reqwest/struct.RequestBuilder.html#method.send"><code>RequestBuilder::send</code></a> 都返回错误类型 <a href="https://docs.rs/reqwest/*/reqwest/struct.Error.html"><code>reqwest::Error</code></a>，所以便捷的 <a href="https://docs.rs/reqwest/*/reqwest/type.Result.html"><code>reqwest::Result</code></a> 类型被用于主函数的返回类型。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use reqwest::Result;
use std::time::Duration;
use reqwest::ClientBuilder;

#[tokio::main]
async fn main() -&gt; Result&lt;()&gt; {
    let user = &quot;ferris-the-crab&quot;;
    let request_url = format!(&quot;https://api.github.com/users/{}&quot;, user);
    println!(&quot;{}&quot;, request_url);

    let timeout = Duration::new(5, 0);
    let client = ClientBuilder::new().timeout(timeout).build()?;
    let response = client.head(&amp;request_url).send().await?;

    if response.status().is_success() {
        println!(&quot;{} is a user!&quot;, user);
    } else {
        println!(&quot;{} is not a user!&quot;, user);
    }

    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#使用-github-api-创建和删除-gist" id="使用-github-api-创建和删除-gist">使用 GitHub API 创建和删除 Gist</a></h2>
<!--
> [web/clients/api/rest-post.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/clients/api/rest-post.md)
> <br />
> commit dd4efa8dcd8e611326caa01c08db8f227aa909d6 - 2020.06.07
-->
<p><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/serde/"><img src="https://badge-cache.kominick.com/crates/v/serde.svg?label=serde" alt="serde-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></p>
<p>使用 <a href="https://docs.rs/reqwest/*/reqwest/struct.Client.html#method.post"><code>Client::post</code></a> 创建一个 POST 请求提交到 GitHub <a href="https://docs.github.com/cn/free-pro-team@latest/rest/reference/gists">gists API v3</a> 接口的 gist，并使用 <a href="https://docs.rs/reqwest/*/reqwest/struct.Client.html#method.delete"><code>Client::delete</code></a> 使用 DELETE 请求删除它。</p>
<p><a href="https://docs.rs/reqwest/*/reqwest/struct.Client.html"><code>reqwest::Client</code></a> 负责这两个请求的详细信息，包括：URL、消息体（body）和身份验证。<a href="https://docs.rs/serde_json/*/serde_json/macro.json.html"><code>serde_json::json!</code></a> 宏的 POST 主体可以提供任意形式的 JSON 主体，通过调用 <a href="https://docs.rs/reqwest/*/reqwest/struct.RequestBuilder.html#method.json"><code>RequestBuilder::json</code></a> 设置请求主体，<a href="https://docs.rs/reqwest/*/reqwest/struct.RequestBuilder.html#method.basic_auth"><code>RequestBuilder::basic_auth</code></a> 处理身份验证。本实例中调用 <a href="https://docs.rs/reqwest/*/reqwest/struct.RequestBuilder.html#method.send"><code>RequestBuilder::send</code></a> 方法同步执行请求。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use error_chain::error_chain;
use serde::Deserialize;
use serde_json::json;
use std::env;
use reqwest::Client;

error_chain! {
    foreign_links {
        EnvVar(env::VarError);
        HttpRequest(reqwest::Error);
    }
}

#[derive(Deserialize, Debug)]
struct Gist {
    id: String,
    html_url: String,
}

#[tokio::main]
async fn main() -&gt;  Result&lt;()&gt; {
    let gh_user = env::var(&quot;GH_USER&quot;)?;
    let gh_pass = env::var(&quot;GH_PASS&quot;)?;

    let gist_body = json!({
        &quot;description&quot;: &quot;the description for this gist&quot;,
        &quot;public&quot;: true,
        &quot;files&quot;: {
             &quot;main.rs&quot;: {
             &quot;content&quot;: r#&quot;fn main() { println!(&quot;hello world!&quot;);}&quot;#
            }
        }});

    let request_url = &quot;https://api.github.com/gists&quot;;
    let response = Client::new()
        .post(request_url)
        .basic_auth(gh_user.clone(), Some(gh_pass.clone()))
        .json(&amp;gist_body)
        .send().await?;

    let gist: Gist = response.json().await?;
    println!(&quot;Created {:?}&quot;, gist);

    let request_url = format!(&quot;{}/{}&quot;,request_url, gist.id);
    let response = Client::new()
        .delete(&amp;request_url)
        .basic_auth(gh_user, Some(gh_pass))
        .send().await?;

    println!(&quot;Gist {} deleted! Status code: {}&quot;,gist.id, response.status());
    Ok(())
}
</code></pre></pre>
<p>实例中使用 <a href="https://tools.ietf.org/html/rfc2617">HTTP 基本认证</a> 为了授权访问 <a href="https://docs.github.com/cn/free-pro-team@latest/rest/overview/other-authentication-methods">GitHub API</a>。实际应用中或许将使用一个更为复杂的 <a href="https://oauth.net/getting-started/">OAuth</a> 授权流程。</p>
<h2><a class="header" href="#使用-restful-api-分页" id="使用-restful-api-分页">使用 RESTful API 分页</a></h2>
<!--
> [web/clients/api/paginated.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/clients/api/paginated.md)
> <br />
> commit dd4efa8dcd8e611326caa01c08db8f227aa909d6 - 2020.06.07
-->
<p><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/serde/"><img src="https://badge-cache.kominick.com/crates/v/serde.svg?label=serde" alt="serde-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a> <a href="https://crates.io/categories/encoding"><img src="https://badge-cache.kominick.com/badge/encoding--x.svg?style=social" alt="cat-encoding-badge" /></a></p>
<p>可以将分页的 web API 方便地包裹在 Rust 迭代器中，当到达每一页的末尾时，迭代器会从远程服务器加载下一页结果。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use reqwest::Result;
use serde::Deserialize;

#[derive(Deserialize)]
struct ApiResponse {
    dependencies: Vec&lt;Dependency&gt;,
    meta: Meta,
}

#[derive(Deserialize)]
struct Dependency {
    crate_id: String,
}

#[derive(Deserialize)]
struct Meta {
    total: u32,
}

struct ReverseDependencies {
    crate_id: String,
    dependencies: &lt;Vec&lt;Dependency&gt; as IntoIterator&gt;::IntoIter,
    client: reqwest::blocking::Client,
    page: u32,
    per_page: u32,
    total: u32,
}

impl ReverseDependencies {
    fn of(crate_id: &amp;str) -&gt; Result&lt;Self&gt; {
        Ok(ReverseDependencies {
               crate_id: crate_id.to_owned(),
               dependencies: vec![].into_iter(),
               client: reqwest::blocking::Client::new(),
               page: 0,
               per_page: 100,
               total: 0,
           })
    }

    fn try_next(&amp;mut self) -&gt; Result&lt;Option&lt;Dependency&gt;&gt; {
        if let Some(dep) = self.dependencies.next() {
            return Ok(Some(dep));
        }

        if self.page &gt; 0 &amp;&amp; self.page * self.per_page &gt;= self.total {
            return Ok(None);
        }

        self.page += 1;
        let url = format!(&quot;https://crates.io/api/v1/crates/{}/reverse_dependencies?page={}&amp;per_page={}&quot;,
                          self.crate_id,
                          self.page,
                          self.per_page);

        let response = self.client.get(&amp;url).send()?.json::&lt;ApiResponse&gt;()?;
        self.dependencies = response.dependencies.into_iter();
        self.total = response.meta.total;
        Ok(self.dependencies.next())
    }
}

impl Iterator for ReverseDependencies {
    type Item = Result&lt;Dependency&gt;;

    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt; {
        match self.try_next() {
            Ok(Some(dep)) =&gt; Some(Ok(dep)),
            Ok(None) =&gt; None,
            Err(err) =&gt; Some(Err(err)),
        }
    }
}

fn main() -&gt; Result&lt;()&gt; {
    for dep in ReverseDependencies::of(&quot;serde&quot;)? {
        println!(&quot;reverse dependency: {}&quot;, dep?.crate_id);
    }
    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#处理速率受限-api" id="处理速率受限-api">处理速率受限 API</a></h2>
<!--
> [web/clients/api/rate-limited.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/clients/api/rate-limited.md)
> <br />
> commit 203b1085212a7b857d9a29bdc6a763515e77e0f9 - 2020.06.08
-->
<p><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/hyper/"><img src="https://badge-cache.kominick.com/crates/v/hyper.svg?label=hyper" alt="hyper-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></p>
<p>此实例使用 <a href="https://docs.github.com/cn/free-pro-team@latest/rest/reference/rate-limit">GitHub API - 速率限制</a>展示如何处理远程服务器错误。本实例使用 <a href="https://doc.servo.org/hyper/header/index.html#defining-custom-headers"><code>hyper::header!</code></a> 宏来解析响应头并检查 <a href="https://docs.rs/reqwest/*/reqwest/struct.StatusCode.html#associatedconstant.FORBIDDEN"><code>reqwest::StatusCode::Forbidden</code></a>。如果响应超过速率限制，则将等待并重试。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run"><span class="boring">use error_chain::error_chain;
</span>
use std::time::{Duration, UNIX_EPOCH};
use std::thread;
use reqwest::StatusCode;
<span class="boring">
</span><span class="boring">error_chain! {
</span><span class="boring">   foreign_links {
</span><span class="boring">       Io(std::io::Error);
</span><span class="boring">       Time(std::time::SystemTimeError);
</span><span class="boring">       Reqwest(reqwest::Error);
</span><span class="boring">   }
</span><span class="boring">}
</span>
header! { (XRateLimitLimit, &quot;X-RateLimit-Limit&quot;) =&gt; [usize] }
header! { (XRateLimitRemaining, &quot;X-RateLimit-Remaining&quot;) =&gt; [usize] }
header! { (XRateLimitReset, &quot;X-RateLimit-Reset&quot;) =&gt; [u64] }

fn main() -&gt; Result&lt;()&gt; {
    loop {
        let url = &quot;https://api.github.com/users/rust-lang-nursery &quot;;
        let client = reqwest::Client::new();
        let response = client.get(url).send()?;

        let rate_limit = response.headers().get::&lt;XRateLimitLimit&gt;().ok_or(
            &quot;response doesn't include the expected X-RateLimit-Limit header&quot;,
        )?;

        let rate_remaining = response.headers().get::&lt;XRateLimitRemaining&gt;().ok_or(
            &quot;response doesn't include the expected X-RateLimit-Remaining header&quot;,
        )?;

        let rate_reset_at = response.headers().get::&lt;XRateLimitReset&gt;().ok_or(
            &quot;response doesn't include the expected X-RateLimit-Reset header&quot;,
        )?;

        let rate_reset_within = Duration::from_secs(**rate_reset_at) - UNIX_EPOCH.elapsed()?;

        if response.status() == StatusCode::Forbidden &amp;&amp; **rate_remaining == 0 {
            println!(&quot;Sleeping for {} seconds.&quot;, rate_reset_within.as_secs());
            thread::sleep(rate_reset_within);
            return main();
        } else {
            println!(
                &quot;Rate limit is currently {}/{}, the reset of this limit will be within {} seconds.&quot;,
                **rate_remaining,
                **rate_limit,
                rate_reset_within.as_secs(),
            );
            break;
        }
    }
    Ok(())
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->
<h1><a class="header" href="#下载-3" id="下载-3">下载</a></h1>
<!--
> [web/clients/download.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/clients/download.md)
> <br />
> commit 97dabe59ae705bf6a2aaebbcd1d189ec2a83f98b - 2018.07.11
-->
<h2><a class="header" href="#下载文件到临时目录" id="下载文件到临时目录">下载文件到临时目录</a></h2>
<!--
> [web/clients/download/basic.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/clients/download/basic.md)
> <br />
> commit dd4efa8dcd8e611326caa01c08db8f227aa909d6 - 2020.06.07
-->
<p><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://docs.rs/tempdir/"><img src="https://badge-cache.kominick.com/crates/v/tempdir.svg?label=tempdir" alt="tempdir-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a> <a href="https://crates.io/categories/filesystem"><img src="https://badge-cache.kominick.com/badge/filesystem--x.svg?style=social" alt="cat-filesystem-badge" /></a></p>
<p>使用 <a href="https://docs.rs/tempfile/*/tempfile/struct.Builder.html"><code>tempfile::Builder</code></a> 创建一个临时目录，并使用 <a href="https://docs.rs/reqwest/*/reqwest/fn.get.html"><code>reqwest::get</code></a> 通过 HTTP 协议异步下载文件。</p>
<p>使用 <a href="https://docs.rs/reqwest/*/reqwest/struct.Response.html#method.url"><code>Response::url</code></a> 方法内部的 <a href="https://docs.rs/tempfile/3.1.0/tempfile/struct.Builder.html#method.tempdir"><code>tempdir()</code></a> 方法获取文件名字，使用  <a href="https://doc.rust-lang.org/std/fs/struct.File.html"><code>File</code></a>  结构体创建目标文件，并使用 <a href="https://doc.rust-lang.org/std/io/fn.copy.html"><code>io::copy</code></a> 将下载的数据复制到文件中。程序退出时，会自动删除临时目录。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use error_chain::error_chain;
use std::io::copy;
use std::fs::File;
use tempfile::Builder;

error_chain! {
     foreign_links {
         Io(std::io::Error);
         HttpRequest(reqwest::Error);
     }
}

#[tokio::main]
async fn main() -&gt; Result&lt;()&gt; {
    let tmp_dir = Builder::new().prefix(&quot;example&quot;).tempdir()?;
    let target = &quot;https://www.rust-lang.org/logos/rust-logo-512x512.png&quot;;
    let response = reqwest::get(target).await?;

    let mut dest = {
        let fname = response
            .url()
            .path_segments()
            .and_then(|segments| segments.last())
            .and_then(|name| if name.is_empty() { None } else { Some(name) })
            .unwrap_or(&quot;tmp.bin&quot;);

        println!(&quot;file to download: '{}'&quot;, fname);
        let fname = tmp_dir.path().join(fname);
        println!(&quot;will be located under: '{:?}'&quot;, fname);
        File::create(fname)?
    };
    let content =  response.text().await?;
    copy(&amp;mut content.as_bytes(), &amp;mut dest)?;
    Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#使用-http-range-请求头进行部分下载" id="使用-http-range-请求头进行部分下载">使用 HTTP range 请求头进行部分下载</a></h2>
<!--
> [web/clients/download/partial.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/clients/download/partial.md)
> <br />
> commit dd4efa8dcd8e611326caa01c08db8f227aa909d6 - 2020.06.07
-->
<p><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></p>
<p>使用 <a href="https://docs.rs/reqwest/*/reqwest/blocking/struct.Client.html#method.head"><code>reqwest::blocking::Client::head</code></a> 获取响应的<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Length">消息主体的大小</a>（即消息主体内容长度）。</p>
<p>然后，使用 <a href="https://docs.rs/reqwest/*/reqwest/blocking/struct.Client.html#method.get"><code>reqwest::blocking::Client::get</code></a> 下载 10240 字节的内容，同时打印进度消息。本实例使用同步的 reqwest 模块，<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Range">消息范围</a>标头指定响应的消息块大小和位置。</p>
<p><a href="https://tools.ietf.org/html/rfc7233#section-3.1">RFC7233</a> 中定义了<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Range">消息范围</a>标头。</p>
<blockquote>
<p>译者注：RFC（Request For Comments）是一系列以编号排定的文件。文件收集了有关互联网相关信息，以及 UNIX 和互联网社区的软件文件。</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use error_chain::error_chain;
use reqwest::header::{HeaderValue, CONTENT_LENGTH, RANGE};
use reqwest::StatusCode;
use std::fs::File;
use std::str::FromStr;

error_chain! {
    foreign_links {
        Io(std::io::Error);
        Reqwest(reqwest::Error);
        Header(reqwest::header::ToStrError);
    }
}

struct PartialRangeIter {
  start: u64,
  end: u64,
  buffer_size: u32,
}

impl PartialRangeIter {
  pub fn new(start: u64, end: u64, buffer_size: u32) -&gt; Result&lt;Self&gt; {
    if buffer_size == 0 {
      Err(&quot;invalid buffer_size, give a value greater than zero.&quot;)?;
    }
    Ok(PartialRangeIter {
      start,
      end,
      buffer_size,
    })
  }
}

impl Iterator for PartialRangeIter {
  type Item = HeaderValue;
  fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt; {
    if self.start &gt; self.end {
      None
    } else {
      let prev_start = self.start;
      self.start += std::cmp::min(self.buffer_size as u64, self.end - self.start + 1);
      Some(HeaderValue::from_str(&amp;format!(&quot;bytes={}-{}&quot;, prev_start, self.start - 1)).expect(&quot;string provided by format!&quot;))
    }
  }
}

fn main() -&gt; Result&lt;()&gt; {
  let url = &quot;https://httpbin.org/range/102400?duration=2&quot;;
  const CHUNK_SIZE: u32 = 10240;
    
  let client = reqwest::blocking::Client::new();
  let response = client.head(url).send()?;
  let length = response
    .headers()
    .get(CONTENT_LENGTH)
    .ok_or(&quot;response doesn't include the content length&quot;)?;
  let length = u64::from_str(length.to_str()?).map_err(|_| &quot;invalid Content-Length header&quot;)?;
    
  let mut output_file = File::create(&quot;download.bin&quot;)?;
    
  println!(&quot;starting download...&quot;);
  for range in PartialRangeIter::new(0, length - 1, CHUNK_SIZE)? {
    println!(&quot;range {:?}&quot;, range);
    let mut response = client.get(url).header(RANGE, range).send()?;
    
    let status = response.status();
    if !(status == StatusCode::OK || status == StatusCode::PARTIAL_CONTENT) {
      error_chain::bail!(&quot;Unexpected server response: {}&quot;, status)
    }
    std::io::copy(&amp;mut response, &amp;mut output_file)?;
  }
    
  let content = response.text()?;
  std::io::copy(&amp;mut content.as_bytes(), &amp;mut output_file)?;

  println!(&quot;Finished with success!&quot;);
  Ok(())
}
</code></pre></pre>
<h2><a class="header" href="#post-文件到-paste-rs" id="post-文件到-paste-rs">POST 文件到 paste-rs</a></h2>
<!--
> [web/clients/download/post-file.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/web/clients/download/post-file.md)
> <br />
> commit dd4efa8dcd8e611326caa01c08db8f227aa909d6 - 2020.06.07
-->
<p><a href="https://docs.rs/reqwest/"><img src="https://badge-cache.kominick.com/crates/v/reqwest.svg?label=reqwest" alt="reqwest-badge" /></a> <a href="https://crates.io/categories/network-programming"><img src="https://badge-cache.kominick.com/badge/net--x.svg?style=social" alt="cat-net-badge" /></a></p>
<p>本实例使用 <a href="https://docs.rs/reqwest/*/reqwest/struct.Client.html"><code>reqwest::Client</code></a> 建立与 https://paste.rs 的连接，遵循 <a href="https://docs.rs/reqwest/*/reqwest/struct.RequestBuilder.html"><code>reqwest::RequestBuilder</code></a> 结构体模式。调用 <a href="https://docs.rs/reqwest/*/reqwest/struct.Client.html#method.post"><code>Client::post</code></a> 方法，以 URL 为参数连接目标，<a href="https://docs.rs/reqwest/*/reqwest/struct.RequestBuilder.html#method.body"><code>RequestBuilder::body</code></a> 通过读取文件设置要发送的内容，<a href="https://docs.rs/reqwest/*/reqwest/struct.RequestBuilder.html#method.send"><code>RequestBuilder::send</code></a> 方法在文件上传过程中将一直阻塞，直到返回响应消息。最后，<a href="https://doc.rust-lang.org/std/io/trait.Read.html#method.read_to_string"><code>read_to_string</code></a> 返回响应消息并显示在控制台中。</p>
<pre><pre class="playground"><code class="language-rust edition2018 no_run">use error_chain::error_chain;
use std::fs::File;
use std::io::Read;

 error_chain! {
     foreign_links {
         HttpRequest(reqwest::Error);
         IoError(::std::io::Error);
     }
 }
 #[tokio::main]

async fn main() -&gt; Result&lt;()&gt; {
    let paste_api = &quot;https://paste.rs&quot;;
    let mut file = File::open(&quot;message&quot;)?;

    let mut contents = String::new();
    file.read_to_string(&amp;mut contents)?;

    let client = reqwest::Client::new();
    let res = client.post(paste_api)
        .body(contents)
        .send()
        .await?;
    let response_text = res.text().await?;
    println!(&quot;Your paste is located at: {}&quot;,response_text );
    Ok(())
}
</code></pre></pre>
<!--
> [links.md](https://github.com/rust-lang-nursery/rust-cookbook/blob/master/src/links.md)
> <br />
> commit - 7a06c79008f3998fc03d23c56aee885ddcf366ac - 2020.05.05
-->
<!--
Links, in a few categories. Follow the existing structure.
Keep lines sorted.
-->
<!-- Categories -->
<!-- Crates -->

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>

                    <script type="text/javascript" src="//static.budshome.com/js/bdubottom.js"></script>

                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        
        <script src="ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>
        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>
        
        

        <script type="text/javascript" src="//static.budshome.com/js/bdtj-bh.js"></script>
        <script type="text/javascript" src="//static.budshome.com/js/bdts.js"></script>
    </body>
</html>
